[["Map",1,2,9,10],"meta::meta",["Map",3,4,5,6,7,8],"astro-version","5.16.8","content-config-digest","28e7bc87492477d9","astro-config-digest","{\"root\":{},\"srcDir\":{},\"publicDir\":{},\"outDir\":{},\"cacheDir\":{},\"site\":\"https://jagreehal.github.io\",\"compressHTML\":true,\"base\":\"/\",\"trailingSlash\":\"ignore\",\"output\":\"static\",\"scopedStyleStrategy\":\"where\",\"build\":{\"format\":\"directory\",\"client\":{},\"server\":{},\"assets\":\"_astro\",\"serverEntry\":\"entry.mjs\",\"redirects\":true,\"inlineStylesheets\":\"auto\",\"concurrency\":1},\"server\":{\"open\":false,\"host\":false,\"port\":4321,\"streaming\":true,\"allowedHosts\":[]},\"redirects\":{},\"image\":{\"endpoint\":{\"route\":\"/_image\"},\"service\":{\"entrypoint\":\"astro/assets/services/sharp\",\"config\":{}},\"domains\":[],\"remotePatterns\":[],\"responsiveStyles\":false},\"devToolbar\":{\"enabled\":true},\"markdown\":{\"syntaxHighlight\":false,\"shikiConfig\":{\"langs\":[],\"langAlias\":{},\"theme\":\"github-dark\",\"themes\":{},\"wrap\":false,\"transformers\":[]},\"remarkPlugins\":[[null,{\"logger\":{\"options\":{\"dest\":{},\"level\":\"info\"},\"label\":\"astro-mermaid\"}}],null,null,null],\"rehypePlugins\":[[null,{\"logger\":{\"options\":{\"dest\":{},\"level\":\"info\"},\"label\":\"astro-mermaid\"}}],[null,{\"experimentalHeadingIdCompat\":false}],null,[null,{\"themes\":[\"vitesse-dark\",\"vitesse-light\"],\"defaultLocale\":\"en\",\"cascadeLayer\":\"starlight.components\",\"styleOverrides\":{\"borderRadius\":\"0.5rem\",\"borderWidth\":\"1px\",\"codePaddingBlock\":\"0.75rem\",\"codePaddingInline\":\"1rem\",\"codeFontFamily\":\"var(--__sl-font-mono)\",\"codeFontSize\":\"var(--sl-text-code)\",\"codeLineHeight\":\"var(--sl-line-height)\",\"uiFontFamily\":\"var(--__sl-font)\",\"textMarkers\":{\"lineDiffIndicatorMarginLeft\":\"0.25rem\",\"defaultChroma\":\"45\",\"backgroundOpacity\":\"60%\"},\"borderColor\":\"var(--sl-color-gray-5)\",\"frames\":{\"editorActiveTabIndicatorTopColor\":\"unset\",\"editorActiveTabIndicatorBottomColor\":\"var(--sl-color-gray-3)\",\"editorTabBarBorderBottomColor\":\"var(--sl-color-gray-5)\",\"frameBoxShadowCssValue\":\"unset\"}},\"plugins\":[{\"name\":\"Starlight Plugin\",\"hooks\":{}},{\"name\":\"astro-expressive-code\",\"hooks\":{}}]}]],\"remarkRehype\":{},\"gfm\":true,\"smartypants\":true},\"security\":{\"checkOrigin\":true,\"allowedDomains\":[]},\"env\":{\"schema\":{},\"validateSecrets\":false},\"experimental\":{\"clientPrerender\":false,\"contentIntellisense\":false,\"headingIdCompat\":false,\"preserveScriptOrder\":false,\"liveContentCollections\":false,\"csp\":false,\"staticImportMetaEnv\":false,\"chromeDevtoolsWorkspace\":false,\"failOnPrerenderConflict\":false,\"svgo\":false},\"legacy\":{\"collections\":false},\"prefetch\":{\"prefetchAll\":true},\"i18n\":{\"defaultLocale\":\"en\",\"locales\":[\"en\"],\"routing\":{\"prefixDefaultLocale\":false,\"redirectToDefaultLocale\":false,\"fallbackType\":\"redirect\"}}}","docs",["Map",11,12,40,41,85,86,126,127,178,179,232,233,285,286,340,341,423,424,471,472,521,522,572,573,621,622,668,669,730,731,771,772,818,819,867,868,925,926,970,971,1057,1058,1096,1097,1132,1133,1164,1165,1199,1200,1262,1263,1298,1299,1351,1352,1398,1399,1518,1519],"index",{"id":11,"data":13,"body":37,"filePath":38,"digest":39,"deferredRender":16},{"title":14,"description":15,"editUrl":16,"head":17,"template":18,"hero":19,"sidebar":34,"pagefind":16,"draft":35},"awaitly","Typed async workflows with Result types and automatic error inference",true,[],"splash",{"tagline":15,"actions":20},[21,28],{"text":22,"link":23,"variant":24,"icon":25},"Get Started","/getting-started/installation/","primary",{"type":26,"name":27},"icon","right-arrow",{"text":29,"link":30,"variant":31,"icon":32},"View on GitHub","https://github.com/jagreehal/awaitly","minimal",{"type":26,"name":33},"external",{"hidden":35,"attrs":36},false,{},"import { Card, CardGrid, LinkCard } from '@astrojs/starlight/components';\n\n## What it does\n\n- Wraps async operations in `Result\u003CT, E>` instead of try/catch\n- Infers error types from your dependencies automatically\n- Provides step caching, retries, and timeouts when you need them\n- Supports pause/resume for long-running workflows\n\n## Install\n\n```bash\nnpm install awaitly\n```\n\n## Basic example\n\n```typescript\nimport { ok, err, type AsyncResult } from 'awaitly';\nimport { createWorkflow } from 'awaitly/workflow';\n\n// Define operations that return Results\nconst fetchUser = async (id: string): AsyncResult\u003CUser, 'NOT_FOUND'> =>\n  id === '1' ? ok({ id, name: 'Alice' }) : err('NOT_FOUND');\n\n// Create workflow - error types are inferred\nconst workflow = createWorkflow({ fetchUser });\n\n// Run it\nconst result = await workflow(async (step) => {\n  const user = await step(fetchUser('1'));\n  return user;\n});\n\nif (result.ok) {\n  console.log(result.value.name);\n} else {\n  // TypeScript knows: result.error is 'NOT_FOUND' | UnexpectedError\n}\n```\n\n## When to use this\n\n\u003CCardGrid>\n  \u003CCard title=\"Typed errors with async/await\" icon=\"pencil\">\n    You want compile-time error checking without giving up familiar syntax\n  \u003C/Card>\n  \u003CCard title=\"Reliability primitives\" icon=\"setting\">\n    You need retries, timeouts, circuit breakers built into your workflow\n  \u003C/Card>\n  \u003CCard title=\"Long-running workflows\" icon=\"document\">\n    You're building workflows that pause for approval or persist across restarts\n  \u003C/Card>\n  \u003CCard title=\"Automatic error inference\" icon=\"approve-check\">\n    You want error types computed from dependencies, not maintained manually\n  \u003C/Card>\n\u003C/CardGrid>\n\n## When not to use this\n\n- **Simple scripts** - If you don't need typed errors, try/catch works fine\n- **Functional chaining preferred** - If you prefer `.andThen()` chains, consider [neverthrow](https://github.com/supermacro/neverthrow)\n- **Bundle size critical** - If you only need Result types without workflow features, a smaller library may suffice\n\n## Next steps\n\n\u003CCardGrid>\n  \u003CLinkCard title=\"Installation\" description=\"Install the package and set up your first project\" href=\"/getting-started/installation/\" />\n  \u003CLinkCard title=\"Your First Workflow\" description=\"Build a simple workflow in 5 minutes\" href=\"/getting-started/first-workflow/\" />\n  \u003CLinkCard title=\"Core Concepts\" description=\"Understand Results, Steps, and Workflows\" href=\"/concepts/results/\" />\n  \u003CLinkCard title=\"API Reference\" description=\"Full API documentation\" href=\"/reference/api/\" />\n\u003C/CardGrid>","src/content/docs/index.mdx","78d315034b8e6fa0","advanced/saga-compensation",{"id":40,"data":42,"body":49,"filePath":50,"digest":51,"rendered":52},{"title":43,"description":44,"editUrl":16,"head":45,"template":46,"sidebar":47,"pagefind":16,"draft":35},"Saga / Compensation","Define compensating actions for rollback on failures",[],"doc",{"hidden":35,"attrs":48},{},"Define compensating actions for steps that need rollback on downstream failures. When a step fails, compensations run in reverse order.\n\n## Basic usage\n\n```typescript\nimport { createSagaWorkflow, isSagaCompensationError } from 'awaitly/saga';\n\n// Create saga with deps (error types inferred automatically)\nconst checkoutSaga = createSagaWorkflow(\n  { reserveInventory, chargeCard, sendConfirmation },\n  { onEvent: (event) => console.log(event) }\n);\n\nconst result = await checkoutSaga(async (saga, deps) => {\n  // Reserve inventory with compensation\n  const reservation = await saga.step(\n    () => deps.reserveInventory(items),\n    {\n      name: 'reserve-inventory',\n      compensate: (res) => releaseInventory(res.reservationId),\n    }\n  );\n\n  // Charge card with compensation\n  const payment = await saga.step(\n    () => deps.chargeCard(amount),\n    {\n      name: 'charge-card',\n      compensate: (p) => refundPayment(p.transactionId),\n    }\n  );\n\n  // If sendConfirmation fails, compensations run in reverse order:\n  // 1. refundPayment(payment.transactionId)\n  // 2. releaseInventory(reservation.reservationId)\n  await saga.step(\n    () => deps.sendConfirmation(email),\n    { name: 'send-confirmation' }\n  );\n\n  return { reservation, payment };\n});\n```\n\n## Compensation order\n\nCompensations run in reverse order of completion (LIFO):\n\n```\nStep 1: reserve-inventory ✓\nStep 2: charge-card ✓\nStep 3: send-confirmation ✗\n\nCompensation order:\n1. refund charge-card\n2. release reserve-inventory\n```\n\n## Handling compensation errors\n\n```typescript\nif (!result.ok && isSagaCompensationError(result.error)) {\n  console.log('Saga failed, compensations may have partially succeeded');\n  console.log('Compensation errors:', result.error.compensationErrors);\n  // Manual intervention may be needed\n}\n```\n\n## Steps without compensation\n\nNot every step needs compensation:\n\n```typescript\nconst result = await checkoutSaga(async (saga, deps) => {\n  // No compensation needed for reads\n  const user = await saga.step(\n    () => deps.fetchUser(userId),\n    { name: 'fetch-user' }\n  );\n\n  // Needs compensation\n  const payment = await saga.step(\n    () => deps.chargeCard(amount),\n    {\n      name: 'charge-card',\n      compensate: (p) => deps.refundPayment(p.transactionId),\n    }\n  );\n\n  // Idempotent operation - no compensation\n  await saga.step(\n    () => deps.sendEmail(user.email),\n    { name: 'send-email' }\n  );\n\n  return { payment };\n});\n```\n\n## tryStep for throwing code\n\nUse `tryStep` to catch exceptions from external libraries:\n\n```typescript\nimport { runSaga } from 'awaitly/saga';\n\nconst result = await runSaga\u003COrderResult, OrderError>(async (saga) => {\n  const reservation = await saga.step(\n    () => reserveInventory(items),\n    { compensate: (res) => releaseInventory(res.id) }\n  );\n\n  // tryStep catches throws and converts to error\n  const payment = await saga.tryStep(\n    () => externalPaymentApi.charge(amount), // May throw\n    {\n      error: 'PAYMENT_FAILED' as const,\n      compensate: (p) => externalPaymentApi.refund(p.txId),\n    }\n  );\n\n  return { reservation, payment };\n});\n```\n\n## Low-level runSaga\n\nFor explicit error typing without deps-based inference:\n\n```typescript\nimport { runSaga } from 'awaitly/saga';\n\ntype CheckoutResult = { orderId: string; chargeId: string };\ntype CheckoutError = 'INVENTORY_UNAVAILABLE' | 'PAYMENT_FAILED' | 'SEND_FAILED';\n\nconst result = await runSaga\u003CCheckoutResult, CheckoutError>(async (saga) => {\n  const reservation = await saga.step(\n    () => reserveInventory(items),\n    { compensate: (res) => releaseInventory(res.id) }\n  );\n\n  const charge = await saga.step(\n    () => chargeCard(amount),\n    { compensate: (c) => refundCharge(c.id) }\n  );\n\n  await saga.step(() => sendConfirmation(email));\n\n  return { orderId: reservation.id, chargeId: charge.id };\n});\n```\n\n## Real-world example: Order fulfillment\n\n```typescript\nconst fulfillOrder = createSagaWorkflow({\n  reserveStock,\n  createShipment,\n  chargePayment,\n  updateOrder,\n  notifyCustomer,\n});\n\nconst result = await fulfillOrder(async (saga, deps) => {\n  // Reserve inventory\n  const stock = await saga.step(\n    () => deps.reserveStock(order.items),\n    {\n      name: 'reserve-stock',\n      compensate: (s) => deps.releaseStock(s.reservationId),\n    }\n  );\n\n  // Create shipment record\n  const shipment = await saga.step(\n    () => deps.createShipment(order.address, stock),\n    {\n      name: 'create-shipment',\n      compensate: (s) => deps.cancelShipment(s.trackingId),\n    }\n  );\n\n  // Charge customer\n  const payment = await saga.step(\n    () => deps.chargePayment(order.total, order.paymentMethod),\n    {\n      name: 'charge-payment',\n      compensate: (p) => deps.refundPayment(p.transactionId),\n    }\n  );\n\n  // Update order status (idempotent, no compensation)\n  await saga.step(\n    () => deps.updateOrder(order.id, { status: 'FULFILLED', shipment, payment }),\n    { name: 'update-order' }\n  );\n\n  // Notify customer (can't really undo this)\n  await saga.step(\n    () => deps.notifyCustomer(order.customerId, { shipment, payment }),\n    { name: 'notify-customer' }\n  );\n\n  return { shipment, payment };\n});\n\nif (!result.ok) {\n  if (isSagaCompensationError(result.error)) {\n    // Log for manual review\n    await alertOps('Saga compensation had errors', result.error);\n  }\n}\n```\n\n## Best practices\n\n1. **Compensations should be idempotent** - They may run multiple times on retries\n2. **Not everything needs compensation** - Read operations and truly idempotent writes don't\n3. **Plan for compensation failures** - Have alerting and manual recovery procedures\n4. **Keep compensations simple** - Complex compensation logic is a code smell\n5. **Test the failure paths** - Saga value comes from handling failures correctly","src/content/docs/advanced/saga-compensation.md","867a0561bd5a6144",{"html":53,"metadata":54},"\u003Cp>Define compensating actions for steps that need rollback on downstream failures. When a step fails, compensations run in reverse order.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"basic-usage\">Basic usage\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#basic-usage\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Basic usage”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createSagaWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isSagaCompensationError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/saga\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create saga with deps (error types inferred automatically)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">checkoutSaga\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createSagaWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reserveInventory\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">sendConfirmation\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">checkoutSaga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Reserve inventory with compensation\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reservation\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">reserveInventory\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">reserve-inventory\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">compensate\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">releaseInventory\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reservationId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Charge card with compensation\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">charge-card\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">compensate\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">refundPayment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">transactionId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// If sendConfirmation fails, compensations run in reverse order:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 1. refundPayment(payment.transactionId)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 2. releaseInventory(reservation.reservationId)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">sendConfirmation\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">email\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">send-confirmation\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reservation\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createSagaWorkflow, isSagaCompensationError } from &#x27;awaitly/saga&#x27;;// Create saga with deps (error types inferred automatically)const checkoutSaga = createSagaWorkflow(  { reserveInventory, chargeCard, sendConfirmation },  { onEvent: (event) => console.log(event) });const result = await checkoutSaga(async (saga, deps) => {  // Reserve inventory with compensation  const reservation = await saga.step(    () => deps.reserveInventory(items),    {      name: &#x27;reserve-inventory&#x27;,      compensate: (res) => releaseInventory(res.reservationId),    }  );  // Charge card with compensation  const payment = await saga.step(    () => deps.chargeCard(amount),    {      name: &#x27;charge-card&#x27;,      compensate: (p) => refundPayment(p.transactionId),    }  );  // If sendConfirmation fails, compensations run in reverse order:  // 1. refundPayment(payment.transactionId)  // 2. releaseInventory(reservation.reservationId)  await saga.step(    () => deps.sendConfirmation(email),    { name: &#x27;send-confirmation&#x27; }  );  return { reservation, payment };});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"compensation-order\">Compensation order\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#compensation-order\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Compensation order”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Compensations run in reverse order of completion (LIFO):\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#dbd7caee;--1:#393a34\">Step 1: reserve-inventory ✓\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#dbd7caee;--1:#393a34\">Step 2: charge-card ✓\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#dbd7caee;--1:#393a34\">Step 3: send-confirmation ✗\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#dbd7caee;--1:#393a34\">Compensation order:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#dbd7caee;--1:#393a34\">1. refund charge-card\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#dbd7caee;--1:#393a34\">2. release reserve-inventory\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"Step 1: reserve-inventory ✓Step 2: charge-card ✓Step 3: send-confirmation ✗Compensation order:1. refund charge-card2. release reserve-inventory\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"handling-compensation-errors\">Handling compensation errors\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#handling-compensation-errors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Handling compensation errors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">&#x26;&#x26;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isSagaCompensationError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Saga failed, compensations may have partially succeeded\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Compensation errors:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">compensationErrors\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Manual intervention may be needed\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"if (!result.ok &#x26;&#x26; isSagaCompensationError(result.error)) {  console.log(&#x27;Saga failed, compensations may have partially succeeded&#x27;);  console.log(&#x27;Compensation errors:&#x27;, result.error.compensationErrors);  // Manual intervention may be needed}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"steps-without-compensation\">Steps without compensation\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#steps-without-compensation\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Steps without compensation”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Not every step needs compensation:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">checkoutSaga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// No compensation needed for reads\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">userId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">fetch-user\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Needs compensation\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">charge-card\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">compensate\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">refundPayment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">transactionId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Idempotent operation - no compensation\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">sendEmail\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">email\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">send-email\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await checkoutSaga(async (saga, deps) => {  // No compensation needed for reads  const user = await saga.step(    () => deps.fetchUser(userId),    { name: &#x27;fetch-user&#x27; }  );  // Needs compensation  const payment = await saga.step(    () => deps.chargeCard(amount),    {      name: &#x27;charge-card&#x27;,      compensate: (p) => deps.refundPayment(p.transactionId),    }  );  // Idempotent operation - no compensation  await saga.step(    () => deps.sendEmail(user.email),    { name: &#x27;send-email&#x27; }  );  return { payment };});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"trystep-for-throwing-code\">tryStep for throwing code\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#trystep-for-throwing-code\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “tryStep for throwing code”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">tryStep\u003C/code> to catch exceptions from external libraries:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">runSaga\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/saga\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">runSaga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">OrderResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">OrderError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reservation\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">reserveInventory\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">compensate\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">releaseInventory\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// tryStep catches throws and converts to error\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">tryStep\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">externalPaymentApi\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// May throw\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">PAYMENT_FAILED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">as\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">compensate\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">externalPaymentApi\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">refund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">txId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reservation\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { runSaga } from &#x27;awaitly/saga&#x27;;const result = await runSaga\u003COrderResult, OrderError>(async (saga) => {  const reservation = await saga.step(    () => reserveInventory(items),    { compensate: (res) => releaseInventory(res.id) }  );  // tryStep catches throws and converts to error  const payment = await saga.tryStep(    () => externalPaymentApi.charge(amount), // May throw    {      error: &#x27;PAYMENT_FAILED&#x27; as const,      compensate: (p) => externalPaymentApi.refund(p.txId),    }  );  return { reservation, payment };});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"low-level-runsaga\">Low-level runSaga\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#low-level-runsaga\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Low-level runSaga”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>For explicit error typing without deps-based inference:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">runSaga\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/saga\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">CheckoutResult\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">orderId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">chargeId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">CheckoutError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">INVENTORY_UNAVAILABLE\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">|\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">PAYMENT_FAILED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">|\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">SEND_FAILED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">runSaga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">CheckoutResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">CheckoutError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reservation\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">reserveInventory\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">compensate\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">releaseInventory\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">compensate\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">c\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">refundCharge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">c\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">sendConfirmation\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">email\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">orderId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reservation\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">chargeId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { runSaga } from &#x27;awaitly/saga&#x27;;type CheckoutResult = { orderId: string; chargeId: string };type CheckoutError = &#x27;INVENTORY_UNAVAILABLE&#x27; | &#x27;PAYMENT_FAILED&#x27; | &#x27;SEND_FAILED&#x27;;const result = await runSaga\u003CCheckoutResult, CheckoutError>(async (saga) => {  const reservation = await saga.step(    () => reserveInventory(items),    { compensate: (res) => releaseInventory(res.id) }  );  const charge = await saga.step(    () => chargeCard(amount),    { compensate: (c) => refundCharge(c.id) }  );  await saga.step(() => sendConfirmation(email));  return { orderId: reservation.id, chargeId: charge.id };});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"real-world-example-order-fulfillment\">Real-world example: Order fulfillment\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#real-world-example-order-fulfillment\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Real-world example: Order fulfillment”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fulfillOrder\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createSagaWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reserveStock\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createShipment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">chargePayment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">updateOrder\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">notifyCustomer\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fulfillOrder\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Reserve inventory\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stock\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">reserveStock\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">reserve-stock\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">compensate\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">s\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">releaseStock\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">s\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reservationId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create shipment record\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">shipment\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createShipment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">address\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stock\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">create-shipment\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">compensate\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">s\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">cancelShipment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">s\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">trackingId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Charge customer\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">chargePayment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">total\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">paymentMethod\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">charge-payment\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">compensate\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">refundPayment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">transactionId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Update order status (idempotent, no compensation)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">updateOrder\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">FULFILLED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">shipment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">update-order\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Notify customer (can't really undo this)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">notifyCustomer\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">customerId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">shipment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">notify-customer\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">shipment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isSagaCompensationError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Log for manual review\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">alertOps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Saga compensation had errors\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const fulfillOrder = createSagaWorkflow({  reserveStock,  createShipment,  chargePayment,  updateOrder,  notifyCustomer,});const result = await fulfillOrder(async (saga, deps) => {  // Reserve inventory  const stock = await saga.step(    () => deps.reserveStock(order.items),    {      name: &#x27;reserve-stock&#x27;,      compensate: (s) => deps.releaseStock(s.reservationId),    }  );  // Create shipment record  const shipment = await saga.step(    () => deps.createShipment(order.address, stock),    {      name: &#x27;create-shipment&#x27;,      compensate: (s) => deps.cancelShipment(s.trackingId),    }  );  // Charge customer  const payment = await saga.step(    () => deps.chargePayment(order.total, order.paymentMethod),    {      name: &#x27;charge-payment&#x27;,      compensate: (p) => deps.refundPayment(p.transactionId),    }  );  // Update order status (idempotent, no compensation)  await saga.step(    () => deps.updateOrder(order.id, { status: &#x27;FULFILLED&#x27;, shipment, payment }),    { name: &#x27;update-order&#x27; }  );  // Notify customer (can&#x27;t really undo this)  await saga.step(    () => deps.notifyCustomer(order.customerId, { shipment, payment }),    { name: &#x27;notify-customer&#x27; }  );  return { shipment, payment };});if (!result.ok) {  if (isSagaCompensationError(result.error)) {    // Log for manual review    await alertOps(&#x27;Saga compensation had errors&#x27;, result.error);  }}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"best-practices\">Best practices\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#best-practices\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Best practices”\u003C/span>\u003C/a>\u003C/div>\n\u003Col>\n\u003Cli>\u003Cstrong>Compensations should be idempotent\u003C/strong> - They may run multiple times on retries\u003C/li>\n\u003Cli>\u003Cstrong>Not everything needs compensation\u003C/strong> - Read operations and truly idempotent writes don’t\u003C/li>\n\u003Cli>\u003Cstrong>Plan for compensation failures\u003C/strong> - Have alerting and manual recovery procedures\u003C/li>\n\u003Cli>\u003Cstrong>Keep compensations simple\u003C/strong> - Complex compensation logic is a code smell\u003C/li>\n\u003Cli>\u003Cstrong>Test the failure paths\u003C/strong> - Saga value comes from handling failures correctly\u003C/li>\n\u003C/ol>",{"headings":55,"localImagePaths":81,"remoteImagePaths":82,"frontmatter":83,"imagePaths":84},[56,60,63,66,69,72,75,78],{"depth":57,"slug":58,"text":59},2,"basic-usage","Basic usage",{"depth":57,"slug":61,"text":62},"compensation-order","Compensation order",{"depth":57,"slug":64,"text":65},"handling-compensation-errors","Handling compensation errors",{"depth":57,"slug":67,"text":68},"steps-without-compensation","Steps without compensation",{"depth":57,"slug":70,"text":71},"trystep-for-throwing-code","tryStep for throwing code",{"depth":57,"slug":73,"text":74},"low-level-runsaga","Low-level runSaga",{"depth":57,"slug":76,"text":77},"real-world-example-order-fulfillment","Real-world example: Order fulfillment",{"depth":57,"slug":79,"text":80},"best-practices","Best practices",[],[],{"title":43,"description":44},[],"advanced/circuit-breaker",{"id":85,"data":87,"body":93,"filePath":94,"digest":95,"rendered":96},{"title":88,"description":89,"editUrl":16,"head":90,"template":46,"sidebar":91,"pagefind":16,"draft":35},"Circuit Breaker","Prevent cascading failures with failure tracking",[],{"hidden":35,"attrs":92},{},"Prevent cascading failures by tracking step failure rates and short-circuiting calls when a threshold is exceeded.\n\n## Basic usage\n\n```typescript\nimport { ok } from 'awaitly';\nimport {\n  createCircuitBreaker,\n  isCircuitOpenError,\n  circuitBreakerPresets,\n} from 'awaitly/circuit-breaker';\n\n// Create a circuit breaker (name is required)\nconst breaker = createCircuitBreaker('external-api', {\n  failureThreshold: 5,      // Open after 5 failures\n  resetTimeout: 30000,      // Try again after 30 seconds\n  halfOpenMax: 3,           // Allow 3 test requests in half-open state\n  windowSize: 60000,        // Count failures within this window (1 minute)\n});\n\n// Execute with the breaker\ntry {\n  const data = await breaker.execute(async () => {\n    return await fetchFromExternalApi();\n  });\n  console.log('Got data:', data);\n} catch (error) {\n  if (isCircuitOpenError(error)) {\n    console.log(`Circuit is open, retry after ${error.retryAfterMs}ms`);\n  } else {\n    console.log('Operation failed:', error);\n  }\n}\n```\n\n## Using presets\n\n```typescript\nimport { createCircuitBreaker, circuitBreakerPresets } from 'awaitly/circuit-breaker';\n\n// For critical services - opens quickly, recovers slowly\nconst criticalBreaker = createCircuitBreaker(\n  'payment-api',\n  circuitBreakerPresets.critical\n);\n\n// For lenient services - tolerates more failures\nconst lenientBreaker = createCircuitBreaker(\n  'recommendation-api',\n  circuitBreakerPresets.lenient\n);\n```\n\n## Result-returning operations\n\nUse `executeResult` instead of `execute` if your operation returns a `Result`:\n\n```typescript\nconst result = await breaker.executeResult(async () => {\n  return ok(await fetchFromExternalApi());\n});\n\nif (!result.ok) {\n  if (isCircuitOpenError(result.error)) {\n    console.log('Circuit is open, try again later');\n  }\n}\n```\n\n## Circuit states\n\nThe circuit breaker has three states:\n\n| State | Description |\n|-------|-------------|\n| `CLOSED` | Normal operation. Failures are tracked. |\n| `OPEN` | Circuit tripped. All calls fail immediately. |\n| `HALF_OPEN` | Testing recovery. Limited calls allowed. |\n\n```typescript\nconst stats = breaker.getStats();\nconsole.log(stats.state);          // 'CLOSED' | 'OPEN' | 'HALF_OPEN'\nconsole.log(stats.failureCount);   // Failures in current window\nconsole.log(stats.successCount);   // Successes in current window\nconsole.log(stats.halfOpenSuccesses); // Successful test calls\n```\n\n## State transitions\n\n```\nCLOSED → OPEN: When failureThreshold is reached\nOPEN → HALF_OPEN: After resetTimeout elapses\nHALF_OPEN → CLOSED: After halfOpenMax successes\nHALF_OPEN → OPEN: On any failure\n```\n\n## In workflows\n\n```typescript\nconst breaker = createCircuitBreaker('api', circuitBreakerPresets.standard);\n\nconst result = await workflow(async (step) => {\n  const data = await step(async () => {\n    const apiResult = await breaker.executeResult(() =>\n      ok(await externalApi.fetch())\n    );\n    return apiResult;\n  });\n\n  return data;\n});\n```\n\n## Multiple services\n\nCreate separate breakers for independent failure domains:\n\n```typescript\nconst paymentBreaker = createCircuitBreaker('payment', {\n  failureThreshold: 3,\n  resetTimeout: 60000, // Conservative for payments\n});\n\nconst inventoryBreaker = createCircuitBreaker('inventory', {\n  failureThreshold: 10,\n  resetTimeout: 10000, // Can recover faster\n});\n\nconst emailBreaker = createCircuitBreaker('email', {\n  failureThreshold: 20,\n  resetTimeout: 5000, // Non-critical, aggressive recovery\n});\n```\n\n## Configuration reference\n\n```typescript\n{\n  failureThreshold: number;  // Failures before opening (required)\n  resetTimeout: number;      // Ms before half-open (required)\n  halfOpenMax?: number;      // Test calls allowed (default: 1)\n  windowSize?: number;       // Failure counting window (default: 60000)\n}\n```","src/content/docs/advanced/circuit-breaker.md","250527e201f45735",{"html":97,"metadata":98},"\u003Cp>Prevent cascading failures by tracking step failure rates and short-circuiting calls when a threshold is exceeded.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"basic-usage\">Basic usage\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#basic-usage\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Basic usage”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createCircuitBreaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isCircuitOpenError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">circuitBreakerPresets\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/circuit-breaker\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create a circuit breaker (name is required)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">breaker\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createCircuitBreaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">external-api\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">failureThreshold\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Open after 5 failures\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">resetTimeout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">30000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Try again after 30 seconds\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">halfOpenMax\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,           \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Allow 3 test requests in half-open state\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">windowSize\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">60000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Count failures within this window (1 minute)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Execute with the breaker\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">try\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">breaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">execute\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchFromExternalApi\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Got data:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">catch\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isCircuitOpenError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Circuit is open, retry after \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">retryAfterMs\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">ms\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">else\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Operation failed:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { ok } from &#x27;awaitly&#x27;;import {  createCircuitBreaker,  isCircuitOpenError,  circuitBreakerPresets,} from &#x27;awaitly/circuit-breaker&#x27;;// Create a circuit breaker (name is required)const breaker = createCircuitBreaker(&#x27;external-api&#x27;, {  failureThreshold: 5,      // Open after 5 failures  resetTimeout: 30000,      // Try again after 30 seconds  halfOpenMax: 3,           // Allow 3 test requests in half-open state  windowSize: 60000,        // Count failures within this window (1 minute)});// Execute with the breakertry {  const data = await breaker.execute(async () => {    return await fetchFromExternalApi();  });  console.log(&#x27;Got data:&#x27;, data);} catch (error) {  if (isCircuitOpenError(error)) {    console.log(&#x60;Circuit is open, retry after ${error.retryAfterMs}ms&#x60;);  } else {    console.log(&#x27;Operation failed:&#x27;, error);  }}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"using-presets\">Using presets\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#using-presets\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Using presets”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createCircuitBreaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">circuitBreakerPresets\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/circuit-breaker\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// For critical services - opens quickly, recovers slowly\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">criticalBreaker\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createCircuitBreaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">payment-api\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">circuitBreakerPresets\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">critical\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// For lenient services - tolerates more failures\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">lenientBreaker\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createCircuitBreaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">recommendation-api\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">circuitBreakerPresets\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">lenient\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createCircuitBreaker, circuitBreakerPresets } from &#x27;awaitly/circuit-breaker&#x27;;// For critical services - opens quickly, recovers slowlyconst criticalBreaker = createCircuitBreaker(  &#x27;payment-api&#x27;,  circuitBreakerPresets.critical);// For lenient services - tolerates more failuresconst lenientBreaker = createCircuitBreaker(  &#x27;recommendation-api&#x27;,  circuitBreakerPresets.lenient);\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"result-returning-operations\">Result-returning operations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#result-returning-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Result-returning operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">executeResult\u003C/code> instead of \u003Ccode dir=\"auto\">execute\u003C/code> if your operation returns a \u003Ccode dir=\"auto\">Result\u003C/code>:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">breaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">executeResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchFromExternalApi\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isCircuitOpenError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Circuit is open, try again later\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await breaker.executeResult(async () => {  return ok(await fetchFromExternalApi());});if (!result.ok) {  if (isCircuitOpenError(result.error)) {    console.log(&#x27;Circuit is open, try again later&#x27;);  }}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"circuit-states\">Circuit states\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#circuit-states\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Circuit states”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>The circuit breaker has three states:\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>State\u003C/th>\u003Cth>Description\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">CLOSED\u003C/code>\u003C/td>\u003Ctd>Normal operation. Failures are tracked.\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">OPEN\u003C/code>\u003C/td>\u003Ctd>Circuit tripped. All calls fail immediately.\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">HALF_OPEN\u003C/code>\u003C/td>\u003Ctd>Testing recovery. Limited calls allowed.\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stats\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">breaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getStats\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stats\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">          \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 'CLOSED' | 'OPEN' | 'HALF_OPEN'\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stats\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">failureCount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">   \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Failures in current window\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stats\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">successCount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">   \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Successes in current window\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stats\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">halfOpenSuccesses\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Successful test calls\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const stats = breaker.getStats();console.log(stats.state);          // &#x27;CLOSED&#x27; | &#x27;OPEN&#x27; | &#x27;HALF_OPEN&#x27;console.log(stats.failureCount);   // Failures in current windowconsole.log(stats.successCount);   // Successes in current windowconsole.log(stats.halfOpenSuccesses); // Successful test calls\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"state-transitions\">State transitions\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#state-transitions\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “State transitions”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#dbd7caee;--1:#393a34\">CLOSED → OPEN: When failureThreshold is reached\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#dbd7caee;--1:#393a34\">OPEN → HALF_OPEN: After resetTimeout elapses\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#dbd7caee;--1:#393a34\">HALF_OPEN → CLOSED: After halfOpenMax successes\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#dbd7caee;--1:#393a34\">HALF_OPEN → OPEN: On any failure\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"CLOSED → OPEN: When failureThreshold is reachedOPEN → HALF_OPEN: After resetTimeout elapsesHALF_OPEN → CLOSED: After halfOpenMax successesHALF_OPEN → OPEN: On any failure\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"in-workflows\">In workflows\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#in-workflows\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “In workflows”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">breaker\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createCircuitBreaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">api\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">circuitBreakerPresets\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">standard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">apiResult\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">breaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">executeResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">externalApi\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetch\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">())\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">apiResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const breaker = createCircuitBreaker(&#x27;api&#x27;, circuitBreakerPresets.standard);const result = await workflow(async (step) => {  const data = await step(async () => {    const apiResult = await breaker.executeResult(() =>      ok(await externalApi.fetch())    );    return apiResult;  });  return data;});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"multiple-services\">Multiple services\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#multiple-services\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Multiple services”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Create separate breakers for independent failure domains:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">paymentBreaker\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createCircuitBreaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">payment\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">failureThreshold\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">resetTimeout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">60000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Conservative for payments\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">inventoryBreaker\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createCircuitBreaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">inventory\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">failureThreshold\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">10\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">resetTimeout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">10000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Can recover faster\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">emailBreaker\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createCircuitBreaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">email\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">failureThreshold\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">20\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">resetTimeout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Non-critical, aggressive recovery\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const paymentBreaker = createCircuitBreaker(&#x27;payment&#x27;, {  failureThreshold: 3,  resetTimeout: 60000, // Conservative for payments});const inventoryBreaker = createCircuitBreaker(&#x27;inventory&#x27;, {  failureThreshold: 10,  resetTimeout: 10000, // Can recover faster});const emailBreaker = createCircuitBreaker(&#x27;email&#x27;, {  failureThreshold: 20,  resetTimeout: 5000, // Non-critical, aggressive recovery});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"configuration-reference\">Configuration reference\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#configuration-reference\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Configuration reference”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">failureThreshold\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Failures before opening (required)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">resetTimeout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Ms before half-open (required)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">halfOpenMax\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Test calls allowed (default: 1)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">windowSize\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">       \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Failure counting window (default: 60000)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"{  failureThreshold: number;  // Failures before opening (required)  resetTimeout: number;      // Ms before half-open (required)  halfOpenMax?: number;      // Test calls allowed (default: 1)  windowSize?: number;       // Failure counting window (default: 60000)}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>",{"headings":99,"localImagePaths":122,"remoteImagePaths":123,"frontmatter":124,"imagePaths":125},[100,101,104,107,110,113,116,119],{"depth":57,"slug":58,"text":59},{"depth":57,"slug":102,"text":103},"using-presets","Using presets",{"depth":57,"slug":105,"text":106},"result-returning-operations","Result-returning operations",{"depth":57,"slug":108,"text":109},"circuit-states","Circuit states",{"depth":57,"slug":111,"text":112},"state-transitions","State transitions",{"depth":57,"slug":114,"text":115},"in-workflows","In workflows",{"depth":57,"slug":117,"text":118},"multiple-services","Multiple services",{"depth":57,"slug":120,"text":121},"configuration-reference","Configuration reference",[],[],{"title":88,"description":89},[],"advanced/opentelemetry",{"id":126,"data":128,"body":134,"filePath":135,"digest":136,"rendered":137},{"title":129,"description":130,"editUrl":16,"head":131,"template":46,"sidebar":132,"pagefind":16,"draft":35},"OpenTelemetry","Observability with traces and metrics",[],{"hidden":35,"attrs":133},{},"First-class OpenTelemetry metrics from the workflow event stream.\n\n## Autotel adapter\n\nCreate an adapter that tracks metrics and optionally creates spans:\n\n```typescript\nimport { createWorkflow } from 'awaitly/workflow';\nimport { createAutotelAdapter } from 'awaitly/otel';\n\nconst autotel = createAutotelAdapter({\n  serviceName: 'checkout-service',\n  createStepSpans: true,        // Create spans for each step\n  recordMetrics: true,          // Record step metrics\n  recordRetryEvents: true,      // Record retry events\n  markErrorsOnSpan: true,       // Mark errors on spans\n  defaultAttributes: {          // Custom attributes for all spans\n    environment: 'production',\n  },\n});\n\n// Use with workflow\nconst workflow = createWorkflow(deps, {\n  onEvent: autotel.handleEvent,\n});\n\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser(id), { name: 'fetch-user' });\n  const charge = await step(() => chargeCard(100), { name: 'charge-card' });\n  return { user, charge };\n});\n```\n\n## Access metrics\n\n```typescript\nconst metrics = autotel.getMetrics();\n\nconsole.log(metrics.stepDurations);\n// [{ name: 'fetch-user', durationMs: 45, success: true }, ...]\n\nconsole.log(metrics.retryCount);     // Total retry count\nconsole.log(metrics.errorCount);     // Total error count\nconsole.log(metrics.cacheHits);      // Cache hit count\nconsole.log(metrics.cacheMisses);    // Cache miss count\n```\n\n## Simple event handler\n\nFor debug logging without full metrics collection:\n\n```typescript\nimport { createWorkflow } from 'awaitly/workflow';\nimport { createAutotelEventHandler } from 'awaitly/otel';\n\nconst workflow = createWorkflow(deps, {\n  onEvent: createAutotelEventHandler({\n    serviceName: 'checkout',\n    includeStepDetails: true,\n  }),\n});\n\n// Set AUTOTEL_DEBUG=true to see console output\n```\n\n## With autotel tracing\n\nWrap workflows with actual OpenTelemetry spans:\n\n```typescript\nimport { withAutotelTracing } from 'awaitly/otel';\nimport { trace } from 'autotel';\n\nconst traced = withAutotelTracing(trace, { serviceName: 'checkout' });\n\nconst result = await traced('process-order', async () => {\n  return workflow(async (step) => {\n    const user = await step(() => fetchUser(id), { name: 'fetch-user' });\n    const charge = await step(() => chargeCard(100), { name: 'charge' });\n    return { user, charge };\n  });\n}, { orderId: '123' }); // Optional attributes\n```\n\n## Configuration options\n\n```typescript\n{\n  serviceName: string;           // Required: identifies the service\n  createStepSpans?: boolean;     // Create spans for steps (default: false)\n  recordMetrics?: boolean;       // Collect metrics (default: true)\n  recordRetryEvents?: boolean;   // Track retries (default: true)\n  markErrorsOnSpan?: boolean;    // Mark errors on spans (default: true)\n  defaultAttributes?: Record\u003Cstring, string>; // Added to all spans\n}\n```\n\n## Span attributes\n\nWhen `createStepSpans` is enabled, spans include:\n\n| Attribute | Description |\n|-----------|-------------|\n| `workflow.step.name` | Step name from options |\n| `workflow.step.key` | Step cache key (if set) |\n| `workflow.step.cached` | Whether result was cached |\n| `workflow.step.retry_count` | Number of retries |\n| `workflow.step.duration_ms` | Step duration |\n| `workflow.step.success` | Whether step succeeded |\n| `workflow.step.error` | Error type (if failed) |\n\n## Multiple workflows\n\nCreate separate adapters for different workflows:\n\n```typescript\nconst checkoutTelemetry = createAutotelAdapter({\n  serviceName: 'checkout-service',\n  defaultAttributes: { workflow: 'checkout' },\n});\n\nconst inventoryTelemetry = createAutotelAdapter({\n  serviceName: 'inventory-service',\n  defaultAttributes: { workflow: 'inventory' },\n});\n\nconst checkoutWorkflow = createWorkflow(checkoutDeps, {\n  onEvent: checkoutTelemetry.handleEvent,\n});\n\nconst inventoryWorkflow = createWorkflow(inventoryDeps, {\n  onEvent: inventoryTelemetry.handleEvent,\n});\n```\n\n## Combining with other event handlers\n\n```typescript\nimport { createWorkflow } from 'awaitly/workflow';\nimport { createAutotelAdapter, createVisualizer } from 'awaitly/otel';\n\nconst autotel = createAutotelAdapter({ serviceName: 'checkout' });\nconst viz = createVisualizer({ workflowName: 'checkout' });\n\nconst workflow = createWorkflow(deps, {\n  onEvent: (event) => {\n    autotel.handleEvent(event);\n    viz.handleEvent(event);\n  },\n});\n```\n\n## Custom metrics\n\nExtend the adapter output with your own metrics:\n\n```typescript\nconst autotel = createAutotelAdapter({ serviceName: 'checkout' });\n\nconst workflow = createWorkflow(deps, {\n  onEvent: (event) => {\n    autotel.handleEvent(event);\n\n    // Custom metric tracking\n    if (event.type === 'step_complete' && !event.result.ok) {\n      customMetrics.increment('checkout.step.failures', {\n        step: event.stepName,\n        error: String(event.result.error),\n      });\n    }\n  },\n});\n```\n\n## Environment variables\n\n| Variable | Description |\n|----------|-------------|\n| `AUTOTEL_DEBUG` | Set to `true` for console output |\n| `OTEL_SERVICE_NAME` | Default service name (overridden by config) |\n\n## Integration with OTEL collectors\n\nThe adapter works with standard OpenTelemetry collectors. Configure your collector endpoint:\n\n```typescript\nimport { trace } from 'autotel';\n\n// Configure your OTEL exporter\ntrace.configure({\n  endpoint: process.env.OTEL_EXPORTER_OTLP_ENDPOINT,\n  headers: {\n    'api-key': process.env.OTEL_API_KEY,\n  },\n});\n\nconst traced = withAutotelTracing(trace, { serviceName: 'checkout' });\n```","src/content/docs/advanced/opentelemetry.md","c0c18418b8adeaad",{"html":138,"metadata":139},"\u003Cp>First-class OpenTelemetry metrics from the workflow event stream.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"autotel-adapter\">Autotel adapter\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#autotel-adapter\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Autotel adapter”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Create an adapter that tracks metrics and optionally creates spans:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createAutotelAdapter\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/otel\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">autotel\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createAutotelAdapter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">serviceName\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">checkout-service\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">createStepSpans\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create spans for each step\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">recordMetrics\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,          \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Record step metrics\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">recordRetryEvents\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Record retry events\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">markErrorsOnSpan\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,       \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Mark errors on spans\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">defaultAttributes\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: {          \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Custom attributes for all spans\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">environment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">production\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Use with workflow\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">autotel\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">fetch-user\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">100\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">charge-card\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createWorkflow } from &#x27;awaitly/workflow&#x27;;import { createAutotelAdapter } from &#x27;awaitly/otel&#x27;;const autotel = createAutotelAdapter({  serviceName: &#x27;checkout-service&#x27;,  createStepSpans: true,        // Create spans for each step  recordMetrics: true,          // Record step metrics  recordRetryEvents: true,      // Record retry events  markErrorsOnSpan: true,       // Mark errors on spans  defaultAttributes: {          // Custom attributes for all spans    environment: &#x27;production&#x27;,  },});// Use with workflowconst workflow = createWorkflow(deps, {  onEvent: autotel.handleEvent,});await workflow(async (step) => {  const user = await step(() => fetchUser(id), { name: &#x27;fetch-user&#x27; });  const charge = await step(() => chargeCard(100), { name: &#x27;charge-card&#x27; });  return { user, charge };});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"access-metrics\">Access metrics\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#access-metrics\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Access metrics”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">metrics\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">autotel\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getMetrics\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">metrics\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stepDurations\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// [{ name: 'fetch-user', durationMs: 45, success: true }, ...]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">metrics\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">retryCount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Total retry count\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">metrics\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">errorCount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Total error count\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">metrics\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cacheHits\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Cache hit count\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">metrics\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cacheMisses\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Cache miss count\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const metrics = autotel.getMetrics();console.log(metrics.stepDurations);// [{ name: &#x27;fetch-user&#x27;, durationMs: 45, success: true }, ...]console.log(metrics.retryCount);     // Total retry countconsole.log(metrics.errorCount);     // Total error countconsole.log(metrics.cacheHits);      // Cache hit countconsole.log(metrics.cacheMisses);    // Cache miss count\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"simple-event-handler\">Simple event handler\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#simple-event-handler\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Simple event handler”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>For debug logging without full metrics collection:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createAutotelEventHandler\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/otel\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createAutotelEventHandler\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">serviceName\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">checkout\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">includeStepDetails\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Set AUTOTEL_DEBUG=true to see console output\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createWorkflow } from &#x27;awaitly/workflow&#x27;;import { createAutotelEventHandler } from &#x27;awaitly/otel&#x27;;const workflow = createWorkflow(deps, {  onEvent: createAutotelEventHandler({    serviceName: &#x27;checkout&#x27;,    includeStepDetails: true,  }),});// Set AUTOTEL_DEBUG=true to see console output\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"with-autotel-tracing\">With autotel tracing\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#with-autotel-tracing\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “With autotel tracing”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Wrap workflows with actual OpenTelemetry spans:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">withAutotelTracing\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/otel\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">trace\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">autotel\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">traced\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withAutotelTracing\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">trace\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">serviceName\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">checkout\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">traced\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">process-order\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">fetch-user\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">100\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">charge\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">orderId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Optional attributes\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { withAutotelTracing } from &#x27;awaitly/otel&#x27;;import { trace } from &#x27;autotel&#x27;;const traced = withAutotelTracing(trace, { serviceName: &#x27;checkout&#x27; });const result = await traced(&#x27;process-order&#x27;, async () => {  return workflow(async (step) => {    const user = await step(() => fetchUser(id), { name: &#x27;fetch-user&#x27; });    const charge = await step(() => chargeCard(100), { name: &#x27;charge&#x27; });    return { user, charge };  });}, { orderId: &#x27;123&#x27; }); // Optional attributes\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"configuration-options\">Configuration options\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#configuration-options\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Configuration options”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">serviceName\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">           \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Required: identifies the service\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createStepSpans\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">boolean\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create spans for steps (default: false)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">recordMetrics\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">boolean\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">       \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Collect metrics (default: true)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">recordRetryEvents\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">boolean\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">   \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Track retries (default: true)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">markErrorsOnSpan\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">boolean\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Mark errors on spans (default: true)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">defaultAttributes\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">Record\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Added to all spans\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"{  serviceName: string;           // Required: identifies the service  createStepSpans?: boolean;     // Create spans for steps (default: false)  recordMetrics?: boolean;       // Collect metrics (default: true)  recordRetryEvents?: boolean;   // Track retries (default: true)  markErrorsOnSpan?: boolean;    // Mark errors on spans (default: true)  defaultAttributes?: Record\u003Cstring, string>; // Added to all spans}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"span-attributes\">Span attributes\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#span-attributes\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Span attributes”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>When \u003Ccode dir=\"auto\">createStepSpans\u003C/code> is enabled, spans include:\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Attribute\u003C/th>\u003Cth>Description\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">workflow.step.name\u003C/code>\u003C/td>\u003Ctd>Step name from options\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">workflow.step.key\u003C/code>\u003C/td>\u003Ctd>Step cache key (if set)\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">workflow.step.cached\u003C/code>\u003C/td>\u003Ctd>Whether result was cached\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">workflow.step.retry_count\u003C/code>\u003C/td>\u003Ctd>Number of retries\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">workflow.step.duration_ms\u003C/code>\u003C/td>\u003Ctd>Step duration\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">workflow.step.success\u003C/code>\u003C/td>\u003Ctd>Whether step succeeded\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">workflow.step.error\u003C/code>\u003C/td>\u003Ctd>Error type (if failed)\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"multiple-workflows\">Multiple workflows\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#multiple-workflows\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Multiple workflows”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Create separate adapters for different workflows:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">checkoutTelemetry\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createAutotelAdapter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">serviceName\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">checkout-service\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">defaultAttributes\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">checkout\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">inventoryTelemetry\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createAutotelAdapter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">serviceName\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">inventory-service\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">defaultAttributes\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">inventory\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">checkoutWorkflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">checkoutDeps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">checkoutTelemetry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">inventoryWorkflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">inventoryDeps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">inventoryTelemetry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const checkoutTelemetry = createAutotelAdapter({  serviceName: &#x27;checkout-service&#x27;,  defaultAttributes: { workflow: &#x27;checkout&#x27; },});const inventoryTelemetry = createAutotelAdapter({  serviceName: &#x27;inventory-service&#x27;,  defaultAttributes: { workflow: &#x27;inventory&#x27; },});const checkoutWorkflow = createWorkflow(checkoutDeps, {  onEvent: checkoutTelemetry.handleEvent,});const inventoryWorkflow = createWorkflow(inventoryDeps, {  onEvent: inventoryTelemetry.handleEvent,});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"combining-with-other-event-handlers\">Combining with other event handlers\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#combining-with-other-event-handlers\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Combining with other event handlers”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createAutotelAdapter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createVisualizer\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/otel\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">autotel\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createAutotelAdapter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">serviceName\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">checkout\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">viz\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createVisualizer\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">workflowName\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">checkout\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">autotel\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">viz\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createWorkflow } from &#x27;awaitly/workflow&#x27;;import { createAutotelAdapter, createVisualizer } from &#x27;awaitly/otel&#x27;;const autotel = createAutotelAdapter({ serviceName: &#x27;checkout&#x27; });const viz = createVisualizer({ workflowName: &#x27;checkout&#x27; });const workflow = createWorkflow(deps, {  onEvent: (event) => {    autotel.handleEvent(event);    viz.handleEvent(event);  },});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"custom-metrics\">Custom metrics\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#custom-metrics\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Custom metrics”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Extend the adapter output with your own metrics:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">autotel\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createAutotelAdapter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">serviceName\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">checkout\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">autotel\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Custom metric tracking\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">===\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">step_complete\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">&#x26;&#x26;\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">customMetrics\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">increment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">checkout.step.failures\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stepName\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">String\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const autotel = createAutotelAdapter({ serviceName: &#x27;checkout&#x27; });const workflow = createWorkflow(deps, {  onEvent: (event) => {    autotel.handleEvent(event);    // Custom metric tracking    if (event.type === &#x27;step_complete&#x27; &#x26;&#x26; !event.result.ok) {      customMetrics.increment(&#x27;checkout.step.failures&#x27;, {        step: event.stepName,        error: String(event.result.error),      });    }  },});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"environment-variables\">Environment variables\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#environment-variables\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Environment variables”\u003C/span>\u003C/a>\u003C/div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Variable\u003C/th>\u003Cth>Description\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">AUTOTEL_DEBUG\u003C/code>\u003C/td>\u003Ctd>Set to \u003Ccode dir=\"auto\">true\u003C/code> for console output\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">OTEL_SERVICE_NAME\u003C/code>\u003C/td>\u003Ctd>Default service name (overridden by config)\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"integration-with-otel-collectors\">Integration with OTEL collectors\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#integration-with-otel-collectors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Integration with OTEL collectors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>The adapter works with standard OpenTelemetry collectors. Configure your collector endpoint:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">trace\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">autotel\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Configure your OTEL exporter\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">trace\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">configure\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">endpoint\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">process\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">env\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">OTEL_EXPORTER_OTLP_ENDPOINT\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">headers\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">api-key\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">process\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">env\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">OTEL_API_KEY\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">traced\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withAutotelTracing\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">trace\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">serviceName\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">checkout\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { trace } from &#x27;autotel&#x27;;// Configure your OTEL exportertrace.configure({  endpoint: process.env.OTEL_EXPORTER_OTLP_ENDPOINT,  headers: {    &#x27;api-key&#x27;: process.env.OTEL_API_KEY,  },});const traced = withAutotelTracing(trace, { serviceName: &#x27;checkout&#x27; });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>",{"headings":140,"localImagePaths":174,"remoteImagePaths":175,"frontmatter":176,"imagePaths":177},[141,144,147,150,153,156,159,162,165,168,171],{"depth":57,"slug":142,"text":143},"autotel-adapter","Autotel adapter",{"depth":57,"slug":145,"text":146},"access-metrics","Access metrics",{"depth":57,"slug":148,"text":149},"simple-event-handler","Simple event handler",{"depth":57,"slug":151,"text":152},"with-autotel-tracing","With autotel tracing",{"depth":57,"slug":154,"text":155},"configuration-options","Configuration options",{"depth":57,"slug":157,"text":158},"span-attributes","Span attributes",{"depth":57,"slug":160,"text":161},"multiple-workflows","Multiple workflows",{"depth":57,"slug":163,"text":164},"combining-with-other-event-handlers","Combining with other event handlers",{"depth":57,"slug":166,"text":167},"custom-metrics","Custom metrics",{"depth":57,"slug":169,"text":170},"environment-variables","Environment variables",{"depth":57,"slug":172,"text":173},"integration-with-otel-collectors","Integration with OTEL collectors",[],[],{"title":129,"description":130},[],"advanced/policies",{"id":178,"data":180,"body":186,"filePath":187,"digest":188,"rendered":189},{"title":181,"description":182,"editUrl":16,"head":183,"template":46,"sidebar":184,"pagefind":16,"draft":35},"Policies","Reusable bundles of step options",[],{"hidden":35,"attrs":185},{},"Reusable bundles of `StepOptions` (retry, timeout, cache keys) that can be composed and applied per-workflow or per-step.\n\n## Using service policies\n\nApply pre-built policies for common scenarios:\n\n```typescript\nimport { withPolicy, servicePolicies } from 'awaitly/policies';\n\nconst result = await workflow(async (step) => {\n  // HTTP API: 5s timeout, 3 retries\n  const user = await step(\n    () => fetchUser(id),\n    withPolicy(servicePolicies.httpApi, { name: 'fetch-user' })\n  );\n\n  // Database: 30s timeout, 2 retries\n  const orders = await step(\n    () => db.query('SELECT * FROM orders'),\n    withPolicy(servicePolicies.database, { name: 'fetch-orders' })\n  );\n\n  // Cache: 1s timeout, no retry\n  const cached = await step(\n    () => cache.get(key),\n    withPolicy(servicePolicies.cache, { name: 'cache-lookup' })\n  );\n\n  return { user, orders, cached };\n});\n```\n\n## Combining policies\n\nMerge multiple policies together:\n\n```typescript\nimport { withPolicies, timeoutPolicies, retryPolicies } from 'awaitly/policies';\n\nconst data = await step(\n  () => fetchData(),\n  withPolicies([timeoutPolicies.api, retryPolicies.standard], 'fetch-data')\n);\n```\n\n## Policy applier\n\nCreate a reusable applier for consistent defaults:\n\n```typescript\nimport { createPolicyApplier, timeoutPolicies, retryPolicies } from 'awaitly/policies';\n\nconst applyPolicy = createPolicyApplier(\n  timeoutPolicies.api,\n  retryPolicies.transient\n);\n\nconst result = await step(\n  () => callApi(),\n  applyPolicy({ name: 'api-call', key: 'cache:api' })\n);\n```\n\n## Fluent builder\n\nBuild step options with a fluent API:\n\n```typescript\nimport { stepOptions } from 'awaitly/policies';\n\nconst options = stepOptions()\n  .name('fetch-user')\n  .key('user:123')\n  .timeout(5000)\n  .retries(3)\n  .build();\n\nconst user = await step(() => fetchUser('123'), options);\n```\n\n## Policy registry\n\nCreate organization-wide policy standards:\n\n```typescript\nimport { createPolicyRegistry, servicePolicies } from 'awaitly/policies';\n\nconst registry = createPolicyRegistry();\nregistry.register('api', servicePolicies.httpApi);\nregistry.register('db', servicePolicies.database);\nregistry.register('cache', servicePolicies.cache);\nregistry.register('queue', servicePolicies.messageQueue);\n\n// Use in workflows\nconst user = await step(\n  () => fetchUser(id),\n  registry.apply('api', { name: 'fetch-user' })\n);\n\nconst data = await step(\n  () => db.query(sql),\n  registry.apply('db', { name: 'query-data' })\n);\n```\n\n## Available presets\n\n### Retry policies\n\n```typescript\nimport { retryPolicies } from 'awaitly/policies';\n\nretryPolicies.none           // No retry\nretryPolicies.transient      // 3 attempts, fast backoff\nretryPolicies.standard       // 3 attempts, moderate backoff\nretryPolicies.aggressive     // 5 attempts, longer backoff\nretryPolicies.fixed(3, 1000) // 3 attempts, 1s fixed delay\nretryPolicies.linear(3, 100) // 3 attempts, linear backoff\n```\n\n### Timeout policies\n\n```typescript\nimport { timeoutPolicies } from 'awaitly/policies';\n\ntimeoutPolicies.fast         // 1 second\ntimeoutPolicies.api          // 5 seconds\ntimeoutPolicies.extended     // 30 seconds\ntimeoutPolicies.long         // 2 minutes\ntimeoutPolicies.ms(3000)     // Custom milliseconds\n```\n\n### Service policies\n\nCombined retry + timeout for specific scenarios:\n\n```typescript\nimport { servicePolicies } from 'awaitly/policies';\n\nservicePolicies.httpApi      // 5s timeout, 3 retries\nservicePolicies.database     // 30s timeout, 2 retries\nservicePolicies.cache        // 1s timeout, no retry\nservicePolicies.messageQueue // 30s timeout, 5 retries\nservicePolicies.fileSystem   // 2min timeout, 3 retries\nservicePolicies.rateLimited  // 10s timeout, 5 linear retries\n```\n\n## Custom policies\n\nCreate your own policies:\n\n```typescript\nimport { mergePolicies } from 'awaitly/policies';\n\nconst myApiPolicy = {\n  timeout: { ms: 10000 },\n  retry: {\n    attempts: 4,\n    backoff: 'exponential',\n    delayMs: 200,\n    maxDelayMs: 5000,\n  },\n};\n\nconst myDbPolicy = {\n  timeout: { ms: 60000 },\n  retry: {\n    attempts: 2,\n    backoff: 'fixed',\n    delayMs: 1000,\n  },\n};\n\n// Combine with existing policies\nconst criticalApiPolicy = mergePolicies(\n  servicePolicies.httpApi,\n  { retry: { attempts: 5 } }\n);\n```\n\n## When to use policies\n\n| Scenario | Recommended Policy |\n|----------|-------------------|\n| External HTTP APIs | `servicePolicies.httpApi` |\n| Database queries | `servicePolicies.database` |\n| Cache operations | `servicePolicies.cache` |\n| Message queue consumers | `servicePolicies.messageQueue` |\n| File system operations | `servicePolicies.fileSystem` |\n| Rate-limited APIs | `servicePolicies.rateLimited` |\n\n## Best practices\n\n1. **Use policies consistently** - Same service type should use same policy\n2. **Register in one place** - Use `createPolicyRegistry` for organization-wide standards\n3. **Don't over-configure** - Presets handle most cases well\n4. **Adjust for criticality** - Payment APIs may need more retries than logging\n5. **Monitor and tune** - Adjust based on actual failure patterns","src/content/docs/advanced/policies.md","abb40f63c201301f",{"html":190,"metadata":191},"\u003Cp>Reusable bundles of \u003Ccode dir=\"auto\">StepOptions\u003C/code> (retry, timeout, cache keys) that can be composed and applied per-workflow or per-step.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"using-service-policies\">Using service policies\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#using-service-policies\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Using service policies”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Apply pre-built policies for common scenarios:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">withPolicy\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">servicePolicies\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/policies\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// HTTP API: 5s timeout, 3 retries\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withPolicy\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">servicePolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">httpApi\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">fetch-user\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Database: 30s timeout, 2 retries\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">orders\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">query\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">SELECT * FROM orders\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withPolicy\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">servicePolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">database\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">fetch-orders\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Cache: 1s timeout, no retry\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cached\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cache\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">get\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withPolicy\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">servicePolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cache\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">cache-lookup\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">orders\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cached\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { withPolicy, servicePolicies } from &#x27;awaitly/policies&#x27;;const result = await workflow(async (step) => {  // HTTP API: 5s timeout, 3 retries  const user = await step(    () => fetchUser(id),    withPolicy(servicePolicies.httpApi, { name: &#x27;fetch-user&#x27; })  );  // Database: 30s timeout, 2 retries  const orders = await step(    () => db.query(&#x27;SELECT * FROM orders&#x27;),    withPolicy(servicePolicies.database, { name: &#x27;fetch-orders&#x27; })  );  // Cache: 1s timeout, no retry  const cached = await step(    () => cache.get(key),    withPolicy(servicePolicies.cache, { name: &#x27;cache-lookup&#x27; })  );  return { user, orders, cached };});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"combining-policies\">Combining policies\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#combining-policies\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Combining policies”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Merge multiple policies together:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">withPolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">timeoutPolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">retryPolicies\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/policies\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchData\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withPolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">timeoutPolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">api\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">retryPolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">standard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">],\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">fetch-data\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { withPolicies, timeoutPolicies, retryPolicies } from &#x27;awaitly/policies&#x27;;const data = await step(  () => fetchData(),  withPolicies([timeoutPolicies.api, retryPolicies.standard], &#x27;fetch-data&#x27;));\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"policy-applier\">Policy applier\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#policy-applier\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Policy applier”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Create a reusable applier for consistent defaults:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createPolicyApplier\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">timeoutPolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">retryPolicies\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/policies\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">applyPolicy\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createPolicyApplier\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">timeoutPolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">api\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">retryPolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">transient\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">callApi\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">applyPolicy\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">api-call\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">cache:api\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createPolicyApplier, timeoutPolicies, retryPolicies } from &#x27;awaitly/policies&#x27;;const applyPolicy = createPolicyApplier(  timeoutPolicies.api,  retryPolicies.transient);const result = await step(  () => callApi(),  applyPolicy({ name: &#x27;api-call&#x27;, key: &#x27;cache:api&#x27; }));\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"fluent-builder\">Fluent builder\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#fluent-builder\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Fluent builder”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Build step options with a fluent API:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stepOptions\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/policies\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">options\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">stepOptions\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">fetch-user\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">timeout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retries\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">build\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">options\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { stepOptions } from &#x27;awaitly/policies&#x27;;const options = stepOptions()  .name(&#x27;fetch-user&#x27;)  .key(&#x27;user:123&#x27;)  .timeout(5000)  .retries(3)  .build();const user = await step(() => fetchUser(&#x27;123&#x27;), options);\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"policy-registry\">Policy registry\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#policy-registry\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Policy registry”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Create organization-wide policy standards:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createPolicyRegistry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">servicePolicies\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/policies\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">registry\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createPolicyRegistry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">registry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">register\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">api\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">servicePolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">httpApi\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">registry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">register\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">db\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">servicePolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">database\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">registry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">register\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">cache\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">servicePolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cache\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">registry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">register\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">queue\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">servicePolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">messageQueue\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Use in workflows\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">registry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">apply\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">api\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">fetch-user\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">query\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">sql\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">registry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">apply\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">db\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">query-data\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createPolicyRegistry, servicePolicies } from &#x27;awaitly/policies&#x27;;const registry = createPolicyRegistry();registry.register(&#x27;api&#x27;, servicePolicies.httpApi);registry.register(&#x27;db&#x27;, servicePolicies.database);registry.register(&#x27;cache&#x27;, servicePolicies.cache);registry.register(&#x27;queue&#x27;, servicePolicies.messageQueue);// Use in workflowsconst user = await step(  () => fetchUser(id),  registry.apply(&#x27;api&#x27;, { name: &#x27;fetch-user&#x27; }));const data = await step(  () => db.query(sql),  registry.apply(&#x27;db&#x27;, { name: &#x27;query-data&#x27; }));\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"available-presets\">Available presets\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#available-presets\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Available presets”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"retry-policies\">Retry policies\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#retry-policies\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Retry policies”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">retryPolicies\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/policies\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">retryPolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">none\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">           \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// No retry\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">retryPolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">transient\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 3 attempts, fast backoff\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">retryPolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">standard\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">       \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 3 attempts, moderate backoff\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">retryPolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">aggressive\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 5 attempts, longer backoff\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">retryPolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fixed\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 3 attempts, 1s fixed delay\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">retryPolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">linear\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">100\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 3 attempts, linear backoff\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { retryPolicies } from &#x27;awaitly/policies&#x27;;retryPolicies.none           // No retryretryPolicies.transient      // 3 attempts, fast backoffretryPolicies.standard       // 3 attempts, moderate backoffretryPolicies.aggressive     // 5 attempts, longer backoffretryPolicies.fixed(3, 1000) // 3 attempts, 1s fixed delayretryPolicies.linear(3, 100) // 3 attempts, linear backoff\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"timeout-policies\">Timeout policies\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#timeout-policies\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Timeout policies”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">timeoutPolicies\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/policies\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">timeoutPolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fast\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">         \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 1 second\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">timeoutPolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">api\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">          \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 5 seconds\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">timeoutPolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">extended\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 30 seconds\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">timeoutPolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">long\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">         \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 2 minutes\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">timeoutPolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ms\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Custom milliseconds\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { timeoutPolicies } from &#x27;awaitly/policies&#x27;;timeoutPolicies.fast         // 1 secondtimeoutPolicies.api          // 5 secondstimeoutPolicies.extended     // 30 secondstimeoutPolicies.long         // 2 minutestimeoutPolicies.ms(3000)     // Custom milliseconds\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"service-policies\">Service policies\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#service-policies\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Service policies”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Combined retry + timeout for specific scenarios:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">servicePolicies\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/policies\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">servicePolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">httpApi\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 5s timeout, 3 retries\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">servicePolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">database\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 30s timeout, 2 retries\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">servicePolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cache\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 1s timeout, no retry\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">servicePolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">messageQueue\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 30s timeout, 5 retries\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">servicePolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fileSystem\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">   \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 2min timeout, 3 retries\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">servicePolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">rateLimited\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 10s timeout, 5 linear retries\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { servicePolicies } from &#x27;awaitly/policies&#x27;;servicePolicies.httpApi      // 5s timeout, 3 retriesservicePolicies.database     // 30s timeout, 2 retriesservicePolicies.cache        // 1s timeout, no retryservicePolicies.messageQueue // 30s timeout, 5 retriesservicePolicies.fileSystem   // 2min timeout, 3 retriesservicePolicies.rateLimited  // 10s timeout, 5 linear retries\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"custom-policies\">Custom policies\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#custom-policies\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Custom policies”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Create your own policies:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mergePolicies\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/policies\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">myApiPolicy\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">timeout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">ms\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">10000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">retry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">attempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">4\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">backoff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">exponential\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">delayMs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">200\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxDelayMs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">myDbPolicy\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">timeout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">ms\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">60000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">retry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">attempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">backoff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">fixed\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">delayMs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Combine with existing policies\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">criticalApiPolicy\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">mergePolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">servicePolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">httpApi\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">retry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">attempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> } }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { mergePolicies } from &#x27;awaitly/policies&#x27;;const myApiPolicy = {  timeout: { ms: 10000 },  retry: {    attempts: 4,    backoff: &#x27;exponential&#x27;,    delayMs: 200,    maxDelayMs: 5000,  },};const myDbPolicy = {  timeout: { ms: 60000 },  retry: {    attempts: 2,    backoff: &#x27;fixed&#x27;,    delayMs: 1000,  },};// Combine with existing policiesconst criticalApiPolicy = mergePolicies(  servicePolicies.httpApi,  { retry: { attempts: 5 } });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"when-to-use-policies\">When to use policies\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#when-to-use-policies\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “When to use policies”\u003C/span>\u003C/a>\u003C/div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Scenario\u003C/th>\u003Cth>Recommended Policy\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>External HTTP APIs\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">servicePolicies.httpApi\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Database queries\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">servicePolicies.database\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Cache operations\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">servicePolicies.cache\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Message queue consumers\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">servicePolicies.messageQueue\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>File system operations\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">servicePolicies.fileSystem\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Rate-limited APIs\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">servicePolicies.rateLimited\u003C/code>\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"best-practices\">Best practices\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#best-practices\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Best practices”\u003C/span>\u003C/a>\u003C/div>\n\u003Col>\n\u003Cli>\u003Cstrong>Use policies consistently\u003C/strong> - Same service type should use same policy\u003C/li>\n\u003Cli>\u003Cstrong>Register in one place\u003C/strong> - Use \u003Ccode dir=\"auto\">createPolicyRegistry\u003C/code> for organization-wide standards\u003C/li>\n\u003Cli>\u003Cstrong>Don’t over-configure\u003C/strong> - Presets handle most cases well\u003C/li>\n\u003Cli>\u003Cstrong>Adjust for criticality\u003C/strong> - Payment APIs may need more retries than logging\u003C/li>\n\u003Cli>\u003Cstrong>Monitor and tune\u003C/strong> - Adjust based on actual failure patterns\u003C/li>\n\u003C/ol>",{"headings":192,"localImagePaths":228,"remoteImagePaths":229,"frontmatter":230,"imagePaths":231},[193,196,199,202,205,208,211,215,218,221,224,227],{"depth":57,"slug":194,"text":195},"using-service-policies","Using service policies",{"depth":57,"slug":197,"text":198},"combining-policies","Combining policies",{"depth":57,"slug":200,"text":201},"policy-applier","Policy applier",{"depth":57,"slug":203,"text":204},"fluent-builder","Fluent builder",{"depth":57,"slug":206,"text":207},"policy-registry","Policy registry",{"depth":57,"slug":209,"text":210},"available-presets","Available presets",{"depth":212,"slug":213,"text":214},3,"retry-policies","Retry policies",{"depth":212,"slug":216,"text":217},"timeout-policies","Timeout policies",{"depth":212,"slug":219,"text":220},"service-policies","Service policies",{"depth":57,"slug":222,"text":223},"custom-policies","Custom policies",{"depth":57,"slug":225,"text":226},"when-to-use-policies","When to use policies",{"depth":57,"slug":79,"text":80},[],[],{"title":181,"description":182},[],"advanced/rate-limiting",{"id":232,"data":234,"body":240,"filePath":241,"digest":242,"rendered":243},{"title":235,"description":236,"editUrl":16,"head":237,"template":46,"sidebar":238,"pagefind":16,"draft":35},"Rate Limiting","Control throughput with token bucket and concurrency limiters",[],{"hidden":35,"attrs":239},{},"Control throughput for steps that hit rate-limited APIs or limited resources.\n\n## Rate limiter\n\nToken bucket algorithm for requests-per-second limits:\n\n```typescript\nimport { createRateLimiter, rateLimiterPresets } from 'awaitly/ratelimit';\n\n// Custom config\nconst rateLimiter = createRateLimiter('api-calls', {\n  maxPerSecond: 10,        // Maximum operations per second\n  burstCapacity: 20,       // Allow brief spikes (default: maxPerSecond * 2)\n  strategy: 'wait',        // 'wait' (default) or 'reject'\n});\n\n// Wrap operations\nconst data = await rateLimiter.execute(async () => {\n  return await callExternalApi();\n});\n\n// Or use presets\nconst apiLimiter = createRateLimiter('external-api', rateLimiterPresets.api);\n// { maxPerSecond: 10, burstCapacity: 20, strategy: 'wait' }\n\nconst externalLimiter = createRateLimiter('partner-api', rateLimiterPresets.external);\n// { maxPerSecond: 5, burstCapacity: 10, strategy: 'wait' }\n```\n\n## Concurrency limiter\n\nLimit parallel operations (for database connections, file handles, etc.):\n\n```typescript\nimport { createConcurrencyLimiter, rateLimiterPresets } from 'awaitly/ratelimit';\n\nconst concurrencyLimiter = createConcurrencyLimiter('db-pool', {\n  maxConcurrent: 5,        // Max 5 concurrent operations\n  maxQueueSize: 100,       // Queue up to 100 waiting requests\n  strategy: 'queue',       // 'queue' (default) or 'reject'\n});\n\nconst data = await concurrencyLimiter.execute(async () => {\n  return await db.query('SELECT * FROM users');\n});\n\n// Or use preset\nconst dbLimiter = createConcurrencyLimiter('database', rateLimiterPresets.database);\n// { maxConcurrent: 10, strategy: 'queue', maxQueueSize: 100 }\n```\n\n## Combined limiter\n\nApply both rate and concurrency limits:\n\n```typescript\nimport { createCombinedLimiter } from 'awaitly/ratelimit';\n\nconst limiter = createCombinedLimiter('api', {\n  rate: { maxPerSecond: 10 },\n  concurrency: { maxConcurrent: 3 },\n});\n\nconst data = await limiter.execute(async () => callApi());\n```\n\n## Result-returning operations\n\n```typescript\nconst result = await rateLimiter.executeResult(async () => {\n  return ok(await callExternalApi());\n});\n\nif (!result.ok) {\n  // Handle error (could be rate limit rejection or operation error)\n}\n```\n\n## Batch operations\n\nProcess many items with bounded concurrency:\n\n```typescript\nconst results = await concurrencyLimiter.executeAll(\n  ids.map(id => async () => fetchItem(id))\n);\n\n// results: Array of outcomes\n```\n\n## Monitoring\n\n```typescript\nconst stats = rateLimiter.getStats();\nconsole.log(stats.availableTokens);  // Current available tokens\nconsole.log(stats.waitingCount);     // Requests waiting for tokens\n```\n\n## Strategies\n\n### Wait strategy (default)\n\nRequests wait until capacity is available:\n\n```typescript\nconst limiter = createRateLimiter('api', {\n  maxPerSecond: 10,\n  strategy: 'wait', // Queues requests\n});\n```\n\n### Reject strategy\n\nRequests fail immediately when at capacity:\n\n```typescript\nconst limiter = createRateLimiter('api', {\n  maxPerSecond: 10,\n  strategy: 'reject', // Throws RateLimitExceededError\n});\n\ntry {\n  await limiter.execute(() => callApi());\n} catch (error) {\n  if (isRateLimitExceededError(error)) {\n    console.log('Rate limit exceeded, try later');\n  }\n}\n```\n\n## In workflows\n\n```typescript\nconst apiLimiter = createRateLimiter('partner-api', rateLimiterPresets.external);\n\nconst result = await workflow(async (step) => {\n  // Rate-limited API calls\n  const users = await step(async () => {\n    const ids = ['1', '2', '3', '4', '5'];\n    return await apiLimiter.executeAll(\n      ids.map(id => async () => fetchUser(id))\n    );\n  });\n\n  return users;\n});\n```\n\n## Configuration reference\n\n### Rate limiter\n\n```typescript\n{\n  maxPerSecond: number;      // Operations per second (required)\n  burstCapacity?: number;    // Max burst (default: maxPerSecond * 2)\n  strategy?: 'wait' | 'reject';\n}\n```\n\n### Concurrency limiter\n\n```typescript\n{\n  maxConcurrent: number;     // Max parallel operations (required)\n  maxQueueSize?: number;     // Max waiting requests (default: Infinity)\n  strategy?: 'queue' | 'reject';\n}\n```\n\n### Presets\n\n| Preset | Type | Config |\n|--------|------|--------|\n| `rateLimiterPresets.api` | Rate | 10/s, burst 20 |\n| `rateLimiterPresets.external` | Rate | 5/s, burst 10 |\n| `rateLimiterPresets.database` | Concurrency | 10 concurrent, queue 100 |","src/content/docs/advanced/rate-limiting.md","f78535777ad6db1a",{"html":244,"metadata":245},"\u003Cp>Control throughput for steps that hit rate-limited APIs or limited resources.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"rate-limiter\">Rate limiter\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#rate-limiter\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Rate limiter”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Token bucket algorithm for requests-per-second limits:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createRateLimiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">rateLimiterPresets\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/ratelimit\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Custom config\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">rateLimiter\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createRateLimiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">api-calls\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxPerSecond\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">10\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Maximum operations per second\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">burstCapacity\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">20\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,       \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Allow brief spikes (default: maxPerSecond * 2)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">strategy\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">wait\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 'wait' (default) or 'reject'\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Wrap operations\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">rateLimiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">execute\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">callExternalApi\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Or use presets\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">apiLimiter\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createRateLimiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">external-api\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">rateLimiterPresets\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">api\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// { maxPerSecond: 10, burstCapacity: 20, strategy: 'wait' }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">externalLimiter\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createRateLimiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">partner-api\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">rateLimiterPresets\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">external\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// { maxPerSecond: 5, burstCapacity: 10, strategy: 'wait' }\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createRateLimiter, rateLimiterPresets } from &#x27;awaitly/ratelimit&#x27;;// Custom configconst rateLimiter = createRateLimiter(&#x27;api-calls&#x27;, {  maxPerSecond: 10,        // Maximum operations per second  burstCapacity: 20,       // Allow brief spikes (default: maxPerSecond * 2)  strategy: &#x27;wait&#x27;,        // &#x27;wait&#x27; (default) or &#x27;reject&#x27;});// Wrap operationsconst data = await rateLimiter.execute(async () => {  return await callExternalApi();});// Or use presetsconst apiLimiter = createRateLimiter(&#x27;external-api&#x27;, rateLimiterPresets.api);// { maxPerSecond: 10, burstCapacity: 20, strategy: &#x27;wait&#x27; }const externalLimiter = createRateLimiter(&#x27;partner-api&#x27;, rateLimiterPresets.external);// { maxPerSecond: 5, burstCapacity: 10, strategy: &#x27;wait&#x27; }\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"concurrency-limiter\">Concurrency limiter\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#concurrency-limiter\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Concurrency limiter”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Limit parallel operations (for database connections, file handles, etc.):\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createConcurrencyLimiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">rateLimiterPresets\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/ratelimit\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">concurrencyLimiter\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createConcurrencyLimiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">db-pool\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxConcurrent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Max 5 concurrent operations\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxQueueSize\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">100\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,       \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Queue up to 100 waiting requests\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">strategy\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">queue\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,       \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 'queue' (default) or 'reject'\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">concurrencyLimiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">execute\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">query\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">SELECT * FROM users\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Or use preset\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">dbLimiter\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createConcurrencyLimiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">database\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">rateLimiterPresets\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">database\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// { maxConcurrent: 10, strategy: 'queue', maxQueueSize: 100 }\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createConcurrencyLimiter, rateLimiterPresets } from &#x27;awaitly/ratelimit&#x27;;const concurrencyLimiter = createConcurrencyLimiter(&#x27;db-pool&#x27;, {  maxConcurrent: 5,        // Max 5 concurrent operations  maxQueueSize: 100,       // Queue up to 100 waiting requests  strategy: &#x27;queue&#x27;,       // &#x27;queue&#x27; (default) or &#x27;reject&#x27;});const data = await concurrencyLimiter.execute(async () => {  return await db.query(&#x27;SELECT * FROM users&#x27;);});// Or use presetconst dbLimiter = createConcurrencyLimiter(&#x27;database&#x27;, rateLimiterPresets.database);// { maxConcurrent: 10, strategy: &#x27;queue&#x27;, maxQueueSize: 100 }\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"combined-limiter\">Combined limiter\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#combined-limiter\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Combined limiter”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Apply both rate and concurrency limits:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createCombinedLimiter\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/ratelimit\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">limiter\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createCombinedLimiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">api\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">rate\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxPerSecond\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">10\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">concurrency\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxConcurrent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">limiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">execute\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">callApi\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createCombinedLimiter } from &#x27;awaitly/ratelimit&#x27;;const limiter = createCombinedLimiter(&#x27;api&#x27;, {  rate: { maxPerSecond: 10 },  concurrency: { maxConcurrent: 3 },});const data = await limiter.execute(async () => callApi());\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"result-returning-operations\">Result-returning operations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#result-returning-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Result-returning operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">rateLimiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">executeResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">callExternalApi\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Handle error (could be rate limit rejection or operation error)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await rateLimiter.executeResult(async () => {  return ok(await callExternalApi());});if (!result.ok) {  // Handle error (could be rate limit rejection or operation error)}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"batch-operations\">Batch operations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#batch-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Batch operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Process many items with bounded concurrency:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">results\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">concurrencyLimiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">executeAll\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ids\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">map\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchItem\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// results: Array of outcomes\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const results = await concurrencyLimiter.executeAll(  ids.map(id => async () => fetchItem(id)));// results: Array of outcomes\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"monitoring\">Monitoring\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#monitoring\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Monitoring”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stats\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">rateLimiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getStats\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stats\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">availableTokens\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Current available tokens\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stats\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">waitingCount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Requests waiting for tokens\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const stats = rateLimiter.getStats();console.log(stats.availableTokens);  // Current available tokensconsole.log(stats.waitingCount);     // Requests waiting for tokens\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"strategies\">Strategies\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#strategies\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Strategies”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"wait-strategy-default\">Wait strategy (default)\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#wait-strategy-default\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Wait strategy (default)”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Requests wait until capacity is available:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">limiter\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createRateLimiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">api\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxPerSecond\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">10\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">strategy\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">wait\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Queues requests\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const limiter = createRateLimiter(&#x27;api&#x27;, {  maxPerSecond: 10,  strategy: &#x27;wait&#x27;, // Queues requests});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"reject-strategy\">Reject strategy\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#reject-strategy\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Reject strategy”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Requests fail immediately when at capacity:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">limiter\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createRateLimiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">api\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxPerSecond\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">10\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">strategy\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">reject\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Throws RateLimitExceededError\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">try\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">limiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">execute\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">callApi\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">catch\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isRateLimitExceededError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Rate limit exceeded, try later\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const limiter = createRateLimiter(&#x27;api&#x27;, {  maxPerSecond: 10,  strategy: &#x27;reject&#x27;, // Throws RateLimitExceededError});try {  await limiter.execute(() => callApi());} catch (error) {  if (isRateLimitExceededError(error)) {    console.log(&#x27;Rate limit exceeded, try later&#x27;);  }}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"in-workflows\">In workflows\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#in-workflows\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “In workflows”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">apiLimiter\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createRateLimiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">partner-api\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">rateLimiterPresets\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">external\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Rate-limited API calls\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">users\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ids\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">2\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">3\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">4\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">5\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">];\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">apiLimiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">executeAll\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ids\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">map\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">users\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const apiLimiter = createRateLimiter(&#x27;partner-api&#x27;, rateLimiterPresets.external);const result = await workflow(async (step) => {  // Rate-limited API calls  const users = await step(async () => {    const ids = [&#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;];    return await apiLimiter.executeAll(      ids.map(id => async () => fetchUser(id))    );  });  return users;});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"configuration-reference\">Configuration reference\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#configuration-reference\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Configuration reference”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"rate-limiter-1\">Rate limiter\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#rate-limiter-1\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Rate limiter”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">maxPerSecond\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Operations per second (required)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">burstCapacity\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Max burst (default: maxPerSecond * 2)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">strategy\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">wait\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">|\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">reject\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"{  maxPerSecond: number;      // Operations per second (required)  burstCapacity?: number;    // Max burst (default: maxPerSecond * 2)  strategy?: &#x27;wait&#x27; | &#x27;reject&#x27;;}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"concurrency-limiter-1\">Concurrency limiter\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#concurrency-limiter-1\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Concurrency limiter”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">maxConcurrent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Max parallel operations (required)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">maxQueueSize\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Max waiting requests (default: Infinity)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">strategy\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">queue\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">|\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">reject\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"{  maxConcurrent: number;     // Max parallel operations (required)  maxQueueSize?: number;     // Max waiting requests (default: Infinity)  strategy?: &#x27;queue&#x27; | &#x27;reject&#x27;;}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"presets\">Presets\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#presets\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Presets”\u003C/span>\u003C/a>\u003C/div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Preset\u003C/th>\u003Cth>Type\u003C/th>\u003Cth>Config\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">rateLimiterPresets.api\u003C/code>\u003C/td>\u003Ctd>Rate\u003C/td>\u003Ctd>10/s, burst 20\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">rateLimiterPresets.external\u003C/code>\u003C/td>\u003Ctd>Rate\u003C/td>\u003Ctd>5/s, burst 10\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">rateLimiterPresets.database\u003C/code>\u003C/td>\u003Ctd>Concurrency\u003C/td>\u003Ctd>10 concurrent, queue 100\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>",{"headings":246,"localImagePaths":281,"remoteImagePaths":282,"frontmatter":283,"imagePaths":284},[247,250,253,256,257,260,263,266,269,272,273,274,276,278],{"depth":57,"slug":248,"text":249},"rate-limiter","Rate limiter",{"depth":57,"slug":251,"text":252},"concurrency-limiter","Concurrency limiter",{"depth":57,"slug":254,"text":255},"combined-limiter","Combined limiter",{"depth":57,"slug":105,"text":106},{"depth":57,"slug":258,"text":259},"batch-operations","Batch operations",{"depth":57,"slug":261,"text":262},"monitoring","Monitoring",{"depth":57,"slug":264,"text":265},"strategies","Strategies",{"depth":212,"slug":267,"text":268},"wait-strategy-default","Wait strategy (default)",{"depth":212,"slug":270,"text":271},"reject-strategy","Reject strategy",{"depth":57,"slug":114,"text":115},{"depth":57,"slug":120,"text":121},{"depth":212,"slug":275,"text":249},"rate-limiter-1",{"depth":212,"slug":277,"text":252},"concurrency-limiter-1",{"depth":212,"slug":279,"text":280},"presets","Presets",[],[],{"title":235,"description":236},[],"advanced/webhooks",{"id":285,"data":287,"body":293,"filePath":294,"digest":295,"rendered":296},{"title":288,"description":289,"editUrl":16,"head":290,"template":46,"sidebar":291,"pagefind":16,"draft":35},"Webhooks & Events","Expose workflows as HTTP endpoints or event consumers",[],{"hidden":35,"attrs":292},{},"Expose workflows as HTTP endpoints or event consumers with built-in validation and error mapping.\n\n## Webhook handler\n\nCreate HTTP handlers for workflows:\n\n```typescript\nimport { ok } from 'awaitly';\nimport {\n  createWebhookHandler,\n  createResultMapper,\n  createExpressHandler,\n  requireFields,\n} from 'awaitly/webhook';\n\n// Create a webhook handler\nconst handler = createWebhookHandler(\n  checkoutWorkflow,\n  async (step, deps, input: CheckoutInput) => {\n    const charge = await step(() => deps.chargeCard(input.amount));\n    await step(() => deps.sendEmail(input.email, charge.receiptUrl));\n    return { chargeId: charge.id };\n  },\n  {\n    validateInput: (req) => {\n      const validation = requireFields(['amount', 'email'])(req.body);\n      if (!validation.ok) return validation;\n      return ok({ amount: req.body.amount, email: req.body.email });\n    },\n    mapResult: createResultMapper([\n      { error: 'CARD_DECLINED', status: 402, message: 'Payment failed' },\n      { error: 'INVALID_EMAIL', status: 400, message: 'Invalid email address' },\n    ]),\n  }\n);\n```\n\n## With Express\n\n```typescript\nimport express from 'express';\nimport { createExpressHandler } from 'awaitly/webhook';\n\nconst app = express();\napp.use(express.json());\n\n// Use the built-in adapter\napp.post('/checkout', createExpressHandler(handler));\n\n// Or handle manually\napp.post('/checkout', async (req, res) => {\n  const response = await handler({\n    method: req.method,\n    path: req.path,\n    headers: req.headers,\n    body: req.body,\n    query: req.query,\n    params: req.params,\n  });\n  res.status(response.status).json(response.body);\n});\n```\n\n## Input validation\n\nUse built-in validators or write your own:\n\n```typescript\nimport { ok, err } from 'awaitly';\nimport { requireFields, validationError } from 'awaitly/webhook';\n\n// Built-in field checker\nconst validate = requireFields(['amount', 'email', 'items']);\n\n// Custom validation\nconst validateInput = (req) => {\n  if (!req.body.amount || req.body.amount \u003C= 0) {\n    return err(validationError('Amount must be positive'));\n  }\n  if (!req.body.email?.includes('@')) {\n    return err(validationError('Invalid email format'));\n  }\n  return ok({\n    amount: req.body.amount,\n    email: req.body.email,\n  });\n};\n```\n\n## Result mapping\n\nMap workflow errors to HTTP responses:\n\n```typescript\nimport { createResultMapper } from 'awaitly/webhook';\n\nconst mapResult = createResultMapper([\n  { error: 'NOT_FOUND', status: 404, message: 'Resource not found' },\n  { error: 'UNAUTHORIZED', status: 401, message: 'Authentication required' },\n  { error: 'FORBIDDEN', status: 403, message: 'Access denied' },\n  { error: 'VALIDATION_ERROR', status: 400, message: 'Invalid input' },\n  { error: 'CARD_DECLINED', status: 402, message: 'Payment declined' },\n  // Unmapped errors return 500 with generic message\n]);\n```\n\n## Event handlers\n\nFor message queues (SQS, RabbitMQ, etc.):\n\n```typescript\nimport { createEventHandler } from 'awaitly/webhook';\n\nconst handler = createEventHandler(\n  checkoutWorkflow,\n  async (step, deps, payload: CheckoutPayload) => {\n    const charge = await step(() => deps.chargeCard(payload.amount));\n    return { chargeId: charge.id };\n  },\n  {\n    validatePayload: (event) => {\n      if (!event.payload.amount) {\n        return err(validationError('Missing amount'));\n      }\n      return ok(event.payload);\n    },\n    mapResult: (result) => ({\n      success: result.ok,\n      ack: result.ok || !isRetryableError(result.error),\n      error: result.ok ? undefined : { type: String(result.error) },\n    }),\n  }\n);\n\n// Use with SQS, RabbitMQ, etc.\nqueue.consume(async (message) => {\n  const result = await handler({\n    id: message.id,\n    type: message.type,\n    payload: message.body,\n  });\n  if (result.ack) await message.ack();\n  else await message.nack();\n});\n```\n\n## Simple handlers\n\nFor straightforward use cases without workflow context:\n\n```typescript\nimport { ok } from 'awaitly';\nimport { createSimpleHandler } from 'awaitly/webhook';\n\nconst handler = createSimpleHandler(\n  async (input: { userId: string }) => {\n    const user = await db.users.find(input.userId);\n    if (!user) return err('NOT_FOUND' as const);\n    return ok(user);\n  },\n  {\n    validateInput: (req) => {\n      if (!req.params.userId) {\n        return err(validationError('Missing userId'));\n      }\n      return ok({ userId: req.params.userId });\n    },\n  }\n);\n```\n\n## Request/response types\n\n### WebhookRequest\n\n```typescript\ninterface WebhookRequest {\n  method: string;\n  path: string;\n  headers: Record\u003Cstring, string | string[]>;\n  body: unknown;\n  query: Record\u003Cstring, string>;\n  params: Record\u003Cstring, string>;\n}\n```\n\n### WebhookResponse\n\n```typescript\ninterface WebhookResponse {\n  status: number;\n  body: unknown;\n  headers?: Record\u003Cstring, string>;\n}\n```\n\n### EventRequest\n\n```typescript\ninterface EventRequest\u003CT> {\n  id: string;\n  type: string;\n  payload: T;\n  metadata?: Record\u003Cstring, unknown>;\n}\n```\n\n### EventResponse\n\n```typescript\ninterface EventResponse {\n  success: boolean;\n  ack: boolean;  // Whether to acknowledge the message\n  error?: { type: string; message?: string };\n}\n```\n\n## Error handling patterns\n\n```typescript\n// Determine if error is retryable\nconst isRetryableError = (error: unknown): boolean => {\n  const retryable = ['TIMEOUT', 'SERVICE_UNAVAILABLE', 'RATE_LIMITED'];\n  return typeof error === 'string' && retryable.includes(error);\n};\n\n// Custom result mapper with retry logic\nconst mapResult = (result) => ({\n  success: result.ok,\n  ack: result.ok || !isRetryableError(result.error),\n  error: result.ok ? undefined : {\n    type: String(result.error),\n    retryable: isRetryableError(result.error),\n  },\n});\n```","src/content/docs/advanced/webhooks.md","8dc31bbab63162b1",{"html":297,"metadata":298},"\u003Cp>Expose workflows as HTTP endpoints or event consumers with built-in validation and error mapping.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"webhook-handler\">Webhook handler\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#webhook-handler\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Webhook handler”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Create HTTP handlers for workflows:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWebhookHandler\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createResultMapper\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createExpressHandler\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">requireFields\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/webhook\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create a webhook handler\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handler\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWebhookHandler\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">checkoutWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">input\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">CheckoutInput\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">input\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">sendEmail\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">input\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">email\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">receiptUrl\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">chargeId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">validateInput\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">validation\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">requireFields\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">amount\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">email\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">])(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> (\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">validation\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">validation\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">email\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">email\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">mapResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createResultMapper\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">CARD_DECLINED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">402\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Payment failed\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">INVALID_EMAIL\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">400\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Invalid email address\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { ok } from &#x27;awaitly&#x27;;import {  createWebhookHandler,  createResultMapper,  createExpressHandler,  requireFields,} from &#x27;awaitly/webhook&#x27;;// Create a webhook handlerconst handler = createWebhookHandler(  checkoutWorkflow,  async (step, deps, input: CheckoutInput) => {    const charge = await step(() => deps.chargeCard(input.amount));    await step(() => deps.sendEmail(input.email, charge.receiptUrl));    return { chargeId: charge.id };  },  {    validateInput: (req) => {      const validation = requireFields([&#x27;amount&#x27;, &#x27;email&#x27;])(req.body);      if (!validation.ok) return validation;      return ok({ amount: req.body.amount, email: req.body.email });    },    mapResult: createResultMapper([      { error: &#x27;CARD_DECLINED&#x27;, status: 402, message: &#x27;Payment failed&#x27; },      { error: &#x27;INVALID_EMAIL&#x27;, status: 400, message: &#x27;Invalid email address&#x27; },    ]),  });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"with-express\">With Express\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#with-express\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “With Express”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">express\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">express\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createExpressHandler\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/webhook\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">app\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">express\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">app\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">use\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">express\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Use the built-in adapter\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">app\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">post\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">/checkout\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createExpressHandler\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handler\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Or handle manually\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">app\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">post\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">/checkout\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">response\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">handler\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">method\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">method\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">path\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">path\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">headers\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">headers\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">query\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">query\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">params\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">params\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">response\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">response\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import express from &#x27;express&#x27;;import { createExpressHandler } from &#x27;awaitly/webhook&#x27;;const app = express();app.use(express.json());// Use the built-in adapterapp.post(&#x27;/checkout&#x27;, createExpressHandler(handler));// Or handle manuallyapp.post(&#x27;/checkout&#x27;, async (req, res) => {  const response = await handler({    method: req.method,    path: req.path,    headers: req.headers,    body: req.body,    query: req.query,    params: req.params,  });  res.status(response.status).json(response.body);});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"input-validation\">Input validation\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#input-validation\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Input validation”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use built-in validators or write your own:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">err\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">requireFields\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">validationError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/webhook\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Built-in field checker\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">validate\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">requireFields\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">amount\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">email\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">items\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Custom validation\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">validateInput\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> || \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">validationError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Amount must be positive\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">email\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">?.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">includes\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">@\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">validationError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Invalid email format\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">email\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">email\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { ok, err } from &#x27;awaitly&#x27;;import { requireFields, validationError } from &#x27;awaitly/webhook&#x27;;// Built-in field checkerconst validate = requireFields([&#x27;amount&#x27;, &#x27;email&#x27;, &#x27;items&#x27;]);// Custom validationconst validateInput = (req) => {  if (!req.body.amount || req.body.amount \u003C= 0) {    return err(validationError(&#x27;Amount must be positive&#x27;));  }  if (!req.body.email?.includes(&#x27;@&#x27;)) {    return err(validationError(&#x27;Invalid email format&#x27;));  }  return ok({    amount: req.body.amount,    email: req.body.email,  });};\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"result-mapping\">Result mapping\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#result-mapping\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Result mapping”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Map workflow errors to HTTP responses:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createResultMapper\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/webhook\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mapResult\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createResultMapper\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">404\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Resource not found\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">UNAUTHORIZED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">401\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Authentication required\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">FORBIDDEN\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">403\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Access denied\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">VALIDATION_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">400\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Invalid input\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">CARD_DECLINED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">402\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Payment declined\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Unmapped errors return 500 with generic message\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createResultMapper } from &#x27;awaitly/webhook&#x27;;const mapResult = createResultMapper([  { error: &#x27;NOT_FOUND&#x27;, status: 404, message: &#x27;Resource not found&#x27; },  { error: &#x27;UNAUTHORIZED&#x27;, status: 401, message: &#x27;Authentication required&#x27; },  { error: &#x27;FORBIDDEN&#x27;, status: 403, message: &#x27;Access denied&#x27; },  { error: &#x27;VALIDATION_ERROR&#x27;, status: 400, message: &#x27;Invalid input&#x27; },  { error: &#x27;CARD_DECLINED&#x27;, status: 402, message: &#x27;Payment declined&#x27; },  // Unmapped errors return 500 with generic message]);\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"event-handlers\">Event handlers\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#event-handlers\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Event handlers”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>For message queues (SQS, RabbitMQ, etc.):\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createEventHandler\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/webhook\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handler\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createEventHandler\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">checkoutWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payload\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">CheckoutPayload\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payload\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">chargeId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">validatePayload\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> (\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payload\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">validationError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Missing amount\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payload\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">mapResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => ({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">success\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">ack\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">||\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isRetryableError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">undefined\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">:\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">String\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Use with SQS, RabbitMQ, etc.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">queue\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">consume\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">handler\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">payload\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ack\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ack\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">else\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">nack\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createEventHandler } from &#x27;awaitly/webhook&#x27;;const handler = createEventHandler(  checkoutWorkflow,  async (step, deps, payload: CheckoutPayload) => {    const charge = await step(() => deps.chargeCard(payload.amount));    return { chargeId: charge.id };  },  {    validatePayload: (event) => {      if (!event.payload.amount) {        return err(validationError(&#x27;Missing amount&#x27;));      }      return ok(event.payload);    },    mapResult: (result) => ({      success: result.ok,      ack: result.ok || !isRetryableError(result.error),      error: result.ok ? undefined : { type: String(result.error) },    }),  });// Use with SQS, RabbitMQ, etc.queue.consume(async (message) => {  const result = await handler({    id: message.id,    type: message.type,    payload: message.body,  });  if (result.ack) await message.ack();  else await message.nack();});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"simple-handlers\">Simple handlers\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#simple-handlers\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Simple handlers”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>For straightforward use cases without workflow context:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createSimpleHandler\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/webhook\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handler\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createSimpleHandler\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">input\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">userId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">users\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">find\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">input\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">userId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">as\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> const\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">validateInput\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> (\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">params\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">userId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">validationError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Missing userId\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">userId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">params\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">userId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { ok } from &#x27;awaitly&#x27;;import { createSimpleHandler } from &#x27;awaitly/webhook&#x27;;const handler = createSimpleHandler(  async (input: { userId: string }) => {    const user = await db.users.find(input.userId);    if (!user) return err(&#x27;NOT_FOUND&#x27; as const);    return ok(user);  },  {    validateInput: (req) => {      if (!req.params.userId) {        return err(validationError(&#x27;Missing userId&#x27;));      }      return ok({ userId: req.params.userId });    },  });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"requestresponse-types\">Request/response types\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#requestresponse-types\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Request/response types”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"webhookrequest\">WebhookRequest\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#webhookrequest\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “WebhookRequest”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">interface\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">WebhookRequest\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">method\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">path\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">headers\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Record\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> | \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[]>;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">unknown\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">query\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Record\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">params\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Record\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"interface WebhookRequest {  method: string;  path: string;  headers: Record\u003Cstring, string | string[]>;  body: unknown;  query: Record\u003Cstring, string>;  params: Record\u003Cstring, string>;}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"webhookresponse\">WebhookResponse\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#webhookresponse\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “WebhookResponse”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">interface\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">WebhookResponse\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">unknown\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">headers\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Record\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"interface WebhookResponse {  status: number;  body: unknown;  headers?: Record\u003Cstring, string>;}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"eventrequest\">EventRequest\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#eventrequest\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “EventRequest”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">interface\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">EventRequest\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">T\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payload\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">T\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">metadata\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Record\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">unknown\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"interface EventRequest\u003CT> {  id: string;  type: string;  payload: T;  metadata?: Record\u003Cstring, unknown>;}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"eventresponse\">EventResponse\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#eventresponse\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “EventResponse”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">interface\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">EventResponse\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">success\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">boolean\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ack\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">boolean\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Whether to acknowledge the message\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">; \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">message\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"interface EventResponse {  success: boolean;  ack: boolean;  // Whether to acknowledge the message  error?: { type: string; message?: string };}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"error-handling-patterns\">Error handling patterns\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#error-handling-patterns\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Error handling patterns”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Determine if error is retryable\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isRetryableError\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">unknown\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">boolean\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">retryable\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">TIMEOUT\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">SERVICE_UNAVAILABLE\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">RATE_LIMITED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">];\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> typeof \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> === \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">string\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> &#x26;&#x26; \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">retryable\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">includes\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Custom result mapper with retry logic\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">mapResult\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">success\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">ack\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">||\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isRetryableError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">undefined\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">:\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">String\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">retryable\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isRetryableError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// Determine if error is retryableconst isRetryableError = (error: unknown): boolean => {  const retryable = [&#x27;TIMEOUT&#x27;, &#x27;SERVICE_UNAVAILABLE&#x27;, &#x27;RATE_LIMITED&#x27;];  return typeof error === &#x27;string&#x27; &#x26;&#x26; retryable.includes(error);};// Custom result mapper with retry logicconst mapResult = (result) => ({  success: result.ok,  ack: result.ok || !isRetryableError(result.error),  error: result.ok ? undefined : {    type: String(result.error),    retryable: isRetryableError(result.error),  },});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>",{"headings":299,"localImagePaths":336,"remoteImagePaths":337,"frontmatter":338,"imagePaths":339},[300,303,306,309,312,315,318,321,324,327,330,333],{"depth":57,"slug":301,"text":302},"webhook-handler","Webhook handler",{"depth":57,"slug":304,"text":305},"with-express","With Express",{"depth":57,"slug":307,"text":308},"input-validation","Input validation",{"depth":57,"slug":310,"text":311},"result-mapping","Result mapping",{"depth":57,"slug":313,"text":314},"event-handlers","Event handlers",{"depth":57,"slug":316,"text":317},"simple-handlers","Simple handlers",{"depth":57,"slug":319,"text":320},"requestresponse-types","Request/response types",{"depth":212,"slug":322,"text":323},"webhookrequest","WebhookRequest",{"depth":212,"slug":325,"text":326},"webhookresponse","WebhookResponse",{"depth":212,"slug":328,"text":329},"eventrequest","EventRequest",{"depth":212,"slug":331,"text":332},"eventresponse","EventResponse",{"depth":57,"slug":334,"text":335},"error-handling-patterns","Error handling patterns",[],[],{"title":288,"description":289},[],"concepts/results",{"id":340,"data":342,"body":348,"filePath":349,"digest":350,"rendered":351},{"title":343,"description":344,"editUrl":16,"head":345,"template":46,"sidebar":346,"pagefind":16,"draft":35},"Results","The Result type and how to work with it",[],{"hidden":35,"attrs":347},{},"A `Result\u003CT, E>` represents either success (`ok`) or failure (`err`). It replaces try/catch with explicit typing.\n\n## Creating Results\n\n```typescript\nimport { ok, err, type AsyncResult } from 'awaitly';\n\n// Synchronous\nconst divide = (a: number, b: number): Result\u003Cnumber, 'DIVIDE_BY_ZERO'> =>\n  b === 0 ? err('DIVIDE_BY_ZERO') : ok(a / b);\n\n// Asynchronous\nconst fetchUser = async (id: string): AsyncResult\u003CUser, 'NOT_FOUND'> => {\n  const user = await db.users.find(id);\n  return user ? ok(user) : err('NOT_FOUND');\n};\n```\n\n## Checking Results\n\n```typescript\nconst result = divide(10, 2);\n\nif (result.ok) {\n  console.log(result.value); // 5 - TypeScript knows it's a number\n} else {\n  console.log(result.error); // TypeScript knows it's 'DIVIDE_BY_ZERO'\n}\n```\n\n## Type guards\n\n```typescript\nimport { isOk, isErr } from 'awaitly';\n\nif (isOk(result)) {\n  // result.value is accessible\n}\n\nif (isErr(result)) {\n  // result.error is accessible\n}\n```\n\n## Transforming Results\n\n### map - transform the value\n\n```typescript\nimport { map } from 'awaitly';\n\nconst result = ok(5);\nconst doubled = map(result, (n) => n * 2);\n// ok(10)\n```\n\n### mapError - transform the error\n\n```typescript\nimport { mapError } from 'awaitly';\n\nconst result = err('NOT_FOUND');\nconst mapped = mapError(result, (e) => ({ type: e, status: 404 }));\n// err({ type: 'NOT_FOUND', status: 404 })\n```\n\n### andThen - chain operations\n\n```typescript\nimport { andThen } from 'awaitly';\n\nconst result = ok(10);\nconst chained = andThen(result, (n) =>\n  n > 0 ? ok(n * 2) : err('NEGATIVE')\n);\n// ok(20)\n```\n\n### match - pattern match\n\n```typescript\nimport { match } from 'awaitly';\n\nconst message = match(\n  result,\n  (value) => `Success: ${value}`,\n  (error) => `Error: ${error}`\n);\n```\n\n## Unwrapping\n\n### unwrap - get value or throw\n\n```typescript\nimport { unwrap } from 'awaitly';\n\nconst value = unwrap(result); // Throws if err\n```\n\n### unwrapOr - get value or default\n\n```typescript\nimport { unwrapOr } from 'awaitly';\n\nconst value = unwrapOr(result, 0); // Returns 0 if err\n```\n\n### unwrapOrElse - get value or compute default\n\n```typescript\nimport { unwrapOrElse } from 'awaitly';\n\nconst value = unwrapOrElse(result, (error) => {\n  console.log('Failed with:', error);\n  return 0;\n});\n```\n\n## Wrapping throwing code\n\n### from - wrap sync function\n\n```typescript\nimport { from } from 'awaitly';\n\nconst result = from(() => JSON.parse(jsonString));\n// ok(parsed) or err(Error)\n```\n\n### fromPromise - wrap async function\n\n```typescript\nimport { fromPromise } from 'awaitly';\n\nconst result = await fromPromise(fetch('/api/data'));\n// ok(Response) or err(Error)\n```\n\n### tryAsync - wrap with custom error\n\n```typescript\nimport { tryAsync } from 'awaitly';\n\nconst result = await tryAsync(\n  () => fetch('/api/data').then(r => r.json()),\n  (thrown) => ({ type: 'FETCH_FAILED' as const, cause: thrown })\n);\n```\n\n## Batch operations\n\n### all - fail fast\n\n```typescript\nimport { all } from 'awaitly';\n\nconst results = [ok(1), ok(2), ok(3)];\nconst combined = all(results);\n// ok([1, 2, 3])\n\nconst withError = [ok(1), err('FAILED'), ok(3)];\nconst failed = all(withError);\n// err('FAILED')\n```\n\n### allSettled - collect all\n\n```typescript\nimport { allSettled } from 'awaitly';\n\nconst results = [ok(1), err('A'), ok(3), err('B')];\nconst settled = allSettled(results);\n// ok([\n//   { status: 'ok', value: 1 },\n//   { status: 'err', error: 'A' },\n//   { status: 'ok', value: 3 },\n//   { status: 'err', error: 'B' },\n// ])\n```\n\n### partition - separate successes and failures\n\n```typescript\nimport { partition } from 'awaitly';\n\nconst results = [ok(1), err('A'), ok(3)];\nconst [successes, failures] = partition(results);\n// successes: [1, 3]\n// failures: ['A']\n```\n\n## Async versions\n\nMost operations have async variants for working with promises:\n\n```typescript\nimport { allAsync, anyAsync } from 'awaitly';\n\nconst results = await allAsync([\n  fetchUser('1'),\n  fetchPosts('1'),\n  fetchComments('1'),\n]);\n```\n\n## Next\n\n[Learn about Steps →](/concepts/step/)","src/content/docs/concepts/results.md","979327a934b6790b",{"html":352,"metadata":353},"\u003Cp>A \u003Ccode dir=\"auto\">Result&#x3C;T, E>\u003C/code> represents either success (\u003Ccode dir=\"auto\">ok\u003C/code>) or failure (\u003Ccode dir=\"auto\">err\u003C/code>). It replaces try/catch with explicit typing.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"creating-results\">Creating Results\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#creating-results\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Creating Results”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Synchronous\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">divide\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">a\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">b\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">DIVIDE_BY_ZERO\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">b\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> === \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> ? \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">DIVIDE_BY_ZERO\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> : \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">a\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> / \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">b\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Asynchronous\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">User\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">users\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">find\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> ? \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> : \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { ok, err, type AsyncResult } from &#x27;awaitly&#x27;;// Synchronousconst divide = (a: number, b: number): Result\u003Cnumber, &#x27;DIVIDE_BY_ZERO&#x27;> =>  b === 0 ? err(&#x27;DIVIDE_BY_ZERO&#x27;) : ok(a / b);// Asynchronousconst fetchUser = async (id: string): AsyncResult\u003CUser, &#x27;NOT_FOUND&#x27;> => {  const user = await db.users.find(id);  return user ? ok(user) : err(&#x27;NOT_FOUND&#x27;);};\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"checking-results\">Checking Results\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#checking-results\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Checking Results”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">divide\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">10\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 5 - TypeScript knows it's a number\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">else\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// TypeScript knows it's 'DIVIDE_BY_ZERO'\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = divide(10, 2);if (result.ok) {  console.log(result.value); // 5 - TypeScript knows it&#x27;s a number} else {  console.log(result.error); // TypeScript knows it&#x27;s &#x27;DIVIDE_BY_ZERO&#x27;}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"type-guards\">Type guards\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#type-guards\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Type guards”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isOk\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isErr\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isOk\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// result.value is accessible\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isErr\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// result.error is accessible\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { isOk, isErr } from &#x27;awaitly&#x27;;if (isOk(result)) {  // result.value is accessible}if (isErr(result)) {  // result.error is accessible}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"transforming-results\">Transforming Results\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#transforming-results\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Transforming Results”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"map---transform-the-value\">map - transform the value\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#map---transform-the-value\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “map - transform the value”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">map\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">doubled\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">map\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">n\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">n\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> * \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// ok(10)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { map } from &#x27;awaitly&#x27;;const result = ok(5);const doubled = map(result, (n) => n * 2);// ok(10)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"maperror---transform-the-error\">mapError - transform the error\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#maperror---transform-the-error\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “mapError - transform the error”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mapError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mapped\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">mapError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">404\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// err({ type: 'NOT_FOUND', status: 404 })\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { mapError } from &#x27;awaitly&#x27;;const result = err(&#x27;NOT_FOUND&#x27;);const mapped = mapError(result, (e) => ({ type: e, status: 404 }));// err({ type: &#x27;NOT_FOUND&#x27;, status: 404 })\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"andthen---chain-operations\">andThen - chain operations\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#andthen---chain-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “andThen - chain operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">andThen\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">10\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">chained\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">andThen\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">n\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">n\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> ? \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">n\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> * \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> : \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NEGATIVE\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// ok(20)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { andThen } from &#x27;awaitly&#x27;;const result = ok(10);const chained = andThen(result, (n) =>  n > 0 ? ok(n * 2) : err(&#x27;NEGATIVE&#x27;));// ok(20)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"match---pattern-match\">match - pattern match\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#match---pattern-match\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “match - pattern match”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">match\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">message\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">match\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Success: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">value\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Error: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">error\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { match } from &#x27;awaitly&#x27;;const message = match(  result,  (value) => &#x60;Success: ${value}&#x60;,  (error) => &#x60;Error: ${error}&#x60;);\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"unwrapping\">Unwrapping\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#unwrapping\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Unwrapping”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"unwrap---get-value-or-throw\">unwrap - get value or throw\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#unwrap---get-value-or-throw\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “unwrap - get value or throw”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">unwrap\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">unwrap\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Throws if err\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { unwrap } from &#x27;awaitly&#x27;;const value = unwrap(result); // Throws if err\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"unwrapor---get-value-or-default\">unwrapOr - get value or default\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#unwrapor---get-value-or-default\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “unwrapOr - get value or default”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">unwrapOr\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">unwrapOr\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Returns 0 if err\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { unwrapOr } from &#x27;awaitly&#x27;;const value = unwrapOr(result, 0); // Returns 0 if err\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"unwraporelse---get-value-or-compute-default\">unwrapOrElse - get value or compute default\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#unwraporelse---get-value-or-compute-default\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “unwrapOrElse - get value or compute default”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">unwrapOrElse\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">unwrapOrElse\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Failed with:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { unwrapOrElse } from &#x27;awaitly&#x27;;const value = unwrapOrElse(result, (error) => {  console.log(&#x27;Failed with:&#x27;, error);  return 0;});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"wrapping-throwing-code\">Wrapping throwing code\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#wrapping-throwing-code\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Wrapping throwing code”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"from---wrap-sync-function\">from - wrap sync function\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#from---wrap-sync-function\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “from - wrap sync function”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">from\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">JSON\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">parse\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">jsonString\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// ok(parsed) or err(Error)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { from } from &#x27;awaitly&#x27;;const result = from(() => JSON.parse(jsonString));// ok(parsed) or err(Error)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"frompromise---wrap-async-function\">fromPromise - wrap async function\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#frompromise---wrap-async-function\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “fromPromise - wrap async function”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fromPromise\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fromPromise\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetch\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">/api/data\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// ok(Response) or err(Error)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { fromPromise } from &#x27;awaitly&#x27;;const result = await fromPromise(fetch(&#x27;/api/data&#x27;));// ok(Response) or err(Error)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"tryasync---wrap-with-custom-error\">tryAsync - wrap with custom error\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#tryasync---wrap-with-custom-error\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “tryAsync - wrap with custom error”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">tryAsync\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">tryAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetch\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">/api/data\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">then\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">r\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">r\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">thrown\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">FETCH_FAILED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">as\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">cause\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">thrown\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { tryAsync } from &#x27;awaitly&#x27;;const result = await tryAsync(  () => fetch(&#x27;/api/data&#x27;).then(r => r.json()),  (thrown) => ({ type: &#x27;FETCH_FAILED&#x27; as const, cause: thrown }));\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"batch-operations\">Batch operations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#batch-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Batch operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"all---fail-fast\">all - fail fast\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#all---fail-fast\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “all - fail fast”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">all\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">results\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)];\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">combined\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">all\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">results\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// ok([1, 2, 3])\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">withError\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">FAILED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)];\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">failed\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">all\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">withError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// err('FAILED')\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { all } from &#x27;awaitly&#x27;;const results = [ok(1), ok(2), ok(3)];const combined = all(results);// ok([1, 2, 3])const withError = [ok(1), err(&#x27;FAILED&#x27;), ok(3)];const failed = all(withError);// err(&#x27;FAILED&#x27;)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"allsettled---collect-all\">allSettled - collect all\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#allsettled---collect-all\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “allSettled - collect all”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">allSettled\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">results\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">A\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">B\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)];\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">settled\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">allSettled\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">results\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// ok([\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">//   { status: 'ok', value: 1 },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">//   { status: 'err', error: 'A' },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">//   { status: 'ok', value: 3 },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">//   { status: 'err', error: 'B' },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// ])\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { allSettled } from &#x27;awaitly&#x27;;const results = [ok(1), err(&#x27;A&#x27;), ok(3), err(&#x27;B&#x27;)];const settled = allSettled(results);// ok([//   { status: &#x27;ok&#x27;, value: 1 },//   { status: &#x27;err&#x27;, error: &#x27;A&#x27; },//   { status: &#x27;ok&#x27;, value: 3 },//   { status: &#x27;err&#x27;, error: &#x27;B&#x27; },// ])\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"partition---separate-successes-and-failures\">partition - separate successes and failures\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#partition---separate-successes-and-failures\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “partition - separate successes and failures”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">partition\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">results\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">A\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)];\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">successes\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">failures\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">partition\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">results\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// successes: [1, 3]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// failures: ['A']\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { partition } from &#x27;awaitly&#x27;;const results = [ok(1), err(&#x27;A&#x27;), ok(3)];const [successes, failures] = partition(results);// successes: [1, 3]// failures: [&#x27;A&#x27;]\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"async-versions\">Async versions\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#async-versions\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Async versions”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Most operations have async variants for working with promises:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">allAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">anyAsync\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">results\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">allAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchComments\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { allAsync, anyAsync } from &#x27;awaitly&#x27;;const results = await allAsync([  fetchUser(&#x27;1&#x27;),  fetchPosts(&#x27;1&#x27;),  fetchComments(&#x27;1&#x27;),]);\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/concepts/step/\">Learn about Steps →\u003C/a>\u003C/p>",{"headings":354,"localImagePaths":419,"remoteImagePaths":420,"frontmatter":421,"imagePaths":422},[355,358,361,364,367,370,373,376,379,382,385,388,391,394,397,400,403,404,407,410,413,416],{"depth":57,"slug":356,"text":357},"creating-results","Creating Results",{"depth":57,"slug":359,"text":360},"checking-results","Checking Results",{"depth":57,"slug":362,"text":363},"type-guards","Type guards",{"depth":57,"slug":365,"text":366},"transforming-results","Transforming Results",{"depth":212,"slug":368,"text":369},"map---transform-the-value","map - transform the value",{"depth":212,"slug":371,"text":372},"maperror---transform-the-error","mapError - transform the error",{"depth":212,"slug":374,"text":375},"andthen---chain-operations","andThen - chain operations",{"depth":212,"slug":377,"text":378},"match---pattern-match","match - pattern match",{"depth":57,"slug":380,"text":381},"unwrapping","Unwrapping",{"depth":212,"slug":383,"text":384},"unwrap---get-value-or-throw","unwrap - get value or throw",{"depth":212,"slug":386,"text":387},"unwrapor---get-value-or-default","unwrapOr - get value or default",{"depth":212,"slug":389,"text":390},"unwraporelse---get-value-or-compute-default","unwrapOrElse - get value or compute default",{"depth":57,"slug":392,"text":393},"wrapping-throwing-code","Wrapping throwing code",{"depth":212,"slug":395,"text":396},"from---wrap-sync-function","from - wrap sync function",{"depth":212,"slug":398,"text":399},"frompromise---wrap-async-function","fromPromise - wrap async function",{"depth":212,"slug":401,"text":402},"tryasync---wrap-with-custom-error","tryAsync - wrap with custom error",{"depth":57,"slug":258,"text":259},{"depth":212,"slug":405,"text":406},"all---fail-fast","all - fail fast",{"depth":212,"slug":408,"text":409},"allsettled---collect-all","allSettled - collect all",{"depth":212,"slug":411,"text":412},"partition---separate-successes-and-failures","partition - separate successes and failures",{"depth":57,"slug":414,"text":415},"async-versions","Async versions",{"depth":57,"slug":417,"text":418},"next","Next",[],[],{"title":343,"description":344},[],"concepts/step",{"id":423,"data":425,"body":431,"filePath":432,"digest":433,"rendered":434},{"title":426,"description":427,"editUrl":16,"head":428,"template":46,"sidebar":429,"pagefind":16,"draft":35},"Steps","The step() function and its variants",[],{"hidden":35,"attrs":430},{},"`step()` executes an operation within a workflow. If the operation fails, the workflow exits early.\n\n## Basic usage\n\n```typescript\nconst workflow = createWorkflow({ fetchUser, fetchPosts });\n\nconst result = await workflow(async (step) => {\n  const user = await step(fetchUser('1'));\n  // If fetchUser returns err(), execution stops here\n  const posts = await step(fetchPosts(user.id));\n  return { user, posts };\n});\n```\n\n## Using thunks for caching\n\nPass a function (thunk) instead of calling directly to enable caching:\n\n```typescript\n// Without thunk - always executes\nconst user = await step(fetchUser('1'));\n\n// With thunk - can be cached\nconst user = await step(() => fetchUser('1'), { key: 'user:1' });\n```\n\n## Step options\n\n```typescript\nconst user = await step(() => fetchUser('1'), {\n  name: 'Fetch user',       // For visualization/logging\n  key: 'user:1',            // For caching/deduplication\n  retry: { attempts: 3 },   // Retry on failure\n  timeout: { ms: 5000 },    // Timeout after 5 seconds\n});\n```\n\n## step.try - wrap throwing code\n\nConvert exceptions into typed errors:\n\n```typescript\nconst data = await step.try(\n  async () => {\n    const res = await fetch('/api/data');\n    if (!res.ok) throw new Error(`HTTP ${res.status}`);\n    return res.json();\n  },\n  { error: 'FETCH_FAILED' as const }\n);\n```\n\nThe error type is added to the workflow's error union.\n\n## step.fromResult - preserve error details\n\nWhen your operation returns a Result with rich error objects:\n\n```typescript\ntype ApiError = { code: number; message: string };\n\nconst callApi = async (): AsyncResult\u003CData, ApiError> => {\n  // Returns err({ code: 429, message: 'Rate limited' })\n};\n\nconst data = await step.fromResult(\n  () => callApi(),\n  {\n    onError: (apiError) => ({\n      type: 'API_ERROR' as const,\n      ...apiError,\n    }),\n  }\n);\n```\n\n## step.retry - retry with backoff\n\n```typescript\nconst user = await step.retry(\n  () => fetchUser('1'),\n  {\n    attempts: 3,\n    backoff: 'exponential',  // 'fixed' | 'linear' | 'exponential'\n    delayMs: 100,            // Base delay\n    maxDelayMs: 5000,        // Cap for exponential\n    jitter: true,            // Add randomness\n    retryOn: (error) => error !== 'NOT_FOUND', // Don't retry NOT_FOUND\n  }\n);\n```\n\nBackoff strategies:\n- **fixed**: Same delay every time\n- **linear**: delay, delay*2, delay*3, ...\n- **exponential**: delay, delay*2, delay*4, delay*8, ...\n\n## step.withTimeout - add timeout\n\n```typescript\nconst data = await step.withTimeout(\n  () => slowOperation(),\n  {\n    ms: 5000,\n    name: 'Slow operation', // For error messages\n  }\n);\n```\n\nIf the timeout is reached, the workflow gets a `StepTimeoutError`.\n\n## Combining retry and timeout\n\n```typescript\nconst data = await step.retry(\n  () => step.withTimeout(() => fetchData(), { ms: 2000 }),\n  { attempts: 3, backoff: 'exponential' }\n);\n```\n\nEach attempt has a 2-second timeout. The whole operation retries up to 3 times.\n\n## Parallel steps\n\nRun multiple steps concurrently:\n\n```typescript\nimport { allAsync } from 'awaitly';\n\nconst result = await workflow(async (step) => {\n  const [user, posts, comments] = await step(() =>\n    allAsync([\n      fetchUser('1'),\n      fetchPosts('1'),\n      fetchComments('1'),\n    ])\n  );\n  return { user, posts, comments };\n});\n```\n\n## Named steps for visualization\n\nGive steps names to see them in workflow diagrams:\n\n```typescript\nconst user = await step(() => fetchUser('1'), { name: 'Fetch user' });\nconst posts = await step(() => fetchPosts(user.id), { name: 'Fetch posts' });\n```\n\nSee [Visualization](/guides/visualization/) for details.\n\n## Next\n\n[Learn about Workflows →](/concepts/workflows/)","src/content/docs/concepts/step.md","d099a49ff298b925",{"html":435,"metadata":436},"\u003Cp>\u003Ccode dir=\"auto\">step()\u003C/code> executes an operation within a workflow. If the operation fails, the workflow exits early.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"basic-usage\">Basic usage\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#basic-usage\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Basic usage”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// If fetchUser returns err(), execution stops here\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const workflow = createWorkflow({ fetchUser, fetchPosts });const result = await workflow(async (step) => {  const user = await step(fetchUser(&#x27;1&#x27;));  // If fetchUser returns err(), execution stops here  const posts = await step(fetchPosts(user.id));  return { user, posts };});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"using-thunks-for-caching\">Using thunks for caching\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#using-thunks-for-caching\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Using thunks for caching”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Pass a function (thunk) instead of calling directly to enable caching:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Without thunk - always executes\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// With thunk - can be cached\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// Without thunk - always executesconst user = await step(fetchUser(&#x27;1&#x27;));// With thunk - can be cachedconst user = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"step-options\">Step options\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#step-options\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Step options”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Fetch user\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,       \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// For visualization/logging\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,            \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// For caching/deduplication\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">retry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">attempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },   \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Retry on failure\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">timeout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">ms\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Timeout after 5 seconds\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const user = await step(() => fetchUser(&#x27;1&#x27;), {  name: &#x27;Fetch user&#x27;,       // For visualization/logging  key: &#x27;user:1&#x27;,            // For caching/deduplication  retry: { attempts: 3 },   // Retry on failure  timeout: { ms: 5000 },    // Timeout after 5 seconds});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"steptry---wrap-throwing-code\">step.try - wrap throwing code\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#steptry---wrap-throwing-code\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “step.try - wrap throwing code”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Convert exceptions into typed errors:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">try\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetch\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">/api/data\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">throw\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> new \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">Error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">HTTP \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">status\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">FETCH_FAILED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">as\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const data = await step.try(  async () => {    const res = await fetch(&#x27;/api/data&#x27;);    if (!res.ok) throw new Error(&#x60;HTTP ${res.status}&#x60;);    return res.json();  },  { error: &#x27;FETCH_FAILED&#x27; as const });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>The error type is added to the workflow’s error union.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"stepfromresult---preserve-error-details\">step.fromResult - preserve error details\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#stepfromresult---preserve-error-details\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “step.fromResult - preserve error details”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>When your operation returns a Result with rich error objects:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">ApiError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">code\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">callApi\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">():\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">ApiError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Returns err({ code: 429, message: 'Rate limited' })\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fromResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">callApi\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">apiError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => ({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">API_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">as\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">apiError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"type ApiError = { code: number; message: string };const callApi = async (): AsyncResult\u003CData, ApiError> => {  // Returns err({ code: 429, message: &#x27;Rate limited&#x27; })};const data = await step.fromResult(  () => callApi(),  {    onError: (apiError) => ({      type: &#x27;API_ERROR&#x27; as const,      ...apiError,    }),  });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"stepretry---retry-with-backoff\">step.retry - retry with backoff\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#stepretry---retry-with-backoff\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “step.retry - retry with backoff”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">attempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">backoff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">exponential\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 'fixed' | 'linear' | 'exponential'\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">delayMs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">100\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,            \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Base delay\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxDelayMs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Cap for exponential\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">jitter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,            \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Add randomness\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retryOn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!==\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Don't retry NOT_FOUND\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const user = await step.retry(  () => fetchUser(&#x27;1&#x27;),  {    attempts: 3,    backoff: &#x27;exponential&#x27;,  // &#x27;fixed&#x27; | &#x27;linear&#x27; | &#x27;exponential&#x27;    delayMs: 100,            // Base delay    maxDelayMs: 5000,        // Cap for exponential    jitter: true,            // Add randomness    retryOn: (error) => error !== &#x27;NOT_FOUND&#x27;, // Don&#x27;t retry NOT_FOUND  });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>Backoff strategies:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>fixed\u003C/strong>: Same delay every time\u003C/li>\n\u003Cli>\u003Cstrong>linear\u003C/strong>: delay, delay\u003Cem>2, delay\u003C/em>3, …\u003C/li>\n\u003Cli>\u003Cstrong>exponential\u003C/strong>: delay, delay\u003Cem>2, delay\u003C/em>4, delay*8, …\u003C/li>\n\u003C/ul>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"stepwithtimeout---add-timeout\">step.withTimeout - add timeout\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#stepwithtimeout---add-timeout\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “step.withTimeout - add timeout”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withTimeout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">slowOperation\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">ms\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Slow operation\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// For error messages\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const data = await step.withTimeout(  () => slowOperation(),  {    ms: 5000,    name: &#x27;Slow operation&#x27;, // For error messages  });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>If the timeout is reached, the workflow gets a \u003Ccode dir=\"auto\">StepTimeoutError\u003C/code>.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"combining-retry-and-timeout\">Combining retry and timeout\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#combining-retry-and-timeout\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Combining retry and timeout”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withTimeout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchData\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">ms\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">2000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">attempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">backoff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">exponential\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const data = await step.retry(  () => step.withTimeout(() => fetchData(), { ms: 2000 }),  { attempts: 3, backoff: &#x27;exponential&#x27; });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>Each attempt has a 2-second timeout. The whole operation retries up to 3 times.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"parallel-steps\">Parallel steps\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#parallel-steps\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Parallel steps”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Run multiple steps concurrently:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">allAsync\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">comments\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">allAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchComments\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">])\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">comments\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { allAsync } from &#x27;awaitly&#x27;;const result = await workflow(async (step) => {  const [user, posts, comments] = await step(() =>    allAsync([      fetchUser(&#x27;1&#x27;),      fetchPosts(&#x27;1&#x27;),      fetchComments(&#x27;1&#x27;),    ])  );  return { user, posts, comments };});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"named-steps-for-visualization\">Named steps for visualization\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#named-steps-for-visualization\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Named steps for visualization”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Give steps names to see them in workflow diagrams:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Fetch user\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Fetch posts\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const user = await step(() => fetchUser(&#x27;1&#x27;), { name: &#x27;Fetch user&#x27; });const posts = await step(() => fetchPosts(user.id), { name: &#x27;Fetch posts&#x27; });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>See \u003Ca href=\"/guides/visualization/\">Visualization\u003C/a> for details.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/concepts/workflows/\">Learn about Workflows →\u003C/a>\u003C/p>",{"headings":437,"localImagePaths":467,"remoteImagePaths":468,"frontmatter":469,"imagePaths":470},[438,439,442,445,448,451,454,457,460,463,466],{"depth":57,"slug":58,"text":59},{"depth":57,"slug":440,"text":441},"using-thunks-for-caching","Using thunks for caching",{"depth":57,"slug":443,"text":444},"step-options","Step options",{"depth":57,"slug":446,"text":447},"steptry---wrap-throwing-code","step.try - wrap throwing code",{"depth":57,"slug":449,"text":450},"stepfromresult---preserve-error-details","step.fromResult - preserve error details",{"depth":57,"slug":452,"text":453},"stepretry---retry-with-backoff","step.retry - retry with backoff",{"depth":57,"slug":455,"text":456},"stepwithtimeout---add-timeout","step.withTimeout - add timeout",{"depth":57,"slug":458,"text":459},"combining-retry-and-timeout","Combining retry and timeout",{"depth":57,"slug":461,"text":462},"parallel-steps","Parallel steps",{"depth":57,"slug":464,"text":465},"named-steps-for-visualization","Named steps for visualization",{"depth":57,"slug":417,"text":418},[],[],{"title":426,"description":427},[],"concepts/tagged-errors",{"id":471,"data":473,"body":479,"filePath":480,"digest":481,"rendered":482},{"title":474,"description":475,"editUrl":16,"head":476,"template":46,"sidebar":477,"pagefind":16,"draft":35},"Tagged Errors","Rich error types with exhaustive pattern matching",[],{"hidden":35,"attrs":478},{},"String literal errors like `'NOT_FOUND'` work for simple cases. When you need errors with contextual data, use `TaggedError`.\n\n## When to use what\n\n| Use case | Recommendation |\n|----------|---------------|\n| Simple distinct states | String literals: `'NOT_FOUND' \\| 'UNAUTHORIZED'` |\n| Errors with context | TaggedError: `NotFoundError { id, resource }` |\n| Multiple variants to handle | TaggedError with `match()` |\n| API responses | TaggedError for structured data |\n\n## Creating tagged errors\n\n```typescript\nimport { TaggedError } from 'awaitly';\n\n// Pattern 1: Props via generic\nclass NotFoundError extends TaggedError('NotFoundError')\u003C{\n  resource: string;\n  id: string;\n}> {}\n\n// Pattern 2: Custom message\nclass ValidationError extends TaggedError('ValidationError', {\n  message: (p: { field: string; reason: string }) =>\n    `Validation failed for ${p.field}: ${p.reason}`,\n}) {}\n\n// Pattern 3: No props\nclass UnauthorizedError extends TaggedError('UnauthorizedError') {}\n```\n\n## Using tagged errors\n\n```typescript\nconst fetchUser = async (id: string): AsyncResult\u003CUser, NotFoundError | UnauthorizedError> => {\n  if (!session.isValid) {\n    return err(new UnauthorizedError());\n  }\n  const user = await db.users.find(id);\n  if (!user) {\n    return err(new NotFoundError({ resource: 'User', id }));\n  }\n  return ok(user);\n};\n```\n\n## Pattern matching with match()\n\n`TaggedError.match` forces exhaustive handling:\n\n```typescript\nconst workflow = createWorkflow({ fetchUser, updateProfile });\n\nconst result = await workflow(async (step) => {\n  const user = await step(fetchUser('123'));\n  return await step(updateProfile(user.id, data));\n});\n\nif (!result.ok) {\n  const response = TaggedError.match(result.error, {\n    NotFoundError: (e) => ({\n      status: 404,\n      body: { error: 'not_found', resource: e.resource, id: e.id },\n    }),\n    UnauthorizedError: () => ({\n      status: 401,\n      body: { error: 'unauthorized' },\n    }),\n    ValidationError: (e) => ({\n      status: 400,\n      body: { error: 'validation', field: e.field, reason: e.reason },\n    }),\n  });\n\n  return res.status(response.status).json(response.body);\n}\n```\n\nAdd a new error type? TypeScript errors until you handle it.\n\n## Partial matching\n\nHandle specific errors with a fallback:\n\n```typescript\nconst message = TaggedError.matchPartial(\n  result.error,\n  {\n    RateLimitError: (e) => `Please wait ${e.retryAfter} seconds`,\n  },\n  (e) => `Something went wrong: ${e.message}` // Fallback\n);\n```\n\n## Type helpers\n\n```typescript\nimport { type TagOf, type ErrorByTag } from 'awaitly';\n\ntype AllErrors = NotFoundError | ValidationError | RateLimitError;\n\n// Extract tag literals\ntype Tags = TagOf\u003CAllErrors>;\n// 'NotFoundError' | 'ValidationError' | 'RateLimitError'\n\n// Extract specific variant\ntype NotFound = ErrorByTag\u003CAllErrors, 'NotFoundError'>;\n// NotFoundError\n```\n\n## Runtime checks\n\nTagged errors support `instanceof`:\n\n```typescript\nconst error = new NotFoundError({ resource: 'User', id: '123' });\n\nconsole.log(error instanceof TaggedError);  // true\nconsole.log(error instanceof NotFoundError); // true\nconsole.log(error._tag);                     // 'NotFoundError'\nconsole.log(error.resource);                 // 'User'\nconsole.log(error.message);                  // 'NotFoundError'\n```\n\n## Error chaining\n\nLink to the original error via `ErrorOptions.cause`:\n\n```typescript\ntry {\n  await fetch('/api');\n} catch (original) {\n  throw new NetworkError(\n    { url: '/api', statusCode: 500 },\n    { cause: original } // Chain to original error\n  );\n}\n```\n\n## Real-world example\n\n```typescript\n// Define error types\nclass PaymentDeclinedError extends TaggedError('PaymentDeclinedError', {\n  message: (p: { reason: 'insufficient_funds' | 'card_expired' | 'fraud' }) =>\n    `Payment declined: ${p.reason}`,\n}) {}\n\nclass PaymentProviderError extends TaggedError('PaymentProviderError', {\n  message: (p: { provider: string; statusCode: number }) =>\n    `${p.provider} returned ${p.statusCode}`,\n}) {}\n\n// Use in workflow\nconst processPayment = async (\n  amount: number\n): AsyncResult\u003CReceipt, PaymentDeclinedError | PaymentProviderError> => {\n  const response = await paymentProvider.charge(amount);\n\n  if (response.declined) {\n    return err(new PaymentDeclinedError({ reason: response.declineReason }));\n  }\n  if (!response.ok) {\n    return err(new PaymentProviderError({\n      provider: 'Stripe',\n      statusCode: response.status,\n    }));\n  }\n  return ok(response.receipt);\n};\n\n// Handle errors\nif (!result.ok) {\n  TaggedError.match(result.error, {\n    PaymentDeclinedError: (e) => {\n      switch (e.reason) {\n        case 'insufficient_funds':\n          notifyUser('Please use a different card');\n          break;\n        case 'card_expired':\n          notifyUser('Your card has expired');\n          break;\n        case 'fraud':\n          alertFraudTeam(e);\n          break;\n      }\n    },\n    PaymentProviderError: (e) => {\n      logToDatadog({ provider: e.provider, status: e.statusCode });\n      retryWithBackup(e.provider);\n    },\n  });\n}\n```\n\n## Reserved keys\n\nThese property names are reserved and cannot be used in props:\n\n| Key | Reason |\n|-----|--------|\n| `_tag` | Discriminant for pattern matching |\n| `name` | Error.name (stack traces) |\n| `message` | Error.message (logs) |\n| `stack` | Error.stack (stack trace) |\n\n```typescript\n// Don't do this\nclass BadExample extends TaggedError('BadExample')\u003C{\n  message: string; // Won't work - use 'details' instead\n}> {}\n\n// Do this\nclass GoodExample extends TaggedError('GoodExample')\u003C{\n  details: string;\n}> {}\n```\n\n## Next\n\n[Learn about Retries & Timeouts →](/guides/retries-timeouts/)","src/content/docs/concepts/tagged-errors.md","e0d0e4f01aa18e3c",{"html":483,"metadata":484},"\u003Cp>String literal errors like \u003Ccode dir=\"auto\">'NOT_FOUND'\u003C/code> work for simple cases. When you need errors with contextual data, use \u003Ccode dir=\"auto\">TaggedError\u003C/code>.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"when-to-use-what\">When to use what\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#when-to-use-what\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “When to use what”\u003C/span>\u003C/a>\u003C/div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Use case\u003C/th>\u003Cth>Recommendation\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Simple distinct states\u003C/td>\u003Ctd>String literals: \u003Ccode dir=\"auto\">'NOT_FOUND' | 'UNAUTHORIZED'\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Errors with context\u003C/td>\u003Ctd>TaggedError: \u003Ccode dir=\"auto\">NotFoundError { id, resource }\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Multiple variants to handle\u003C/td>\u003Ctd>TaggedError with \u003Ccode dir=\"auto\">match()\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>API responses\u003C/td>\u003Ctd>TaggedError for structured data\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"creating-tagged-errors\">Creating tagged errors\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#creating-tagged-errors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Creating tagged errors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">TaggedError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Pattern 1: Props via generic\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">class\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">NotFoundError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">extends\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">TaggedError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NotFoundError\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)&#x3C;{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">resource\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Pattern 2: Custom message\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">class\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">ValidationError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">extends\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">TaggedError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">ValidationError\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">field\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">; \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reason\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }) =>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Validation failed for \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">field\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">reason\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">})\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Pattern 3: No props\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">class\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">UnauthorizedError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">extends\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">TaggedError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">UnauthorizedError\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { TaggedError } from &#x27;awaitly&#x27;;// Pattern 1: Props via genericclass NotFoundError extends TaggedError(&#x27;NotFoundError&#x27;)\u003C{  resource: string;  id: string;}> {}// Pattern 2: Custom messageclass ValidationError extends TaggedError(&#x27;ValidationError&#x27;, {  message: (p: { field: string; reason: string }) =>    &#x60;Validation failed for ${p.field}: ${p.reason}&#x60;,}) {}// Pattern 3: No propsclass UnauthorizedError extends TaggedError(&#x27;UnauthorizedError&#x27;) {}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"using-tagged-errors\">Using tagged errors\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#using-tagged-errors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Using tagged errors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">User\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">NotFoundError\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">|\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">UnauthorizedError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">session\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isValid\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">new \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">UnauthorizedError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">users\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">find\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">new \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">NotFoundError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">resource\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">User\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const fetchUser = async (id: string): AsyncResult\u003CUser, NotFoundError | UnauthorizedError> => {  if (!session.isValid) {    return err(new UnauthorizedError());  }  const user = await db.users.find(id);  if (!user) {    return err(new NotFoundError({ resource: &#x27;User&#x27;, id }));  }  return ok(user);};\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"pattern-matching-with-match\">Pattern matching with match()\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#pattern-matching-with-match\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Pattern matching with match()”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ccode dir=\"auto\">TaggedError.match\u003C/code> forces exhaustive handling:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">updateProfile\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">updateProfile\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">response\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">TaggedError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">match\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">NotFoundError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => ({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">404\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">not_found\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">resource\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">resource\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">UnauthorizedError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: () => ({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">401\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">unauthorized\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ValidationError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => ({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">400\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">validation\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">field\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">field\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">reason\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reason\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">response\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">response\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const workflow = createWorkflow({ fetchUser, updateProfile });const result = await workflow(async (step) => {  const user = await step(fetchUser(&#x27;123&#x27;));  return await step(updateProfile(user.id, data));});if (!result.ok) {  const response = TaggedError.match(result.error, {    NotFoundError: (e) => ({      status: 404,      body: { error: &#x27;not_found&#x27;, resource: e.resource, id: e.id },    }),    UnauthorizedError: () => ({      status: 401,      body: { error: &#x27;unauthorized&#x27; },    }),    ValidationError: (e) => ({      status: 400,      body: { error: &#x27;validation&#x27;, field: e.field, reason: e.reason },    }),  });  return res.status(response.status).json(response.body);}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>Add a new error type? TypeScript errors until you handle it.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"partial-matching\">Partial matching\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#partial-matching\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Partial matching”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Handle specific errors with a fallback:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">message\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">TaggedError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">matchPartial\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">RateLimitError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Please wait \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">retryAfter\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> seconds\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Something went wrong: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">message\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Fallback\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const message = TaggedError.matchPartial(  result.error,  {    RateLimitError: (e) => &#x60;Please wait ${e.retryAfter} seconds&#x60;,  },  (e) => &#x60;Something went wrong: ${e.message}&#x60; // Fallback);\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"type-helpers\">Type helpers\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#type-helpers\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Type helpers”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">TagOf\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ErrorByTag\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AllErrors\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">NotFoundError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">|\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">ValidationError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">|\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">RateLimitError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Extract tag literals\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Tags\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">TagOf\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AllErrors\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 'NotFoundError' | 'ValidationError' | 'RateLimitError'\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Extract specific variant\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">NotFound\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">ErrorByTag\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AllErrors\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NotFoundError\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// NotFoundError\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { type TagOf, type ErrorByTag } from &#x27;awaitly&#x27;;type AllErrors = NotFoundError | ValidationError | RateLimitError;// Extract tag literalstype Tags = TagOf\u003CAllErrors>;// &#x27;NotFoundError&#x27; | &#x27;ValidationError&#x27; | &#x27;RateLimitError&#x27;// Extract specific varianttype NotFound = ErrorByTag\u003CAllErrors, &#x27;NotFoundError&#x27;>;// NotFoundError\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"runtime-checks\">Runtime checks\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#runtime-checks\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Runtime checks”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Tagged errors support \u003Ccode dir=\"auto\">instanceof\u003C/code>:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> new \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">NotFoundError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">resource\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">User\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">instanceof\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">TaggedError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// true\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">instanceof\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">NotFoundError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// true\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">_tag\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 'NotFoundError'\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">resource\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                 \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 'User'\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 'NotFoundError'\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const error = new NotFoundError({ resource: &#x27;User&#x27;, id: &#x27;123&#x27; });console.log(error instanceof TaggedError);  // trueconsole.log(error instanceof NotFoundError); // trueconsole.log(error._tag);                     // &#x27;NotFoundError&#x27;console.log(error.resource);                 // &#x27;User&#x27;console.log(error.message);                  // &#x27;NotFoundError&#x27;\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"error-chaining\">Error chaining\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#error-chaining\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Error chaining”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Link to the original error via \u003Ccode dir=\"auto\">ErrorOptions.cause\u003C/code>:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">try\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetch\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">/api\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">catch\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">original\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">throw\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">new\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">NetworkError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">url\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">/api\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">statusCode\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">500\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">cause\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">original\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Chain to original error\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"try {  await fetch(&#x27;/api&#x27;);} catch (original) {  throw new NetworkError(    { url: &#x27;/api&#x27;, statusCode: 500 },    { cause: original } // Chain to original error  );}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"real-world-example\">Real-world example\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#real-world-example\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Real-world example”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Define error types\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">class\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">PaymentDeclinedError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">extends\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">TaggedError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">PaymentDeclinedError\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reason\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">insufficient_funds\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> | \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">card_expired\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> | \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">fraud\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }) =>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Payment declined: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">reason\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">})\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">class\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">PaymentProviderError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">extends\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">TaggedError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">PaymentProviderError\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">provider\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">; \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">statusCode\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }) =>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">provider\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> returned \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">statusCode\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">})\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Use in workflow\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processPayment\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">number\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Receipt\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">PaymentDeclinedError\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">|\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">PaymentProviderError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">response\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">paymentProvider\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">response\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">declined\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">new \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">PaymentDeclinedError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">reason\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">response\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">declineReason\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">response\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">new \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">PaymentProviderError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">provider\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Stripe\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">statusCode\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">response\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">response\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">receipt\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Handle errors\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">TaggedError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">match\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">PaymentDeclinedError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">switch\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reason\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">case\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">insufficient_funds\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">          \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">notifyUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Please use a different card\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">          \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">break\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">case\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">card_expired\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">          \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">notifyUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Your card has expired\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">          \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">break\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">case\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">fraud\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">          \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">alertFraudTeam\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">          \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">break\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">PaymentProviderError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">logToDatadog\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">provider\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">provider\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">statusCode\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retryWithBackup\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">provider\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// Define error typesclass PaymentDeclinedError extends TaggedError(&#x27;PaymentDeclinedError&#x27;, {  message: (p: { reason: &#x27;insufficient_funds&#x27; | &#x27;card_expired&#x27; | &#x27;fraud&#x27; }) =>    &#x60;Payment declined: ${p.reason}&#x60;,}) {}class PaymentProviderError extends TaggedError(&#x27;PaymentProviderError&#x27;, {  message: (p: { provider: string; statusCode: number }) =>    &#x60;${p.provider} returned ${p.statusCode}&#x60;,}) {}// Use in workflowconst processPayment = async (  amount: number): AsyncResult\u003CReceipt, PaymentDeclinedError | PaymentProviderError> => {  const response = await paymentProvider.charge(amount);  if (response.declined) {    return err(new PaymentDeclinedError({ reason: response.declineReason }));  }  if (!response.ok) {    return err(new PaymentProviderError({      provider: &#x27;Stripe&#x27;,      statusCode: response.status,    }));  }  return ok(response.receipt);};// Handle errorsif (!result.ok) {  TaggedError.match(result.error, {    PaymentDeclinedError: (e) => {      switch (e.reason) {        case &#x27;insufficient_funds&#x27;:          notifyUser(&#x27;Please use a different card&#x27;);          break;        case &#x27;card_expired&#x27;:          notifyUser(&#x27;Your card has expired&#x27;);          break;        case &#x27;fraud&#x27;:          alertFraudTeam(e);          break;      }    },    PaymentProviderError: (e) => {      logToDatadog({ provider: e.provider, status: e.statusCode });      retryWithBackup(e.provider);    },  });}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"reserved-keys\">Reserved keys\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#reserved-keys\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Reserved keys”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>These property names are reserved and cannot be used in props:\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Key\u003C/th>\u003Cth>Reason\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">_tag\u003C/code>\u003C/td>\u003Ctd>Discriminant for pattern matching\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">name\u003C/code>\u003C/td>\u003Ctd>Error.name (stack traces)\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">message\u003C/code>\u003C/td>\u003Ctd>Error.message (logs)\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">stack\u003C/code>\u003C/td>\u003Ctd>Error.stack (stack trace)\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Don't do this\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">class\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">BadExample\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">extends\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">TaggedError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">BadExample\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)&#x3C;{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Won't work - use 'details' instead\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Do this\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">class\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">GoodExample\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">extends\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">TaggedError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">GoodExample\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)&#x3C;{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">details\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// Don&#x27;t do thisclass BadExample extends TaggedError(&#x27;BadExample&#x27;)\u003C{  message: string; // Won&#x27;t work - use &#x27;details&#x27; instead}> {}// Do thisclass GoodExample extends TaggedError(&#x27;GoodExample&#x27;)\u003C{  details: string;}> {}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/guides/retries-timeouts/\">Learn about Retries &#x26; Timeouts →\u003C/a>\u003C/p>",{"headings":485,"localImagePaths":517,"remoteImagePaths":518,"frontmatter":519,"imagePaths":520},[486,489,492,495,498,501,504,507,510,513,516],{"depth":57,"slug":487,"text":488},"when-to-use-what","When to use what",{"depth":57,"slug":490,"text":491},"creating-tagged-errors","Creating tagged errors",{"depth":57,"slug":493,"text":494},"using-tagged-errors","Using tagged errors",{"depth":57,"slug":496,"text":497},"pattern-matching-with-match","Pattern matching with match()",{"depth":57,"slug":499,"text":500},"partial-matching","Partial matching",{"depth":57,"slug":502,"text":503},"type-helpers","Type helpers",{"depth":57,"slug":505,"text":506},"runtime-checks","Runtime checks",{"depth":57,"slug":508,"text":509},"error-chaining","Error chaining",{"depth":57,"slug":511,"text":512},"real-world-example","Real-world example",{"depth":57,"slug":514,"text":515},"reserved-keys","Reserved keys",{"depth":57,"slug":417,"text":418},[],[],{"title":474,"description":475},[],"concepts/workflows",{"id":521,"data":523,"body":529,"filePath":530,"digest":531,"rendered":532},{"title":524,"description":525,"editUrl":16,"head":526,"template":46,"sidebar":527,"pagefind":16,"draft":35},"Workflows","createWorkflow vs run() and when to use each",[],{"hidden":35,"attrs":528},{},"There are two ways to run workflows: `createWorkflow` for reusable workflows with dependency inference, and `run` for one-off operations.\n\n## createWorkflow\n\nCreates a reusable workflow with automatic error type inference from dependencies:\n\n```typescript\nimport { ok, err, type AsyncResult } from 'awaitly';\nimport { createWorkflow } from 'awaitly/workflow';\n\nconst fetchUser = async (id: string): AsyncResult\u003CUser, 'NOT_FOUND'> => { ... };\nconst sendEmail = async (to: string): AsyncResult\u003Cvoid, 'EMAIL_FAILED'> => { ... };\n\n// Error types inferred from dependencies\nconst workflow = createWorkflow({ fetchUser, sendEmail });\n\nconst result = await workflow(async (step) => {\n  const user = await step(fetchUser('1'));\n  await step(sendEmail(user.email));\n  return user;\n});\n// result.error is: 'NOT_FOUND' | 'EMAIL_FAILED' | UnexpectedError\n```\n\n### With options\n\n```typescript\nconst workflow = createWorkflow(\n  { fetchUser, sendEmail },\n  {\n    cache: new Map(),                    // Enable step caching\n    onEvent: (event) => console.log(event), // Event stream\n    strict: true,                        // Force explicit error handling\n  }\n);\n```\n\n## run()\n\nFor one-off workflows where you specify error types manually:\n\n```typescript\nimport { run } from 'awaitly';\n\nconst result = await run\u003CUser, 'NOT_FOUND' | 'EMAIL_FAILED'>(\n  async (step) => {\n    const user = await step(fetchUser('1'));\n    await step(sendEmail(user.email));\n    return user;\n  }\n);\n```\n\n## When to use each\n\n| Scenario | Use |\n|----------|-----|\n| Dependencies known at compile time | `createWorkflow` |\n| Dependencies passed as parameters | `run` |\n| Need step caching or resume | `createWorkflow` |\n| Need automatic error inference | `createWorkflow` |\n| One-off workflow | `run` |\n| Testing with mocks | `run` |\n\n## Workflow options\n\n### cache\n\nEnable step caching to avoid re-executing completed steps:\n\n```typescript\nconst workflow = createWorkflow(deps, {\n  cache: new Map(),\n});\n\nconst result = await workflow(async (step) => {\n  // This step runs once, even if workflow is called multiple times\n  const user = await step(() => fetchUser('1'), { key: 'user:1' });\n  return user;\n});\n```\n\n### resumeState\n\nResume a workflow from saved state:\n\n```typescript\nconst workflow = createWorkflow(deps, {\n  resumeState: savedState, // From a previous run\n});\n\nconst result = await workflow(async (step) => {\n  // Cached steps return their saved values\n  const user = await step(() => fetchUser('1'), { key: 'user:1' });\n  return user;\n});\n```\n\nSee [Persistence](/guides/persistence/) for details.\n\n### onEvent\n\nSubscribe to workflow events for logging, visualization, or debugging:\n\n```typescript\nconst workflow = createWorkflow(deps, {\n  onEvent: (event) => {\n    switch (event.type) {\n      case 'step_start':\n        console.log('Starting:', event.name);\n        break;\n      case 'step_complete':\n        console.log('Completed:', event.name, event.durationMs, 'ms');\n        break;\n      case 'step_error':\n        console.error('Failed:', event.name, event.error);\n        break;\n    }\n  },\n});\n```\n\n### strict\n\nForce explicit handling of unexpected errors:\n\n```typescript\nconst workflow = createWorkflow(deps, {\n  strict: true,\n  catchUnexpected: (thrown) => ({\n    type: 'UNEXPECTED' as const,\n    message: String(thrown),\n  }),\n});\n```\n\n## Composing workflows\n\nWorkflows are just functions. Compose them naturally:\n\n```typescript\nconst validateInput = createWorkflow({ validateEmail, validatePassword });\nconst processPayment = createWorkflow({ chargeCard, saveReceipt });\n\nconst checkout = createWorkflow({\n  validateEmail,\n  validatePassword,\n  chargeCard,\n  saveReceipt,\n});\n\nconst result = await checkout(async (step) => {\n  // Use steps from all dependencies\n  await step(validateEmail(input.email));\n  await step(validatePassword(input.password));\n  await step(chargeCard(input.amount));\n  await step(saveReceipt(input.orderId));\n});\n```\n\n## Context\n\nPass context through workflow execution:\n\n```typescript\nconst workflow = createWorkflow(deps);\n\nconst result = await workflow(\n  async (step, context) => {\n    console.log('User ID:', context.userId);\n    const user = await step(fetchUser(context.userId));\n    return user;\n  },\n  { context: { userId: '123', requestId: 'abc' } }\n);\n```\n\n## Next\n\n[Learn about Tagged Errors →](/concepts/tagged-errors/)","src/content/docs/concepts/workflows.md","8f07fb3f6b8684c8",{"html":533,"metadata":534},"\u003Cp>There are two ways to run workflows: \u003Ccode dir=\"auto\">createWorkflow\u003C/code> for reusable workflows with dependency inference, and \u003Ccode dir=\"auto\">run\u003C/code> for one-off operations.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"createworkflow\">createWorkflow\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#createworkflow\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “createWorkflow”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Creates a reusable workflow with automatic error type inference from dependencies:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">User\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">sendEmail\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">to\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">void\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">EMAIL_FAILED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Error types inferred from dependencies\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">sendEmail\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">sendEmail\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">email\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// result.error is: 'NOT_FOUND' | 'EMAIL_FAILED' | UnexpectedError\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { ok, err, type AsyncResult } from &#x27;awaitly&#x27;;import { createWorkflow } from &#x27;awaitly/workflow&#x27;;const fetchUser = async (id: string): AsyncResult\u003CUser, &#x27;NOT_FOUND&#x27;> => { ... };const sendEmail = async (to: string): AsyncResult\u003Cvoid, &#x27;EMAIL_FAILED&#x27;> => { ... };// Error types inferred from dependenciesconst workflow = createWorkflow({ fetchUser, sendEmail });const result = await workflow(async (step) => {  const user = await step(fetchUser(&#x27;1&#x27;));  await step(sendEmail(user.email));  return user;});// result.error is: &#x27;NOT_FOUND&#x27; | &#x27;EMAIL_FAILED&#x27; | UnexpectedError\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"with-options\">With options\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#with-options\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “With options”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">sendEmail\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">cache\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">new\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">Map\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),                    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Enable step caching\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">), \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Event stream\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">strict\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,                        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Force explicit error handling\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const workflow = createWorkflow(  { fetchUser, sendEmail },  {    cache: new Map(),                    // Enable step caching    onEvent: (event) => console.log(event), // Event stream    strict: true,                        // Force explicit error handling  });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"run\">run()\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#run\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “run()”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>For one-off workflows where you specify error types manually:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">run\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">run\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">User\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">|\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">EMAIL_FAILED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">sendEmail\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">email\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { run } from &#x27;awaitly&#x27;;const result = await run\u003CUser, &#x27;NOT_FOUND&#x27; | &#x27;EMAIL_FAILED&#x27;>(  async (step) => {    const user = await step(fetchUser(&#x27;1&#x27;));    await step(sendEmail(user.email));    return user;  });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"when-to-use-each\">When to use each\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#when-to-use-each\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “When to use each”\u003C/span>\u003C/a>\u003C/div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Scenario\u003C/th>\u003Cth>Use\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Dependencies known at compile time\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">createWorkflow\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Dependencies passed as parameters\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">run\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Need step caching or resume\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">createWorkflow\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Need automatic error inference\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">createWorkflow\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>One-off workflow\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">run\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Testing with mocks\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">run\u003C/code>\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"workflow-options\">Workflow options\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#workflow-options\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Workflow options”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"cache\">cache\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#cache\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “cache”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Enable step caching to avoid re-executing completed steps:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">cache\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">new\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">Map\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// This step runs once, even if workflow is called multiple times\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const workflow = createWorkflow(deps, {  cache: new Map(),});const result = await workflow(async (step) => {  // This step runs once, even if workflow is called multiple times  const user = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });  return user;});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"resumestate\">resumeState\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#resumestate\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “resumeState”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Resume a workflow from saved state:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">resumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">savedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// From a previous run\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Cached steps return their saved values\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const workflow = createWorkflow(deps, {  resumeState: savedState, // From a previous run});const result = await workflow(async (step) => {  // Cached steps return their saved values  const user = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });  return user;});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>See \u003Ca href=\"/guides/persistence/\">Persistence\u003C/a> for details.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"onevent\">onEvent\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#onevent\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “onEvent”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Subscribe to workflow events for logging, visualization, or debugging:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">switch\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">case\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">step_start\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Starting:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">break\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">case\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">step_complete\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Completed:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">durationMs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">ms\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">break\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">case\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">step_error\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Failed:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">break\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const workflow = createWorkflow(deps, {  onEvent: (event) => {    switch (event.type) {      case &#x27;step_start&#x27;:        console.log(&#x27;Starting:&#x27;, event.name);        break;      case &#x27;step_complete&#x27;:        console.log(&#x27;Completed:&#x27;, event.name, event.durationMs, &#x27;ms&#x27;);        break;      case &#x27;step_error&#x27;:        console.error(&#x27;Failed:&#x27;, event.name, event.error);        break;    }  },});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"strict\">strict\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#strict\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “strict”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Force explicit handling of unexpected errors:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">strict\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">catchUnexpected\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">thrown\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => ({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">UNEXPECTED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">as\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">String\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">thrown\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const workflow = createWorkflow(deps, {  strict: true,  catchUnexpected: (thrown) => ({    type: &#x27;UNEXPECTED&#x27; as const,    message: String(thrown),  }),});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"composing-workflows\">Composing workflows\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#composing-workflows\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Composing workflows”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Workflows are just functions. Compose them naturally:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">validateInput\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">validateEmail\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">validatePassword\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">processPayment\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saveReceipt\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">checkout\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">validateEmail\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">validatePassword\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saveReceipt\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">checkout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Use steps from all dependencies\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">validateEmail\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">input\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">email\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">validatePassword\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">input\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">password\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">input\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">saveReceipt\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">input\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">orderId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const validateInput = createWorkflow({ validateEmail, validatePassword });const processPayment = createWorkflow({ chargeCard, saveReceipt });const checkout = createWorkflow({  validateEmail,  validatePassword,  chargeCard,  saveReceipt,});const result = await checkout(async (step) => {  // Use steps from all dependencies  await step(validateEmail(input.email));  await step(validatePassword(input.password));  await step(chargeCard(input.amount));  await step(saveReceipt(input.orderId));});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"context\">Context\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#context\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Context”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Pass context through workflow execution:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">context\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">User ID:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">context\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">userId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">context\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">userId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">context\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">userId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">requestId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">abc\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> } }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const workflow = createWorkflow(deps);const result = await workflow(  async (step, context) => {    console.log(&#x27;User ID:&#x27;, context.userId);    const user = await step(fetchUser(context.userId));    return user;  },  { context: { userId: &#x27;123&#x27;, requestId: &#x27;abc&#x27; } });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/concepts/tagged-errors/\">Learn about Tagged Errors →\u003C/a>\u003C/p>",{"headings":535,"localImagePaths":568,"remoteImagePaths":569,"frontmatter":570,"imagePaths":571},[536,539,542,545,548,551,553,556,559,561,564,567],{"depth":57,"slug":537,"text":538},"createworkflow","createWorkflow",{"depth":212,"slug":540,"text":541},"with-options","With options",{"depth":57,"slug":543,"text":544},"run","run()",{"depth":57,"slug":546,"text":547},"when-to-use-each","When to use each",{"depth":57,"slug":549,"text":550},"workflow-options","Workflow options",{"depth":212,"slug":552,"text":552},"cache",{"depth":212,"slug":554,"text":555},"resumestate","resumeState",{"depth":212,"slug":557,"text":558},"onevent","onEvent",{"depth":212,"slug":560,"text":560},"strict",{"depth":57,"slug":562,"text":563},"composing-workflows","Composing workflows",{"depth":57,"slug":565,"text":566},"context","Context",{"depth":57,"slug":417,"text":418},[],[],{"title":524,"description":525},[],"guides/conditional-execution",{"id":572,"data":574,"body":580,"filePath":581,"digest":582,"rendered":583},{"title":575,"description":576,"editUrl":16,"head":577,"template":46,"sidebar":578,"pagefind":16,"draft":35},"Conditional Execution","Conditionally execute steps with when/unless helpers",[],{"hidden":35,"attrs":579},{},"Execute steps only when certain conditions are met, with automatic event emission for skipped steps.\n\n## Basic usage\n\n```typescript\nimport { ok, err, type AsyncResult } from 'awaitly';\nimport { when, unless, createWorkflow } from 'awaitly/workflow';\n\nconst fetchUser = async (id: string): AsyncResult\u003CUser, 'NOT_FOUND'> => {\n  // ...\n};\n\nconst sendEmail = async (to: string): AsyncResult\u003Cvoid, 'SEND_FAILED'> => {\n  // ...\n};\n\nconst workflow = createWorkflow({ fetchUser, sendEmail });\n\nconst result = await workflow(async (step) => {\n  const user = await step(fetchUser('123'));\n\n  // Only send email if user is not verified\n  await when(\n    !user.isVerified,\n    () => step(sendEmail(user.email)),\n    { name: 'send-verification', reason: 'User is already verified' }\n  );\n\n  return user;\n});\n```\n\n## when - Execute if condition is true\n\nRun a step only when a condition is true. Returns `undefined` if skipped.\n\n```typescript\nconst result = await workflow(async (step) => {\n  const user = await step(fetchUser('123'));\n\n  // Only fetch premium data if user is premium\n  const premium = await when(\n    user.isPremium,\n    () => step(fetchPremiumData(user.id)),\n    { name: 'premium-data', reason: 'User is not premium' }\n  );\n\n  return { user, premium }; // premium is User | undefined\n});\n```\n\n## unless - Execute if condition is false\n\nRun a step only when a condition is false. Returns `undefined` if skipped.\n\n```typescript\nconst result = await workflow(async (step) => {\n  const user = await step(fetchUser('123'));\n\n  // Only send verification email if user is NOT verified\n  const email = await unless(\n    user.isVerified,\n    () => step(sendVerificationEmail(user.email)),\n    { name: 'send-verification', reason: 'User is already verified' }\n  );\n\n  return { user, email }; // email is void | undefined\n});\n```\n\n## whenOr - Execute if true, else return default\n\nRun a step if condition is true, otherwise return a default value.\n\n```typescript\nconst result = await workflow(async (step) => {\n  const user = await step(fetchUser('123'));\n\n  // Get premium limits or use default for non-premium users\n  const limits = await whenOr(\n    user.isPremium,\n    () => step(fetchPremiumLimits(user.id)),\n    { maxRequests: 100, maxStorage: 1000 }, // default\n    { name: 'premium-limits', reason: 'Using default limits' }\n  );\n\n  return { user, limits }; // limits is PremiumLimits | DefaultLimits\n});\n```\n\n## unlessOr - Execute if false, else return default\n\nRun a step if condition is false, otherwise return a default value.\n\n```typescript\nconst result = await workflow(async (step) => {\n  const user = await step(fetchUser('123'));\n\n  // Generate new token if NOT authenticated, else use existing\n  const token = await unlessOr(\n    user.isAuthenticated,\n    () => step(generateNewToken(user.id)),\n    user.existingToken, // default\n    { name: 'token-generation', reason: 'Using existing token' }\n  );\n\n  return { user, token };\n});\n```\n\n## Event emission\n\nConditional helpers automatically emit `step_skipped` events when steps are skipped:\n\n```typescript\nconst workflow = createWorkflow({ fetchUser }, {\n  onEvent: (event) => {\n    if (event.type === 'step_skipped') {\n      console.log(`Step ${event.name} skipped: ${event.reason}`);\n      // event.decisionId - unique ID for this decision\n    }\n  }\n});\n```\n\n## With workflow context\n\nUse `createConditionalHelpers` to bind helpers to workflow context for automatic event emission:\n\n```typescript\nimport { createConditionalHelpers, createWorkflow } from 'awaitly/workflow';\n\nconst workflow = createWorkflow({ fetchUser }, {\n  onEvent: (event, ctx) => {\n    // ctx is available here\n  }\n});\n\nconst result = await workflow(async (step, deps, args, ctx) => {\n  // Create bound helpers\n  const { when, whenOr } = createConditionalHelpers({\n    workflowId: ctx.workflowId,\n    onEvent: (e) => {\n      // Events automatically include context\n    },\n    context: ctx\n  });\n\n  const user = await step(fetchUser('123'));\n\n  // Helpers automatically emit events with context\n  const premium = await when(\n    user.isPremium,\n    () => step(fetchPremiumData(user.id)),\n    { name: 'premium-data' }\n  );\n\n  return { user, premium };\n});\n```\n\n## With run()\n\nWhen using `run()`, pass context manually:\n\n```typescript\nimport { run } from 'awaitly';\nimport { createConditionalHelpers } from 'awaitly/workflow';\n\nconst result = await run(async (step) => {\n  const ctx = {\n    workflowId: 'workflow-123',\n    onEvent: (event) => {\n      // Handle events\n    },\n    context: { requestId: 'req-456' }\n  };\n\n  const { when } = createConditionalHelpers(ctx);\n\n  const user = await step(fetchUser('123'));\n\n  const premium = await when(\n    user.isPremium,\n    () => step(fetchPremiumData(user.id)),\n    { name: 'premium-data' }\n  );\n\n  return { user, premium };\n}, {\n  onEvent: ctx.onEvent,\n  workflowId: ctx.workflowId,\n  context: ctx.context\n});\n```\n\n## Options\n\nAll conditional helpers accept an optional `ConditionalOptions` object:\n\n```typescript\n{\n  name?: string;      // Human-readable name for the step\n  key?: string;       // Stable identity key for caching/tracking\n  reason?: string;    // Explanation for why step was skipped\n}\n```\n\n## Visualization\n\nSkipped steps appear in workflow visualizations:\n\n```typescript\nimport { createVisualizer } from 'awaitly/visualize';\n\nconst viz = createVisualizer();\nconst workflow = createWorkflow(deps, { onEvent: viz.handleEvent });\n\nawait workflow(async (step) => {\n  const user = await step(fetchUser('123'));\n\n  await when(\n    user.isPremium,\n    () => step(fetchPremiumData(user.id)),\n    { name: 'premium-data', reason: 'Not premium' }\n  );\n\n  return user;\n});\n\nconsole.log(viz.render());\n// Shows skipped step with reason\n```\n\n## Real-world example\n\n```typescript\nconst processOrder = createWorkflow({ fetchOrder, chargeCard, sendEmail, applyDiscount });\n\nconst result = await processOrder(async (step) => {\n  const order = await step(fetchOrder(orderId));\n\n  // Apply discount only if order is large enough\n  const discount = await whenOr(\n    order.total > 100,\n    () => step(applyDiscount(order.id, 'BULK_10')),\n    0, // no discount\n    { name: 'apply-discount', reason: 'Order too small for discount' }\n  );\n\n  // Charge card\n  const payment = await step(chargeCard(order.total - discount));\n\n  // Send confirmation email only if payment succeeded\n  await when(\n    payment.status === 'succeeded',\n    () => step(sendEmail(order.email, 'Order confirmed')),\n    { name: 'send-confirmation', reason: 'Payment failed' }\n  );\n\n  return { order, payment, discount };\n});\n```\n\n## Next\n\n[Learn about Testing →](/guides/testing/)","src/content/docs/guides/conditional-execution.md","27e08f79e886d2b7",{"html":584,"metadata":585},"\u003Cp>Execute steps only when certain conditions are met, with automatic event emission for skipped steps.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"basic-usage\">Basic usage\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#basic-usage\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Basic usage”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">when\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">unless\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">User\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// ...\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">sendEmail\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">to\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">void\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">SEND_FAILED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// ...\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">sendEmail\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Only send email if user is not verified\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">when\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isVerified\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">sendEmail\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">email\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">send-verification\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">reason\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">User is already verified\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { ok, err, type AsyncResult } from &#x27;awaitly&#x27;;import { when, unless, createWorkflow } from &#x27;awaitly/workflow&#x27;;const fetchUser = async (id: string): AsyncResult\u003CUser, &#x27;NOT_FOUND&#x27;> => {  // ...};const sendEmail = async (to: string): AsyncResult\u003Cvoid, &#x27;SEND_FAILED&#x27;> => {  // ...};const workflow = createWorkflow({ fetchUser, sendEmail });const result = await workflow(async (step) => {  const user = await step(fetchUser(&#x27;123&#x27;));  // Only send email if user is not verified  await when(    !user.isVerified,    () => step(sendEmail(user.email)),    { name: &#x27;send-verification&#x27;, reason: &#x27;User is already verified&#x27; }  );  return user;});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"when---execute-if-condition-is-true\">when - Execute if condition is true\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#when---execute-if-condition-is-true\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “when - Execute if condition is true”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Run a step only when a condition is true. Returns \u003Ccode dir=\"auto\">undefined\u003C/code> if skipped.\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Only fetch premium data if user is premium\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">premium\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">when\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isPremium\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPremiumData\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">premium-data\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">reason\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">User is not premium\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">premium\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// premium is User | undefined\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await workflow(async (step) => {  const user = await step(fetchUser(&#x27;123&#x27;));  // Only fetch premium data if user is premium  const premium = await when(    user.isPremium,    () => step(fetchPremiumData(user.id)),    { name: &#x27;premium-data&#x27;, reason: &#x27;User is not premium&#x27; }  );  return { user, premium }; // premium is User | undefined});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"unless---execute-if-condition-is-false\">unless - Execute if condition is false\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#unless---execute-if-condition-is-false\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “unless - Execute if condition is false”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Run a step only when a condition is false. Returns \u003Ccode dir=\"auto\">undefined\u003C/code> if skipped.\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Only send verification email if user is NOT verified\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">email\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">unless\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isVerified\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">sendVerificationEmail\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">email\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">send-verification\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">reason\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">User is already verified\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">email\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// email is void | undefined\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await workflow(async (step) => {  const user = await step(fetchUser(&#x27;123&#x27;));  // Only send verification email if user is NOT verified  const email = await unless(    user.isVerified,    () => step(sendVerificationEmail(user.email)),    { name: &#x27;send-verification&#x27;, reason: &#x27;User is already verified&#x27; }  );  return { user, email }; // email is void | undefined});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"whenor---execute-if-true-else-return-default\">whenOr - Execute if true, else return default\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#whenor---execute-if-true-else-return-default\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “whenOr - Execute if true, else return default”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Run a step if condition is true, otherwise return a default value.\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Get premium limits or use default for non-premium users\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">limits\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">whenOr\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isPremium\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPremiumLimits\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxRequests\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">100\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxStorage\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// default\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">premium-limits\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">reason\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Using default limits\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">limits\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// limits is PremiumLimits | DefaultLimits\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await workflow(async (step) => {  const user = await step(fetchUser(&#x27;123&#x27;));  // Get premium limits or use default for non-premium users  const limits = await whenOr(    user.isPremium,    () => step(fetchPremiumLimits(user.id)),    { maxRequests: 100, maxStorage: 1000 }, // default    { name: &#x27;premium-limits&#x27;, reason: &#x27;Using default limits&#x27; }  );  return { user, limits }; // limits is PremiumLimits | DefaultLimits});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"unlessor---execute-if-false-else-return-default\">unlessOr - Execute if false, else return default\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#unlessor---execute-if-false-else-return-default\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “unlessOr - Execute if false, else return default”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Run a step if condition is false, otherwise return a default value.\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Generate new token if NOT authenticated, else use existing\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">token\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">unlessOr\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isAuthenticated\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">generateNewToken\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">existingToken\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// default\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">token-generation\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">reason\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Using existing token\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">token\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await workflow(async (step) => {  const user = await step(fetchUser(&#x27;123&#x27;));  // Generate new token if NOT authenticated, else use existing  const token = await unlessOr(    user.isAuthenticated,    () => step(generateNewToken(user.id)),    user.existingToken, // default    { name: &#x27;token-generation&#x27;, reason: &#x27;Using existing token&#x27; }  );  return { user, token };});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"event-emission\">Event emission\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#event-emission\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Event emission”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Conditional helpers automatically emit \u003Ccode dir=\"auto\">step_skipped\u003C/code> events when steps are skipped:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">===\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">step_skipped\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Step \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">name\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> skipped: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">reason\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// event.decisionId - unique ID for this decision\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const workflow = createWorkflow({ fetchUser }, {  onEvent: (event) => {    if (event.type === &#x27;step_skipped&#x27;) {      console.log(&#x60;Step ${event.name} skipped: ${event.reason}&#x60;);      // event.decisionId - unique ID for this decision    }  }});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"with-workflow-context\">With workflow context\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#with-workflow-context\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “With workflow context”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">createConditionalHelpers\u003C/code> to bind helpers to workflow context for automatic event emission:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createConditionalHelpers\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ctx\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// ctx is available here\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">args\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ctx\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create bound helpers\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">when\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">whenOr\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createConditionalHelpers\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">workflowId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ctx\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflowId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Events automatically include context\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">context\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ctx\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Helpers automatically emit events with context\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">premium\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">when\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isPremium\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPremiumData\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">premium-data\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">premium\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createConditionalHelpers, createWorkflow } from &#x27;awaitly/workflow&#x27;;const workflow = createWorkflow({ fetchUser }, {  onEvent: (event, ctx) => {    // ctx is available here  }});const result = await workflow(async (step, deps, args, ctx) => {  // Create bound helpers  const { when, whenOr } = createConditionalHelpers({    workflowId: ctx.workflowId,    onEvent: (e) => {      // Events automatically include context    },    context: ctx  });  const user = await step(fetchUser(&#x27;123&#x27;));  // Helpers automatically emit events with context  const premium = await when(    user.isPremium,    () => step(fetchPremiumData(user.id)),    { name: &#x27;premium-data&#x27; }  );  return { user, premium };});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"with-run\">With run()\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#with-run\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “With run()”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>When using \u003Ccode dir=\"auto\">run()\u003C/code>, pass context manually:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">run\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createConditionalHelpers\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">run\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ctx\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">workflowId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">workflow-123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Handle events\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">context\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">requestId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">req-456\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">when\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createConditionalHelpers\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ctx\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">premium\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">when\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isPremium\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPremiumData\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">premium-data\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">premium\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ctx\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">workflowId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ctx\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflowId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">context\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ctx\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">context\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { run } from &#x27;awaitly&#x27;;import { createConditionalHelpers } from &#x27;awaitly/workflow&#x27;;const result = await run(async (step) => {  const ctx = {    workflowId: &#x27;workflow-123&#x27;,    onEvent: (event) => {      // Handle events    },    context: { requestId: &#x27;req-456&#x27; }  };  const { when } = createConditionalHelpers(ctx);  const user = await step(fetchUser(&#x27;123&#x27;));  const premium = await when(    user.isPremium,    () => step(fetchPremiumData(user.id)),    { name: &#x27;premium-data&#x27; }  );  return { user, premium };}, {  onEvent: ctx.onEvent,  workflowId: ctx.workflowId,  context: ctx.context});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"options\">Options\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#options\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Options”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>All conditional helpers accept an optional \u003Ccode dir=\"auto\">ConditionalOptions\u003C/code> object:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">name\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Human-readable name for the step\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">key\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">       \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Stable identity key for caching/tracking\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reason\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Explanation for why step was skipped\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"{  name?: string;      // Human-readable name for the step  key?: string;       // Stable identity key for caching/tracking  reason?: string;    // Explanation for why step was skipped}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"visualization\">Visualization\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#visualization\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Visualization”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Skipped steps appear in workflow visualizations:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createVisualizer\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/visualize\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">viz\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createVisualizer\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">viz\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">when\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isPremium\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPremiumData\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">premium-data\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">reason\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Not premium\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">viz\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">render\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Shows skipped step with reason\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createVisualizer } from &#x27;awaitly/visualize&#x27;;const viz = createVisualizer();const workflow = createWorkflow(deps, { onEvent: viz.handleEvent });await workflow(async (step) => {  const user = await step(fetchUser(&#x27;123&#x27;));  await when(    user.isPremium,    () => step(fetchPremiumData(user.id)),    { name: &#x27;premium-data&#x27;, reason: &#x27;Not premium&#x27; }  );  return user;});console.log(viz.render());// Shows skipped step with reason\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"real-world-example\">Real-world example\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#real-world-example\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Real-world example”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">processOrder\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchOrder\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">sendEmail\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">applyDiscount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processOrder\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchOrder\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">orderId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Apply discount only if order is large enough\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">discount\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">whenOr\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">total\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">100\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">applyDiscount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">BULK_10\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// no discount\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">apply-discount\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">reason\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Order too small for discount\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Charge card\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">total\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> - \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">discount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Send confirmation email only if payment succeeded\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">when\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">status\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> === \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">succeeded\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">sendEmail\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">email\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Order confirmed\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">send-confirmation\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">reason\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Payment failed\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">discount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const processOrder = createWorkflow({ fetchOrder, chargeCard, sendEmail, applyDiscount });const result = await processOrder(async (step) => {  const order = await step(fetchOrder(orderId));  // Apply discount only if order is large enough  const discount = await whenOr(    order.total > 100,    () => step(applyDiscount(order.id, &#x27;BULK_10&#x27;)),    0, // no discount    { name: &#x27;apply-discount&#x27;, reason: &#x27;Order too small for discount&#x27; }  );  // Charge card  const payment = await step(chargeCard(order.total - discount));  // Send confirmation email only if payment succeeded  await when(    payment.status === &#x27;succeeded&#x27;,    () => step(sendEmail(order.email, &#x27;Order confirmed&#x27;)),    { name: &#x27;send-confirmation&#x27;, reason: &#x27;Payment failed&#x27; }  );  return { order, payment, discount };});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/guides/testing/\">Learn about Testing →\u003C/a>\u003C/p>",{"headings":586,"localImagePaths":617,"remoteImagePaths":618,"frontmatter":619,"imagePaths":620},[587,588,591,594,597,600,603,606,609,612,615,616],{"depth":57,"slug":58,"text":59},{"depth":57,"slug":589,"text":590},"when---execute-if-condition-is-true","when - Execute if condition is true",{"depth":57,"slug":592,"text":593},"unless---execute-if-condition-is-false","unless - Execute if condition is false",{"depth":57,"slug":595,"text":596},"whenor---execute-if-true-else-return-default","whenOr - Execute if true, else return default",{"depth":57,"slug":598,"text":599},"unlessor---execute-if-false-else-return-default","unlessOr - Execute if false, else return default",{"depth":57,"slug":601,"text":602},"event-emission","Event emission",{"depth":57,"slug":604,"text":605},"with-workflow-context","With workflow context",{"depth":57,"slug":607,"text":608},"with-run","With run()",{"depth":57,"slug":610,"text":611},"options","Options",{"depth":57,"slug":613,"text":614},"visualization","Visualization",{"depth":57,"slug":511,"text":512},{"depth":57,"slug":417,"text":418},[],[],{"title":575,"description":576},[],"guides/caching",{"id":621,"data":623,"body":629,"filePath":630,"digest":631,"rendered":632},{"title":624,"description":625,"editUrl":16,"head":626,"template":46,"sidebar":627,"pagefind":16,"draft":35},"Caching","Cache step results to avoid duplicate work",[],{"hidden":35,"attrs":628},{},"Cache step results so they don't re-execute if the workflow runs again.\n\n## Enable caching\n\nPass a cache to the workflow:\n\n```typescript\nconst workflow = createWorkflow(deps, {\n  cache: new Map(),\n});\n```\n\n## Use keys to cache steps\n\nGive steps a `key` to enable caching:\n\n```typescript\nconst result = await workflow(async (step) => {\n  // This step is cached with key 'user:1'\n  const user = await step(() => fetchUser('1'), { key: 'user:1' });\n\n  // Subsequent calls with same key return cached value\n  const sameUser = await step(() => fetchUser('1'), { key: 'user:1' });\n\n  return user;\n});\n```\n\n## Key requirements\n\nKeys must be:\n- **Unique per step**: Different steps need different keys\n- **Stable**: Same input should produce same key\n- **Deterministic**: Don't use timestamps or random values\n\n```typescript\n// Good keys\n{ key: 'user:123' }\n{ key: `posts:${userId}` }\n{ key: `order:${orderId}:validate` }\n\n// Bad keys\n{ key: `user:${Date.now()}` }  // Changes every call\n{ key: `user:${Math.random()}` } // Random\n```\n\n## Thunks required for caching\n\nPass a function, not the result of calling the function:\n\n```typescript\n// Without thunk - executes immediately, caching ignored\nconst user = await step(fetchUser('1'), { key: 'user:1' });\n\n// With thunk - can be cached\nconst user = await step(() => fetchUser('1'), { key: 'user:1' });\n```\n\n## Cache scope\n\nThe cache persists across workflow runs:\n\n```typescript\nconst cache = new Map();\nconst workflow = createWorkflow(deps, { cache });\n\n// First run - fetches user\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser('1'), { key: 'user:1' });\n  return user;\n});\n\n// Second run - uses cached value\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser('1'), { key: 'user:1' });\n  return user; // No fetch - returns cached value\n});\n```\n\n## Clearing the cache\n\nClear specific keys or the entire cache:\n\n```typescript\nconst cache = new Map();\n\n// Clear one key\ncache.delete('user:1');\n\n// Clear all\ncache.clear();\n```\n\n## Custom cache implementations\n\nAny object with Map-like `get`, `set`, `has`, `delete` methods works:\n\n```typescript\n// Redis-backed cache\nconst redisCache = {\n  async get(key: string) {\n    const value = await redis.get(key);\n    return value ? JSON.parse(value) : undefined;\n  },\n  async set(key: string, value: unknown) {\n    await redis.set(key, JSON.stringify(value));\n  },\n  async has(key: string) {\n    return await redis.exists(key) > 0;\n  },\n  async delete(key: string) {\n    return await redis.del(key) > 0;\n  },\n};\n\nconst workflow = createWorkflow(deps, { cache: redisCache });\n```\n\n## Caching and errors\n\nErrors are cached by default. If a step fails, subsequent runs return the same error:\n\n```typescript\n// First run - fetchUser returns err('NOT_FOUND')\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser('999'), { key: 'user:999' });\n  return user;\n});\n// result.error === 'NOT_FOUND'\n\n// Second run - returns cached error, no fetch\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser('999'), { key: 'user:999' });\n  return user;\n});\n// result.error === 'NOT_FOUND' (from cache)\n```\n\nTo retry on error, clear the cache key first.\n\n## When to use caching\n\n| Use case | Caching helps |\n|----------|--------------|\n| Idempotent operations | Yes - payments, API calls |\n| Resume after crash | Yes - completed steps skipped |\n| Expensive computations | Yes - don't recompute |\n| Time-sensitive data | No - data may be stale |\n| Non-idempotent operations | Careful - may cause issues |\n\n## Next\n\n[Learn about Persistence →](/guides/persistence/)","src/content/docs/guides/caching.md","cda6135ab107fd73",{"html":633,"metadata":634},"\u003Cp>Cache step results so they don’t re-execute if the workflow runs again.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"enable-caching\">Enable caching\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#enable-caching\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Enable caching”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Pass a cache to the workflow:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">cache\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">new\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">Map\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const workflow = createWorkflow(deps, {  cache: new Map(),});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"use-keys-to-cache-steps\">Use keys to cache steps\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#use-keys-to-cache-steps\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Use keys to cache steps”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Give steps a \u003Ccode dir=\"auto\">key\u003C/code> to enable caching:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// This step is cached with key 'user:1'\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Subsequent calls with same key return cached value\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">sameUser\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await workflow(async (step) => {  // This step is cached with key &#x27;user:1&#x27;  const user = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });  // Subsequent calls with same key return cached value  const sameUser = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });  return user;});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"key-requirements\">Key requirements\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#key-requirements\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Key requirements”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Keys must be:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Unique per step\u003C/strong>: Different steps need different keys\u003C/li>\n\u003Cli>\u003Cstrong>Stable\u003C/strong>: Same input should produce same key\u003C/li>\n\u003Cli>\u003Cstrong>Deterministic\u003C/strong>: Don’t use timestamps or random values\u003C/li>\n\u003C/ul>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Good keys\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">posts:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">userId\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">order:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">orderId\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">:validate\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Bad keys\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Date\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">now\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Changes every call\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Math\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">random\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Random\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// Good keys{ key: &#x27;user:123&#x27; }{ key: &#x60;posts:${userId}&#x60; }{ key: &#x60;order:${orderId}:validate&#x60; }// Bad keys{ key: &#x60;user:${Date.now()}&#x60; }  // Changes every call{ key: &#x60;user:${Math.random()}&#x60; } // Random\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"thunks-required-for-caching\">Thunks required for caching\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#thunks-required-for-caching\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Thunks required for caching”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Pass a function, not the result of calling the function:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Without thunk - executes immediately, caching ignored\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// With thunk - can be cached\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// Without thunk - executes immediately, caching ignoredconst user = await step(fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });// With thunk - can be cachedconst user = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"cache-scope\">Cache scope\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#cache-scope\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Cache scope”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>The cache persists across workflow runs:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cache\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> new \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">Map\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cache\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// First run - fetches user\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Second run - uses cached value\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// No fetch - returns cached value\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const cache = new Map();const workflow = createWorkflow(deps, { cache });// First run - fetches userawait workflow(async (step) => {  const user = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });  return user;});// Second run - uses cached valueawait workflow(async (step) => {  const user = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });  return user; // No fetch - returns cached value});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"clearing-the-cache\">Clearing the cache\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#clearing-the-cache\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Clearing the cache”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Clear specific keys or the entire cache:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cache\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> new \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">Map\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Clear one key\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">cache\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">delete\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Clear all\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">cache\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">clear\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const cache = new Map();// Clear one keycache.delete(&#x27;user:1&#x27;);// Clear allcache.clear();\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"custom-cache-implementations\">Custom cache implementations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#custom-cache-implementations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Custom cache implementations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Any object with Map-like \u003Ccode dir=\"auto\">get\u003C/code>, \u003Ccode dir=\"auto\">set\u003C/code>, \u003Ccode dir=\"auto\">has\u003C/code>, \u003Ccode dir=\"auto\">delete\u003C/code> methods works:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Redis-backed cache\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">redisCache\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">get\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">redis\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">get\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">JSON\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">parse\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">:\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">undefined\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">set\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">unknown\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">redis\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">set\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">JSON\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">stringify\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">has\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">redis\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">exists\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) > \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">delete\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">redis\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">del\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) > \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">cache\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">redisCache\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// Redis-backed cacheconst redisCache = {  async get(key: string) {    const value = await redis.get(key);    return value ? JSON.parse(value) : undefined;  },  async set(key: string, value: unknown) {    await redis.set(key, JSON.stringify(value));  },  async has(key: string) {    return await redis.exists(key) > 0;  },  async delete(key: string) {    return await redis.del(key) > 0;  },};const workflow = createWorkflow(deps, { cache: redisCache });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"caching-and-errors\">Caching and errors\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#caching-and-errors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Caching and errors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Errors are cached by default. If a step fails, subsequent runs return the same error:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// First run - fetchUser returns err('NOT_FOUND')\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">999\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:999\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// result.error === 'NOT_FOUND'\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Second run - returns cached error, no fetch\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">999\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:999\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// result.error === 'NOT_FOUND' (from cache)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// First run - fetchUser returns err(&#x27;NOT_FOUND&#x27;)await workflow(async (step) => {  const user = await step(() => fetchUser(&#x27;999&#x27;), { key: &#x27;user:999&#x27; });  return user;});// result.error === &#x27;NOT_FOUND&#x27;// Second run - returns cached error, no fetchawait workflow(async (step) => {  const user = await step(() => fetchUser(&#x27;999&#x27;), { key: &#x27;user:999&#x27; });  return user;});// result.error === &#x27;NOT_FOUND&#x27; (from cache)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>To retry on error, clear the cache key first.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"when-to-use-caching\">When to use caching\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#when-to-use-caching\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “When to use caching”\u003C/span>\u003C/a>\u003C/div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Use case\u003C/th>\u003Cth>Caching helps\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Idempotent operations\u003C/td>\u003Ctd>Yes - payments, API calls\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Resume after crash\u003C/td>\u003Ctd>Yes - completed steps skipped\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Expensive computations\u003C/td>\u003Ctd>Yes - don’t recompute\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Time-sensitive data\u003C/td>\u003Ctd>No - data may be stale\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Non-idempotent operations\u003C/td>\u003Ctd>Careful - may cause issues\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/guides/persistence/\">Learn about Persistence →\u003C/a>\u003C/p>",{"headings":635,"localImagePaths":664,"remoteImagePaths":665,"frontmatter":666,"imagePaths":667},[636,639,642,645,648,651,654,657,660,663],{"depth":57,"slug":637,"text":638},"enable-caching","Enable caching",{"depth":57,"slug":640,"text":641},"use-keys-to-cache-steps","Use keys to cache steps",{"depth":57,"slug":643,"text":644},"key-requirements","Key requirements",{"depth":57,"slug":646,"text":647},"thunks-required-for-caching","Thunks required for caching",{"depth":57,"slug":649,"text":650},"cache-scope","Cache scope",{"depth":57,"slug":652,"text":653},"clearing-the-cache","Clearing the cache",{"depth":57,"slug":655,"text":656},"custom-cache-implementations","Custom cache implementations",{"depth":57,"slug":658,"text":659},"caching-and-errors","Caching and errors",{"depth":57,"slug":661,"text":662},"when-to-use-caching","When to use caching",{"depth":57,"slug":417,"text":418},[],[],{"title":624,"description":625},[],"guides/human-in-loop",{"id":668,"data":670,"body":676,"filePath":677,"digest":678,"rendered":679},{"title":671,"description":672,"editUrl":16,"head":673,"template":46,"sidebar":674,"pagefind":16,"draft":35},"Human-in-the-Loop","Pause workflows for manual approval",[],{"hidden":35,"attrs":675},{},"Pause workflows for human approval (large transfers, deployments, refunds) and resume when approved.\n\n## Create an approval step\n\n```typescript\nimport { createApprovalStep, isPendingApproval } from 'awaitly/hitl';\n\nconst requireApproval = createApprovalStep({\n  key: 'approve:refund',\n  checkApproval: async () => {\n    const status = await db.getApprovalStatus('refund-123');\n    if (!status) return { status: 'pending' };\n    if (status.approved) return { status: 'approved', value: status };\n    return { status: 'rejected', reason: status.reason };\n  },\n});\n```\n\n## Use in workflow\n\n```typescript\nconst refundWorkflow = createWorkflow({ calculateRefund, processRefund, requireApproval });\n\nconst result = await refundWorkflow(async (step) => {\n  const refund = await step(calculateRefund(orderId));\n\n  // Workflow pauses here until approved\n  const approval = await step(requireApproval, { key: 'approve:refund' });\n\n  return await step(processRefund(refund, approval));\n});\n```\n\n## Check for pending approval\n\n```typescript\nif (!result.ok && isPendingApproval(result.error)) {\n  // Save state, notify team\n  await notifySlack(`Refund ${orderId} needs approval`);\n  await db.workflowStates.create({\n    id: orderId,\n    state: stringifyState(collector.getResumeState()),\n  });\n}\n```\n\n## Inject approval and resume\n\nWhen approval is granted:\n\n```typescript\nimport { injectApproval } from 'awaitly/hitl';\nimport { parseState } from 'awaitly/persistence';\n\n// Load saved state\nconst saved = await db.workflowStates.findUnique({ where: { id: orderId } });\nconst state = parseState(saved.state);\n\n// Inject the approval\nconst updatedState = injectApproval(state, {\n  stepKey: 'approve:refund',\n  value: { approvedBy: 'alice@company.com', timestamp: Date.now() },\n});\n\n// Resume workflow\nconst workflow = createWorkflow(\n  { calculateRefund, processRefund, requireApproval },\n  { resumeState: updatedState }\n);\n\nconst result = await workflow(async (step) => {\n  const refund = await step(calculateRefund(orderId));\n  const approval = await step(requireApproval, { key: 'approve:refund' });\n  return await step(processRefund(refund, approval));\n});\n// Now completes successfully\n```\n\n## Handle rejection\n\n```typescript\nimport { isApprovalRejected } from 'awaitly/hitl';\n\nif (!result.ok && isApprovalRejected(result.error)) {\n  console.log('Rejected:', result.error.reason);\n  await db.refunds.updateStatus(orderId, 'rejected');\n}\n```\n\n## List pending approvals\n\n```typescript\nimport { getPendingApprovals } from 'awaitly/hitl';\n\nconst state = collector.getResumeState();\nconst pending = getPendingApprovals(state);\n// [{ stepKey: 'approve:refund', ... }]\n```\n\n## HITL orchestrator\n\nFor complex approval flows, use the orchestrator:\n\n```typescript\nimport {\n  createHITLOrchestrator,\n  createMemoryApprovalStore,\n  createMemoryWorkflowStateStore,\n} from 'awaitly/hitl';\n\nconst orchestrator = createHITLOrchestrator({\n  approvalStore: createMemoryApprovalStore(),\n  workflowStateStore: createMemoryWorkflowStateStore(),\n  createWorkflow: (resumeState) =>\n    createWorkflow(deps, { resumeState }),\n});\n\n// Start workflow\nconst { runId, result } = await orchestrator.start(\n  async (step) => {\n    const data = await step(fetchData());\n    await step(requireApproval, { key: 'approve:data' });\n    return data;\n  },\n  { workflowId: 'wf-1' }\n);\n\n// Approve\nawait orchestrator.approve(runId, 'approve:data', { approvedBy: 'alice' });\n\n// Resume\nconst finalResult = await orchestrator.resume(runId);\n```\n\n## Approval webhook handler\n\nExpose an HTTP endpoint for approvals:\n\n```typescript\nimport { createApprovalWebhookHandler, createMemoryApprovalStore } from 'awaitly/hitl';\n\nconst approvalStore = createMemoryApprovalStore();\nconst handler = createApprovalWebhookHandler(approvalStore);\n\n// Express\napp.post('/webhooks/approve', async (req, res) => {\n  const result = await handler({\n    key: req.body.key,\n    action: req.body.action, // 'approve' | 'reject' | 'edit' | 'cancel'\n    value: req.body.value,\n    reason: req.body.reason,\n    actorId: req.body.actorId,\n    // For 'edit' action:\n    originalValue: req.body.originalValue,\n    editedValue: req.body.editedValue,\n  });\n\n  res.json(result);\n});\n```\n\n## Full example\n\n```typescript\nimport { createWorkflow, createResumeStateCollector } from 'awaitly/workflow';\nimport {\n  createApprovalStep,\n  isPendingApproval,\n  injectApproval,\n} from 'awaitly/hitl';\nimport { stringifyState, parseState } from 'awaitly/persistence';\n\n// Define approval step\nconst requireManagerApproval = createApprovalStep({\n  key: 'manager-approval',\n  checkApproval: async () => {\n    const record = await db.approvals.find('expense-123');\n    if (!record) return { status: 'pending' };\n    return record.approved\n      ? { status: 'approved', value: record }\n      : { status: 'rejected', reason: record.reason };\n  },\n});\n\n// Workflow\nconst expenseWorkflow = createWorkflow({\n  validateExpense,\n  processPayment,\n  requireManagerApproval,\n});\n\nconst collector = createResumeStateCollector();\nconst workflow = createWorkflow(deps, { onEvent: collector.handleEvent });\n\nconst result = await workflow(async (step) => {\n  const expense = await step(validateExpense(data));\n  const approval = await step(requireManagerApproval, { key: 'manager-approval' });\n  return await step(processPayment(expense, approval));\n});\n\nif (!result.ok && isPendingApproval(result.error)) {\n  // Save for later\n  await db.pendingWorkflows.create({\n    id: 'expense-123',\n    state: stringifyState(collector.getResumeState()),\n  });\n  await sendSlackMessage('Expense needs approval: expense-123');\n}\n```\n\n## Notification channel (Slack, email, etc.)\n\nPush notifications when approvals are needed:\n\n```typescript\nimport { createHITLOrchestrator, NotificationChannel } from 'awaitly/hitl';\n\nconst slackChannel: NotificationChannel = {\n  async onApprovalNeeded(ctx) {\n    await slack.chat.postMessage({\n      channel: '#approvals',\n      blocks: [\n        { type: 'section', text: { type: 'mrkdwn', text: `*${ctx.summary}*` } },\n        { type: 'context', text: { type: 'mrkdwn', text: `Workflow: ${ctx.workflowName} | Key: ${ctx.approvalKey}` } },\n        { type: 'actions', elements: [\n          { type: 'button', text: { type: 'plain_text', text: 'Approve' }, action_id: `approve:${ctx.approvalKey}` },\n          { type: 'button', text: { type: 'plain_text', text: 'Reject' }, action_id: `reject:${ctx.approvalKey}` }\n        ]}\n      ]\n    });\n  },\n  async onApprovalResolved(ctx) {\n    // Update the Slack message when approved/rejected\n    await slack.chat.update({ ... });\n  }\n};\n\nconst orchestrator = createHITLOrchestrator({\n  approvalStore: createMemoryApprovalStore(),\n  workflowStateStore: createMemoryWorkflowStateStore(),\n  notificationChannel: slackChannel, // Push notifications\n});\n```\n\n## Edit approval (modify before approving)\n\nAllow humans to approve with modifications:\n\n```typescript\n// Instead of simple approve:\nawait orchestrator.grantApproval('budget', { amount: 5000 });\n\n// Edit the value:\nawait orchestrator.editApproval(\n  'budget',\n  { amount: 5000 },      // Original proposed value\n  { amount: 4500 },      // Edited value (human reduced it)\n  { editedBy: 'manager@co.com' }\n);\n\n// The workflow continues with the edited value\n```\n\nCheck for edited approvals:\n\n```typescript\nconst status = await approvalStore.getApproval('budget');\nif (status.status === 'edited') {\n  console.log('Original:', status.originalValue);\n  console.log('Edited to:', status.editedValue);\n  console.log('By:', status.editedBy);\n}\n```\n\n## Pre-execution gating (AI SDK pattern)\n\nGate operations *before* they execute, showing args for approval:\n\n```typescript\nimport { gatedStep, isPendingApproval } from 'awaitly/hitl';\n\n// Gate external email sends\nconst gatedSendEmail = gatedStep(\n  (args: { to: string; subject: string; body: string }) => sendEmail(args),\n  {\n    key: 'email-approval',\n    requiresApproval: (args) => !args.to.endsWith('@mycompany.com'),\n    description: (args) => `Send email to ${args.to}: \"${args.subject}\"`,\n  }\n);\n\n// In workflow:\nconst result = await workflow(async (step) => {\n  // This shows the email args before sending\n  await step(\n    () => gatedSendEmail({ to: 'external@other.com', subject: 'Hello', body: '...' }),\n    { key: 'send-email' }\n  );\n});\n\nif (!result.ok && isPendingApproval(result.error)) {\n  // Human sees: \"Send email to external@other.com: \"Hello\"\"\n  // Plus the full args in metadata.pendingArgs\n  console.log(result.error.metadata?.pendingArgs);\n  // { to: 'external@other.com', subject: 'Hello', body: '...' }\n}\n```\n\n### Conditional gating\n\nOnly gate certain operations:\n\n```typescript\nconst gatedDelete = gatedStep(\n  (args: { path: string }) => deleteFile(args.path),\n  {\n    key: 'delete-file',\n    requiresApproval: (args) => args.path.startsWith('/important/'),\n    description: (args) => `Delete file: ${args.path}`,\n  }\n);\n\n// Deleting /tmp/foo.txt: No approval needed, executes immediately\n// Deleting /important/data.json: Pauses for approval\n```\n\n## React integration\n\n```typescript\nfunction useApprovalStatus(approvalKey: string) {\n  const [status, setStatus] = useState\u003CApprovalStatus>({ status: 'pending' });\n\n  useEffect(() => {\n    const ws = new WebSocket(`/api/approvals/${approvalKey}/stream`);\n    ws.onmessage = (e) => setStatus(JSON.parse(e.data));\n    return () => ws.close();\n  }, [approvalKey]);\n\n  return status;\n}\n\nfunction ApprovalCard({ approvalKey, pendingArgs }) {\n  const status = useApprovalStatus(approvalKey);\n\n  if (status.status === 'pending') {\n    return (\n      \u003Cdiv>\n        \u003Ch3>Approval Needed\u003C/h3>\n        \u003Cpre>{JSON.stringify(pendingArgs, null, 2)}\u003C/pre>\n        \u003Cbutton onClick={() => approve(approvalKey, pendingArgs)}>Approve\u003C/button>\n        \u003Cbutton onClick={() => reject(approvalKey, 'User rejected')}>Reject\u003C/button>\n      \u003C/div>\n    );\n  }\n\n  return \u003Cdiv>Status: {status.status}\u003C/div>;\n}\n```\n\n## Next\n\n[Learn about Visualization →](/guides/visualization/)","src/content/docs/guides/human-in-loop.md","1131680f08466328",{"html":680,"metadata":681},"\u003Cp>Pause workflows for human approval (large transfers, deployments, refunds) and resume when approved.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"create-an-approval-step\">Create an approval step\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#create-an-approval-step\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Create an approval step”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createApprovalStep\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isPendingApproval\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/hitl\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">requireApproval\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createApprovalStep\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">approve:refund\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">checkApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> () => {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">status\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getApprovalStatus\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">refund-123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> (\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">pending\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">approved\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">approved\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">rejected\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">reason\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reason\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createApprovalStep, isPendingApproval } from &#x27;awaitly/hitl&#x27;;const requireApproval = createApprovalStep({  key: &#x27;approve:refund&#x27;,  checkApproval: async () => {    const status = await db.getApprovalStatus(&#x27;refund-123&#x27;);    if (!status) return { status: &#x27;pending&#x27; };    if (status.approved) return { status: &#x27;approved&#x27;, value: status };    return { status: &#x27;rejected&#x27;, reason: status.reason };  },});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"use-in-workflow\">Use in workflow\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#use-in-workflow\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Use in workflow”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">refundWorkflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">calculateRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">processRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">requireApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">refundWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">refund\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">calculateRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">orderId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Workflow pauses here until approved\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">approval\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">requireApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">approve:refund\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">refund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">approval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const refundWorkflow = createWorkflow({ calculateRefund, processRefund, requireApproval });const result = await refundWorkflow(async (step) => {  const refund = await step(calculateRefund(orderId));  // Workflow pauses here until approved  const approval = await step(requireApproval, { key: &#x27;approve:refund&#x27; });  return await step(processRefund(refund, approval));});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"check-for-pending-approval\">Check for pending approval\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#check-for-pending-approval\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Check for pending approval”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">&#x26;&#x26;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isPendingApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Save state, notify team\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">notifySlack\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Refund \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">orderId\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> needs approval\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflowStates\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">create\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">orderId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">stringifyState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getResumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"if (!result.ok &#x26;&#x26; isPendingApproval(result.error)) {  // Save state, notify team  await notifySlack(&#x60;Refund ${orderId} needs approval&#x60;);  await db.workflowStates.create({    id: orderId,    state: stringifyState(collector.getResumeState()),  });}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"inject-approval-and-resume\">Inject approval and resume\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#inject-approval-and-resume\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Inject approval and resume”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>When approval is granted:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">injectApproval\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/hitl\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">parseState\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/persistence\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Load saved state\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saved\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflowStates\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">findUnique\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">where\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">orderId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> } });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">parseState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saved\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Inject the approval\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">updatedState\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">injectApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">stepKey\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">approve:refund\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">approvedBy\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">alice@company.com\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">timestamp\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">Date\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">now\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">() },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Resume workflow\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">calculateRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">processRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">requireApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">resumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">updatedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">refund\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">calculateRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">orderId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">approval\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">requireApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">approve:refund\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">refund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">approval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Now completes successfully\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { injectApproval } from &#x27;awaitly/hitl&#x27;;import { parseState } from &#x27;awaitly/persistence&#x27;;// Load saved stateconst saved = await db.workflowStates.findUnique({ where: { id: orderId } });const state = parseState(saved.state);// Inject the approvalconst updatedState = injectApproval(state, {  stepKey: &#x27;approve:refund&#x27;,  value: { approvedBy: &#x27;alice@company.com&#x27;, timestamp: Date.now() },});// Resume workflowconst workflow = createWorkflow(  { calculateRefund, processRefund, requireApproval },  { resumeState: updatedState });const result = await workflow(async (step) => {  const refund = await step(calculateRefund(orderId));  const approval = await step(requireApproval, { key: &#x27;approve:refund&#x27; });  return await step(processRefund(refund, approval));});// Now completes successfully\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"handle-rejection\">Handle rejection\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#handle-rejection\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Handle rejection”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isApprovalRejected\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/hitl\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">&#x26;&#x26;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isApprovalRejected\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Rejected:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reason\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">refunds\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">updateStatus\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">orderId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">rejected\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { isApprovalRejected } from &#x27;awaitly/hitl&#x27;;if (!result.ok &#x26;&#x26; isApprovalRejected(result.error)) {  console.log(&#x27;Rejected:&#x27;, result.error.reason);  await db.refunds.updateStatus(orderId, &#x27;rejected&#x27;);}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"list-pending-approvals\">List pending approvals\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#list-pending-approvals\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “List pending approvals”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">getPendingApprovals\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/hitl\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getResumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">pending\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getPendingApprovals\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// [{ stepKey: 'approve:refund', ... }]\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { getPendingApprovals } from &#x27;awaitly/hitl&#x27;;const state = collector.getResumeState();const pending = getPendingApprovals(state);// [{ stepKey: &#x27;approve:refund&#x27;, ... }]\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"hitl-orchestrator\">HITL orchestrator\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#hitl-orchestrator\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “HITL orchestrator”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>For complex approval flows, use the orchestrator:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createHITLOrchestrator\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createMemoryApprovalStore\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createMemoryWorkflowStateStore\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/hitl\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">orchestrator\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createHITLOrchestrator\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">approvalStore\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createMemoryApprovalStore\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">workflowStateStore\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createMemoryWorkflowStateStore\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">resumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) =>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, { \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">resumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Start workflow\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">runId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">orchestrator\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">start\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchData\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">requireApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">approve:data\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">workflowId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">wf-1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Approve\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">orchestrator\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">approve\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">runId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">approve:data\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">approvedBy\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">alice\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Resume\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">finalResult\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">orchestrator\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">resume\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">runId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import {  createHITLOrchestrator,  createMemoryApprovalStore,  createMemoryWorkflowStateStore,} from &#x27;awaitly/hitl&#x27;;const orchestrator = createHITLOrchestrator({  approvalStore: createMemoryApprovalStore(),  workflowStateStore: createMemoryWorkflowStateStore(),  createWorkflow: (resumeState) =>    createWorkflow(deps, { resumeState }),});// Start workflowconst { runId, result } = await orchestrator.start(  async (step) => {    const data = await step(fetchData());    await step(requireApproval, { key: &#x27;approve:data&#x27; });    return data;  },  { workflowId: &#x27;wf-1&#x27; });// Approveawait orchestrator.approve(runId, &#x27;approve:data&#x27;, { approvedBy: &#x27;alice&#x27; });// Resumeconst finalResult = await orchestrator.resume(runId);\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"approval-webhook-handler\">Approval webhook handler\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#approval-webhook-handler\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Approval webhook handler”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Expose an HTTP endpoint for approvals:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createApprovalWebhookHandler\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createMemoryApprovalStore\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/hitl\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">approvalStore\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createMemoryApprovalStore\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handler\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createApprovalWebhookHandler\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">approvalStore\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Express\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">app\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">post\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">/webhooks/approve\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">handler\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">action\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">action\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 'approve' | 'reject' | 'edit' | 'cancel'\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">reason\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reason\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">actorId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">actorId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// For 'edit' action:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">originalValue\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">originalValue\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">editedValue\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">req\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">editedValue\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createApprovalWebhookHandler, createMemoryApprovalStore } from &#x27;awaitly/hitl&#x27;;const approvalStore = createMemoryApprovalStore();const handler = createApprovalWebhookHandler(approvalStore);// Expressapp.post(&#x27;/webhooks/approve&#x27;, async (req, res) => {  const result = await handler({    key: req.body.key,    action: req.body.action, // &#x27;approve&#x27; | &#x27;reject&#x27; | &#x27;edit&#x27; | &#x27;cancel&#x27;    value: req.body.value,    reason: req.body.reason,    actorId: req.body.actorId,    // For &#x27;edit&#x27; action:    originalValue: req.body.originalValue,    editedValue: req.body.editedValue,  });  res.json(result);});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"full-example\">Full example\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#full-example\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Full example”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createResumeStateCollector\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createApprovalStep\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isPendingApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">injectApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/hitl\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stringifyState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">parseState\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/persistence\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Define approval step\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">requireManagerApproval\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createApprovalStep\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">manager-approval\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">checkApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> () => {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">record\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">approvals\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">find\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">expense-123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> (\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">record\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">pending\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">record\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">approved\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">approved\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">record\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">:\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">rejected\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">reason\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">record\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reason\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Workflow\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">expenseWorkflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">validateExpense\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">processPayment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">requireManagerApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createResumeStateCollector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">expense\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">validateExpense\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">approval\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">requireManagerApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">manager-approval\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processPayment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">expense\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">approval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">&#x26;&#x26;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isPendingApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Save for later\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">pendingWorkflows\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">create\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">expense-123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">stringifyState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getResumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">sendSlackMessage\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Expense needs approval: expense-123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createWorkflow, createResumeStateCollector } from &#x27;awaitly/workflow&#x27;;import {  createApprovalStep,  isPendingApproval,  injectApproval,} from &#x27;awaitly/hitl&#x27;;import { stringifyState, parseState } from &#x27;awaitly/persistence&#x27;;// Define approval stepconst requireManagerApproval = createApprovalStep({  key: &#x27;manager-approval&#x27;,  checkApproval: async () => {    const record = await db.approvals.find(&#x27;expense-123&#x27;);    if (!record) return { status: &#x27;pending&#x27; };    return record.approved      ? { status: &#x27;approved&#x27;, value: record }      : { status: &#x27;rejected&#x27;, reason: record.reason };  },});// Workflowconst expenseWorkflow = createWorkflow({  validateExpense,  processPayment,  requireManagerApproval,});const collector = createResumeStateCollector();const workflow = createWorkflow(deps, { onEvent: collector.handleEvent });const result = await workflow(async (step) => {  const expense = await step(validateExpense(data));  const approval = await step(requireManagerApproval, { key: &#x27;manager-approval&#x27; });  return await step(processPayment(expense, approval));});if (!result.ok &#x26;&#x26; isPendingApproval(result.error)) {  // Save for later  await db.pendingWorkflows.create({    id: &#x27;expense-123&#x27;,    state: stringifyState(collector.getResumeState()),  });  await sendSlackMessage(&#x27;Expense needs approval: expense-123&#x27;);}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"notification-channel-slack-email-etc\">Notification channel (Slack, email, etc.)\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#notification-channel-slack-email-etc\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Notification channel (Slack, email, etc.)”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Push notifications when approvals are needed:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createHITLOrchestrator\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">NotificationChannel\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/hitl\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">slackChannel\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">NotificationChannel\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> =\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onApprovalNeeded\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ctx\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">slack\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">chat\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">postMessage\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">channel\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">#approvals\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">blocks\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: [\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">section\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">text\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">mrkdwn\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">text\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">*\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">ctx\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">summary\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">*\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> } },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">context\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">text\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">mrkdwn\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">text\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Workflow: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">ctx\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">workflowName\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> | Key: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">ctx\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">approvalKey\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> } },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">actions\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">elements\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: [\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">          \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">button\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">text\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">plain_text\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">text\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Approve\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">action_id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">approve:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">ctx\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">approvalKey\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">          \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">button\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">text\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">plain_text\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">text\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Reject\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">action_id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">reject:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">ctx\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">approvalKey\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">        \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onApprovalResolved\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ctx\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Update the Slack message when approved/rejected\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">slack\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">chat\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">update\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ ... });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">orchestrator\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createHITLOrchestrator\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">approvalStore\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createMemoryApprovalStore\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">workflowStateStore\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createMemoryWorkflowStateStore\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">notificationChannel\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">slackChannel\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Push notifications\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createHITLOrchestrator, NotificationChannel } from &#x27;awaitly/hitl&#x27;;const slackChannel: NotificationChannel = {  async onApprovalNeeded(ctx) {    await slack.chat.postMessage({      channel: &#x27;#approvals&#x27;,      blocks: [        { type: &#x27;section&#x27;, text: { type: &#x27;mrkdwn&#x27;, text: &#x60;*${ctx.summary}*&#x60; } },        { type: &#x27;context&#x27;, text: { type: &#x27;mrkdwn&#x27;, text: &#x60;Workflow: ${ctx.workflowName} | Key: ${ctx.approvalKey}&#x60; } },        { type: &#x27;actions&#x27;, elements: [          { type: &#x27;button&#x27;, text: { type: &#x27;plain_text&#x27;, text: &#x27;Approve&#x27; }, action_id: &#x60;approve:${ctx.approvalKey}&#x60; },          { type: &#x27;button&#x27;, text: { type: &#x27;plain_text&#x27;, text: &#x27;Reject&#x27; }, action_id: &#x60;reject:${ctx.approvalKey}&#x60; }        ]}      ]    });  },  async onApprovalResolved(ctx) {    // Update the Slack message when approved/rejected    await slack.chat.update({ ... });  }};const orchestrator = createHITLOrchestrator({  approvalStore: createMemoryApprovalStore(),  workflowStateStore: createMemoryWorkflowStateStore(),  notificationChannel: slackChannel, // Push notifications});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"edit-approval-modify-before-approving\">Edit approval (modify before approving)\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#edit-approval-modify-before-approving\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Edit approval (modify before approving)”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Allow humans to approve with modifications:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Instead of simple approve:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">orchestrator\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">grantApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">budget\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Edit the value:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">orchestrator\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">editApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">budget\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Original proposed value\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">4500\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Edited value (human reduced it)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">editedBy\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">manager@co.com\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// The workflow continues with the edited value\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// Instead of simple approve:await orchestrator.grantApproval(&#x27;budget&#x27;, { amount: 5000 });// Edit the value:await orchestrator.editApproval(  &#x27;budget&#x27;,  { amount: 5000 },      // Original proposed value  { amount: 4500 },      // Edited value (human reduced it)  { editedBy: &#x27;manager@co.com&#x27; });// The workflow continues with the edited value\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>Check for edited approvals:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">status\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">approvalStore\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">budget\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">status\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">===\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">edited\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Original:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">originalValue\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Edited to:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">editedValue\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">By:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">editedBy\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const status = await approvalStore.getApproval(&#x27;budget&#x27;);if (status.status === &#x27;edited&#x27;) {  console.log(&#x27;Original:&#x27;, status.originalValue);  console.log(&#x27;Edited to:&#x27;, status.editedValue);  console.log(&#x27;By:&#x27;, status.editedBy);}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"pre-execution-gating-ai-sdk-pattern\">Pre-execution gating (AI SDK pattern)\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#pre-execution-gating-ai-sdk-pattern\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Pre-execution gating (AI SDK pattern)”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Gate operations \u003Cem>before\u003C/em> they execute, showing args for approval:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">gatedStep\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isPendingApproval\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/hitl\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Gate external email sends\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">gatedSendEmail\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">gatedStep\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">args\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">to\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">; \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">subject\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">; \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">sendEmail\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">args\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">email-approval\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">requiresApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">args\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">args\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">to\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">endsWith\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">@mycompany.com\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">description\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">args\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Send email to \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">args\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">to\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">: \"\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">args\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">subject\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">\"\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// In workflow:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// This shows the email args before sending\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">gatedSendEmail\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">to\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">external@other.com\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">subject\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Hello\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">...\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">send-email\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">&#x26;&#x26;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isPendingApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Human sees: \"Send email to external@other.com: \"Hello\"\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Plus the full args in metadata.pendingArgs\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">metadata\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">?.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">pendingArgs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// { to: 'external@other.com', subject: 'Hello', body: '...' }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { gatedStep, isPendingApproval } from &#x27;awaitly/hitl&#x27;;// Gate external email sendsconst gatedSendEmail = gatedStep(  (args: { to: string; subject: string; body: string }) => sendEmail(args),  {    key: &#x27;email-approval&#x27;,    requiresApproval: (args) => !args.to.endsWith(&#x27;@mycompany.com&#x27;),    description: (args) => &#x60;Send email to ${args.to}: &#x22;${args.subject}&#x22;&#x60;,  });// In workflow:const result = await workflow(async (step) => {  // This shows the email args before sending  await step(    () => gatedSendEmail({ to: &#x27;external@other.com&#x27;, subject: &#x27;Hello&#x27;, body: &#x27;...&#x27; }),    { key: &#x27;send-email&#x27; }  );});if (!result.ok &#x26;&#x26; isPendingApproval(result.error)) {  // Human sees: &#x22;Send email to external@other.com: &#x22;Hello&#x22;&#x22;  // Plus the full args in metadata.pendingArgs  console.log(result.error.metadata?.pendingArgs);  // { to: &#x27;external@other.com&#x27;, subject: &#x27;Hello&#x27;, body: &#x27;...&#x27; }}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"conditional-gating\">Conditional gating\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#conditional-gating\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Conditional gating”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Only gate certain operations:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">gatedDelete\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">gatedStep\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">args\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">path\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">deleteFile\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">args\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">path\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">delete-file\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">requiresApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">args\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">args\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">path\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">startsWith\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">/important/\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">description\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">args\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Delete file: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">args\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">path\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Deleting /tmp/foo.txt: No approval needed, executes immediately\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Deleting /important/data.json: Pauses for approval\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const gatedDelete = gatedStep(  (args: { path: string }) => deleteFile(args.path),  {    key: &#x27;delete-file&#x27;,    requiresApproval: (args) => args.path.startsWith(&#x27;/important/&#x27;),    description: (args) => &#x60;Delete file: ${args.path}&#x60;,  });// Deleting /tmp/foo.txt: No approval needed, executes immediately// Deleting /important/data.json: Pauses for approval\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"react-integration\">React integration\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#react-integration\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “React integration”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">function\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">useApprovalStatus\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">approvalKey\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">setStatus\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">useState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">ApprovalStatus\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">pending\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">useEffect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ws\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> new \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">WebSocket\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">/api/approvals/\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">approvalKey\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">/stream\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ws\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onmessage\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">setStatus\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">JSON\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">parse\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ws\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">close\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">approvalKey\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">function\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ApprovalCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">approvalKey\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">pendingArgs\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">})\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">status\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">useApprovalStatus\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">approvalKey\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">status\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">===\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">pending\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">div\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">h3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">Approval\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">Needed\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">/\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">h3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">pre\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>{JSON.stringify(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">pendingArgs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">null\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">2\u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">)\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}&#x3C;\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">/\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">pre\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">button\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">onClick\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">={() => \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">approve\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">approvalKey\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">pendingArgs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)}>\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">Approve\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">/\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">button\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">button\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">onClick\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">={() => \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">reject\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">approvalKey\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">User rejected\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)}>\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">Reject\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">/\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">button\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">/\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">div\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">div\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">Status\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">: \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{status.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}&#x3C;\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">/\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">div\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"function useApprovalStatus(approvalKey: string) {  const [status, setStatus] = useState\u003CApprovalStatus>({ status: &#x27;pending&#x27; });  useEffect(() => {    const ws = new WebSocket(&#x60;/api/approvals/${approvalKey}/stream&#x60;);    ws.onmessage = (e) => setStatus(JSON.parse(e.data));    return () => ws.close();  }, [approvalKey]);  return status;}function ApprovalCard({ approvalKey, pendingArgs }) {  const status = useApprovalStatus(approvalKey);  if (status.status === &#x27;pending&#x27;) {    return (      \u003Cdiv>        \u003Ch3>Approval Needed\u003C/h3>        \u003Cpre>{JSON.stringify(pendingArgs, null, 2)}\u003C/pre>        \u003Cbutton onClick={() => approve(approvalKey, pendingArgs)}>Approve\u003C/button>        \u003Cbutton onClick={() => reject(approvalKey, &#x27;User rejected&#x27;)}>Reject\u003C/button>      \u003C/div>    );  }  return \u003Cdiv>Status: {status.status}\u003C/div>;}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/guides/visualization/\">Learn about Visualization →\u003C/a>\u003C/p>",{"headings":682,"localImagePaths":726,"remoteImagePaths":727,"frontmatter":728,"imagePaths":729},[683,686,689,692,695,698,701,704,707,710,713,716,719,722,725],{"depth":57,"slug":684,"text":685},"create-an-approval-step","Create an approval step",{"depth":57,"slug":687,"text":688},"use-in-workflow","Use in workflow",{"depth":57,"slug":690,"text":691},"check-for-pending-approval","Check for pending approval",{"depth":57,"slug":693,"text":694},"inject-approval-and-resume","Inject approval and resume",{"depth":57,"slug":696,"text":697},"handle-rejection","Handle rejection",{"depth":57,"slug":699,"text":700},"list-pending-approvals","List pending approvals",{"depth":57,"slug":702,"text":703},"hitl-orchestrator","HITL orchestrator",{"depth":57,"slug":705,"text":706},"approval-webhook-handler","Approval webhook handler",{"depth":57,"slug":708,"text":709},"full-example","Full example",{"depth":57,"slug":711,"text":712},"notification-channel-slack-email-etc","Notification channel (Slack, email, etc.)",{"depth":57,"slug":714,"text":715},"edit-approval-modify-before-approving","Edit approval (modify before approving)",{"depth":57,"slug":717,"text":718},"pre-execution-gating-ai-sdk-pattern","Pre-execution gating (AI SDK pattern)",{"depth":212,"slug":720,"text":721},"conditional-gating","Conditional gating",{"depth":57,"slug":723,"text":724},"react-integration","React integration",{"depth":57,"slug":417,"text":418},[],[],{"title":671,"description":672},[],"guides/batch-processing",{"id":730,"data":732,"body":738,"filePath":739,"digest":740,"rendered":741},{"title":733,"description":734,"editUrl":16,"head":735,"template":46,"sidebar":736,"pagefind":16,"draft":35},"Batch Processing","Process large datasets with bounded concurrency",[],{"hidden":35,"attrs":737},{},"Process items in batches with progress tracking and checkpoint hooks. Useful for embedding generation, bulk API calls, or database migrations.\n\n## Basic usage\n\n```typescript\nimport { processInBatches, ok, err, type AsyncResult } from 'awaitly/batch';\n\nconst embedText = async (text: string): AsyncResult\u003Cnumber[], 'EMBED_ERROR'> => {\n  const response = await fetch('/api/embed', { method: 'POST', body: text });\n  return response.ok ? ok(await response.json()) : err('EMBED_ERROR');\n};\n\nconst result = await processInBatches(\n  texts,                    // Array of items\n  embedText,                // Process function\n  { batchSize: 20, concurrency: 3 }\n);\n\nif (result.ok) {\n  console.log(`Processed ${result.value.length} items`);\n}\n```\n\n## Configuration\n\n```typescript\n{\n  batchSize: 20,      // Items per batch\n  concurrency: 3,     // Parallel operations within each batch\n  batchDelayMs: 50,   // Delay between batches (backpressure)\n}\n```\n\n## Progress tracking\n\n```typescript\nconst result = await processInBatches(\n  items,\n  processItem,\n  { batchSize: 20, concurrency: 3 },\n  {\n    onProgress: (progress) => {\n      console.log(`${progress.percent}% complete`);\n      console.log(`Batch ${progress.batch}/${progress.totalBatches}`);\n      console.log(`${progress.processed}/${progress.total} items`);\n    },\n  }\n);\n```\n\n## Checkpoint hooks\n\nRun code between batches (e.g., flush database WAL):\n\n```typescript\nconst result = await processInBatches(\n  records,\n  insertRecord,\n  { batchSize: 100, concurrency: 5 },\n  {\n    afterBatch: async () => {\n      await db.checkpoint();\n      return ok(undefined);\n    },\n  }\n);\n```\n\nIf `afterBatch` returns an error, processing stops.\n\n## Presets\n\nUse presets for common scenarios:\n\n```typescript\nimport { processInBatches, batchPresets } from 'awaitly/batch';\n\n// Conservative: batchSize=20, concurrency=3, delay=50ms\n// Good for memory-constrained environments\nawait processInBatches(items, process, batchPresets.conservative);\n\n// Balanced: batchSize=50, concurrency=5, delay=10ms\n// Good for typical workloads\nawait processInBatches(items, process, batchPresets.balanced);\n\n// Aggressive: batchSize=100, concurrency=10, no delay\n// Good when memory isn't a concern\nawait processInBatches(items, process, batchPresets.aggressive);\n```\n\n## Error handling\n\nProcessing stops on the first error:\n\n```typescript\nconst result = await processInBatches(\n  items,\n  async (item, index) => {\n    if (item.invalid) {\n      return err('INVALID_ITEM');\n    }\n    return ok(await process(item));\n  },\n  { batchSize: 20, concurrency: 3 }\n);\n\nif (!result.ok) {\n  if (isBatchProcessingError(result.error)) {\n    console.log('Failed at item:', result.error.itemIndex);\n    console.log('In batch:', result.error.batchNumber);\n    console.log('Underlying error:', result.error.error);\n  }\n}\n```\n\n## Item index\n\nThe process function receives the global index:\n\n```typescript\nconst result = await processInBatches(\n  items,\n  async (item, index) => {\n    console.log(`Processing item ${index + 1} of ${items.length}`);\n    return ok(await process(item));\n  },\n  { batchSize: 20, concurrency: 3 }\n);\n```\n\n## Config validation\n\nInvalid config returns an error immediately:\n\n```typescript\nconst result = await processInBatches(\n  items,\n  process,\n  { batchSize: 0, concurrency: 3 } // Invalid!\n);\n\nif (!result.ok && isInvalidBatchConfigError(result.error)) {\n  console.log(result.error.reason); // \"batchSize must be a positive integer\"\n  console.log(result.error.field);  // \"batchSize\"\n  console.log(result.error.value);  // 0\n}\n```\n\n`batchSize` and `concurrency` must be positive integers.\n\n## Full example\n\n```typescript\nimport { ok, err } from 'awaitly';\nimport {\n  processInBatches,\n  batchPresets,\n  isBatchProcessingError,\n} from 'awaitly/batch';\n\n// Generate embeddings for documents\nconst generateEmbeddings = async (documents: Document[]) => {\n  let processed = 0;\n\n  const result = await processInBatches(\n    documents,\n    async (doc) => {\n      const response = await fetch('/api/embed', {\n        method: 'POST',\n        body: JSON.stringify({ text: doc.content }),\n      });\n\n      if (!response.ok) {\n        return err('EMBED_FAILED' as const);\n      }\n\n      return ok({\n        docId: doc.id,\n        embedding: await response.json(),\n      });\n    },\n    batchPresets.conservative,\n    {\n      afterBatch: async () => {\n        // Checkpoint after each batch\n        await db.checkpoint();\n        return ok(undefined);\n      },\n      onProgress: (p) => {\n        console.log(`Embedding documents: ${p.percent}%`);\n      },\n    }\n  );\n\n  if (!result.ok) {\n    if (isBatchProcessingError(result.error)) {\n      console.error(`Failed at document ${result.error.itemIndex}`);\n    }\n    return result;\n  }\n\n  // Save all embeddings\n  await db.embeddings.insertMany(result.value);\n  return ok({ count: result.value.length });\n};\n```\n\n## Next\n\n[See Patterns: Checkout Flow →](/patterns/checkout-flow/)","src/content/docs/guides/batch-processing.md","ba252e7948384ba8",{"html":742,"metadata":743},"\u003Cp>Process items in batches with progress tracking and checkpoint hooks. Useful for embedding generation, bulk API calls, or database migrations.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"basic-usage\">Basic usage\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#basic-usage\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Basic usage”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">processInBatches\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/batch\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">embedText\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">text\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[],\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">EMBED_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">response\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetch\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">/api/embed\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">method\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">POST\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">text\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">response\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> ? \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">response\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">())\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> : \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">EMBED_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processInBatches\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">texts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">                    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Array of items\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">embedText\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">                \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Process function\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">batchSize\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">20\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">concurrency\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Processed \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">length\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> items\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { processInBatches, ok, err, type AsyncResult } from &#x27;awaitly/batch&#x27;;const embedText = async (text: string): AsyncResult\u003Cnumber[], &#x27;EMBED_ERROR&#x27;> => {  const response = await fetch(&#x27;/api/embed&#x27;, { method: &#x27;POST&#x27;, body: text });  return response.ok ? ok(await response.json()) : err(&#x27;EMBED_ERROR&#x27;);};const result = await processInBatches(  texts,                    // Array of items  embedText,                // Process function  { batchSize: 20, concurrency: 3 });if (result.ok) {  console.log(&#x60;Processed ${result.value.length} items&#x60;);}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"configuration\">Configuration\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#configuration\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Configuration”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">batchSize\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">20\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Items per batch\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">concurrency\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Parallel operations within each batch\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">batchDelayMs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">50\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">   \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Delay between batches (backpressure)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"{  batchSize: 20,      // Items per batch  concurrency: 3,     // Parallel operations within each batch  batchDelayMs: 50,   // Delay between batches (backpressure)}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"progress-tracking\">Progress tracking\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#progress-tracking\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Progress tracking”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processInBatches\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">processItem\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">batchSize\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">20\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">concurrency\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onProgress\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">progress\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">progress\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">percent\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">% complete\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Batch \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">progress\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">batch\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">/\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">progress\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">totalBatches\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">progress\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">processed\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">/\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">progress\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">total\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> items\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await processInBatches(  items,  processItem,  { batchSize: 20, concurrency: 3 },  {    onProgress: (progress) => {      console.log(&#x60;${progress.percent}% complete&#x60;);      console.log(&#x60;Batch ${progress.batch}/${progress.totalBatches}&#x60;);      console.log(&#x60;${progress.processed}/${progress.total} items&#x60;);    },  });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"checkpoint-hooks\">Checkpoint hooks\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#checkpoint-hooks\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Checkpoint hooks”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Run code between batches (e.g., flush database WAL):\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processInBatches\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">records\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">insertRecord\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">batchSize\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">100\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">concurrency\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">afterBatch\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> () => {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">checkpoint\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">undefined\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await processInBatches(  records,  insertRecord,  { batchSize: 100, concurrency: 5 },  {    afterBatch: async () => {      await db.checkpoint();      return ok(undefined);    },  });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>If \u003Ccode dir=\"auto\">afterBatch\u003C/code> returns an error, processing stops.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"presets\">Presets\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#presets\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Presets”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use presets for common scenarios:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">processInBatches\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">batchPresets\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/batch\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Conservative: batchSize=20, concurrency=3, delay=50ms\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Good for memory-constrained environments\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processInBatches\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">process\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">batchPresets\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">conservative\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Balanced: batchSize=50, concurrency=5, delay=10ms\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Good for typical workloads\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processInBatches\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">process\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">batchPresets\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">balanced\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Aggressive: batchSize=100, concurrency=10, no delay\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Good when memory isn't a concern\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processInBatches\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">process\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">batchPresets\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">aggressive\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { processInBatches, batchPresets } from &#x27;awaitly/batch&#x27;;// Conservative: batchSize=20, concurrency=3, delay=50ms// Good for memory-constrained environmentsawait processInBatches(items, process, batchPresets.conservative);// Balanced: batchSize=50, concurrency=5, delay=10ms// Good for typical workloadsawait processInBatches(items, process, batchPresets.balanced);// Aggressive: batchSize=100, concurrency=10, no delay// Good when memory isn&#x27;t a concernawait processInBatches(items, process, batchPresets.aggressive);\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"error-handling\">Error handling\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#error-handling\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Error handling”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Processing stops on the first error:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processInBatches\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">item\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">index\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">item\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">invalid\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">INVALID_ITEM\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">process\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">item\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">batchSize\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">20\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">concurrency\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isBatchProcessingError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Failed at item:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">itemIndex\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">In batch:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">batchNumber\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Underlying error:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await processInBatches(  items,  async (item, index) => {    if (item.invalid) {      return err(&#x27;INVALID_ITEM&#x27;);    }    return ok(await process(item));  },  { batchSize: 20, concurrency: 3 });if (!result.ok) {  if (isBatchProcessingError(result.error)) {    console.log(&#x27;Failed at item:&#x27;, result.error.itemIndex);    console.log(&#x27;In batch:&#x27;, result.error.batchNumber);    console.log(&#x27;Underlying error:&#x27;, result.error.error);  }}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"item-index\">Item index\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#item-index\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Item index”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>The process function receives the global index:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processInBatches\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">item\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">index\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Processing item \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">index \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">+\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> of \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">length\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">process\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">item\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">batchSize\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">20\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">concurrency\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await processInBatches(  items,  async (item, index) => {    console.log(&#x60;Processing item ${index + 1} of ${items.length}&#x60;);    return ok(await process(item));  },  { batchSize: 20, concurrency: 3 });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"config-validation\">Config validation\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#config-validation\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Config validation”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Invalid config returns an error immediately:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processInBatches\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">process\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">batchSize\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">concurrency\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Invalid!\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">&#x26;&#x26;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isInvalidBatchConfigError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reason\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// \"batchSize must be a positive integer\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">field\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// \"batchSize\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 0\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await processInBatches(  items,  process,  { batchSize: 0, concurrency: 3 } // Invalid!);if (!result.ok &#x26;&#x26; isInvalidBatchConfigError(result.error)) {  console.log(result.error.reason); // &#x22;batchSize must be a positive integer&#x22;  console.log(result.error.field);  // &#x22;batchSize&#x22;  console.log(result.error.value);  // 0}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>\u003Ccode dir=\"auto\">batchSize\u003C/code> and \u003Ccode dir=\"auto\">concurrency\u003C/code> must be positive integers.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"full-example\">Full example\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#full-example\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Full example”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">err\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">processInBatches\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">batchPresets\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isBatchProcessingError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/batch\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Generate embeddings for documents\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">generateEmbeddings\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">documents\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Document\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[])\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">let \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">processed\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processInBatches\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">documents\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">doc\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">response\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetch\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">/api/embed\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">method\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">POST\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">body\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">JSON\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">stringify\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">text\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">doc\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">content\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">response\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">EMBED_FAILED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">as\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> const\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">docId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">doc\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">embedding\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">response\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">batchPresets\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">conservative\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">afterBatch\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> () => {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Checkpoint after each batch\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">checkpoint\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">undefined\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onProgress\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Embedding documents: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">percent\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">%\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isBatchProcessingError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Failed at document \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">itemIndex\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Save all embeddings\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">embeddings\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">insertMany\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">count\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">length\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { ok, err } from &#x27;awaitly&#x27;;import {  processInBatches,  batchPresets,  isBatchProcessingError,} from &#x27;awaitly/batch&#x27;;// Generate embeddings for documentsconst generateEmbeddings = async (documents: Document[]) => {  let processed = 0;  const result = await processInBatches(    documents,    async (doc) => {      const response = await fetch(&#x27;/api/embed&#x27;, {        method: &#x27;POST&#x27;,        body: JSON.stringify({ text: doc.content }),      });      if (!response.ok) {        return err(&#x27;EMBED_FAILED&#x27; as const);      }      return ok({        docId: doc.id,        embedding: await response.json(),      });    },    batchPresets.conservative,    {      afterBatch: async () => {        // Checkpoint after each batch        await db.checkpoint();        return ok(undefined);      },      onProgress: (p) => {        console.log(&#x60;Embedding documents: ${p.percent}%&#x60;);      },    }  );  if (!result.ok) {    if (isBatchProcessingError(result.error)) {      console.error(&#x60;Failed at document ${result.error.itemIndex}&#x60;);    }    return result;  }  // Save all embeddings  await db.embeddings.insertMany(result.value);  return ok({ count: result.value.length });};\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/patterns/checkout-flow/\">See Patterns: Checkout Flow →\u003C/a>\u003C/p>",{"headings":744,"localImagePaths":767,"remoteImagePaths":768,"frontmatter":769,"imagePaths":770},[745,746,749,752,755,756,759,762,765,766],{"depth":57,"slug":58,"text":59},{"depth":57,"slug":747,"text":748},"configuration","Configuration",{"depth":57,"slug":750,"text":751},"progress-tracking","Progress tracking",{"depth":57,"slug":753,"text":754},"checkpoint-hooks","Checkpoint hooks",{"depth":57,"slug":279,"text":280},{"depth":57,"slug":757,"text":758},"error-handling","Error handling",{"depth":57,"slug":760,"text":761},"item-index","Item index",{"depth":57,"slug":763,"text":764},"config-validation","Config validation",{"depth":57,"slug":708,"text":709},{"depth":57,"slug":417,"text":418},[],[],{"title":733,"description":734},[],"guides/persistence",{"id":771,"data":773,"body":779,"filePath":780,"digest":781,"rendered":782},{"title":774,"description":775,"editUrl":16,"head":776,"template":46,"sidebar":777,"pagefind":16,"draft":35},"Persistence","Save and resume workflows across restarts",[],{"hidden":35,"attrs":778},{},"Save workflow state to a database and resume later. Completed steps return their cached results without re-executing.\n\n## Quick Start Imports\n\n**Option 1: Import from main package** (recommended for most use cases)\n\n```typescript\nimport { createWorkflow, createResumeStateCollector, isStepComplete } from 'awaitly/workflow';\nimport { stringifyState, parseState } from 'awaitly/persistence';\n```\n\n**Option 2: Import from persistence submodule** (for full persistence API)\n\n```typescript\nimport { createWorkflow, createResumeStateCollector, isStepComplete } from 'awaitly/workflow';\nimport { stringifyState, parseState, createStatePersistence } from 'awaitly/persistence';\n```\n\n## Collect state during execution\n\nUse `createResumeStateCollector` to automatically capture step results:\n\n```typescript\nimport { createWorkflow, createResumeStateCollector } from 'awaitly/workflow';\n\nconst collector = createResumeStateCollector();\n\nconst workflow = createWorkflow(\n  { fetchUser, fetchPosts },\n  { onEvent: collector.handleEvent }\n);\n\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser('1'), { key: 'user:1' });\n  const posts = await step(() => fetchPosts(user.id), { key: `posts:${user.id}` });\n  return { user, posts };\n});\n\n// Get collected state\nconst state = collector.getResumeState();\n```\n\nOnly steps with `key` are saved.\n\n## Save to database\n\nSerialize the state and store it:\n\n```typescript\nimport { stringifyState } from 'awaitly/persistence';\n\nconst json = stringifyState(state, {\n  workflowId: 'wf-123',\n  timestamp: Date.now(),\n});\n\nawait db.workflowStates.create({\n  id: 'wf-123',\n  state: json,\n  createdAt: new Date(),\n});\n```\n\n## Resume from saved state\n\nLoad and parse the state, then pass it to a new workflow:\n\n```typescript\nimport { parseState } from 'awaitly/persistence';\n\nconst saved = await db.workflowStates.findUnique({\n  where: { id: 'wf-123' },\n});\n\nconst resumeState = parseState(saved.state);\n\nconst workflow = createWorkflow(\n  { fetchUser, fetchPosts },\n  { resumeState }\n);\n\nawait workflow(async (step) => {\n  // These steps return cached values - no actual fetch\n  const user = await step(() => fetchUser('1'), { key: 'user:1' });\n  const posts = await step(() => fetchPosts(user.id), { key: `posts:${user.id}` });\n  return { user, posts };\n});\n```\n\n## State persistence adapter\n\nFor structured storage, use `createStatePersistence`:\n\n```typescript\nimport { createStatePersistence } from 'awaitly/persistence';\n\nconst persistence = createStatePersistence({\n  get: (key) => redis.get(key),\n  set: (key, value) => redis.set(key, value),\n  delete: (key) => redis.del(key).then(n => n > 0),\n  exists: (key) => redis.exists(key).then(n => n > 0),\n  keys: (pattern) => redis.keys(pattern),\n}, 'workflow:state:');\n\n// Save\nawait persistence.save('wf-123', state, { userId: 'user-1' });\n\n// Load\nconst savedState = await persistence.load('wf-123');\n\n// Resume\nconst workflow = createWorkflow(deps, { resumeState: savedState });\n```\n\n## Check if step is complete\n\nUse `isStepComplete` to check state before execution:\n\n```typescript\nimport { isStepComplete } from 'awaitly/workflow';\n\nconst state = await persistence.load('wf-123');\n\nif (isStepComplete(state, 'user:1')) {\n  console.log('User already fetched');\n}\n```\n\n## Crash recovery pattern\n\nSave state after each batch of work:\n\n```typescript\nconst collector = createResumeStateCollector();\nconst workflow = createWorkflow(deps, { onEvent: collector.handleEvent });\n\nconst result = await workflow(async (step) => {\n  const user = await step(() => fetchUser('1'), { key: 'user:1' });\n\n  // Save after critical step\n  await saveCheckpoint(collector.getResumeState());\n\n  const posts = await step(() => fetchPosts(user.id), { key: `posts:${user.id}` });\n  return { user, posts };\n});\n\n// Final save\nawait saveCheckpoint(collector.getResumeState());\n```\n\nIf the workflow crashes, resume from the last checkpoint:\n\n```typescript\nconst savedState = await loadCheckpoint('wf-123');\n\nconst workflow = createWorkflow(deps, { resumeState: savedState });\n\n// Completed steps use cached values\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser('1'), { key: 'user:1' });\n  const posts = await step(() => fetchPosts(user.id), { key: `posts:${user.id}` });\n  return { user, posts };\n});\n```\n\n## Async resume state loading\n\nLoad state lazily:\n\n```typescript\nimport { parseState } from 'awaitly/persistence';\n\nconst workflow = createWorkflow(deps, {\n  resumeState: async () => {\n    const saved = await db.workflowStates.findUnique({ where: { id: 'wf-123' } });\n    return saved ? parseState(saved.state) : undefined;\n  },\n});\n```\n\n## File-based persistence\n\nFor simple cases, use the file cache adapter:\n\n```typescript\nimport { createFileCache } from 'awaitly/persistence';\n\nconst cache = createFileCache({\n  directory: './workflow-state',\n  ttlMs: 7 * 24 * 60 * 60 * 1000, // 7 days\n});\n\nconst workflow = createWorkflow(deps, { cache });\n```\n\n## Next\n\n[Learn about Human-in-the-Loop →](/guides/human-in-loop/)","src/content/docs/guides/persistence.md","cab8ed65e266b820",{"html":783,"metadata":784},"\u003Cp>Save workflow state to a database and resume later. Completed steps return their cached results without re-executing.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"quick-start-imports\">Quick Start Imports\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#quick-start-imports\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Quick Start Imports”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Cstrong>Option 1: Import from main package\u003C/strong> (recommended for most use cases)\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createResumeStateCollector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isStepComplete\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stringifyState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">parseState\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/persistence\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createWorkflow, createResumeStateCollector, isStepComplete } from &#x27;awaitly/workflow&#x27;;import { stringifyState, parseState } from &#x27;awaitly/persistence&#x27;;\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>\u003Cstrong>Option 2: Import from persistence submodule\u003C/strong> (for full persistence API)\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createResumeStateCollector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isStepComplete\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stringifyState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">parseState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createStatePersistence\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/persistence\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createWorkflow, createResumeStateCollector, isStepComplete } from &#x27;awaitly/workflow&#x27;;import { stringifyState, parseState, createStatePersistence } from &#x27;awaitly/persistence&#x27;;\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"collect-state-during-execution\">Collect state during execution\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#collect-state-during-execution\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Collect state during execution”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">createResumeStateCollector\u003C/code> to automatically capture step results:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createResumeStateCollector\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createResumeStateCollector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">posts:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">id\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Get collected state\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getResumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createWorkflow, createResumeStateCollector } from &#x27;awaitly/workflow&#x27;;const collector = createResumeStateCollector();const workflow = createWorkflow(  { fetchUser, fetchPosts },  { onEvent: collector.handleEvent });await workflow(async (step) => {  const user = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });  const posts = await step(() => fetchPosts(user.id), { key: &#x60;posts:${user.id}&#x60; });  return { user, posts };});// Get collected stateconst state = collector.getResumeState();\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>Only steps with \u003Ccode dir=\"auto\">key\u003C/code> are saved.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"save-to-database\">Save to database\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#save-to-database\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Save to database”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Serialize the state and store it:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stringifyState\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/persistence\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">json\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">stringifyState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">workflowId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">wf-123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">timestamp\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">Date\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">now\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflowStates\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">create\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">wf-123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">createdAt\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">new\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">Date\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { stringifyState } from &#x27;awaitly/persistence&#x27;;const json = stringifyState(state, {  workflowId: &#x27;wf-123&#x27;,  timestamp: Date.now(),});await db.workflowStates.create({  id: &#x27;wf-123&#x27;,  state: json,  createdAt: new Date(),});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"resume-from-saved-state\">Resume from saved state\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#resume-from-saved-state\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Resume from saved state”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Load and parse the state, then pass it to a new workflow:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">parseState\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/persistence\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saved\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflowStates\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">findUnique\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">where\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">wf-123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">resumeState\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">parseState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saved\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">resumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// These steps return cached values - no actual fetch\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">posts:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">id\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { parseState } from &#x27;awaitly/persistence&#x27;;const saved = await db.workflowStates.findUnique({  where: { id: &#x27;wf-123&#x27; },});const resumeState = parseState(saved.state);const workflow = createWorkflow(  { fetchUser, fetchPosts },  { resumeState });await workflow(async (step) => {  // These steps return cached values - no actual fetch  const user = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });  const posts = await step(() => fetchPosts(user.id), { key: &#x60;posts:${user.id}&#x60; });  return { user, posts };});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"state-persistence-adapter\">State persistence adapter\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#state-persistence-adapter\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “State persistence adapter”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>For structured storage, use \u003Ccode dir=\"auto\">createStatePersistence\u003C/code>:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createStatePersistence\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/persistence\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">persistence\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createStatePersistence\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">get\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">redis\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">get\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">set\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">redis\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">set\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">delete\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">redis\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">del\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">then\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">n\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> => \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">n\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> > \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">exists\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">redis\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">exists\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">then\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">n\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> => \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">n\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> > \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">keys\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">pattern\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">redis\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">keys\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">pattern\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">workflow:state:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Save\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">persistence\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">save\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">wf-123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">userId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user-1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Load\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">savedState\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">persistence\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">load\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">wf-123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Resume\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">resumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">savedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createStatePersistence } from &#x27;awaitly/persistence&#x27;;const persistence = createStatePersistence({  get: (key) => redis.get(key),  set: (key, value) => redis.set(key, value),  delete: (key) => redis.del(key).then(n => n > 0),  exists: (key) => redis.exists(key).then(n => n > 0),  keys: (pattern) => redis.keys(pattern),}, &#x27;workflow:state:&#x27;);// Saveawait persistence.save(&#x27;wf-123&#x27;, state, { userId: &#x27;user-1&#x27; });// Loadconst savedState = await persistence.load(&#x27;wf-123&#x27;);// Resumeconst workflow = createWorkflow(deps, { resumeState: savedState });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"check-if-step-is-complete\">Check if step is complete\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#check-if-step-is-complete\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Check if step is complete”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">isStepComplete\u003C/code> to check state before execution:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isStepComplete\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">persistence\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">load\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">wf-123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isStepComplete\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">User already fetched\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { isStepComplete } from &#x27;awaitly/workflow&#x27;;const state = await persistence.load(&#x27;wf-123&#x27;);if (isStepComplete(state, &#x27;user:1&#x27;)) {  console.log(&#x27;User already fetched&#x27;);}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"crash-recovery-pattern\">Crash recovery pattern\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#crash-recovery-pattern\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Crash recovery pattern”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Save state after each batch of work:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createResumeStateCollector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Save after critical step\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">saveCheckpoint\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getResumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">posts:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">id\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Final save\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">saveCheckpoint\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getResumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const collector = createResumeStateCollector();const workflow = createWorkflow(deps, { onEvent: collector.handleEvent });const result = await workflow(async (step) => {  const user = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });  // Save after critical step  await saveCheckpoint(collector.getResumeState());  const posts = await step(() => fetchPosts(user.id), { key: &#x60;posts:${user.id}&#x60; });  return { user, posts };});// Final saveawait saveCheckpoint(collector.getResumeState());\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>If the workflow crashes, resume from the last checkpoint:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">savedState\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">loadCheckpoint\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">wf-123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">resumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">savedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Completed steps use cached values\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">posts:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">id\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const savedState = await loadCheckpoint(&#x27;wf-123&#x27;);const workflow = createWorkflow(deps, { resumeState: savedState });// Completed steps use cached valuesawait workflow(async (step) => {  const user = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });  const posts = await step(() => fetchPosts(user.id), { key: &#x60;posts:${user.id}&#x60; });  return { user, posts };});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"async-resume-state-loading\">Async resume state loading\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#async-resume-state-loading\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Async resume state loading”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Load state lazily:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">parseState\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/persistence\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">resumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> () => {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saved\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflowStates\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">findUnique\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">where\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">wf-123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> } });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saved\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">parseState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saved\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">:\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">undefined\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { parseState } from &#x27;awaitly/persistence&#x27;;const workflow = createWorkflow(deps, {  resumeState: async () => {    const saved = await db.workflowStates.findUnique({ where: { id: &#x27;wf-123&#x27; } });    return saved ? parseState(saved.state) : undefined;  },});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"file-based-persistence\">File-based persistence\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#file-based-persistence\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “File-based persistence”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>For simple cases, use the file cache adapter:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createFileCache\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/persistence\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cache\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createFileCache\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">directory\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">./workflow-state\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">ttlMs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">7\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">*\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">24\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">*\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">60\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">*\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">60\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">*\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 7 days\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cache\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createFileCache } from &#x27;awaitly/persistence&#x27;;const cache = createFileCache({  directory: &#x27;./workflow-state&#x27;,  ttlMs: 7 * 24 * 60 * 60 * 1000, // 7 days});const workflow = createWorkflow(deps, { cache });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/guides/human-in-loop/\">Learn about Human-in-the-Loop →\u003C/a>\u003C/p>",{"headings":785,"localImagePaths":814,"remoteImagePaths":815,"frontmatter":816,"imagePaths":817},[786,789,792,795,798,801,804,807,810,813],{"depth":57,"slug":787,"text":788},"quick-start-imports","Quick Start Imports",{"depth":57,"slug":790,"text":791},"collect-state-during-execution","Collect state during execution",{"depth":57,"slug":793,"text":794},"save-to-database","Save to database",{"depth":57,"slug":796,"text":797},"resume-from-saved-state","Resume from saved state",{"depth":57,"slug":799,"text":800},"state-persistence-adapter","State persistence adapter",{"depth":57,"slug":802,"text":803},"check-if-step-is-complete","Check if step is complete",{"depth":57,"slug":805,"text":806},"crash-recovery-pattern","Crash recovery pattern",{"depth":57,"slug":808,"text":809},"async-resume-state-loading","Async resume state loading",{"depth":57,"slug":811,"text":812},"file-based-persistence","File-based persistence",{"depth":57,"slug":417,"text":418},[],[],{"title":774,"description":775},[],"guides/retries-timeouts",{"id":818,"data":820,"body":826,"filePath":827,"digest":828,"rendered":829},{"title":821,"description":822,"editUrl":16,"head":823,"template":46,"sidebar":824,"pagefind":16,"draft":35},"Retries & Timeouts","Add resilience to workflow steps",[],{"hidden":35,"attrs":825},{},"Add retries and timeouts to individual steps without wrapping your entire workflow in try/catch.\n\n## Timeouts\n\nLimit how long a step can run:\n\n```typescript\nconst data = await step.withTimeout(\n  () => slowOperation(),\n  { ms: 5000 }\n);\n```\n\n### With name for debugging\n\n```typescript\nconst data = await step.withTimeout(\n  () => slowOperation(),\n  { ms: 5000, name: 'Slow operation' }\n);\n```\n\nIf it times out, you get a `StepTimeoutError` with the name.\n\n### Checking for timeout errors\n\n```typescript\nimport { isStepTimeoutError, getStepTimeoutMeta } from 'awaitly/workflow';\n\nif (!result.ok && isStepTimeoutError(result.error)) {\n  const meta = getStepTimeoutMeta(result.error);\n  console.log(`${meta.name} timed out after ${meta.ms}ms`);\n}\n```\n\n## Retries\n\nRetry failed steps with configurable backoff:\n\n```typescript\nconst data = await step.retry(\n  () => fetchData(),\n  { attempts: 3 }\n);\n```\n\n### Backoff strategies\n\n```typescript\n// Fixed: same delay every time\n{ attempts: 3, backoff: 'fixed', delayMs: 100 }\n// Delays: 100ms, 100ms, 100ms\n\n// Linear: delay increases linearly\n{ attempts: 3, backoff: 'linear', delayMs: 100 }\n// Delays: 100ms, 200ms, 300ms\n\n// Exponential: delay doubles each time\n{ attempts: 3, backoff: 'exponential', delayMs: 100 }\n// Delays: 100ms, 200ms, 400ms\n```\n\n### Cap the delay\n\n```typescript\n{\n  attempts: 10,\n  backoff: 'exponential',\n  delayMs: 100,\n  maxDelayMs: 5000, // Never wait more than 5 seconds\n}\n```\n\n### Add jitter\n\nRandomize delays to avoid thundering herd:\n\n```typescript\n{\n  attempts: 3,\n  backoff: 'exponential',\n  delayMs: 100,\n  jitter: true, // Add random variation\n}\n```\n\n### Conditional retry\n\nOnly retry certain errors:\n\n```typescript\nconst user = await step.retry(\n  () => fetchUser('1'),\n  {\n    attempts: 3,\n    backoff: 'exponential',\n    retryOn: (error) => {\n      // Don't retry NOT_FOUND - the user doesn't exist\n      if (error === 'NOT_FOUND') return false;\n      // Retry everything else\n      return true;\n    },\n  }\n);\n```\n\n## Combining retry and timeout\n\nEach attempt has its own timeout:\n\n```typescript\nconst data = await step.retry(\n  () => step.withTimeout(() => fetchData(), { ms: 2000 }),\n  { attempts: 3, backoff: 'exponential' }\n);\n```\n\nThis retries up to 3 times, with each attempt limited to 2 seconds.\n\n## Via step options\n\nYou can also configure retry and timeout directly in step options:\n\n```typescript\nconst user = await step(() => fetchUser('1'), {\n  retry: {\n    attempts: 3,\n    backoff: 'exponential',\n    delayMs: 100,\n  },\n  timeout: {\n    ms: 5000,\n  },\n});\n```\n\n## Full example\n\n```typescript\nconst workflow = createWorkflow({ fetchUserFromApi, cacheUser });\n\nconst result = await workflow(async (step) => {\n  // Retry API calls with exponential backoff\n  const user = await step.retry(\n    () => step.withTimeout(\n      () => fetchUserFromApi('123'),\n      { ms: 3000, name: 'Fetch user' }\n    ),\n    {\n      attempts: 3,\n      backoff: 'exponential',\n      delayMs: 200,\n      maxDelayMs: 2000,\n      retryOn: (error) => error !== 'NOT_FOUND',\n    }\n  );\n\n  // Cache doesn't need retry\n  await step(() => cacheUser(user));\n\n  return user;\n});\n```\n\n## Next\n\n[Learn about Caching →](/guides/caching/)","src/content/docs/guides/retries-timeouts.md","27d079f2fcfb99b5",{"html":830,"metadata":831},"\u003Cp>Add retries and timeouts to individual steps without wrapping your entire workflow in try/catch.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"timeouts\">Timeouts\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#timeouts\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Timeouts”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Limit how long a step can run:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withTimeout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">slowOperation\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">ms\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const data = await step.withTimeout(  () => slowOperation(),  { ms: 5000 });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"with-name-for-debugging\">With name for debugging\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#with-name-for-debugging\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “With name for debugging”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withTimeout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">slowOperation\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">ms\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Slow operation\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const data = await step.withTimeout(  () => slowOperation(),  { ms: 5000, name: &#x27;Slow operation&#x27; });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>If it times out, you get a \u003Ccode dir=\"auto\">StepTimeoutError\u003C/code> with the name.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"checking-for-timeout-errors\">Checking for timeout errors\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#checking-for-timeout-errors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Checking for timeout errors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isStepTimeoutError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">getStepTimeoutMeta\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">&#x26;&#x26;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isStepTimeoutError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">meta\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getStepTimeoutMeta\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">meta\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">name\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> timed out after \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">meta\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">ms\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">ms\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { isStepTimeoutError, getStepTimeoutMeta } from &#x27;awaitly/workflow&#x27;;if (!result.ok &#x26;&#x26; isStepTimeoutError(result.error)) {  const meta = getStepTimeoutMeta(result.error);  console.log(&#x60;${meta.name} timed out after ${meta.ms}ms&#x60;);}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"retries\">Retries\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#retries\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Retries”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Retry failed steps with configurable backoff:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchData\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">attempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const data = await step.retry(  () => fetchData(),  { attempts: 3 });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"backoff-strategies\">Backoff strategies\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#backoff-strategies\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Backoff strategies”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Fixed: same delay every time\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">attempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">backoff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">fixed\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">delayMs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">100\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Delays: 100ms, 100ms, 100ms\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Linear: delay increases linearly\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">attempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">backoff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">linear\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">delayMs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">100\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Delays: 100ms, 200ms, 300ms\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Exponential: delay doubles each time\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">attempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">backoff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">exponential\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">delayMs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">100\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Delays: 100ms, 200ms, 400ms\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// Fixed: same delay every time{ attempts: 3, backoff: &#x27;fixed&#x27;, delayMs: 100 }// Delays: 100ms, 100ms, 100ms// Linear: delay increases linearly{ attempts: 3, backoff: &#x27;linear&#x27;, delayMs: 100 }// Delays: 100ms, 200ms, 300ms// Exponential: delay doubles each time{ attempts: 3, backoff: &#x27;exponential&#x27;, delayMs: 100 }// Delays: 100ms, 200ms, 400ms\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"cap-the-delay\">Cap the delay\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#cap-the-delay\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Cap the delay”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">attempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">10\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">backoff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">exponential\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">delayMs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">100\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">maxDelayMs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Never wait more than 5 seconds\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"{  attempts: 10,  backoff: &#x27;exponential&#x27;,  delayMs: 100,  maxDelayMs: 5000, // Never wait more than 5 seconds}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"add-jitter\">Add jitter\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#add-jitter\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Add jitter”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Randomize delays to avoid thundering herd:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">attempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">backoff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">exponential\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">delayMs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">100\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">jitter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Add random variation\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"{  attempts: 3,  backoff: &#x27;exponential&#x27;,  delayMs: 100,  jitter: true, // Add random variation}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"conditional-retry\">Conditional retry\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#conditional-retry\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Conditional retry”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Only retry certain errors:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">attempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">backoff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">exponential\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retryOn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Don't retry NOT_FOUND - the user doesn't exist\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">===\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">false\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Retry everything else\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const user = await step.retry(  () => fetchUser(&#x27;1&#x27;),  {    attempts: 3,    backoff: &#x27;exponential&#x27;,    retryOn: (error) => {      // Don&#x27;t retry NOT_FOUND - the user doesn&#x27;t exist      if (error === &#x27;NOT_FOUND&#x27;) return false;      // Retry everything else      return true;    },  });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"combining-retry-and-timeout\">Combining retry and timeout\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#combining-retry-and-timeout\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Combining retry and timeout”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Each attempt has its own timeout:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withTimeout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchData\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">ms\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">2000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">attempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">backoff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">exponential\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const data = await step.retry(  () => step.withTimeout(() => fetchData(), { ms: 2000 }),  { attempts: 3, backoff: &#x27;exponential&#x27; });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>This retries up to 3 times, with each attempt limited to 2 seconds.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"via-step-options\">Via step options\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#via-step-options\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Via step options”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>You can also configure retry and timeout directly in step options:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">retry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">attempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">backoff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">exponential\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">delayMs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">100\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">timeout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">ms\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const user = await step(() => fetchUser(&#x27;1&#x27;), {  retry: {    attempts: 3,    backoff: &#x27;exponential&#x27;,    delayMs: 100,  },  timeout: {    ms: 5000,  },});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"full-example\">Full example\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#full-example\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Full example”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchUserFromApi\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cacheUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Retry API calls with exponential backoff\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withTimeout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUserFromApi\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">ms\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Fetch user\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">attempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">backoff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">exponential\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">delayMs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">200\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxDelayMs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">2000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retryOn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!==\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Cache doesn't need retry\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">cacheUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const workflow = createWorkflow({ fetchUserFromApi, cacheUser });const result = await workflow(async (step) => {  // Retry API calls with exponential backoff  const user = await step.retry(    () => step.withTimeout(      () => fetchUserFromApi(&#x27;123&#x27;),      { ms: 3000, name: &#x27;Fetch user&#x27; }    ),    {      attempts: 3,      backoff: &#x27;exponential&#x27;,      delayMs: 200,      maxDelayMs: 2000,      retryOn: (error) => error !== &#x27;NOT_FOUND&#x27;,    }  );  // Cache doesn&#x27;t need retry  await step(() => cacheUser(user));  return user;});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/guides/caching/\">Learn about Caching →\u003C/a>\u003C/p>",{"headings":832,"localImagePaths":863,"remoteImagePaths":864,"frontmatter":865,"imagePaths":866},[833,836,839,842,845,848,851,854,857,858,861,862],{"depth":57,"slug":834,"text":835},"timeouts","Timeouts",{"depth":212,"slug":837,"text":838},"with-name-for-debugging","With name for debugging",{"depth":212,"slug":840,"text":841},"checking-for-timeout-errors","Checking for timeout errors",{"depth":57,"slug":843,"text":844},"retries","Retries",{"depth":212,"slug":846,"text":847},"backoff-strategies","Backoff strategies",{"depth":212,"slug":849,"text":850},"cap-the-delay","Cap the delay",{"depth":212,"slug":852,"text":853},"add-jitter","Add jitter",{"depth":212,"slug":855,"text":856},"conditional-retry","Conditional retry",{"depth":57,"slug":458,"text":459},{"depth":57,"slug":859,"text":860},"via-step-options","Via step options",{"depth":57,"slug":708,"text":709},{"depth":57,"slug":417,"text":418},[],[],{"title":821,"description":822},[],"guides/versioning",{"id":867,"data":869,"body":875,"filePath":876,"digest":877,"rendered":878},{"title":870,"description":871,"editUrl":16,"head":872,"template":46,"sidebar":873,"pagefind":16,"draft":35},"Workflow Versioning","Migrate persisted workflow state across versions",[],{"hidden":35,"attrs":874},{},"Handle schema changes when resuming workflows that were persisted with older step shapes.\n\n## The problem\n\nWhen you persist workflow state (for resume/replay), changing your workflow code can break compatibility with saved state:\n\n```typescript\n// Version 1: Step key was 'user:fetch'\nconst workflowV1 = createWorkflow({ fetchUser }, {\n  resumeState: savedState // Contains 'user:fetch'\n});\n\n// Version 2: You renamed the step key to 'user:load'\nconst workflowV2 = createWorkflow({ fetchUser }, {\n  resumeState: savedState // ❌ Key mismatch!\n});\n```\n\n## Solution: Versioned workflows\n\nUse versioning to migrate old state to new formats:\n\n```typescript\nimport {\n  createVersionedStateLoader,\n  createVersionedState,\n  createKeyRenameMigration,\n  type VersionedState\n} from 'awaitly/persistence';\n\n// Define migrations\nconst migrations = {\n  1: createKeyRenameMigration({\n    'user:fetch': 'user:load',\n    'order:create': 'order:submit',\n  }),\n  2: createKeyRemoveMigration(['deprecated:step']),\n};\n\n// Create versioned loader\nconst loadVersionedState = createVersionedStateLoader({\n  version: 2, // Current version\n  migrations,\n});\n\n// Load and migrate state\nconst savedState = await db.loadWorkflowState(workflowId);\nconst versionedState = parseVersionedState(savedState);\nconst migratedState = await loadVersionedState(versionedState);\n\nif (migratedState.ok) {\n  const workflow = createWorkflow(deps, {\n    resumeState: migratedState.value,\n  });\n  // ...\n}\n```\n\n## Saving versioned state\n\nAlways save state with version information:\n\n```typescript\nimport { createResumeStateCollector } from 'awaitly/workflow';\nimport { createVersionedState, stringifyVersionedState } from 'awaitly/persistence';\n\nconst collector = createResumeStateCollector();\nconst workflow = createWorkflow(deps, {\n  onEvent: collector.handleEvent,\n});\n\nawait workflow(async (step) => {\n  // ...\n});\n\n// Save with version\nconst state = collector.getResumeState();\nconst versionedState = createVersionedState(state, 2); // Current version\nconst json = stringifyVersionedState(versionedState);\nawait db.saveWorkflowState(workflowId, json);\n```\n\n## Migration helpers\n\n### Rename step keys\n\n```typescript\nimport { createKeyRenameMigration } from 'awaitly/persistence';\n\nconst migrations = {\n  1: createKeyRenameMigration({\n    'old:key': 'new:key',\n    'user:fetch': 'user:load',\n  }),\n};\n```\n\n### Remove step keys\n\n```typescript\nimport { createKeyRemoveMigration } from 'awaitly/persistence';\n\nconst migrations = {\n  1: createKeyRemoveMigration([\n    'deprecated:step',\n    'old:cache',\n  ]),\n};\n```\n\n### Transform step values\n\n```typescript\nimport { createValueTransformMigration } from 'awaitly/persistence';\nimport { ok } from 'awaitly';\n\nconst migrations = {\n  1: createValueTransformMigration({\n    'user:fetch': (entry) => ({\n      ...entry,\n      result: entry.result.ok\n        ? ok({\n            ...entry.result.value,\n            newField: 'default', // Add new required field\n          })\n        : entry.result,\n    }),\n  }),\n};\n```\n\n### Compose multiple migrations\n\n```typescript\nimport { composeMigrations } from 'awaitly/persistence';\n\nconst migrations = {\n  1: composeMigrations([\n    createKeyRenameMigration({ 'old': 'new' }),\n    createKeyRemoveMigration(['deprecated']),\n    createValueTransformMigration({\n      'user:fetch': (entry) => ({ ...entry, /* transform */ }),\n    }),\n  ]),\n};\n```\n\n## Complete example\n\n```typescript\nimport { ok } from 'awaitly';\nimport { createWorkflow, createResumeStateCollector } from 'awaitly/workflow';\nimport {\n  createVersionedStateLoader,\n  createVersionedState,\n  parseVersionedState,\n  stringifyVersionedState,\n  createKeyRenameMigration,\n  createValueTransformMigration,\n} from 'awaitly/persistence';\n\n// Current workflow version\nconst CURRENT_VERSION = 2;\n\n// Define migrations\nconst migrations = {\n  // Migration from v1 to v2\n  1: createKeyRenameMigration({\n    'user:fetch': 'user:load',\n    'order:create': 'order:submit',\n  }),\n  // Migration from v2 to v3 (future)\n  2: createValueTransformMigration({\n    'user:load': (entry) => ({\n      ...entry,\n      result: entry.result.ok\n        ? ok({\n            ...entry.result.value,\n            emailVerified: false, // New required field\n          })\n        : entry.result,\n    }),\n  }),\n};\n\n// Create versioned loader\nconst loadVersionedState = createVersionedStateLoader({\n  version: CURRENT_VERSION,\n  migrations,\n  strictVersioning: true, // Fail if state is from future version\n});\n\n// Load workflow state\nasync function loadWorkflowState(workflowId: string) {\n  const saved = await db.loadWorkflowState(workflowId);\n  if (!saved) return undefined;\n\n  const versionedState = parseVersionedState(saved);\n  if (!versionedState) {\n    throw new Error('Invalid state format');\n  }\n\n  const migrated = await loadVersionedState(versionedState);\n  if (!migrated.ok) {\n    throw new Error(`Migration failed: ${migrated.error.type}`);\n  }\n\n  return migrated.value;\n}\n\n// Save workflow state\nasync function saveWorkflowState(workflowId: string, state: ResumeState) {\n  const versionedState = createVersionedState(state, CURRENT_VERSION);\n  const json = stringifyVersionedState(versionedState);\n  await db.saveWorkflowState(workflowId, json);\n}\n\n// Use in workflow\nconst workflow = createWorkflow(deps, {\n  resumeState: await loadWorkflowState(workflowId),\n  onEvent: (event) => {\n    // Collect state for saving\n    collector.handleEvent(event);\n  },\n});\n\nconst collector = createResumeStateCollector();\nconst result = await workflow(async (step) => {\n  // ...\n});\n\n// Save state after execution\nawait saveWorkflowState(workflowId, collector.getResumeState());\n```\n\n## Error handling\n\n### Migration errors\n\n```typescript\nimport { isMigrationError } from 'awaitly/persistence';\n\nconst migrated = await loadVersionedState(versionedState);\n\nif (!migrated.ok) {\n  if (isMigrationError(migrated.error)) {\n    console.error(`Migration from ${migrated.error.fromVersion} to ${migrated.error.toVersion} failed:`, migrated.error.cause);\n  }\n}\n```\n\n### Version incompatibility\n\n```typescript\nimport { isVersionIncompatibleError } from 'awaitly/persistence';\n\nif (!migrated.ok && isVersionIncompatibleError(migrated.error)) {\n  console.error(\n    `State version ${migrated.error.stateVersion} is incompatible with current version ${migrated.error.currentVersion}: ${migrated.error.reason}`\n  );\n}\n```\n\n## Strict versioning\n\nBy default, versioning is strict - it fails if state is from a future version:\n\n```typescript\nconst loader = createVersionedStateLoader({\n  version: 2,\n  migrations: { 1: migrateV1ToV2 },\n  strictVersioning: true, // Default: true\n});\n\n// If state is version 3 and current is 2, this fails\nconst migrated = await loader({ version: 3, state: ... });\n// Error: \"State version is higher than current workflow version\"\n```\n\nSet `strictVersioning: false` to allow future versions (not recommended):\n\n```typescript\nconst loader = createVersionedStateLoader({\n  version: 2,\n  migrations: { 1: migrateV1ToV2 },\n  strictVersioning: false, // Allow future versions\n});\n```\n\n## Best practices\n\n1. **Always version your state**: Save state with version information\n2. **Test migrations**: Write tests for each migration path\n3. **Incremental migrations**: Migrate one version at a time\n4. **Backward compatibility**: Keep old step keys in migrations for a few versions\n5. **Document changes**: Keep a changelog of state schema changes\n\n## Next\n\n[Learn about Persistence →](/guides/persistence/)","src/content/docs/guides/versioning.md","6630e7682d9ea11d",{"html":879,"metadata":880},"\u003Cp>Handle schema changes when resuming workflows that were persisted with older step shapes.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"the-problem\">The problem\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#the-problem\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “The problem”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>When you persist workflow state (for resume/replay), changing your workflow code can break compatibility with saved state:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Version 1: Step key was 'user:fetch'\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflowV1\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">resumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">savedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Contains 'user:fetch'\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Version 2: You renamed the step key to 'user:load'\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflowV2\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">resumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">savedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// ❌ Key mismatch!\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// Version 1: Step key was &#x27;user:fetch&#x27;const workflowV1 = createWorkflow({ fetchUser }, {  resumeState: savedState // Contains &#x27;user:fetch&#x27;});// Version 2: You renamed the step key to &#x27;user:load&#x27;const workflowV2 = createWorkflow({ fetchUser }, {  resumeState: savedState // ❌ Key mismatch!});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"solution-versioned-workflows\">Solution: Versioned workflows\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#solution-versioned-workflows\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Solution: Versioned workflows”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use versioning to migrate old state to new formats:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createVersionedStateLoader\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createVersionedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createKeyRenameMigration\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">VersionedState\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/persistence\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Define migrations\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migrations\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createKeyRenameMigration\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:fetch\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:load\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">order:create\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">order:submit\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createKeyRemoveMigration\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">deprecated:step\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create versioned loader\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">loadVersionedState\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createVersionedStateLoader\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">version\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Current version\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migrations\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Load and migrate state\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">savedState\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">loadWorkflowState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflowId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">versionedState\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">parseVersionedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">savedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migratedState\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">loadVersionedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">versionedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migratedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">resumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migratedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// ...\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import {  createVersionedStateLoader,  createVersionedState,  createKeyRenameMigration,  type VersionedState} from &#x27;awaitly/persistence&#x27;;// Define migrationsconst migrations = {  1: createKeyRenameMigration({    &#x27;user:fetch&#x27;: &#x27;user:load&#x27;,    &#x27;order:create&#x27;: &#x27;order:submit&#x27;,  }),  2: createKeyRemoveMigration([&#x27;deprecated:step&#x27;]),};// Create versioned loaderconst loadVersionedState = createVersionedStateLoader({  version: 2, // Current version  migrations,});// Load and migrate stateconst savedState = await db.loadWorkflowState(workflowId);const versionedState = parseVersionedState(savedState);const migratedState = await loadVersionedState(versionedState);if (migratedState.ok) {  const workflow = createWorkflow(deps, {    resumeState: migratedState.value,  });  // ...}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"saving-versioned-state\">Saving versioned state\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#saving-versioned-state\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Saving versioned state”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Always save state with version information:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createResumeStateCollector\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createVersionedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stringifyVersionedState\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/persistence\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createResumeStateCollector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// ...\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Save with version\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getResumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">versionedState\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createVersionedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Current version\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">json\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">stringifyVersionedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">versionedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">saveWorkflowState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflowId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createResumeStateCollector } from &#x27;awaitly/workflow&#x27;;import { createVersionedState, stringifyVersionedState } from &#x27;awaitly/persistence&#x27;;const collector = createResumeStateCollector();const workflow = createWorkflow(deps, {  onEvent: collector.handleEvent,});await workflow(async (step) => {  // ...});// Save with versionconst state = collector.getResumeState();const versionedState = createVersionedState(state, 2); // Current versionconst json = stringifyVersionedState(versionedState);await db.saveWorkflowState(workflowId, json);\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"migration-helpers\">Migration helpers\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#migration-helpers\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Migration helpers”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"rename-step-keys\">Rename step keys\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#rename-step-keys\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Rename step keys”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createKeyRenameMigration\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/persistence\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migrations\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createKeyRenameMigration\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">old:key\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">new:key\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:fetch\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:load\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createKeyRenameMigration } from &#x27;awaitly/persistence&#x27;;const migrations = {  1: createKeyRenameMigration({    &#x27;old:key&#x27;: &#x27;new:key&#x27;,    &#x27;user:fetch&#x27;: &#x27;user:load&#x27;,  }),};\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"remove-step-keys\">Remove step keys\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#remove-step-keys\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Remove step keys”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createKeyRemoveMigration\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/persistence\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migrations\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createKeyRemoveMigration\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">deprecated:step\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">old:cache\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createKeyRemoveMigration } from &#x27;awaitly/persistence&#x27;;const migrations = {  1: createKeyRemoveMigration([    &#x27;deprecated:step&#x27;,    &#x27;old:cache&#x27;,  ]),};\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"transform-step-values\">Transform step values\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#transform-step-values\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Transform step values”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createValueTransformMigration\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/persistence\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migrations\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createValueTransformMigration\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:fetch\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">entry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => ({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">entry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">entry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">entry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">newField\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">default\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Add new required field\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">          \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">})\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">:\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">entry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createValueTransformMigration } from &#x27;awaitly/persistence&#x27;;import { ok } from &#x27;awaitly&#x27;;const migrations = {  1: createValueTransformMigration({    &#x27;user:fetch&#x27;: (entry) => ({      ...entry,      result: entry.result.ok        ? ok({            ...entry.result.value,            newField: &#x27;default&#x27;, // Add new required field          })        : entry.result,    }),  }),};\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"compose-multiple-migrations\">Compose multiple migrations\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#compose-multiple-migrations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Compose multiple migrations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">composeMigrations\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/persistence\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migrations\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">composeMigrations\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createKeyRenameMigration\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">old\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">new\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createKeyRemoveMigration\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">deprecated\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createValueTransformMigration\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:fetch\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">entry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => ({ ...\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">entry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">/* transform */\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { composeMigrations } from &#x27;awaitly/persistence&#x27;;const migrations = {  1: composeMigrations([    createKeyRenameMigration({ &#x27;old&#x27;: &#x27;new&#x27; }),    createKeyRemoveMigration([&#x27;deprecated&#x27;]),    createValueTransformMigration({      &#x27;user:fetch&#x27;: (entry) => ({ ...entry, /* transform */ }),    }),  ]),};\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"complete-example\">Complete example\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#complete-example\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Complete example”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createResumeStateCollector\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createVersionedStateLoader\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createVersionedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">parseVersionedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stringifyVersionedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createKeyRenameMigration\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createValueTransformMigration\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/persistence\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Current workflow version\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">CURRENT_VERSION\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Define migrations\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migrations\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Migration from v1 to v2\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createKeyRenameMigration\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:fetch\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:load\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">order:create\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">order:submit\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Migration from v2 to v3 (future)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createValueTransformMigration\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:load\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">entry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => ({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">entry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">entry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">            \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">entry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">emailVerified\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">false\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// New required field\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">          \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">})\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">:\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">entry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create versioned loader\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">loadVersionedState\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createVersionedStateLoader\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">version\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">CURRENT_VERSION\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migrations\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">strictVersioning\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Fail if state is from future version\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Load workflow state\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">function\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">loadWorkflowState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflowId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saved\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">loadWorkflowState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflowId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saved\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">undefined\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">versionedState\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">parseVersionedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saved\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">versionedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">throw\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">new\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">Error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Invalid state format\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migrated\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">loadVersionedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">versionedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migrated\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">throw\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">new\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">Error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Migration failed: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">migrated\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">type\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migrated\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Save workflow state\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">function\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">saveWorkflowState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflowId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">ResumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">versionedState\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createVersionedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">CURRENT_VERSION\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">json\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">stringifyVersionedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">versionedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">saveWorkflowState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflowId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Use in workflow\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">resumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">loadWorkflowState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflowId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Collect state for saving\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createResumeStateCollector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// ...\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Save state after execution\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">saveWorkflowState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflowId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getResumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { ok } from &#x27;awaitly&#x27;;import { createWorkflow, createResumeStateCollector } from &#x27;awaitly/workflow&#x27;;import {  createVersionedStateLoader,  createVersionedState,  parseVersionedState,  stringifyVersionedState,  createKeyRenameMigration,  createValueTransformMigration,} from &#x27;awaitly/persistence&#x27;;// Current workflow versionconst CURRENT_VERSION = 2;// Define migrationsconst migrations = {  // Migration from v1 to v2  1: createKeyRenameMigration({    &#x27;user:fetch&#x27;: &#x27;user:load&#x27;,    &#x27;order:create&#x27;: &#x27;order:submit&#x27;,  }),  // Migration from v2 to v3 (future)  2: createValueTransformMigration({    &#x27;user:load&#x27;: (entry) => ({      ...entry,      result: entry.result.ok        ? ok({            ...entry.result.value,            emailVerified: false, // New required field          })        : entry.result,    }),  }),};// Create versioned loaderconst loadVersionedState = createVersionedStateLoader({  version: CURRENT_VERSION,  migrations,  strictVersioning: true, // Fail if state is from future version});// Load workflow stateasync function loadWorkflowState(workflowId: string) {  const saved = await db.loadWorkflowState(workflowId);  if (!saved) return undefined;  const versionedState = parseVersionedState(saved);  if (!versionedState) {    throw new Error(&#x27;Invalid state format&#x27;);  }  const migrated = await loadVersionedState(versionedState);  if (!migrated.ok) {    throw new Error(&#x60;Migration failed: ${migrated.error.type}&#x60;);  }  return migrated.value;}// Save workflow stateasync function saveWorkflowState(workflowId: string, state: ResumeState) {  const versionedState = createVersionedState(state, CURRENT_VERSION);  const json = stringifyVersionedState(versionedState);  await db.saveWorkflowState(workflowId, json);}// Use in workflowconst workflow = createWorkflow(deps, {  resumeState: await loadWorkflowState(workflowId),  onEvent: (event) => {    // Collect state for saving    collector.handleEvent(event);  },});const collector = createResumeStateCollector();const result = await workflow(async (step) => {  // ...});// Save state after executionawait saveWorkflowState(workflowId, collector.getResumeState());\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"error-handling\">Error handling\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#error-handling\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Error handling”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"migration-errors\">Migration errors\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#migration-errors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Migration errors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isMigrationError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/persistence\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migrated\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">loadVersionedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">versionedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migrated\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isMigrationError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migrated\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Migration from \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">migrated\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">fromVersion\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> to \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">migrated\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">toVersion\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> failed:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migrated\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cause\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { isMigrationError } from &#x27;awaitly/persistence&#x27;;const migrated = await loadVersionedState(versionedState);if (!migrated.ok) {  if (isMigrationError(migrated.error)) {    console.error(&#x60;Migration from ${migrated.error.fromVersion} to ${migrated.error.toVersion} failed:&#x60;, migrated.error.cause);  }}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"version-incompatibility\">Version incompatibility\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#version-incompatibility\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Version incompatibility”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isVersionIncompatibleError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/persistence\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migrated\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">&#x26;&#x26;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isVersionIncompatibleError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migrated\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">State version \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">migrated\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">stateVersion\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> is incompatible with current version \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">migrated\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">currentVersion\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">migrated\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">reason\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { isVersionIncompatibleError } from &#x27;awaitly/persistence&#x27;;if (!migrated.ok &#x26;&#x26; isVersionIncompatibleError(migrated.error)) {  console.error(    &#x60;State version ${migrated.error.stateVersion} is incompatible with current version ${migrated.error.currentVersion}: ${migrated.error.reason}&#x60;  );}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"strict-versioning\">Strict versioning\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#strict-versioning\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Strict versioning”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>By default, versioning is strict - it fails if state is from a future version:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">loader\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createVersionedStateLoader\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">version\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">migrations\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migrateV1ToV2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">strictVersioning\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Default: true\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// If state is version 3 and current is 2, this fails\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migrated\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">loader\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">version\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: ... });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Error: \"State version is higher than current workflow version\"\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const loader = createVersionedStateLoader({  version: 2,  migrations: { 1: migrateV1ToV2 },  strictVersioning: true, // Default: true});// If state is version 3 and current is 2, this failsconst migrated = await loader({ version: 3, state: ... });// Error: &#x22;State version is higher than current workflow version&#x22;\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>Set \u003Ccode dir=\"auto\">strictVersioning: false\u003C/code> to allow future versions (not recommended):\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">loader\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createVersionedStateLoader\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">version\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">migrations\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migrateV1ToV2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">strictVersioning\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">false\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Allow future versions\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const loader = createVersionedStateLoader({  version: 2,  migrations: { 1: migrateV1ToV2 },  strictVersioning: false, // Allow future versions});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"best-practices\">Best practices\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#best-practices\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Best practices”\u003C/span>\u003C/a>\u003C/div>\n\u003Col>\n\u003Cli>\u003Cstrong>Always version your state\u003C/strong>: Save state with version information\u003C/li>\n\u003Cli>\u003Cstrong>Test migrations\u003C/strong>: Write tests for each migration path\u003C/li>\n\u003Cli>\u003Cstrong>Incremental migrations\u003C/strong>: Migrate one version at a time\u003C/li>\n\u003Cli>\u003Cstrong>Backward compatibility\u003C/strong>: Keep old step keys in migrations for a few versions\u003C/li>\n\u003Cli>\u003Cstrong>Document changes\u003C/strong>: Keep a changelog of state schema changes\u003C/li>\n\u003C/ol>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/guides/persistence/\">Learn about Persistence →\u003C/a>\u003C/p>",{"headings":881,"localImagePaths":921,"remoteImagePaths":922,"frontmatter":923,"imagePaths":924},[882,885,888,891,894,897,900,903,906,909,910,913,916,919,920],{"depth":57,"slug":883,"text":884},"the-problem","The problem",{"depth":57,"slug":886,"text":887},"solution-versioned-workflows","Solution: Versioned workflows",{"depth":57,"slug":889,"text":890},"saving-versioned-state","Saving versioned state",{"depth":57,"slug":892,"text":893},"migration-helpers","Migration helpers",{"depth":212,"slug":895,"text":896},"rename-step-keys","Rename step keys",{"depth":212,"slug":898,"text":899},"remove-step-keys","Remove step keys",{"depth":212,"slug":901,"text":902},"transform-step-values","Transform step values",{"depth":212,"slug":904,"text":905},"compose-multiple-migrations","Compose multiple migrations",{"depth":57,"slug":907,"text":908},"complete-example","Complete example",{"depth":57,"slug":757,"text":758},{"depth":212,"slug":911,"text":912},"migration-errors","Migration errors",{"depth":212,"slug":914,"text":915},"version-incompatibility","Version incompatibility",{"depth":57,"slug":917,"text":918},"strict-versioning","Strict versioning",{"depth":57,"slug":79,"text":80},{"depth":57,"slug":417,"text":418},[],[],{"title":870,"description":871},[],"guides/testing",{"id":925,"data":927,"body":933,"filePath":934,"digest":935,"rendered":936},{"title":928,"description":929,"editUrl":16,"head":930,"template":46,"sidebar":931,"pagefind":16,"draft":35},"Testing","Test workflows deterministically",[],{"hidden":35,"attrs":932},{},"Use the test harness to control step execution and verify workflow behavior.\n\n## Basic testing\n\n```typescript\nimport { createWorkflowHarness, okOutcome, errOutcome } from 'awaitly/workflow';\nimport { describe, it, expect } from 'vitest';\n\ndescribe('checkout workflow', () => {\n  it('completes when payment succeeds', async () => {\n    const harness = createWorkflowHarness({\n      fetchOrder: okOutcome({ id: '123', total: 100 }),\n      chargeCard: okOutcome({ txId: 'tx-123' }),\n    });\n\n    const result = await harness.run(async (step) => {\n      const order = await step(fetchOrder('123'));\n      const payment = await step(chargeCard(order.total));\n      return { order, payment };\n    });\n\n    expect(result.ok).toBe(true);\n    expect(result.value.payment.txId).toBe('tx-123');\n  });\n\n  it('fails when payment is declined', async () => {\n    const harness = createWorkflowHarness({\n      fetchOrder: okOutcome({ id: '123', total: 100 }),\n      chargeCard: errOutcome('DECLINED'),\n    });\n\n    const result = await harness.run(async (step) => {\n      const order = await step(fetchOrder('123'));\n      const payment = await step(chargeCard(order.total));\n      return { order, payment };\n    });\n\n    expect(result.ok).toBe(false);\n    expect(result.error).toBe('DECLINED');\n  });\n});\n```\n\n## Scripted outcomes\n\nControl what each step returns:\n\n```typescript\nconst harness = createWorkflowHarness({\n  // Always succeeds\n  fetchUser: okOutcome({ id: '1', name: 'Alice' }),\n\n  // Always fails\n  sendEmail: errOutcome('EMAIL_FAILED'),\n\n  // Throws exception\n  badOperation: throwOutcome(new Error('Boom')),\n});\n```\n\n## Dynamic outcomes\n\nReturn different results based on input:\n\n```typescript\nconst harness = createWorkflowHarness({\n  fetchUser: (id: string) =>\n    id === '1'\n      ? okOutcome({ id, name: 'Alice' })\n      : errOutcome('NOT_FOUND'),\n});\n```\n\n## Mock functions\n\nTrack calls and change behavior:\n\n```typescript\nimport { createMockFn } from 'awaitly/workflow';\n\nconst mockFetchUser = createMockFn\u003Ctypeof fetchUser>();\n\n// Set return value\nmockFetchUser.returns(okOutcome({ id: '1', name: 'Alice' }));\n\nconst harness = createWorkflowHarness({\n  fetchUser: mockFetchUser,\n});\n\nawait harness.run(async (step) => {\n  await step(fetchUser('1'));\n  await step(fetchUser('2'));\n});\n\n// Check calls\nexpect(mockFetchUser.calls.length).toBe(2);\nexpect(mockFetchUser.calls[0].args).toEqual(['1']);\nexpect(mockFetchUser.calls[1].args).toEqual(['2']);\n```\n\n## Testing retries\n\n```typescript\nconst mockFetch = createMockFn\u003Ctypeof fetchData>();\n\n// Fail twice, then succeed\nmockFetch\n  .onCall(0).returns(errOutcome('NETWORK_ERROR'))\n  .onCall(1).returns(errOutcome('NETWORK_ERROR'))\n  .onCall(2).returns(okOutcome({ data: 'success' }));\n\nconst harness = createWorkflowHarness({ fetchData: mockFetch });\n\nconst result = await harness.run(async (step) => {\n  return await step.retry(() => fetchData(), { attempts: 3 });\n});\n\nexpect(result.ok).toBe(true);\nexpect(mockFetch.calls.length).toBe(3);\n```\n\n## Snapshot testing\n\nCompare workflow behavior across changes:\n\n```typescript\nimport { createSnapshot, compareSnapshots } from 'awaitly/workflow';\n\nconst harness = createWorkflowHarness(mocks);\n\nconst result = await harness.run(executor);\nconst snapshot = createSnapshot(harness.getInvocations());\n\n// Save to file or compare\nexpect(snapshot).toMatchSnapshot();\n```\n\n## Testing time-dependent workflows\n\nControl time in tests:\n\n```typescript\nimport { createTestClock } from 'awaitly/workflow';\n\nconst clock = createTestClock();\n\nconst harness = createWorkflowHarness(mocks, { clock });\n\nawait harness.run(async (step) => {\n  const data = await step.withTimeout(() => fetchData(), { ms: 1000 });\n  return data;\n});\n\n// Advance time\nclock.tick(500);  // 500ms passed\nclock.tick(600);  // Now 1100ms, timeout triggers\n```\n\n## Assertions on step invocations\n\n```typescript\nconst result = await harness.run(executor);\n\nconst invocations = harness.getInvocations();\n\n// Check order\nexpect(invocations[0].name).toBe('fetchOrder');\nexpect(invocations[1].name).toBe('chargeCard');\n\n// Check that chargeCard was called after fetchOrder\nexpect(invocations[1].startedAt).toBeGreaterThan(invocations[0].completedAt);\n```\n\n## Full example\n\n```typescript\nimport { describe, it, expect, beforeEach } from 'vitest';\nimport {\n  createWorkflowHarness,\n  createMockFn,\n  okOutcome,\n  errOutcome,\n} from 'awaitly/workflow';\n\ndescribe('refund workflow', () => {\n  let mockCalculateRefund: ReturnType\u003Ctypeof createMockFn>;\n  let mockProcessRefund: ReturnType\u003Ctypeof createMockFn>;\n  let harness: ReturnType\u003Ctypeof createWorkflowHarness>;\n\n  beforeEach(() => {\n    mockCalculateRefund = createMockFn();\n    mockProcessRefund = createMockFn();\n\n    mockCalculateRefund.returns(okOutcome({ amount: 50 }));\n    mockProcessRefund.returns(okOutcome({ refundId: 'ref-123' }));\n\n    harness = createWorkflowHarness({\n      calculateRefund: mockCalculateRefund,\n      processRefund: mockProcessRefund,\n    });\n  });\n\n  it('calculates and processes refund', async () => {\n    const result = await harness.run(async (step) => {\n      const refund = await step(calculateRefund('order-1'));\n      return await step(processRefund(refund));\n    });\n\n    expect(result.ok).toBe(true);\n    expect(result.value.refundId).toBe('ref-123');\n    expect(mockCalculateRefund.calls.length).toBe(1);\n    expect(mockProcessRefund.calls.length).toBe(1);\n  });\n\n  it('stops if calculation fails', async () => {\n    mockCalculateRefund.returns(errOutcome('ORDER_NOT_FOUND'));\n\n    const result = await harness.run(async (step) => {\n      const refund = await step(calculateRefund('order-1'));\n      return await step(processRefund(refund));\n    });\n\n    expect(result.ok).toBe(false);\n    expect(result.error).toBe('ORDER_NOT_FOUND');\n    expect(mockProcessRefund.calls.length).toBe(0); // Never called\n  });\n});\n```\n\n## Next\n\n[Learn about Batch Processing →](/guides/batch-processing/)","src/content/docs/guides/testing.md","0cb9f58ce6b7a513",{"html":937,"metadata":938},"\u003Cp>Use the test harness to control step execution and verify workflow behavior.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"basic-testing\">Basic testing\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#basic-testing\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Basic testing”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflowHarness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">okOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">errOutcome\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">describe\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">it\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">expect\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">vitest\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">describe\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">checkout workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">it\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">completes when payment succeeds\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflowHarness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">fetchOrder\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">okOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">total\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">100\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">okOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">txId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">tx-123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">run\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchOrder\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">total\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">expect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">toBe\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">expect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">txId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">toBe\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">tx-123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">it\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">fails when payment is declined\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflowHarness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">fetchOrder\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">okOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">total\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">100\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">errOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">DECLINED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">run\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchOrder\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">total\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">expect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">toBe\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">false\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">expect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">toBe\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">DECLINED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createWorkflowHarness, okOutcome, errOutcome } from &#x27;awaitly/workflow&#x27;;import { describe, it, expect } from &#x27;vitest&#x27;;describe(&#x27;checkout workflow&#x27;, () => {  it(&#x27;completes when payment succeeds&#x27;, async () => {    const harness = createWorkflowHarness({      fetchOrder: okOutcome({ id: &#x27;123&#x27;, total: 100 }),      chargeCard: okOutcome({ txId: &#x27;tx-123&#x27; }),    });    const result = await harness.run(async (step) => {      const order = await step(fetchOrder(&#x27;123&#x27;));      const payment = await step(chargeCard(order.total));      return { order, payment };    });    expect(result.ok).toBe(true);    expect(result.value.payment.txId).toBe(&#x27;tx-123&#x27;);  });  it(&#x27;fails when payment is declined&#x27;, async () => {    const harness = createWorkflowHarness({      fetchOrder: okOutcome({ id: &#x27;123&#x27;, total: 100 }),      chargeCard: errOutcome(&#x27;DECLINED&#x27;),    });    const result = await harness.run(async (step) => {      const order = await step(fetchOrder(&#x27;123&#x27;));      const payment = await step(chargeCard(order.total));      return { order, payment };    });    expect(result.ok).toBe(false);    expect(result.error).toBe(&#x27;DECLINED&#x27;);  });});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"scripted-outcomes\">Scripted outcomes\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#scripted-outcomes\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Scripted outcomes”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Control what each step returns:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflowHarness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Always succeeds\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">okOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Alice\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Always fails\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">sendEmail\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">errOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">EMAIL_FAILED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Throws exception\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">badOperation\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">throwOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">new\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">Error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Boom\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const harness = createWorkflowHarness({  // Always succeeds  fetchUser: okOutcome({ id: &#x27;1&#x27;, name: &#x27;Alice&#x27; }),  // Always fails  sendEmail: errOutcome(&#x27;EMAIL_FAILED&#x27;),  // Throws exception  badOperation: throwOutcome(new Error(&#x27;Boom&#x27;)),});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"dynamic-outcomes\">Dynamic outcomes\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#dynamic-outcomes\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Dynamic outcomes”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Return different results based on input:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflowHarness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) =>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">===\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">okOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Alice\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">:\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">errOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const harness = createWorkflowHarness({  fetchUser: (id: string) =>    id === &#x27;1&#x27;      ? okOutcome({ id, name: &#x27;Alice&#x27; })      : errOutcome(&#x27;NOT_FOUND&#x27;),});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"mock-functions\">Mock functions\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#mock-functions\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Mock functions”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Track calls and change behavior:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createMockFn\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mockFetchUser\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createMockFn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">typeof \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Set return value\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">mockFetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">returns\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">okOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Alice\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflowHarness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mockFetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">run\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">2\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Check calls\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">expect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mockFetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">calls\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">length\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">toBe\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">expect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mockFetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">calls\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">].\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">args\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">toEqual\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">expect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mockFetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">calls\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">].\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">args\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">toEqual\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">2\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createMockFn } from &#x27;awaitly/workflow&#x27;;const mockFetchUser = createMockFn\u003Ctypeof fetchUser>();// Set return valuemockFetchUser.returns(okOutcome({ id: &#x27;1&#x27;, name: &#x27;Alice&#x27; }));const harness = createWorkflowHarness({  fetchUser: mockFetchUser,});await harness.run(async (step) => {  await step(fetchUser(&#x27;1&#x27;));  await step(fetchUser(&#x27;2&#x27;));});// Check callsexpect(mockFetchUser.calls.length).toBe(2);expect(mockFetchUser.calls[0].args).toEqual([&#x27;1&#x27;]);expect(mockFetchUser.calls[1].args).toEqual([&#x27;2&#x27;]);\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"testing-retries\">Testing retries\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#testing-retries\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Testing retries”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mockFetch\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createMockFn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">typeof \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchData\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Fail twice, then succeed\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">mockFetch\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onCall\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">returns\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">errOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NETWORK_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onCall\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">returns\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">errOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NETWORK_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onCall\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">returns\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">okOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">success\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflowHarness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">fetchData\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mockFetch\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">run\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchData\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">attempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">expect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">toBe\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">expect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mockFetch\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">calls\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">length\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">toBe\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const mockFetch = createMockFn\u003Ctypeof fetchData>();// Fail twice, then succeedmockFetch  .onCall(0).returns(errOutcome(&#x27;NETWORK_ERROR&#x27;))  .onCall(1).returns(errOutcome(&#x27;NETWORK_ERROR&#x27;))  .onCall(2).returns(okOutcome({ data: &#x27;success&#x27; }));const harness = createWorkflowHarness({ fetchData: mockFetch });const result = await harness.run(async (step) => {  return await step.retry(() => fetchData(), { attempts: 3 });});expect(result.ok).toBe(true);expect(mockFetch.calls.length).toBe(3);\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"snapshot-testing\">Snapshot testing\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#snapshot-testing\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Snapshot testing”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Compare workflow behavior across changes:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createSnapshot\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">compareSnapshots\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflowHarness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mocks\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">run\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">executor\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">snapshot\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createSnapshot\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getInvocations\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Save to file or compare\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">expect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">snapshot\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">toMatchSnapshot\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createSnapshot, compareSnapshots } from &#x27;awaitly/workflow&#x27;;const harness = createWorkflowHarness(mocks);const result = await harness.run(executor);const snapshot = createSnapshot(harness.getInvocations());// Save to file or compareexpect(snapshot).toMatchSnapshot();\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"testing-time-dependent-workflows\">Testing time-dependent workflows\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#testing-time-dependent-workflows\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Testing time-dependent workflows”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Control time in tests:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createTestClock\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">clock\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createTestClock\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflowHarness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mocks\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">clock\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">run\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withTimeout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchData\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">ms\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Advance time\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">clock\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">tick\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">500\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 500ms passed\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">clock\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">tick\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">600\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Now 1100ms, timeout triggers\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createTestClock } from &#x27;awaitly/workflow&#x27;;const clock = createTestClock();const harness = createWorkflowHarness(mocks, { clock });await harness.run(async (step) => {  const data = await step.withTimeout(() => fetchData(), { ms: 1000 });  return data;});// Advance timeclock.tick(500);  // 500ms passedclock.tick(600);  // Now 1100ms, timeout triggers\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"assertions-on-step-invocations\">Assertions on step invocations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#assertions-on-step-invocations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Assertions on step invocations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">run\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">executor\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">invocations\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getInvocations\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Check order\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">expect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">invocations\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">].\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">toBe\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">fetchOrder\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">expect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">invocations\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">].\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">toBe\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">chargeCard\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Check that chargeCard was called after fetchOrder\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">expect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">invocations\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">].\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">startedAt\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">toBeGreaterThan\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">invocations\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">].\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">completedAt\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await harness.run(executor);const invocations = harness.getInvocations();// Check orderexpect(invocations[0].name).toBe(&#x27;fetchOrder&#x27;);expect(invocations[1].name).toBe(&#x27;chargeCard&#x27;);// Check that chargeCard was called after fetchOrderexpect(invocations[1].startedAt).toBeGreaterThan(invocations[0].completedAt);\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"full-example\">Full example\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#full-example\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Full example”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">describe\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">it\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">expect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">beforeEach\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">vitest\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflowHarness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createMockFn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">okOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">errOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">describe\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">refund workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">let \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mockCalculateRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">ReturnType\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">typeof\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createMockFn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">let \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mockProcessRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">ReturnType\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">typeof\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createMockFn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">let \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">ReturnType\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">typeof\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflowHarness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">beforeEach\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mockCalculateRefund\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createMockFn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mockProcessRefund\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createMockFn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mockCalculateRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">returns\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">okOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">50\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mockProcessRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">returns\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">okOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">refundId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">ref-123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflowHarness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">calculateRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mockCalculateRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">processRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mockProcessRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">it\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">calculates and processes refund\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">run\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">refund\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">calculateRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">order-1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">refund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">expect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">toBe\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">expect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">refundId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">toBe\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">ref-123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">expect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mockCalculateRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">calls\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">length\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">toBe\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">expect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mockProcessRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">calls\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">length\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">toBe\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">it\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">stops if calculation fails\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mockCalculateRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">returns\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">errOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">ORDER_NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">run\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">refund\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">calculateRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">order-1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">refund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">expect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">toBe\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">false\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">expect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">toBe\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">ORDER_NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">expect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mockProcessRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">calls\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">length\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">toBe\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Never called\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { describe, it, expect, beforeEach } from &#x27;vitest&#x27;;import {  createWorkflowHarness,  createMockFn,  okOutcome,  errOutcome,} from &#x27;awaitly/workflow&#x27;;describe(&#x27;refund workflow&#x27;, () => {  let mockCalculateRefund: ReturnType\u003Ctypeof createMockFn>;  let mockProcessRefund: ReturnType\u003Ctypeof createMockFn>;  let harness: ReturnType\u003Ctypeof createWorkflowHarness>;  beforeEach(() => {    mockCalculateRefund = createMockFn();    mockProcessRefund = createMockFn();    mockCalculateRefund.returns(okOutcome({ amount: 50 }));    mockProcessRefund.returns(okOutcome({ refundId: &#x27;ref-123&#x27; }));    harness = createWorkflowHarness({      calculateRefund: mockCalculateRefund,      processRefund: mockProcessRefund,    });  });  it(&#x27;calculates and processes refund&#x27;, async () => {    const result = await harness.run(async (step) => {      const refund = await step(calculateRefund(&#x27;order-1&#x27;));      return await step(processRefund(refund));    });    expect(result.ok).toBe(true);    expect(result.value.refundId).toBe(&#x27;ref-123&#x27;);    expect(mockCalculateRefund.calls.length).toBe(1);    expect(mockProcessRefund.calls.length).toBe(1);  });  it(&#x27;stops if calculation fails&#x27;, async () => {    mockCalculateRefund.returns(errOutcome(&#x27;ORDER_NOT_FOUND&#x27;));    const result = await harness.run(async (step) => {      const refund = await step(calculateRefund(&#x27;order-1&#x27;));      return await step(processRefund(refund));    });    expect(result.ok).toBe(false);    expect(result.error).toBe(&#x27;ORDER_NOT_FOUND&#x27;);    expect(mockProcessRefund.calls.length).toBe(0); // Never called  });});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/guides/batch-processing/\">Learn about Batch Processing →\u003C/a>\u003C/p>",{"headings":939,"localImagePaths":966,"remoteImagePaths":967,"frontmatter":968,"imagePaths":969},[940,943,946,949,952,955,958,961,964,965],{"depth":57,"slug":941,"text":942},"basic-testing","Basic testing",{"depth":57,"slug":944,"text":945},"scripted-outcomes","Scripted outcomes",{"depth":57,"slug":947,"text":948},"dynamic-outcomes","Dynamic outcomes",{"depth":57,"slug":950,"text":951},"mock-functions","Mock functions",{"depth":57,"slug":953,"text":954},"testing-retries","Testing retries",{"depth":57,"slug":956,"text":957},"snapshot-testing","Snapshot testing",{"depth":57,"slug":959,"text":960},"testing-time-dependent-workflows","Testing time-dependent workflows",{"depth":57,"slug":962,"text":963},"assertions-on-step-invocations","Assertions on step invocations",{"depth":57,"slug":708,"text":709},{"depth":57,"slug":417,"text":418},[],[],{"title":928,"description":929},[],"guides/visualization",{"id":970,"data":972,"body":977,"filePath":978,"digest":979,"rendered":980},{"title":614,"description":973,"editUrl":16,"head":974,"template":46,"sidebar":975,"pagefind":16,"draft":35},"Generate diagrams of workflow execution",[],{"hidden":35,"attrs":976},{},"Visualize workflow execution as ASCII diagrams or Mermaid charts for debugging, documentation, or dashboards.\n\n## Basic usage\n\n```typescript\nimport { createVisualizer } from 'awaitly/visualize';\n\nconst viz = createVisualizer({ workflowName: 'checkout' });\n\nconst workflow = createWorkflow(deps, {\n  onEvent: viz.handleEvent,\n});\n\nawait workflow(async (step) => {\n  const order = await step(() => fetchOrder('123'), { name: 'Fetch order' });\n  const payment = await step(() => chargeCard(order.total), { name: 'Charge card' });\n  return { order, payment };\n});\n\n// ASCII output\nconsole.log(viz.render());\n\n// Mermaid output\nconsole.log(viz.renderAs('mermaid'));\n```\n\n## ASCII output\n\n```\n┌── checkout ─────────────────────────────────────────────────────┐\n│                                                                  │\n│  ✓ Fetch order [12ms]                                           │\n│  ✓ Charge card [45ms]                                           │\n│                                                                  │\n│  Completed in 57ms                                               │\n│                                                                  │\n└──────────────────────────────────────────────────────────────────┘\n```\n\n## Mermaid output\n\n```mermaid\nflowchart TD\n    start((\"▶ Start\"))\n    step_fetch_order[✓ Fetch order 12ms]:::success\n    start --> step_fetch_order\n    step_charge_card[✓ Charge card 45ms]:::success\n    step_fetch_order --> step_charge_card\n    finish((\"✓ Done\")):::success\n    step_charge_card --> finish\n```\n\nPaste into GitHub markdown or any Mermaid-compatible renderer.\n\n## JSON output\n\nGet structured data for custom rendering:\n\n```typescript\nconst ir = viz.renderAs('json');\n// {\n//   workflowName: 'checkout',\n//   status: 'completed',\n//   steps: [...],\n//   duration: 57\n// }\n```\n\n## Naming steps\n\nGive steps descriptive names for better diagrams:\n\n```typescript\nconst user = await step(() => fetchUser('1'), { name: 'Fetch user' });\nconst posts = await step(() => fetchPosts(user.id), { name: 'Fetch posts' });\n```\n\nWithout names, steps show as \"unnamed step\".\n\n## Parallel operations\n\nTrack parallel operations individually:\n\n```typescript\nimport { allAsync } from 'awaitly';\n\nconst result = await workflow(async (step) => {\n  const [user, posts] = await step(\n    () => allAsync([\n      fetchUser('1'),\n      fetchPosts('1'),\n    ]),\n    { name: 'Fetch user data' }\n  );\n  return { user, posts };\n});\n```\n\n## Decision tracking\n\nTrack conditional logic (if/switch) to visualize branching in your workflows:\n\n### Basic decision tracking\n\n```typescript\nimport { trackDecision } from 'awaitly/visualize';\n\nconst viz = createVisualizer();\nconst workflow = createWorkflow(deps, {\n  onEvent: viz.handleEvent,\n});\n\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser('1'), { name: 'Fetch user' });\n\n  // Track a decision point\n  const decision = trackDecision('check-role', {\n    condition: \"user.role === 'admin'\",\n    value: user.role,\n    emit: viz.handleDecisionEvent,\n  });\n\n  if (user.role === 'admin') {\n    decision.takeBranch('admin', true);\n    await step(() => adminDashboard(user), { name: 'Admin dashboard' });\n  } else {\n    decision.takeBranch('user', true);\n    await step(() => userDashboard(user), { name: 'User dashboard' });\n  }\n\n  decision.end();\n});\n```\n\n### trackIf - Simple if/else\n\n```typescript\nimport { trackIf } from 'awaitly/visualize';\n\nconst decision = trackIf('check-premium', user.isPremium, {\n  condition: 'user.isPremium',\n  emit: viz.handleDecisionEvent,\n});\n\nif (decision.condition) {\n  decision.then();\n  await step(() => fetchPremiumData(user.id));\n} else {\n  decision.else();\n  await step(() => fetchBasicData(user.id));\n}\n\ndecision.end();\n```\n\n### trackSwitch - Switch statements\n\n```typescript\nimport { trackSwitch } from 'awaitly/visualize';\n\nconst decision = trackSwitch('process-by-role', user.role, {\n  condition: 'switch(user.role)',\n  emit: viz.handleDecisionEvent,\n});\n\nswitch (user.role) {\n  case 'admin':\n    decision.case('admin', true);\n    await step(() => processAdmin(user));\n    break;\n  case 'moderator':\n    decision.case('moderator', true);\n    await step(() => processModerator(user));\n    break;\n  default:\n    decision.default(true);\n    await step(() => processUser(user));\n}\n\ndecision.end();\n```\n\n### With event collector\n\n```typescript\nimport { createEventCollector, trackIf } from 'awaitly/visualize';\n\nconst collector = createEventCollector({ workflowName: 'Role Check' });\nconst workflow = createWorkflow(deps, {\n  onEvent: collector.handleEvent,\n});\n\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser('1'), { name: 'Fetch user' });\n\n  const decision = trackIf('check-role', user.role === 'admin', {\n    condition: \"user.role === 'admin'\",\n    value: user.role,\n    emit: collector.handleDecisionEvent,\n  });\n\n  if (decision.condition) {\n    decision.then();\n    await step(() => processAdmin(user));\n  } else {\n    decision.else();\n    await step(() => processUser(user));\n  }\n  decision.end();\n\n  return user;\n});\n\n// Visualize with decision tracking\nconsole.log(collector.visualize());\n```\n\n## Post-execution visualization\n\nCollect events and visualize later:\n\n```typescript\nimport { createEventCollector } from 'awaitly/visualize';\n\nconst collector = createEventCollector({ workflowName: 'my-workflow' });\n\nconst workflow = createWorkflow(deps, {\n  onEvent: collector.handleEvent,\n});\n\nawait workflow(async (step) => { ... });\n\n// Visualize anytime after\nconsole.log(collector.visualize());\nconsole.log(collector.visualizeAs('mermaid'));\n```\n\n## Options\n\n```typescript\nconst viz = createVisualizer({\n  workflowName: 'checkout',\n  showDurations: true,     // Show step durations\n  showTimestamps: false,   // Show start times\n  maxWidth: 80,            // ASCII width limit\n});\n```\n\n## Integration with logging\n\n```typescript\nconst workflow = createWorkflow(deps, {\n  onEvent: (event) => {\n    // Feed to visualizer\n    viz.handleEvent(event);\n\n    // Also log\n    if (event.type === 'step_complete') {\n      logger.info(`Step ${event.name} completed in ${event.durationMs}ms`);\n    }\n    if (event.type === 'step_error') {\n      logger.error(`Step ${event.name} failed:`, event.error);\n    }\n  },\n});\n```\n\n## Devtools\n\nFor interactive debugging, run comparison, and timeline analysis:\n\n```typescript\nimport { createDevtools, quickVisualize, createConsoleLogger } from 'awaitly/workflow';\n\nconst devtools = createDevtools({ workflowName: 'checkout' });\n\nconst workflow = createWorkflow(deps, {\n  onEvent: devtools.handleEvent,\n});\n\nawait workflow(async (step) => { ... });\n\n// Get current run\nconst currentRun = devtools.getCurrentRun();\n\n// Get execution history\nconst history = devtools.getHistory();\n\n// Compare runs\nconst diff = devtools.diff(run1.id, run2.id);\nconsole.log(renderDiff(diff));\n\n// Compare with previous run\nconst diffWithPrev = devtools.diffWithPrevious();\n\n// Render timeline\nconsole.log(devtools.renderTimeline());\n\n// Export/import runs\nconst json = devtools.exportRun();\nconst imported = devtools.importRun(json);\n```\n\n### Console logging\n\nUse `createConsoleLogger` for pretty console output:\n\n```typescript\nimport { createConsoleLogger } from 'awaitly/workflow';\n\nconst logger = createConsoleLogger({ prefix: '[workflow]', colors: true });\n\nconst workflow = createWorkflow(deps, {\n  onEvent: logger,\n});\n\nawait workflow(async (step) => { ... });\n// Output:\n// [workflow] ⏵ Workflow started\n// [workflow] → fetch-user\n// [workflow] ✓ fetch-user (12ms)\n// [workflow] ✓ Workflow completed (45ms)\n```\n\n### Quick visualization\n\nVisualize a workflow run without setting up a visualizer:\n\n```typescript\nimport { quickVisualize } from 'awaitly/workflow';\n\nconst result = await quickVisualize(\n  async (handleEvent) => {\n    const workflow = createWorkflow(deps, { onEvent: handleEvent });\n    return await workflow(async (step) => { ... });\n  },\n  { workflowName: 'my-workflow' }\n);\n\nconsole.log(result); // ASCII diagram\n```\n\n### Run comparison\n\nCompare two workflow runs to see what changed:\n\n```typescript\nconst diff = devtools.diff(run1.id, run2.id);\n\nif (diff.statusChange) {\n  console.log(`Status: ${diff.statusChange.from} → ${diff.statusChange.to}`);\n}\n\nif (diff.durationChange) {\n  console.log(`Duration: ${diff.durationChange > 0 ? '+' : ''}${diff.durationChange}ms`);\n}\n\n// See what steps were added/removed/changed\nconsole.log('Added:', diff.added);\nconsole.log('Removed:', diff.removed);\nconsole.log('Changed:', diff.changed);\n```\n\n### Timeline analysis\n\nGet detailed timeline data:\n\n```typescript\nconst timeline = devtools.getTimeline();\n\nfor (const entry of timeline) {\n  console.log(`${entry.name}: ${entry.status} (${entry.durationMs}ms)`);\n  if (entry.error) {\n    console.error(`  Error: ${entry.error}`);\n  }\n}\n```\n\n## Advanced features\n\n### Time-travel debugging\n\nStep through workflow execution history:\n\n```typescript\nimport { createTimeTravelController } from 'awaitly/visualize';\n\nconst controller = createTimeTravelController({ maxSnapshots: 1000 });\n\nconst workflow = createWorkflow(deps, {\n  onEvent: controller.handleEvent,\n});\n\nawait workflow(async (step) => { ... });\n\n// Navigate through execution history\ncontroller.seek(0);              // Go to start\ncontroller.stepForward();        // Step forward one event\ncontroller.stepBackward();      // Step backward one event\ncontroller.seek(10);            // Jump to event 10\ncontroller.play(2.0);            // Playback at 2x speed\ncontroller.pause();              // Pause playback\n\n// Get current state\nconst ir = controller.getCurrentIR();\nconst state = controller.getState();\n```\n\n### Performance analyzer\n\nIdentify slow steps with heatmap visualization:\n\n```typescript\nimport { createPerformanceAnalyzer, getHeatLevel } from 'awaitly/visualize';\n\nconst analyzer = createPerformanceAnalyzer();\n\nconst workflow = createWorkflow(deps, {\n  onEvent: analyzer.handleEvent,\n});\n\nawait workflow(async (step) => { ... });\n\n// Get performance data\nconst data = analyzer.getData();\nconst heatLevel = getHeatLevel(stepDuration, data);\n\n// Export for visualization\nconst json = analyzer.exportData();\n```\n\n### Live visualizer\n\nReal-time visualization as workflow executes:\n\n```typescript\nimport { createLiveVisualizer } from 'awaitly/visualize';\n\nconst visualizer = createLiveVisualizer({ workflowName: 'checkout' });\n\n// Subscribe to updates\nvisualizer.onUpdate((ir) => {\n  console.log('Workflow state updated:', ir);\n  // Update UI, render diagram, etc.\n});\n\nconst workflow = createWorkflow(deps, {\n  onEvent: visualizer.handleEvent,\n});\n\nawait workflow(async (step) => { ... });\n```\n\n### Dev server\n\nInteractive web-based visualization with time-travel and performance analysis:\n\n```typescript\nimport { createDevServer } from 'awaitly/visualize';\n\nconst server = await createDevServer({\n  port: 3377,\n  workflowName: 'checkout',\n  timeTravel: true,\n  heatmap: true,\n});\n\nawait server.start();\n// Opens browser at http://localhost:3377\n\nconst workflow = createWorkflow(deps, {\n  onEvent: server.handleEvent,\n});\n\nawait workflow(async (step) => { ... });\n\nserver.complete();\n// Later, when done\nawait server.stop();\n```\n\nThe dev server provides:\n- Interactive HTML visualization\n- Time-travel debugging controls\n- Performance heatmap\n- Real-time updates via WebSocket\n- Export/import workflow runs\n\n## Next\n\n[Learn about Testing →](/guides/testing/)","src/content/docs/guides/visualization.md","8fce77e97854e514",{"html":981,"metadata":982},"\u003Cp>Visualize workflow execution as ASCII diagrams or Mermaid charts for debugging, documentation, or dashboards.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"basic-usage\">Basic usage\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#basic-usage\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Basic usage”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createVisualizer\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/visualize\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">viz\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createVisualizer\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">workflowName\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">checkout\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">viz\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchOrder\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Fetch order\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">total\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Charge card\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// ASCII output\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">viz\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">render\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Mermaid output\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">viz\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">renderAs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">mermaid\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createVisualizer } from &#x27;awaitly/visualize&#x27;;const viz = createVisualizer({ workflowName: &#x27;checkout&#x27; });const workflow = createWorkflow(deps, {  onEvent: viz.handleEvent,});await workflow(async (step) => {  const order = await step(() => fetchOrder(&#x27;123&#x27;), { name: &#x27;Fetch order&#x27; });  const payment = await step(() => chargeCard(order.total), { name: &#x27;Charge card&#x27; });  return { order, payment };});// ASCII outputconsole.log(viz.render());// Mermaid outputconsole.log(viz.renderAs(&#x27;mermaid&#x27;));\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"ascii-output\">ASCII output\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#ascii-output\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “ASCII output”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"plaintext\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#dbd7caee;--1:#393a34\">┌── checkout ─────────────────────────────────────────────────────┐\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#dbd7caee;--1:#393a34\">│                                                                  │\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#dbd7caee;--1:#393a34\">│  ✓ Fetch order [12ms]                                           │\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#dbd7caee;--1:#393a34\">│  ✓ Charge card [45ms]                                           │\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#dbd7caee;--1:#393a34\">│                                                                  │\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#dbd7caee;--1:#393a34\">│  Completed in 57ms                                               │\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#dbd7caee;--1:#393a34\">│                                                                  │\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#dbd7caee;--1:#393a34\">└──────────────────────────────────────────────────────────────────┘\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"┌── checkout ─────────────────────────────────────────────────────┐│                                                                  ││  ✓ Fetch order [12ms]                                           ││  ✓ Charge card [45ms]                                           ││                                                                  ││  Completed in 57ms                                               ││                                                                  │└──────────────────────────────────────────────────────────────────┘\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"mermaid-output\">Mermaid output\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#mermaid-output\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Mermaid output”\u003C/span>\u003C/a>\u003C/div>\n\u003Cpre class=\"mermaid\">flowchart TD\n    start((\"▶ Start\"))\n    step_fetch_order[✓ Fetch order 12ms]:::success\n    start --> step_fetch_order\n    step_charge_card[✓ Charge card 45ms]:::success\n    step_fetch_order --> step_charge_card\n    finish((\"✓ Done\")):::success\n    step_charge_card --> finish\u003C/pre>\n\u003Cp>Paste into GitHub markdown or any Mermaid-compatible renderer.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"json-output\">JSON output\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#json-output\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “JSON output”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Get structured data for custom rendering:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ir\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">viz\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">renderAs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">json\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">//   workflowName: 'checkout',\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">//   status: 'completed',\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">//   steps: [...],\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">//   duration: 57\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// }\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const ir = viz.renderAs(&#x27;json&#x27;);// {//   workflowName: &#x27;checkout&#x27;,//   status: &#x27;completed&#x27;,//   steps: [...],//   duration: 57// }\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"naming-steps\">Naming steps\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#naming-steps\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Naming steps”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Give steps descriptive names for better diagrams:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Fetch user\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Fetch posts\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const user = await step(() => fetchUser(&#x27;1&#x27;), { name: &#x27;Fetch user&#x27; });const posts = await step(() => fetchPosts(user.id), { name: &#x27;Fetch posts&#x27; });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>Without names, steps show as “unnamed step”.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"parallel-operations\">Parallel operations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#parallel-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Parallel operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Track parallel operations individually:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">allAsync\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">allAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Fetch user data\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { allAsync } from &#x27;awaitly&#x27;;const result = await workflow(async (step) => {  const [user, posts] = await step(    () => allAsync([      fetchUser(&#x27;1&#x27;),      fetchPosts(&#x27;1&#x27;),    ]),    { name: &#x27;Fetch user data&#x27; }  );  return { user, posts };});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"decision-tracking\">Decision tracking\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#decision-tracking\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Decision tracking”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Track conditional logic (if/switch) to visualize branching in your workflows:\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"basic-decision-tracking\">Basic decision tracking\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#basic-decision-tracking\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Basic decision tracking”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">trackDecision\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/visualize\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">viz\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createVisualizer\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">viz\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Fetch user\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Track a decision point\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">decision\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">trackDecision\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">check-role\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">condition\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">\"\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user.role === 'admin'\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">\"\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">role\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">emit\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">viz\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleDecisionEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">role\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">===\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">admin\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">decision\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">takeBranch\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">admin\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">adminDashboard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Admin dashboard\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">else\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">decision\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">takeBranch\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">userDashboard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">User dashboard\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">decision\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">end\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { trackDecision } from &#x27;awaitly/visualize&#x27;;const viz = createVisualizer();const workflow = createWorkflow(deps, {  onEvent: viz.handleEvent,});await workflow(async (step) => {  const user = await step(() => fetchUser(&#x27;1&#x27;), { name: &#x27;Fetch user&#x27; });  // Track a decision point  const decision = trackDecision(&#x27;check-role&#x27;, {    condition: &#x22;user.role === &#x27;admin&#x27;&#x22;,    value: user.role,    emit: viz.handleDecisionEvent,  });  if (user.role === &#x27;admin&#x27;) {    decision.takeBranch(&#x27;admin&#x27;, true);    await step(() => adminDashboard(user), { name: &#x27;Admin dashboard&#x27; });  } else {    decision.takeBranch(&#x27;user&#x27;, true);    await step(() => userDashboard(user), { name: &#x27;User dashboard&#x27; });  }  decision.end();});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"trackif---simple-ifelse\">trackIf - Simple if/else\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#trackif---simple-ifelse\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “trackIf - Simple if/else”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">trackIf\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/visualize\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">decision\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">trackIf\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">check-premium\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isPremium\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">condition\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user.isPremium\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">emit\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">viz\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleDecisionEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">decision\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">condition\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">decision\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">then\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPremiumData\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">else\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">decision\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">else\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchBasicData\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">decision\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">end\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { trackIf } from &#x27;awaitly/visualize&#x27;;const decision = trackIf(&#x27;check-premium&#x27;, user.isPremium, {  condition: &#x27;user.isPremium&#x27;,  emit: viz.handleDecisionEvent,});if (decision.condition) {  decision.then();  await step(() => fetchPremiumData(user.id));} else {  decision.else();  await step(() => fetchBasicData(user.id));}decision.end();\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"trackswitch---switch-statements\">trackSwitch - Switch statements\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#trackswitch---switch-statements\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “trackSwitch - Switch statements”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">trackSwitch\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/visualize\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">decision\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">trackSwitch\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">process-by-role\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">role\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">condition\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">switch(user.role)\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">emit\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">viz\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleDecisionEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">switch\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">role\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">case\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">admin\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">decision\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">case\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">admin\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processAdmin\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">break\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">case\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">moderator\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">decision\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">case\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">moderator\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processModerator\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">break\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">default\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">decision\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">default\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">decision\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">end\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { trackSwitch } from &#x27;awaitly/visualize&#x27;;const decision = trackSwitch(&#x27;process-by-role&#x27;, user.role, {  condition: &#x27;switch(user.role)&#x27;,  emit: viz.handleDecisionEvent,});switch (user.role) {  case &#x27;admin&#x27;:    decision.case(&#x27;admin&#x27;, true);    await step(() => processAdmin(user));    break;  case &#x27;moderator&#x27;:    decision.case(&#x27;moderator&#x27;, true);    await step(() => processModerator(user));    break;  default:    decision.default(true);    await step(() => processUser(user));}decision.end();\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"with-event-collector\">With event collector\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#with-event-collector\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “With event collector”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createEventCollector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">trackIf\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/visualize\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createEventCollector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">workflowName\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Role Check\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Fetch user\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">decision\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">trackIf\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">check-role\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">role\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> === \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">admin\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">condition\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">\"\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user.role === 'admin'\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">\"\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">role\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">emit\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleDecisionEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">decision\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">condition\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">decision\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">then\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processAdmin\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">else\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">decision\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">else\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">decision\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">end\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Visualize with decision tracking\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">visualize\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createEventCollector, trackIf } from &#x27;awaitly/visualize&#x27;;const collector = createEventCollector({ workflowName: &#x27;Role Check&#x27; });const workflow = createWorkflow(deps, {  onEvent: collector.handleEvent,});await workflow(async (step) => {  const user = await step(() => fetchUser(&#x27;1&#x27;), { name: &#x27;Fetch user&#x27; });  const decision = trackIf(&#x27;check-role&#x27;, user.role === &#x27;admin&#x27;, {    condition: &#x22;user.role === &#x27;admin&#x27;&#x22;,    value: user.role,    emit: collector.handleDecisionEvent,  });  if (decision.condition) {    decision.then();    await step(() => processAdmin(user));  } else {    decision.else();    await step(() => processUser(user));  }  decision.end();  return user;});// Visualize with decision trackingconsole.log(collector.visualize());\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"post-execution-visualization\">Post-execution visualization\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#post-execution-visualization\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Post-execution visualization”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Collect events and visualize later:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createEventCollector\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/visualize\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createEventCollector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">workflowName\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">my-workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Visualize anytime after\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">visualize\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">visualizeAs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">mermaid\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createEventCollector } from &#x27;awaitly/visualize&#x27;;const collector = createEventCollector({ workflowName: &#x27;my-workflow&#x27; });const workflow = createWorkflow(deps, {  onEvent: collector.handleEvent,});await workflow(async (step) => { ... });// Visualize anytime afterconsole.log(collector.visualize());console.log(collector.visualizeAs(&#x27;mermaid&#x27;));\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"options\">Options\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#options\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Options”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">viz\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createVisualizer\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">workflowName\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">checkout\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">showDurations\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Show step durations\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">showTimestamps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">false\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,   \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Show start times\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxWidth\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">80\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,            \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// ASCII width limit\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const viz = createVisualizer({  workflowName: &#x27;checkout&#x27;,  showDurations: true,     // Show step durations  showTimestamps: false,   // Show start times  maxWidth: 80,            // ASCII width limit});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"integration-with-logging\">Integration with logging\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#integration-with-logging\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Integration with logging”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Feed to visualizer\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">viz\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Also log\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">===\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">step_complete\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">logger\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">info\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Step \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">name\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> completed in \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">durationMs\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">ms\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">===\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">step_error\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">logger\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Step \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">name\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> failed:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">event\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const workflow = createWorkflow(deps, {  onEvent: (event) => {    // Feed to visualizer    viz.handleEvent(event);    // Also log    if (event.type === &#x27;step_complete&#x27;) {      logger.info(&#x60;Step ${event.name} completed in ${event.durationMs}ms&#x60;);    }    if (event.type === &#x27;step_error&#x27;) {      logger.error(&#x60;Step ${event.name} failed:&#x60;, event.error);    }  },});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"devtools\">Devtools\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#devtools\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Devtools”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>For interactive debugging, run comparison, and timeline analysis:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createDevtools\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">quickVisualize\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createConsoleLogger\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">devtools\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createDevtools\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">workflowName\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">checkout\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">devtools\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Get current run\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">currentRun\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">devtools\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getCurrentRun\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Get execution history\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">history\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">devtools\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getHistory\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Compare runs\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">diff\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">devtools\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">diff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">run1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">run2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">renderDiff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">diff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Compare with previous run\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">diffWithPrev\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">devtools\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">diffWithPrevious\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Render timeline\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">devtools\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">renderTimeline\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Export/import runs\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">json\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">devtools\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">exportRun\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">imported\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">devtools\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">importRun\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createDevtools, quickVisualize, createConsoleLogger } from &#x27;awaitly/workflow&#x27;;const devtools = createDevtools({ workflowName: &#x27;checkout&#x27; });const workflow = createWorkflow(deps, {  onEvent: devtools.handleEvent,});await workflow(async (step) => { ... });// Get current runconst currentRun = devtools.getCurrentRun();// Get execution historyconst history = devtools.getHistory();// Compare runsconst diff = devtools.diff(run1.id, run2.id);console.log(renderDiff(diff));// Compare with previous runconst diffWithPrev = devtools.diffWithPrevious();// Render timelineconsole.log(devtools.renderTimeline());// Export/import runsconst json = devtools.exportRun();const imported = devtools.importRun(json);\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"console-logging\">Console logging\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#console-logging\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Console logging”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">createConsoleLogger\u003C/code> for pretty console output:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createConsoleLogger\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">logger\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createConsoleLogger\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">prefix\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">[workflow]\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">colors\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">logger\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Output:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// [workflow] ⏵ Workflow started\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// [workflow] → fetch-user\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// [workflow] ✓ fetch-user (12ms)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// [workflow] ✓ Workflow completed (45ms)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createConsoleLogger } from &#x27;awaitly/workflow&#x27;;const logger = createConsoleLogger({ prefix: &#x27;[workflow]&#x27;, colors: true });const workflow = createWorkflow(deps, {  onEvent: logger,});await workflow(async (step) => { ... });// Output:// [workflow] ⏵ Workflow started// [workflow] → fetch-user// [workflow] ✓ fetch-user (12ms)// [workflow] ✓ Workflow completed (45ms)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"quick-visualization\">Quick visualization\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#quick-visualization\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Quick visualization”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Visualize a workflow run without setting up a visualizer:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">quickVisualize\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">quickVisualize\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">workflowName\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">my-workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// ASCII diagram\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { quickVisualize } from &#x27;awaitly/workflow&#x27;;const result = await quickVisualize(  async (handleEvent) => {    const workflow = createWorkflow(deps, { onEvent: handleEvent });    return await workflow(async (step) => { ... });  },  { workflowName: &#x27;my-workflow&#x27; });console.log(result); // ASCII diagram\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"run-comparison\">Run comparison\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#run-comparison\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Run comparison”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Compare two workflow runs to see what changed:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">diff\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">devtools\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">diff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">run1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">run2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">diff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">statusChange\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Status: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">diff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">statusChange\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">from\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> → \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">diff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">statusChange\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">to\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">diff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">durationChange\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Duration: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">diff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">durationChange \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">+\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">:\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">''\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">diff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">durationChange\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">ms\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// See what steps were added/removed/changed\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Added:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">diff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">added\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Removed:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">diff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">removed\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Changed:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">diff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">changed\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const diff = devtools.diff(run1.id, run2.id);if (diff.statusChange) {  console.log(&#x60;Status: ${diff.statusChange.from} → ${diff.statusChange.to}&#x60;);}if (diff.durationChange) {  console.log(&#x60;Duration: ${diff.durationChange > 0 ? &#x27;+&#x27; : &#x27;&#x27;}${diff.durationChange}ms&#x60;);}// See what steps were added/removed/changedconsole.log(&#x27;Added:&#x27;, diff.added);console.log(&#x27;Removed:&#x27;, diff.removed);console.log(&#x27;Changed:&#x27;, diff.changed);\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"timeline-analysis\">Timeline analysis\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#timeline-analysis\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Timeline analysis”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Get detailed timeline data:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">timeline\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">devtools\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getTimeline\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">for\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">entry\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> of\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">timeline\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">entry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">name\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">entry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">status\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> (\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">entry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">durationMs\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">ms)\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">entry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">  Error: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">entry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">error\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const timeline = devtools.getTimeline();for (const entry of timeline) {  console.log(&#x60;${entry.name}: ${entry.status} (${entry.durationMs}ms)&#x60;);  if (entry.error) {    console.error(&#x60;  Error: ${entry.error}&#x60;);  }}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"advanced-features\">Advanced features\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#advanced-features\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Advanced features”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"time-travel-debugging\">Time-travel debugging\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#time-travel-debugging\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Time-travel debugging”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Step through workflow execution history:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createTimeTravelController\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/visualize\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">controller\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createTimeTravelController\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxSnapshots\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">controller\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Navigate through execution history\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">controller\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">seek\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">              \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Go to start\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">controller\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">stepForward\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Step forward one event\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">controller\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">stepBackward\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Step backward one event\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">controller\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">seek\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">10\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">            \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Jump to event 10\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">controller\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">play\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">2.0\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">            \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Playback at 2x speed\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">controller\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">pause\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">              \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Pause playback\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Get current state\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ir\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">controller\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getCurrentIR\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">controller\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createTimeTravelController } from &#x27;awaitly/visualize&#x27;;const controller = createTimeTravelController({ maxSnapshots: 1000 });const workflow = createWorkflow(deps, {  onEvent: controller.handleEvent,});await workflow(async (step) => { ... });// Navigate through execution historycontroller.seek(0);              // Go to startcontroller.stepForward();        // Step forward one eventcontroller.stepBackward();      // Step backward one eventcontroller.seek(10);            // Jump to event 10controller.play(2.0);            // Playback at 2x speedcontroller.pause();              // Pause playback// Get current stateconst ir = controller.getCurrentIR();const state = controller.getState();\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"performance-analyzer\">Performance analyzer\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#performance-analyzer\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Performance analyzer”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Identify slow steps with heatmap visualization:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createPerformanceAnalyzer\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">getHeatLevel\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/visualize\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">analyzer\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createPerformanceAnalyzer\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">analyzer\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Get performance data\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">analyzer\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getData\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">heatLevel\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getHeatLevel\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stepDuration\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Export for visualization\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">json\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">analyzer\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">exportData\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createPerformanceAnalyzer, getHeatLevel } from &#x27;awaitly/visualize&#x27;;const analyzer = createPerformanceAnalyzer();const workflow = createWorkflow(deps, {  onEvent: analyzer.handleEvent,});await workflow(async (step) => { ... });// Get performance dataconst data = analyzer.getData();const heatLevel = getHeatLevel(stepDuration, data);// Export for visualizationconst json = analyzer.exportData();\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"live-visualizer\">Live visualizer\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#live-visualizer\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Live visualizer”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Real-time visualization as workflow executes:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createLiveVisualizer\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/visualize\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">visualizer\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createLiveVisualizer\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">workflowName\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">checkout\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Subscribe to updates\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">visualizer\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onUpdate\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">((\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ir\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Workflow state updated:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ir\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Update UI, render diagram, etc.\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">visualizer\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createLiveVisualizer } from &#x27;awaitly/visualize&#x27;;const visualizer = createLiveVisualizer({ workflowName: &#x27;checkout&#x27; });// Subscribe to updatesvisualizer.onUpdate((ir) => {  console.log(&#x27;Workflow state updated:&#x27;, ir);  // Update UI, render diagram, etc.});const workflow = createWorkflow(deps, {  onEvent: visualizer.handleEvent,});await workflow(async (step) => { ... });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"dev-server\">Dev server\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#dev-server\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Dev server”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Interactive web-based visualization with time-travel and performance analysis:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createDevServer\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/visualize\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">server\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createDevServer\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">port\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3377\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">workflowName\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">checkout\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">timeTravel\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">heatmap\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">server\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">start\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Opens browser at http://localhost:3377\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">server\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">server\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">complete\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Later, when done\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">server\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">stop\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createDevServer } from &#x27;awaitly/visualize&#x27;;const server = await createDevServer({  port: 3377,  workflowName: &#x27;checkout&#x27;,  timeTravel: true,  heatmap: true,});await server.start();// Opens browser at http://localhost:3377const workflow = createWorkflow(deps, {  onEvent: server.handleEvent,});await workflow(async (step) => { ... });server.complete();// Later, when doneawait server.stop();\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>The dev server provides:\u003C/p>\n\u003Cul>\n\u003Cli>Interactive HTML visualization\u003C/li>\n\u003Cli>Time-travel debugging controls\u003C/li>\n\u003Cli>Performance heatmap\u003C/li>\n\u003Cli>Real-time updates via WebSocket\u003C/li>\n\u003Cli>Export/import workflow runs\u003C/li>\n\u003C/ul>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/guides/testing/\">Learn about Testing →\u003C/a>\u003C/p>",{"headings":983,"localImagePaths":1053,"remoteImagePaths":1054,"frontmatter":1055,"imagePaths":1056},[984,985,988,991,994,997,1000,1003,1006,1009,1012,1015,1018,1019,1022,1025,1028,1031,1034,1037,1040,1043,1046,1049,1052],{"depth":57,"slug":58,"text":59},{"depth":57,"slug":986,"text":987},"ascii-output","ASCII output",{"depth":57,"slug":989,"text":990},"mermaid-output","Mermaid output",{"depth":57,"slug":992,"text":993},"json-output","JSON output",{"depth":57,"slug":995,"text":996},"naming-steps","Naming steps",{"depth":57,"slug":998,"text":999},"parallel-operations","Parallel operations",{"depth":57,"slug":1001,"text":1002},"decision-tracking","Decision tracking",{"depth":212,"slug":1004,"text":1005},"basic-decision-tracking","Basic decision tracking",{"depth":212,"slug":1007,"text":1008},"trackif---simple-ifelse","trackIf - Simple if/else",{"depth":212,"slug":1010,"text":1011},"trackswitch---switch-statements","trackSwitch - Switch statements",{"depth":212,"slug":1013,"text":1014},"with-event-collector","With event collector",{"depth":57,"slug":1016,"text":1017},"post-execution-visualization","Post-execution visualization",{"depth":57,"slug":610,"text":611},{"depth":57,"slug":1020,"text":1021},"integration-with-logging","Integration with logging",{"depth":57,"slug":1023,"text":1024},"devtools","Devtools",{"depth":212,"slug":1026,"text":1027},"console-logging","Console logging",{"depth":212,"slug":1029,"text":1030},"quick-visualization","Quick visualization",{"depth":212,"slug":1032,"text":1033},"run-comparison","Run comparison",{"depth":212,"slug":1035,"text":1036},"timeline-analysis","Timeline analysis",{"depth":57,"slug":1038,"text":1039},"advanced-features","Advanced features",{"depth":212,"slug":1041,"text":1042},"time-travel-debugging","Time-travel debugging",{"depth":212,"slug":1044,"text":1045},"performance-analyzer","Performance analyzer",{"depth":212,"slug":1047,"text":1048},"live-visualizer","Live visualizer",{"depth":212,"slug":1050,"text":1051},"dev-server","Dev server",{"depth":57,"slug":417,"text":418},[],[],{"title":614,"description":973},[],"getting-started/error-handling",{"id":1057,"data":1059,"body":1065,"filePath":1066,"digest":1067,"rendered":1068},{"title":1060,"description":1061,"editUrl":16,"head":1062,"template":46,"sidebar":1063,"pagefind":16,"draft":35},"Handling Errors","How errors flow through workflows and how to handle them",[],{"hidden":35,"attrs":1064},{},"## Error types are inferred\n\nWhen you create a workflow, TypeScript computes the error union from your dependencies:\n\n```typescript\nconst fetchUser = async (id: string): AsyncResult\u003CUser, 'NOT_FOUND'> => { ... };\nconst fetchPosts = async (id: string): AsyncResult\u003CPost[], 'FETCH_ERROR'> => { ... };\nconst sendEmail = async (to: string): AsyncResult\u003Cvoid, 'EMAIL_FAILED'> => { ... };\n\nconst workflow = createWorkflow({ fetchUser, fetchPosts, sendEmail });\n\nconst result = await workflow(async (step) => { ... });\n// result.error is: 'NOT_FOUND' | 'FETCH_ERROR' | 'EMAIL_FAILED' | UnexpectedError\n```\n\nAdd a new dependency? The error union updates automatically.\n\n## UnexpectedError\n\nIf code throws an exception (not a returned error), it becomes an `UnexpectedError`:\n\n```typescript\nconst badOperation = async (): AsyncResult\u003Cstring, 'KNOWN_ERROR'> => {\n  throw new Error('Something broke'); // Throws instead of returning err()\n};\n\nconst workflow = createWorkflow({ badOperation });\nconst result = await workflow(async (step) => {\n  return await step(badOperation());\n});\n\nif (!result.ok && result.error.type === 'UNEXPECTED') {\n  console.log(result.error.cause); // The original Error object\n}\n```\n\n## Wrapping throwing code\n\nUse `step.try` to convert thrown exceptions into typed errors:\n\n```typescript\nconst result = await workflow(async (step) => {\n  const data = await step.try(\n    async () => {\n      const res = await fetch('/api/data');\n      if (!res.ok) throw new Error(`HTTP ${res.status}`);\n      return res.json();\n    },\n    { error: 'FETCH_FAILED' as const }\n  );\n\n  return data;\n});\n// result.error includes 'FETCH_FAILED'\n```\n\n## Preserving error details\n\nIf your function returns rich error objects, use `step.fromResult`:\n\n```typescript\ntype ApiError = { code: string; message: string };\n\nconst callApi = async (): AsyncResult\u003CData, ApiError> => {\n  return err({ code: 'RATE_LIMITED', message: 'Too many requests' });\n};\n\nconst result = await workflow(async (step) => {\n  const data = await step.fromResult(\n    () => callApi(),\n    {\n      onError: (apiError) => ({\n        type: 'API_ERROR' as const,\n        code: apiError.code,\n        message: apiError.message,\n      }),\n    }\n  );\n  return data;\n});\n```\n\n## Handling specific errors\n\nUse a switch statement for exhaustive handling:\n\n```typescript\nif (!result.ok) {\n  switch (result.error) {\n    case 'NOT_FOUND':\n      return res.status(404).json({ error: 'User not found' });\n    case 'UNAUTHORIZED':\n      return res.status(401).json({ error: 'Please log in' });\n    case 'FETCH_ERROR':\n      return res.status(502).json({ error: 'Upstream service failed' });\n    default:\n      // UnexpectedError or unknown error\n      console.error(result.error);\n      return res.status(500).json({ error: 'Internal error' });\n  }\n}\n```\n\nTypeScript ensures you handle all known error cases.\n\n## Strict mode\n\nBy default, thrown exceptions become `UnexpectedError`. Use strict mode to force explicit handling:\n\n```typescript\nconst workflow = createWorkflow(\n  { fetchUser, fetchPosts },\n  {\n    strict: true,\n    catchUnexpected: (thrown) => ({\n      type: 'UNEXPECTED' as const,\n      message: String(thrown),\n    }),\n  }\n);\n```\n\n## When to use string literals vs objects\n\n| Use case | Recommendation |\n|----------|---------------|\n| Simple distinct states | String literals: `'NOT_FOUND' \\| 'UNAUTHORIZED'` |\n| Errors with context | Objects: `{ type: 'NOT_FOUND', id: string }` |\n| API responses | [Tagged Errors](/concepts/tagged-errors/) for structured data |\n\n## Next\n\n[Learn about Results in depth →](/concepts/results/)","src/content/docs/getting-started/error-handling.md","dff125047940f321",{"html":1069,"metadata":1070},"\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"error-types-are-inferred\">Error types are inferred\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#error-types-are-inferred\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Error types are inferred”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>When you create a workflow, TypeScript computes the error union from your dependencies:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">User\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Post\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[],\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">FETCH_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">sendEmail\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">to\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">void\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">EMAIL_FAILED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">sendEmail\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// result.error is: 'NOT_FOUND' | 'FETCH_ERROR' | 'EMAIL_FAILED' | UnexpectedError\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const fetchUser = async (id: string): AsyncResult\u003CUser, &#x27;NOT_FOUND&#x27;> => { ... };const fetchPosts = async (id: string): AsyncResult\u003CPost[], &#x27;FETCH_ERROR&#x27;> => { ... };const sendEmail = async (to: string): AsyncResult\u003Cvoid, &#x27;EMAIL_FAILED&#x27;> => { ... };const workflow = createWorkflow({ fetchUser, fetchPosts, sendEmail });const result = await workflow(async (step) => { ... });// result.error is: &#x27;NOT_FOUND&#x27; | &#x27;FETCH_ERROR&#x27; | &#x27;EMAIL_FAILED&#x27; | UnexpectedError\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>Add a new dependency? The error union updates automatically.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"unexpectederror\">UnexpectedError\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#unexpectederror\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “UnexpectedError”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>If code throws an exception (not a returned error), it becomes an \u003Ccode dir=\"auto\">UnexpectedError\u003C/code>:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">badOperation\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">():\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">KNOWN_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">throw\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> new \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">Error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Something broke\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Throws instead of returning err()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">badOperation\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">badOperation\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">&#x26;&#x26;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">===\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">UNEXPECTED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cause\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// The original Error object\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const badOperation = async (): AsyncResult\u003Cstring, &#x27;KNOWN_ERROR&#x27;> => {  throw new Error(&#x27;Something broke&#x27;); // Throws instead of returning err()};const workflow = createWorkflow({ badOperation });const result = await workflow(async (step) => {  return await step(badOperation());});if (!result.ok &#x26;&#x26; result.error.type === &#x27;UNEXPECTED&#x27;) {  console.log(result.error.cause); // The original Error object}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"wrapping-throwing-code\">Wrapping throwing code\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#wrapping-throwing-code\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Wrapping throwing code”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">step.try\u003C/code> to convert thrown exceptions into typed errors:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">try\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetch\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">/api/data\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">throw\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> new \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">Error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">HTTP \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">status\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">FETCH_FAILED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">as\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// result.error includes 'FETCH_FAILED'\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await workflow(async (step) => {  const data = await step.try(    async () => {      const res = await fetch(&#x27;/api/data&#x27;);      if (!res.ok) throw new Error(&#x60;HTTP ${res.status}&#x60;);      return res.json();    },    { error: &#x27;FETCH_FAILED&#x27; as const }  );  return data;});// result.error includes &#x27;FETCH_FAILED&#x27;\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"preserving-error-details\">Preserving error details\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#preserving-error-details\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Preserving error details”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>If your function returns rich error objects, use \u003Ccode dir=\"auto\">step.fromResult\u003C/code>:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">ApiError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">code\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">callApi\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">():\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">ApiError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">code\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">RATE_LIMITED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Too many requests\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fromResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">callApi\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">apiError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => ({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">API_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">as\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">code\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">apiError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">code\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">apiError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"type ApiError = { code: string; message: string };const callApi = async (): AsyncResult\u003CData, ApiError> => {  return err({ code: &#x27;RATE_LIMITED&#x27;, message: &#x27;Too many requests&#x27; });};const result = await workflow(async (step) => {  const data = await step.fromResult(    () => callApi(),    {      onError: (apiError) => ({        type: &#x27;API_ERROR&#x27; as const,        code: apiError.code,        message: apiError.message,      }),    }  );  return data;});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"handling-specific-errors\">Handling specific errors\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#handling-specific-errors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Handling specific errors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use a switch statement for exhaustive handling:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">switch\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">case\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">404\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">User not found\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">case\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">UNAUTHORIZED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">401\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Please log in\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">case\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">FETCH_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">502\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Upstream service failed\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">default\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// UnexpectedError or unknown error\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">500\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Internal error\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"if (!result.ok) {  switch (result.error) {    case &#x27;NOT_FOUND&#x27;:      return res.status(404).json({ error: &#x27;User not found&#x27; });    case &#x27;UNAUTHORIZED&#x27;:      return res.status(401).json({ error: &#x27;Please log in&#x27; });    case &#x27;FETCH_ERROR&#x27;:      return res.status(502).json({ error: &#x27;Upstream service failed&#x27; });    default:      // UnexpectedError or unknown error      console.error(result.error);      return res.status(500).json({ error: &#x27;Internal error&#x27; });  }}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>TypeScript ensures you handle all known error cases.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"strict-mode\">Strict mode\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#strict-mode\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Strict mode”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>By default, thrown exceptions become \u003Ccode dir=\"auto\">UnexpectedError\u003C/code>. Use strict mode to force explicit handling:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">strict\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">catchUnexpected\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">thrown\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => ({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">type\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">UNEXPECTED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">as\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">String\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">thrown\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const workflow = createWorkflow(  { fetchUser, fetchPosts },  {    strict: true,    catchUnexpected: (thrown) => ({      type: &#x27;UNEXPECTED&#x27; as const,      message: String(thrown),    }),  });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"when-to-use-string-literals-vs-objects\">When to use string literals vs objects\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#when-to-use-string-literals-vs-objects\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “When to use string literals vs objects”\u003C/span>\u003C/a>\u003C/div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Use case\u003C/th>\u003Cth>Recommendation\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Simple distinct states\u003C/td>\u003Ctd>String literals: \u003Ccode dir=\"auto\">'NOT_FOUND' | 'UNAUTHORIZED'\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Errors with context\u003C/td>\u003Ctd>Objects: \u003Ccode dir=\"auto\">{ type: 'NOT_FOUND', id: string }\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>API responses\u003C/td>\u003Ctd>\u003Ca href=\"/concepts/tagged-errors/\">Tagged Errors\u003C/a> for structured data\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/concepts/results/\">Learn about Results in depth →\u003C/a>\u003C/p>",{"headings":1071,"localImagePaths":1092,"remoteImagePaths":1093,"frontmatter":1094,"imagePaths":1095},[1072,1075,1078,1079,1082,1085,1088,1091],{"depth":57,"slug":1073,"text":1074},"error-types-are-inferred","Error types are inferred",{"depth":57,"slug":1076,"text":1077},"unexpectederror","UnexpectedError",{"depth":57,"slug":392,"text":393},{"depth":57,"slug":1080,"text":1081},"preserving-error-details","Preserving error details",{"depth":57,"slug":1083,"text":1084},"handling-specific-errors","Handling specific errors",{"depth":57,"slug":1086,"text":1087},"strict-mode","Strict mode",{"depth":57,"slug":1089,"text":1090},"when-to-use-string-literals-vs-objects","When to use string literals vs objects",{"depth":57,"slug":417,"text":418},[],[],{"title":1060,"description":1061},[],"getting-started/first-workflow",{"id":1096,"data":1098,"body":1104,"filePath":1105,"digest":1106,"rendered":1107},{"title":1099,"description":1100,"editUrl":16,"head":1101,"template":46,"sidebar":1102,"pagefind":16,"draft":35},"Your First Workflow","Build a simple workflow with typed errors in 5 minutes",[],{"hidden":35,"attrs":1103},{},"This guide walks through building a workflow that fetches a user and their posts, with typed error handling.\n\n## Define your operations\n\nOperations return `AsyncResult\u003CT, E>` - either `ok(value)` or `err(error)`:\n\n```typescript\nimport { ok, err, type AsyncResult } from 'awaitly';\n\ntype User = { id: string; name: string };\ntype Post = { id: number; title: string };\n\nconst fetchUser = async (id: string): AsyncResult\u003CUser, 'NOT_FOUND'> => {\n  if (id === '1') {\n    return ok({ id: '1', name: 'Alice' });\n  }\n  return err('NOT_FOUND');\n};\n\nconst fetchPosts = async (userId: string): AsyncResult\u003CPost[], 'FETCH_ERROR'> => {\n  return ok([\n    { id: 1, title: 'Hello World' },\n    { id: 2, title: 'Second Post' },\n  ]);\n};\n```\n\n## Create the workflow\n\nPass your operations to `createWorkflow`. Error types are inferred automatically:\n\n```typescript\nimport { createWorkflow } from 'awaitly/workflow';\n\nconst loadUserData = createWorkflow({ fetchUser, fetchPosts });\n```\n\n## Run it\n\nUse `step()` to execute operations. If any step fails, the workflow exits early:\n\n```typescript\nconst result = await loadUserData(async (step) => {\n  const user = await step(fetchUser('1'));\n  const posts = await step(fetchPosts(user.id));\n  return { user, posts };\n});\n```\n\n## Handle the result\n\nCheck `result.ok` to determine success or failure:\n\n```typescript\nif (result.ok) {\n  console.log(result.value.user.name);\n  console.log(result.value.posts.length, 'posts');\n} else {\n  // TypeScript knows: result.error is 'NOT_FOUND' | 'FETCH_ERROR' | UnexpectedError\n  switch (result.error) {\n    case 'NOT_FOUND':\n      console.log('User not found');\n      break;\n    case 'FETCH_ERROR':\n      console.log('Failed to fetch posts');\n      break;\n    default:\n      // UnexpectedError - something threw an exception\n      console.log('Unexpected error:', result.error);\n  }\n}\n```\n\n## Complete example\n\n```typescript\nimport { ok, err, type AsyncResult } from 'awaitly';\nimport { createWorkflow } from 'awaitly/workflow';\n\ntype User = { id: string; name: string };\ntype Post = { id: number; title: string };\n\nconst fetchUser = async (id: string): AsyncResult\u003CUser, 'NOT_FOUND'> =>\n  id === '1' ? ok({ id: '1', name: 'Alice' }) : err('NOT_FOUND');\n\nconst fetchPosts = async (userId: string): AsyncResult\u003CPost[], 'FETCH_ERROR'> =>\n  ok([{ id: 1, title: 'Hello World' }]);\n\nconst loadUserData = createWorkflow({ fetchUser, fetchPosts });\n\nconst result = await loadUserData(async (step) => {\n  const user = await step(fetchUser('1'));\n  const posts = await step(fetchPosts(user.id));\n  return { user, posts };\n});\n\nif (result.ok) {\n  console.log(`${result.value.user.name} has ${result.value.posts.length} posts`);\n}\n```\n\n## What happens on error?\n\nChange `fetchUser('1')` to `fetchUser('999')`:\n\n```typescript\nconst result = await loadUserData(async (step) => {\n  const user = await step(fetchUser('999')); // Returns err('NOT_FOUND')\n  // This line never runs\n  const posts = await step(fetchPosts(user.id));\n  return { user, posts };\n});\n\nconsole.log(result.ok);    // false\nconsole.log(result.error); // 'NOT_FOUND'\n```\n\nThe workflow exits at the first error. No need for try/catch or manual error checking.\n\n## Next\n\n[Learn about error handling →](/getting-started/error-handling/)","src/content/docs/getting-started/first-workflow.md","21c6fd38c4b3fbb6",{"html":1108,"metadata":1109},"\u003Cp>This guide walks through building a workflow that fetches a user and their posts, with typed error handling.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"define-your-operations\">Define your operations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#define-your-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Define your operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Operations return \u003Ccode dir=\"auto\">AsyncResult&#x3C;T, E>\u003C/code> - either \u003Ccode dir=\"auto\">ok(value)\u003C/code> or \u003Ccode dir=\"auto\">err(error)\u003C/code>:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">User\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Post\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">title\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">User\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> === \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Alice\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">userId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Post\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[],\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">FETCH_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">title\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Hello World\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">title\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Second Post\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { ok, err, type AsyncResult } from &#x27;awaitly&#x27;;type User = { id: string; name: string };type Post = { id: number; title: string };const fetchUser = async (id: string): AsyncResult\u003CUser, &#x27;NOT_FOUND&#x27;> => {  if (id === &#x27;1&#x27;) {    return ok({ id: &#x27;1&#x27;, name: &#x27;Alice&#x27; });  }  return err(&#x27;NOT_FOUND&#x27;);};const fetchPosts = async (userId: string): AsyncResult\u003CPost[], &#x27;FETCH_ERROR&#x27;> => {  return ok([    { id: 1, title: &#x27;Hello World&#x27; },    { id: 2, title: &#x27;Second Post&#x27; },  ]);};\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"create-the-workflow\">Create the workflow\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#create-the-workflow\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Create the workflow”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Pass your operations to \u003Ccode dir=\"auto\">createWorkflow\u003C/code>. Error types are inferred automatically:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">loadUserData\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createWorkflow } from &#x27;awaitly/workflow&#x27;;const loadUserData = createWorkflow({ fetchUser, fetchPosts });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"run-it\">Run it\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#run-it\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Run it”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">step()\u003C/code> to execute operations. If any step fails, the workflow exits early:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">loadUserData\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await loadUserData(async (step) => {  const user = await step(fetchUser(&#x27;1&#x27;));  const posts = await step(fetchPosts(user.id));  return { user, posts };});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"handle-the-result\">Handle the result\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#handle-the-result\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Handle the result”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Check \u003Ccode dir=\"auto\">result.ok\u003C/code> to determine success or failure:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">length\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">posts\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">else\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// TypeScript knows: result.error is 'NOT_FOUND' | 'FETCH_ERROR' | UnexpectedError\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">switch\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">case\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">User not found\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">break\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">case\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">FETCH_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Failed to fetch posts\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">break\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">default\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// UnexpectedError - something threw an exception\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Unexpected error:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"if (result.ok) {  console.log(result.value.user.name);  console.log(result.value.posts.length, &#x27;posts&#x27;);} else {  // TypeScript knows: result.error is &#x27;NOT_FOUND&#x27; | &#x27;FETCH_ERROR&#x27; | UnexpectedError  switch (result.error) {    case &#x27;NOT_FOUND&#x27;:      console.log(&#x27;User not found&#x27;);      break;    case &#x27;FETCH_ERROR&#x27;:      console.log(&#x27;Failed to fetch posts&#x27;);      break;    default:      // UnexpectedError - something threw an exception      console.log(&#x27;Unexpected error:&#x27;, result.error);  }}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"complete-example\">Complete example\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#complete-example\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Complete example”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">User\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Post\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">title\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">User\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> === \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> ? \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Alice\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> : \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">userId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Post\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[],\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">FETCH_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">title\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Hello World\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }]);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">loadUserData\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">loadUserData\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">name\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> has \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">length\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\"> posts\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { ok, err, type AsyncResult } from &#x27;awaitly&#x27;;import { createWorkflow } from &#x27;awaitly/workflow&#x27;;type User = { id: string; name: string };type Post = { id: number; title: string };const fetchUser = async (id: string): AsyncResult\u003CUser, &#x27;NOT_FOUND&#x27;> =>  id === &#x27;1&#x27; ? ok({ id: &#x27;1&#x27;, name: &#x27;Alice&#x27; }) : err(&#x27;NOT_FOUND&#x27;);const fetchPosts = async (userId: string): AsyncResult\u003CPost[], &#x27;FETCH_ERROR&#x27;> =>  ok([{ id: 1, title: &#x27;Hello World&#x27; }]);const loadUserData = createWorkflow({ fetchUser, fetchPosts });const result = await loadUserData(async (step) => {  const user = await step(fetchUser(&#x27;1&#x27;));  const posts = await step(fetchPosts(user.id));  return { user, posts };});if (result.ok) {  console.log(&#x60;${result.value.user.name} has ${result.value.posts.length} posts&#x60;);}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"what-happens-on-error\">What happens on error?\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#what-happens-on-error\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “What happens on error?”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Change \u003Ccode dir=\"auto\">fetchUser('1')\u003C/code> to \u003Ccode dir=\"auto\">fetchUser('999')\u003C/code>:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">loadUserData\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">999\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Returns err('NOT_FOUND')\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// This line never runs\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// false\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 'NOT_FOUND'\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await loadUserData(async (step) => {  const user = await step(fetchUser(&#x27;999&#x27;)); // Returns err(&#x27;NOT_FOUND&#x27;)  // This line never runs  const posts = await step(fetchPosts(user.id));  return { user, posts };});console.log(result.ok);    // falseconsole.log(result.error); // &#x27;NOT_FOUND&#x27;\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>The workflow exits at the first error. No need for try/catch or manual error checking.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/getting-started/error-handling/\">Learn about error handling →\u003C/a>\u003C/p>",{"headings":1110,"localImagePaths":1128,"remoteImagePaths":1129,"frontmatter":1130,"imagePaths":1131},[1111,1114,1117,1120,1123,1124,1127],{"depth":57,"slug":1112,"text":1113},"define-your-operations","Define your operations",{"depth":57,"slug":1115,"text":1116},"create-the-workflow","Create the workflow",{"depth":57,"slug":1118,"text":1119},"run-it","Run it",{"depth":57,"slug":1121,"text":1122},"handle-the-result","Handle the result",{"depth":57,"slug":907,"text":908},{"depth":57,"slug":1125,"text":1126},"what-happens-on-error","What happens on error?",{"depth":57,"slug":417,"text":418},[],[],{"title":1099,"description":1100},[],"getting-started/installation",{"id":1132,"data":1134,"body":1140,"filePath":1141,"digest":1142,"rendered":1143},{"title":1135,"description":1136,"editUrl":16,"head":1137,"template":46,"sidebar":1138,"pagefind":16,"draft":35},"Installation","Install awaitly and set up your project",[],{"hidden":35,"attrs":1139},{},"## Install the package\n\n```bash\nnpm install awaitly\n```\n\nOr with your preferred package manager:\n\n```bash\npnpm add awaitly\nyarn add awaitly\n```\n\n## TypeScript configuration\n\nThe library requires TypeScript 4.7 or later. Enable strict mode for best results:\n\n```json\n{\n  \"compilerOptions\": {\n    \"strict\": true,\n    \"moduleResolution\": \"bundler\"\n  }\n}\n```\n\n## Import paths\n\nImport from the main entry point:\n\n```typescript\nimport { ok, err, type AsyncResult } from 'awaitly';\nimport { createWorkflow } from 'awaitly/workflow';\n```\n\nOr use tree-shakable imports for smaller bundles:\n\n```typescript\n// Result types + run (~5KB)\nimport { ok, err, run, map, andThen } from 'awaitly';\n\n// Workflow orchestration\nimport { createWorkflow } from 'awaitly/workflow';\n\n// Visualization (~5KB)\nimport { createVisualizer } from 'awaitly/visualize';\n\n// Batch processing (~2KB)\nimport { processInBatches } from 'awaitly/batch';\n\n// Resource management (~1KB)\nimport { withScope, createResource } from 'awaitly/resource';\n```\n\n## Verify installation\n\nCreate a file and run it to verify everything works:\n\n```typescript\n// test.ts\nimport { ok, err, type AsyncResult } from 'awaitly';\n\nconst divide = (a: number, b: number): AsyncResult\u003Cnumber, 'DIVIDE_BY_ZERO'> =>\n  b === 0 ? err('DIVIDE_BY_ZERO') : ok(a / b);\n\nconst result = await divide(10, 2);\n\nif (result.ok) {\n  console.log('Result:', result.value); // Result: 5\n} else {\n  console.log('Error:', result.error);\n}\n```\n\n```bash\nnpx tsx test.ts\n```\n\n## Next\n\n[Build your first workflow →](/getting-started/first-workflow/)","src/content/docs/getting-started/installation.md","369aca35b075edc0",{"html":1144,"metadata":1145},"\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"install-the-package\">Install the package\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#install-the-package\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Install the package”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame is-terminal not-content\">\u003Cfigcaption class=\"header\">\u003Cspan class=\"title\">\u003C/span>\u003Cspan class=\"sr-only\">Terminal window\u003C/span>\u003C/figcaption>\u003Cpre data-language=\"bash\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">npm\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">install\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"npm install awaitly\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>Or with your preferred package manager:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame is-terminal not-content\">\u003Cfigcaption class=\"header\">\u003Cspan class=\"title\">\u003C/span>\u003Cspan class=\"sr-only\">Terminal window\u003C/span>\u003C/figcaption>\u003Cpre data-language=\"bash\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">pnpm\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">add\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">yarn\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">add\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"pnpm add awaitlyyarn add awaitly\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"typescript-configuration\">TypeScript configuration\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#typescript-configuration\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “TypeScript configuration”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>The library requires TypeScript 4.7 or later. Enable strict mode for best results:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"json\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965CD;--1:#786713FD\">\"\u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">compilerOptions\u003C/span>\u003Cspan style=\"--0:#B8A965CD;--1:#786713FD\">\"\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965CD;--1:#786713FD\">\"\u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">strict\u003C/span>\u003Cspan style=\"--0:#B8A965CD;--1:#786713FD\">\"\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965CD;--1:#786713FD\">\"\u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">moduleResolution\u003C/span>\u003Cspan style=\"--0:#B8A965CD;--1:#786713FD\">\"\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">\"\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">bundler\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">\"\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"{  &#x22;compilerOptions&#x22;: {    &#x22;strict&#x22;: true,    &#x22;moduleResolution&#x22;: &#x22;bundler&#x22;  }}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"import-paths\">Import paths\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#import-paths\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Import paths”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Import from the main entry point:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { ok, err, type AsyncResult } from &#x27;awaitly&#x27;;import { createWorkflow } from &#x27;awaitly/workflow&#x27;;\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>Or use tree-shakable imports for smaller bundles:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Result types + run (~5KB)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">run\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">map\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">andThen\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Workflow orchestration\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Visualization (~5KB)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createVisualizer\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/visualize\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Batch processing (~2KB)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">processInBatches\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/batch\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Resource management (~1KB)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">withScope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createResource\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/resource\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// Result types + run (~5KB)import { ok, err, run, map, andThen } from &#x27;awaitly&#x27;;// Workflow orchestrationimport { createWorkflow } from &#x27;awaitly/workflow&#x27;;// Visualization (~5KB)import { createVisualizer } from &#x27;awaitly/visualize&#x27;;// Batch processing (~2KB)import { processInBatches } from &#x27;awaitly/batch&#x27;;// Resource management (~1KB)import { withScope, createResource } from &#x27;awaitly/resource&#x27;;\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"verify-installation\">Verify installation\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#verify-installation\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Verify installation”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Create a file and run it to verify everything works:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame has-title not-content\">\u003Cfigcaption class=\"header\">\u003Cspan class=\"title\">test.ts\u003C/span>\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">divide\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">a\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">b\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">DIVIDE_BY_ZERO\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">b\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> === \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> ? \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">DIVIDE_BY_ZERO\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> : \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">a\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> / \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">b\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">divide\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">10\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Result:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Result: 5\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">else\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Error:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { ok, err, type AsyncResult } from &#x27;awaitly&#x27;;const divide = (a: number, b: number): AsyncResult\u003Cnumber, &#x27;DIVIDE_BY_ZERO&#x27;> =>  b === 0 ? err(&#x27;DIVIDE_BY_ZERO&#x27;) : ok(a / b);const result = await divide(10, 2);if (result.ok) {  console.log(&#x27;Result:&#x27;, result.value); // Result: 5} else {  console.log(&#x27;Error:&#x27;, result.error);}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame is-terminal not-content\">\u003Cfigcaption class=\"header\">\u003Cspan class=\"title\">\u003C/span>\u003Cspan class=\"sr-only\">Terminal window\u003C/span>\u003C/figcaption>\u003Cpre data-language=\"bash\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">npx\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">tsx\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">test.ts\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"npx tsx test.ts\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/getting-started/first-workflow/\">Build your first workflow →\u003C/a>\u003C/p>",{"headings":1146,"localImagePaths":1160,"remoteImagePaths":1161,"frontmatter":1162,"imagePaths":1163},[1147,1150,1153,1156,1159],{"depth":57,"slug":1148,"text":1149},"install-the-package","Install the package",{"depth":57,"slug":1151,"text":1152},"typescript-configuration","TypeScript configuration",{"depth":57,"slug":1154,"text":1155},"import-paths","Import paths",{"depth":57,"slug":1157,"text":1158},"verify-installation","Verify installation",{"depth":57,"slug":417,"text":418},[],[],{"title":1135,"description":1136},[],"patterns/checkout-flow",{"id":1164,"data":1166,"body":1172,"filePath":1173,"digest":1174,"rendered":1175},{"title":1167,"description":1168,"editUrl":16,"head":1169,"template":46,"sidebar":1170,"pagefind":16,"draft":35},"Checkout Flow","A complete e-commerce checkout workflow",[],{"hidden":35,"attrs":1171},{},"A checkout workflow demonstrating validation, payment, and order creation with typed errors.\n\n## Define the operations\n\n```typescript\nimport { ok, err, type AsyncResult } from 'awaitly';\n\ntype CartItem = { productId: string; quantity: number; price: number };\ntype Order = { id: string; items: CartItem[]; total: number };\ntype Payment = { transactionId: string; amount: number };\n\nconst validateCart = async (\n  items: CartItem[]\n): AsyncResult\u003CCartItem[], 'EMPTY_CART' | 'INVALID_QUANTITY'> => {\n  if (items.length === 0) return err('EMPTY_CART');\n  if (items.some((i) => i.quantity \u003C= 0)) return err('INVALID_QUANTITY');\n  return ok(items);\n};\n\nconst checkInventory = async (\n  items: CartItem[]\n): AsyncResult\u003CCartItem[], 'OUT_OF_STOCK'> => {\n  // Check each item against inventory\n  const available = await Promise.all(\n    items.map((item) => inventory.check(item.productId, item.quantity))\n  );\n  if (available.some((a) => !a)) return err('OUT_OF_STOCK');\n  return ok(items);\n};\n\nconst calculateTotal = async (\n  items: CartItem[]\n): AsyncResult\u003Cnumber, 'PRICING_ERROR'> => {\n  try {\n    const total = items.reduce((sum, item) => sum + item.price * item.quantity, 0);\n    return ok(total);\n  } catch {\n    return err('PRICING_ERROR');\n  }\n};\n\nconst processPayment = async (\n  amount: number,\n  paymentMethod: string\n): AsyncResult\u003CPayment, 'PAYMENT_DECLINED' | 'PAYMENT_ERROR'> => {\n  const result = await paymentProvider.charge(amount, paymentMethod);\n  if (result.declined) return err('PAYMENT_DECLINED');\n  if (result.error) return err('PAYMENT_ERROR');\n  return ok({ transactionId: result.id, amount });\n};\n\nconst createOrder = async (\n  items: CartItem[],\n  payment: Payment\n): AsyncResult\u003COrder, 'ORDER_CREATION_FAILED'> => {\n  try {\n    const order = await db.orders.create({\n      items,\n      total: payment.amount,\n      paymentId: payment.transactionId,\n    });\n    return ok(order);\n  } catch {\n    return err('ORDER_CREATION_FAILED');\n  }\n};\n```\n\n## Create the workflow\n\n```typescript\nimport { createWorkflow } from 'awaitly/workflow';\n\nconst checkout = createWorkflow({\n  validateCart,\n  checkInventory,\n  calculateTotal,\n  processPayment,\n  createOrder,\n});\n```\n\n## Execute\n\n```typescript\nconst result = await checkout(async (step) => {\n  // Validate and check inventory\n  const validItems = await step(validateCart(cartItems));\n  const availableItems = await step(checkInventory(validItems));\n\n  // Calculate and charge\n  const total = await step(calculateTotal(availableItems));\n  const payment = await step(processPayment(total, paymentMethodId));\n\n  // Create order\n  const order = await step(createOrder(availableItems, payment));\n\n  return order;\n});\n```\n\n## Handle errors\n\n```typescript\nif (result.ok) {\n  return res.json({ orderId: result.value.id });\n}\n\nswitch (result.error) {\n  case 'EMPTY_CART':\n    return res.status(400).json({ error: 'Cart is empty' });\n  case 'INVALID_QUANTITY':\n    return res.status(400).json({ error: 'Invalid quantity' });\n  case 'OUT_OF_STOCK':\n    return res.status(409).json({ error: 'Some items are out of stock' });\n  case 'PRICING_ERROR':\n    return res.status(500).json({ error: 'Failed to calculate price' });\n  case 'PAYMENT_DECLINED':\n    return res.status(402).json({ error: 'Payment was declined' });\n  case 'PAYMENT_ERROR':\n    return res.status(502).json({ error: 'Payment provider error' });\n  case 'ORDER_CREATION_FAILED':\n    return res.status(500).json({ error: 'Failed to create order' });\n  default:\n    // UnexpectedError\n    console.error(result.error);\n    return res.status(500).json({ error: 'Internal error' });\n}\n```\n\n## With retries and visualization\n\n```typescript\nimport { createVisualizer } from 'awaitly/visualize';\n\nconst viz = createVisualizer({ workflowName: 'checkout' });\n\nconst checkout = createWorkflow(deps, {\n  onEvent: viz.handleEvent,\n});\n\nconst result = await checkout(async (step) => {\n  const validItems = await step(\n    () => validateCart(cartItems),\n    { name: 'Validate cart' }\n  );\n\n  const availableItems = await step(\n    () => checkInventory(validItems),\n    { name: 'Check inventory' }\n  );\n\n  const total = await step(\n    () => calculateTotal(availableItems),\n    { name: 'Calculate total' }\n  );\n\n  // Retry payment with exponential backoff\n  const payment = await step.retry(\n    () => processPayment(total, paymentMethodId),\n    {\n      attempts: 3,\n      backoff: 'exponential',\n      delayMs: 500,\n      retryOn: (error) => error === 'PAYMENT_ERROR', // Don't retry declined\n    }\n  );\n\n  const order = await step(\n    () => createOrder(availableItems, payment),\n    { name: 'Create order' }\n  );\n\n  return order;\n});\n\n// Log visualization\nconsole.log(viz.render());\n```\n\n## With idempotency\n\nUse keys to make the workflow resumable:\n\n```typescript\nconst result = await checkout(async (step) => {\n  const validItems = await step(\n    () => validateCart(cartItems),\n    { key: `validate:${sessionId}` }\n  );\n\n  const availableItems = await step(\n    () => checkInventory(validItems),\n    { key: `inventory:${sessionId}` }\n  );\n\n  const total = await step(\n    () => calculateTotal(availableItems),\n    { key: `total:${sessionId}` }\n  );\n\n  // Critical: payment with idempotency key\n  const payment = await step(\n    () => processPayment(total, paymentMethodId),\n    { key: `payment:${idempotencyKey}` }\n  );\n\n  const order = await step(\n    () => createOrder(availableItems, payment),\n    { key: `order:${idempotencyKey}` }\n  );\n\n  return order;\n});\n```\n\nIf the workflow crashes after payment but before order creation, rerunning with the same `idempotencyKey` returns the cached payment instead of charging again.","src/content/docs/patterns/checkout-flow.md","2d3cb504717d4713",{"html":1176,"metadata":1177},"\u003Cp>A checkout workflow demonstrating validation, payment, and order creation with typed errors.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"define-the-operations\">Define the operations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#define-the-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Define the operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">CartItem\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">productId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">quantity\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">price\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Order\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">CartItem\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[];\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">total\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Payment\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">transactionId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">validateCart\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">CartItem\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">CartItem\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[],\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">EMPTY_CART\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">|\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">INVALID_QUANTITY\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">length\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> === \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">EMPTY_CART\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">some\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">((\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">i\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">i\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">quantity\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">INVALID_QUANTITY\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">checkInventory\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">CartItem\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">CartItem\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[],\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">OUT_OF_STOCK\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Check each item against inventory\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">available\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">Promise\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">all\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">map\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">((\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">item\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">inventory\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">check\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">item\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">productId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">item\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">quantity\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">available\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">some\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">((\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">a\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> !\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">a\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">OUT_OF_STOCK\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">calculateTotal\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">CartItem\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">PRICING_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">try\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">total\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">reduce\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">((\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">sum\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">item\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">sum\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> + \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">item\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">price\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> * \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">item\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">quantity\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">total\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">catch\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">PRICING_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processPayment\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">paymentMethod\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">PAYMENT_DECLINED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">|\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">PAYMENT_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">paymentProvider\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">paymentMethod\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">declined\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">PAYMENT_DECLINED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">PAYMENT_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">transactionId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createOrder\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">CartItem\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[],\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Payment\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">ORDER_CREATION_FAILED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">try\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">orders\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">create\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">total\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">paymentId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">transactionId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">catch\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">ORDER_CREATION_FAILED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { ok, err, type AsyncResult } from &#x27;awaitly&#x27;;type CartItem = { productId: string; quantity: number; price: number };type Order = { id: string; items: CartItem[]; total: number };type Payment = { transactionId: string; amount: number };const validateCart = async (  items: CartItem[]): AsyncResult\u003CCartItem[], &#x27;EMPTY_CART&#x27; | &#x27;INVALID_QUANTITY&#x27;> => {  if (items.length === 0) return err(&#x27;EMPTY_CART&#x27;);  if (items.some((i) => i.quantity \u003C= 0)) return err(&#x27;INVALID_QUANTITY&#x27;);  return ok(items);};const checkInventory = async (  items: CartItem[]): AsyncResult\u003CCartItem[], &#x27;OUT_OF_STOCK&#x27;> => {  // Check each item against inventory  const available = await Promise.all(    items.map((item) => inventory.check(item.productId, item.quantity))  );  if (available.some((a) => !a)) return err(&#x27;OUT_OF_STOCK&#x27;);  return ok(items);};const calculateTotal = async (  items: CartItem[]): AsyncResult\u003Cnumber, &#x27;PRICING_ERROR&#x27;> => {  try {    const total = items.reduce((sum, item) => sum + item.price * item.quantity, 0);    return ok(total);  } catch {    return err(&#x27;PRICING_ERROR&#x27;);  }};const processPayment = async (  amount: number,  paymentMethod: string): AsyncResult\u003CPayment, &#x27;PAYMENT_DECLINED&#x27; | &#x27;PAYMENT_ERROR&#x27;> => {  const result = await paymentProvider.charge(amount, paymentMethod);  if (result.declined) return err(&#x27;PAYMENT_DECLINED&#x27;);  if (result.error) return err(&#x27;PAYMENT_ERROR&#x27;);  return ok({ transactionId: result.id, amount });};const createOrder = async (  items: CartItem[],  payment: Payment): AsyncResult\u003COrder, &#x27;ORDER_CREATION_FAILED&#x27;> => {  try {    const order = await db.orders.create({      items,      total: payment.amount,      paymentId: payment.transactionId,    });    return ok(order);  } catch {    return err(&#x27;ORDER_CREATION_FAILED&#x27;);  }};\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"create-the-workflow\">Create the workflow\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#create-the-workflow\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Create the workflow”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">checkout\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">validateCart\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">checkInventory\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">calculateTotal\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">processPayment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createOrder\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createWorkflow } from &#x27;awaitly/workflow&#x27;;const checkout = createWorkflow({  validateCart,  checkInventory,  calculateTotal,  processPayment,  createOrder,});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"execute\">Execute\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#execute\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Execute”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">checkout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Validate and check inventory\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">validItems\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">validateCart\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cartItems\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">availableItems\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">checkInventory\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">validItems\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Calculate and charge\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">total\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">calculateTotal\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">availableItems\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processPayment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">total\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">paymentMethodId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create order\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createOrder\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">availableItems\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await checkout(async (step) => {  // Validate and check inventory  const validItems = await step(validateCart(cartItems));  const availableItems = await step(checkInventory(validItems));  // Calculate and charge  const total = await step(calculateTotal(availableItems));  const payment = await step(processPayment(total, paymentMethodId));  // Create order  const order = await step(createOrder(availableItems, payment));  return order;});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"handle-errors\">Handle errors\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#handle-errors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Handle errors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">orderId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">switch\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">case\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">EMPTY_CART\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">400\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Cart is empty\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">case\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">INVALID_QUANTITY\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">400\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Invalid quantity\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">case\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">OUT_OF_STOCK\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">409\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Some items are out of stock\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">case\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">PRICING_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">500\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Failed to calculate price\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">case\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">PAYMENT_DECLINED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">402\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Payment was declined\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">case\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">PAYMENT_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">502\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Payment provider error\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">case\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">ORDER_CREATION_FAILED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">500\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Failed to create order\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">default\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// UnexpectedError\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">res\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">500\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Internal error\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"if (result.ok) {  return res.json({ orderId: result.value.id });}switch (result.error) {  case &#x27;EMPTY_CART&#x27;:    return res.status(400).json({ error: &#x27;Cart is empty&#x27; });  case &#x27;INVALID_QUANTITY&#x27;:    return res.status(400).json({ error: &#x27;Invalid quantity&#x27; });  case &#x27;OUT_OF_STOCK&#x27;:    return res.status(409).json({ error: &#x27;Some items are out of stock&#x27; });  case &#x27;PRICING_ERROR&#x27;:    return res.status(500).json({ error: &#x27;Failed to calculate price&#x27; });  case &#x27;PAYMENT_DECLINED&#x27;:    return res.status(402).json({ error: &#x27;Payment was declined&#x27; });  case &#x27;PAYMENT_ERROR&#x27;:    return res.status(502).json({ error: &#x27;Payment provider error&#x27; });  case &#x27;ORDER_CREATION_FAILED&#x27;:    return res.status(500).json({ error: &#x27;Failed to create order&#x27; });  default:    // UnexpectedError    console.error(result.error);    return res.status(500).json({ error: &#x27;Internal error&#x27; });}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"with-retries-and-visualization\">With retries and visualization\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#with-retries-and-visualization\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “With retries and visualization”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createVisualizer\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/visualize\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">viz\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createVisualizer\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">workflowName\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">checkout\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">checkout\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">viz\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">checkout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">validItems\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">validateCart\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cartItems\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Validate cart\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">availableItems\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">checkInventory\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">validItems\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Check inventory\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">total\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">calculateTotal\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">availableItems\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Calculate total\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Retry payment with exponential backoff\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processPayment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">total\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">paymentMethodId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">attempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">backoff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">exponential\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">delayMs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">500\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retryOn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">===\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">PAYMENT_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Don't retry declined\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createOrder\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">availableItems\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Create order\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Log visualization\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">viz\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">render\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createVisualizer } from &#x27;awaitly/visualize&#x27;;const viz = createVisualizer({ workflowName: &#x27;checkout&#x27; });const checkout = createWorkflow(deps, {  onEvent: viz.handleEvent,});const result = await checkout(async (step) => {  const validItems = await step(    () => validateCart(cartItems),    { name: &#x27;Validate cart&#x27; }  );  const availableItems = await step(    () => checkInventory(validItems),    { name: &#x27;Check inventory&#x27; }  );  const total = await step(    () => calculateTotal(availableItems),    { name: &#x27;Calculate total&#x27; }  );  // Retry payment with exponential backoff  const payment = await step.retry(    () => processPayment(total, paymentMethodId),    {      attempts: 3,      backoff: &#x27;exponential&#x27;,      delayMs: 500,      retryOn: (error) => error === &#x27;PAYMENT_ERROR&#x27;, // Don&#x27;t retry declined    }  );  const order = await step(    () => createOrder(availableItems, payment),    { name: &#x27;Create order&#x27; }  );  return order;});// Log visualizationconsole.log(viz.render());\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"with-idempotency\">With idempotency\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#with-idempotency\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “With idempotency”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use keys to make the workflow resumable:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">checkout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">validItems\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">validateCart\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cartItems\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">validate:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">sessionId\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">availableItems\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">checkInventory\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">validItems\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">inventory:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">sessionId\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">total\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">calculateTotal\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">availableItems\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">total:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">sessionId\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Critical: payment with idempotency key\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processPayment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">total\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">paymentMethodId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">payment:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">idempotencyKey\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createOrder\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">availableItems\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">order:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">idempotencyKey\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await checkout(async (step) => {  const validItems = await step(    () => validateCart(cartItems),    { key: &#x60;validate:${sessionId}&#x60; }  );  const availableItems = await step(    () => checkInventory(validItems),    { key: &#x60;inventory:${sessionId}&#x60; }  );  const total = await step(    () => calculateTotal(availableItems),    { key: &#x60;total:${sessionId}&#x60; }  );  // Critical: payment with idempotency key  const payment = await step(    () => processPayment(total, paymentMethodId),    { key: &#x60;payment:${idempotencyKey}&#x60; }  );  const order = await step(    () => createOrder(availableItems, payment),    { key: &#x60;order:${idempotencyKey}&#x60; }  );  return order;});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>If the workflow crashes after payment but before order creation, rerunning with the same \u003Ccode dir=\"auto\">idempotencyKey\u003C/code> returns the cached payment instead of charging again.\u003C/p>",{"headings":1178,"localImagePaths":1195,"remoteImagePaths":1196,"frontmatter":1197,"imagePaths":1198},[1179,1182,1183,1186,1189,1192],{"depth":57,"slug":1180,"text":1181},"define-the-operations","Define the operations",{"depth":57,"slug":1115,"text":1116},{"depth":57,"slug":1184,"text":1185},"execute","Execute",{"depth":57,"slug":1187,"text":1188},"handle-errors","Handle errors",{"depth":57,"slug":1190,"text":1191},"with-retries-and-visualization","With retries and visualization",{"depth":57,"slug":1193,"text":1194},"with-idempotency","With idempotency",[],[],{"title":1167,"description":1168},[],"patterns/error-recovery",{"id":1199,"data":1201,"body":1207,"filePath":1208,"digest":1209,"rendered":1210},{"title":1202,"description":1203,"editUrl":16,"head":1204,"template":46,"sidebar":1205,"pagefind":16,"draft":35},"Error Recovery Trade-offs","When to use retry vs circuit breaker vs saga compensation",[],{"hidden":35,"attrs":1206},{},"Different error recovery patterns solve different problems. Choosing the wrong one can make things worse.\n\n## The Decision Matrix\n\n| Failure Type | Pattern | Why |\n|--------------|---------|-----|\n| Transient (network blip, timeout) | **Retry** | Likely to succeed on next attempt |\n| Downstream overload | **Circuit Breaker** | Stop hammering failing services |\n| Partial completion (multi-step) | **Saga** | Undo completed steps |\n| Rate limit exceeded | **Rate Limiter** | Prevent hitting limits |\n| Permanent (validation, not found) | **Return error** | Retrying won't help |\n\n## Retry\n\n**Use when:** Failures are transient and likely to self-resolve.\n\n```typescript\nimport { createWorkflow } from 'awaitly/workflow';\n\nconst workflow = createWorkflow(deps);\nconst result = await workflow(async (step) => {\n  const data = await step.retry(\n    () => fetchFromAPI(),\n    {\n      maxAttempts: 3,\n      backoff: 'exponential',\n      baseDelay: 100,\n      shouldRetry: (error) => error === 'TIMEOUT' || error === 'CONNECTION_ERROR',\n    }\n  );\n  return data;\n});\n```\n\n**Good for:**\n- Network timeouts\n- Connection resets\n- Brief service unavailability\n- Rate limit with `Retry-After` header\n\n**Bad for:**\n- Validation errors (won't change on retry)\n- Authentication failures\n- Resource not found\n- Downstream service overload (makes it worse)\n\n**Failure mode:** If retries exhaust, you get the last error. No cleanup of partial state.\n\n## Circuit Breaker\n\n**Use when:** A downstream service is failing repeatedly and retrying makes things worse.\n\n```typescript\nimport { createCircuitBreaker, isCircuitOpenError } from 'awaitly/circuit-breaker';\n\nconst paymentBreaker = createCircuitBreaker('payment-api', {\n  failureThreshold: 5,     // Open after 5 failures\n  resetTimeMs: 30000,      // Try again after 30s\n  halfOpenAttempts: 2,     // Test with 2 requests before closing\n});\n\nconst result = await paymentBreaker.call(() => paymentAPI.charge(amount));\n\nif (!result.ok && isCircuitOpenError(result.error)) {\n  // Fail fast - don't even try to call the API\n  return err('SERVICE_UNAVAILABLE');\n}\n```\n\n**Good for:**\n- Protecting degraded services from more load\n- Failing fast when a dependency is down\n- Giving downstream services time to recover\n\n**Bad for:**\n- Transient failures (use retry instead)\n- Single critical operations (use retry with backoff)\n- Operations that must succeed eventually\n\n**Failure mode:** When circuit is open, ALL requests fail immediately. Plan for degraded functionality.\n\n## Saga (Compensation)\n\n**Use when:** A multi-step operation fails partway through and you need to undo completed steps.\n\n```typescript\nimport { createSagaWorkflow } from 'awaitly/workflow';\n\nconst checkout = createSagaWorkflow(deps);\nconst result = await checkout(async (saga) => {\n  const payment = await saga.step(\n    () => chargeCard(amount),\n    { name: 'charge', compensate: (p) => refundCard(p.id) }\n  );\n\n  const reservation = await saga.step(\n    () => reserveInventory(items),\n    { name: 'reserve', compensate: (r) => releaseInventory(r.id) }\n  );\n\n  const order = await saga.step(\n    () => createOrder({ payment, reservation }),\n    { name: 'order', compensate: (o) => cancelOrder(o.id) }\n  );\n\n  return order;\n});\n// If createOrder fails, reservation is released, then payment is refunded (LIFO)\n```\n\n**Good for:**\n- Financial transactions (charge → reserve → fulfill)\n- Multi-service orchestration\n- Operations with external side effects\n\n**Bad for:**\n- Single-step operations (no need for compensation)\n- Operations that can't be undone (sent emails, published events)\n- Pure data transformations\n\n**Failure mode:** Compensation itself can fail. Design compensations to be idempotent and handle the case where compensation errors require manual intervention.\n\n## Combining Patterns\n\nPatterns compose. The key is ordering them correctly:\n\n### Retry inside Saga step\n\n```typescript\n// Good: Retry is scoped to one step\nconst payment = await saga.step(\n  () => retry(() => chargeCard(amount), { maxAttempts: 3 }),\n  { compensate: (p) => refundCard(p.id) }\n);\n```\n\n### Circuit Breaker wrapping Retry\n\n```typescript\n// Good: Circuit breaker prevents retry storms\nconst breaker = createCircuitBreaker('payment-api', config);\n\nconst result = await breaker.call(\n  () => retry(() => paymentAPI.charge(), { maxAttempts: 3 })\n);\n```\n\n### Rate Limiter at the outer layer\n\n```typescript\n// Good: Rate limiter prevents exceeding quotas\nconst limiter = createRateLimiter('payment-api', { maxRequests: 100, windowMs: 60000 });\n\nconst result = await limiter.call(\n  () => breaker.call(\n    () => retry(() => paymentAPI.charge(), { maxAttempts: 3 })\n  )\n);\n```\n\n## Anti-patterns\n\n### Retrying non-transient errors\n\n```typescript\n// Bad: Validation errors won't change on retry\nawait retry(\n  () => createUser({ email: 'invalid' }),\n  { maxAttempts: 3 }  // Wastes 3 attempts\n);\n\n// Good: Only retry transient errors\nawait retry(\n  () => createUser({ email }),\n  {\n    maxAttempts: 3,\n    shouldRetry: (error) => error === 'TIMEOUT' || error === 'CONNECTION_ERROR',\n  }\n);\n```\n\n### Retrying when downstream is overloaded\n\n```typescript\n// Bad: Makes overload worse\nfor (const user of users) {\n  await retry(() => notifyUser(user), { maxAttempts: 10 });\n}\n\n// Good: Circuit breaker protects the service\nconst breaker = createCircuitBreaker('notification-service', config);\nfor (const user of users) {\n  const result = await breaker.call(() => notifyUser(user));\n  if (isCircuitOpenError(result.error)) break; // Stop when circuit opens\n}\n```\n\n### Saga without idempotent compensations\n\n```typescript\n// Bad: Compensation can double-refund\ncompensate: (payment) => refundCard(payment.id)\n\n// Good: Idempotent compensation\ncompensate: async (payment) => {\n  const existing = await getRefund(payment.id);\n  if (existing) return ok(existing); // Already refunded\n  return refundCard(payment.id, { idempotencyKey: `refund-${payment.id}` });\n}\n```\n\n## When Each Pattern Fails\n\n| Pattern | Failure Mode | Mitigation |\n|---------|--------------|------------|\n| Retry | Exhausts attempts, returns last error | Add circuit breaker, adjust attempt count |\n| Circuit Breaker | All requests fail when open | Provide fallback, monitor for flapping |\n| Saga | Compensation can fail | Make compensations idempotent, alert on failure |\n| Rate Limiter | Requests queued or rejected | Increase limits, add backpressure |\n\n## The Right Questions\n\nBefore choosing a pattern, ask:\n\n1. **Is this error transient?** → Retry\n2. **Is the downstream service healthy?** → If no, Circuit Breaker\n3. **Did I create side effects I need to undo?** → Saga\n4. **Am I at risk of hitting rate limits?** → Rate Limiter\n5. **Is this a permanent error?** → Just return it\n\n## Example: Full Stack\n\n```typescript\nimport { createCircuitBreaker } from 'awaitly/circuit-breaker';\nimport { createRateLimiter } from 'awaitly/ratelimit';\nimport { createSagaWorkflow } from 'awaitly/workflow';\n\nconst paymentBreaker = createCircuitBreaker('payment-api', { failureThreshold: 5 });\nconst paymentLimiter = createRateLimiter('payment-api', { maxRequests: 100, windowMs: 60000 });\n\nconst checkout = createSagaWorkflow(deps);\n\nconst result = await checkout(async (saga) => {\n  // Step 1: Charge with retry + circuit breaker + rate limiting\n  const payment = await saga.step(\n    async () => {\n      return paymentLimiter.call(() =>\n        paymentBreaker.call(() =>\n          retry(() => chargeCard(amount), {\n            maxAttempts: 3,\n            shouldRetry: (e) => e === 'TIMEOUT',\n          })\n        )\n      );\n    },\n    { name: 'charge', compensate: (p) => refundCard(p.id) }\n  );\n\n  // Step 2: Reserve (simpler, internal service)\n  const reservation = await saga.step(\n    () => reserveInventory(items),\n    { name: 'reserve', compensate: (r) => releaseInventory(r.id) }\n  );\n\n  return { payment, reservation };\n});\n```\n\nThis stack provides:\n- **Rate limiting** prevents quota exhaustion\n- **Circuit breaker** protects failing services\n- **Retry** handles transient errors\n- **Saga** rolls back on partial failure","src/content/docs/patterns/error-recovery.md","bb0583f5187ca38c",{"html":1211,"metadata":1212},"\u003Cp>Different error recovery patterns solve different problems. Choosing the wrong one can make things worse.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"the-decision-matrix\">The Decision Matrix\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#the-decision-matrix\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “The Decision Matrix”\u003C/span>\u003C/a>\u003C/div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Failure Type\u003C/th>\u003Cth>Pattern\u003C/th>\u003Cth>Why\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Transient (network blip, timeout)\u003C/td>\u003Ctd>\u003Cstrong>Retry\u003C/strong>\u003C/td>\u003Ctd>Likely to succeed on next attempt\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Downstream overload\u003C/td>\u003Ctd>\u003Cstrong>Circuit Breaker\u003C/strong>\u003C/td>\u003Ctd>Stop hammering failing services\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Partial completion (multi-step)\u003C/td>\u003Ctd>\u003Cstrong>Saga\u003C/strong>\u003C/td>\u003Ctd>Undo completed steps\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Rate limit exceeded\u003C/td>\u003Ctd>\u003Cstrong>Rate Limiter\u003C/strong>\u003C/td>\u003Ctd>Prevent hitting limits\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Permanent (validation, not found)\u003C/td>\u003Ctd>\u003Cstrong>Return error\u003C/strong>\u003C/td>\u003Ctd>Retrying won’t help\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"retry\">Retry\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#retry\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Retry”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Cstrong>Use when:\u003C/strong> Failures are transient and likely to self-resolve.\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchFromAPI\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxAttempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">backoff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">exponential\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">baseDelay\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">100\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">shouldRetry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">===\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">TIMEOUT\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">||\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">===\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">CONNECTION_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createWorkflow } from &#x27;awaitly/workflow&#x27;;const workflow = createWorkflow(deps);const result = await workflow(async (step) => {  const data = await step.retry(    () => fetchFromAPI(),    {      maxAttempts: 3,      backoff: &#x27;exponential&#x27;,      baseDelay: 100,      shouldRetry: (error) => error === &#x27;TIMEOUT&#x27; || error === &#x27;CONNECTION_ERROR&#x27;,    }  );  return data;});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>\u003Cstrong>Good for:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Network timeouts\u003C/li>\n\u003Cli>Connection resets\u003C/li>\n\u003Cli>Brief service unavailability\u003C/li>\n\u003Cli>Rate limit with \u003Ccode dir=\"auto\">Retry-After\u003C/code> header\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Bad for:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Validation errors (won’t change on retry)\u003C/li>\n\u003Cli>Authentication failures\u003C/li>\n\u003Cli>Resource not found\u003C/li>\n\u003Cli>Downstream service overload (makes it worse)\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Failure mode:\u003C/strong> If retries exhaust, you get the last error. No cleanup of partial state.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"circuit-breaker\">Circuit Breaker\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#circuit-breaker\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Circuit Breaker”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Cstrong>Use when:\u003C/strong> A downstream service is failing repeatedly and retrying makes things worse.\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createCircuitBreaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isCircuitOpenError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/circuit-breaker\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">paymentBreaker\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createCircuitBreaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">payment-api\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">failureThreshold\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Open after 5 failures\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">resetTimeMs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">30000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Try again after 30s\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">halfOpenAttempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Test with 2 requests before closing\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">paymentBreaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">call\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">paymentAPI\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">&#x26;&#x26;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isCircuitOpenError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Fail fast - don't even try to call the API\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">SERVICE_UNAVAILABLE\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createCircuitBreaker, isCircuitOpenError } from &#x27;awaitly/circuit-breaker&#x27;;const paymentBreaker = createCircuitBreaker(&#x27;payment-api&#x27;, {  failureThreshold: 5,     // Open after 5 failures  resetTimeMs: 30000,      // Try again after 30s  halfOpenAttempts: 2,     // Test with 2 requests before closing});const result = await paymentBreaker.call(() => paymentAPI.charge(amount));if (!result.ok &#x26;&#x26; isCircuitOpenError(result.error)) {  // Fail fast - don&#x27;t even try to call the API  return err(&#x27;SERVICE_UNAVAILABLE&#x27;);}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>\u003Cstrong>Good for:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Protecting degraded services from more load\u003C/li>\n\u003Cli>Failing fast when a dependency is down\u003C/li>\n\u003Cli>Giving downstream services time to recover\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Bad for:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Transient failures (use retry instead)\u003C/li>\n\u003Cli>Single critical operations (use retry with backoff)\u003C/li>\n\u003Cli>Operations that must succeed eventually\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Failure mode:\u003C/strong> When circuit is open, ALL requests fail immediately. Plan for degraded functionality.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"saga-compensation\">Saga (Compensation)\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#saga-compensation\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Saga (Compensation)”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Cstrong>Use when:\u003C/strong> A multi-step operation fails partway through and you need to undo completed steps.\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createSagaWorkflow\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">checkout\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createSagaWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">checkout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">charge\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">compensate\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">refundCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reservation\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">reserveInventory\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">reserve\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">compensate\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">r\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">releaseInventory\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">r\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createOrder\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reservation\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">order\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">compensate\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">o\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">cancelOrder\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">o\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// If createOrder fails, reservation is released, then payment is refunded (LIFO)\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createSagaWorkflow } from &#x27;awaitly/workflow&#x27;;const checkout = createSagaWorkflow(deps);const result = await checkout(async (saga) => {  const payment = await saga.step(    () => chargeCard(amount),    { name: &#x27;charge&#x27;, compensate: (p) => refundCard(p.id) }  );  const reservation = await saga.step(    () => reserveInventory(items),    { name: &#x27;reserve&#x27;, compensate: (r) => releaseInventory(r.id) }  );  const order = await saga.step(    () => createOrder({ payment, reservation }),    { name: &#x27;order&#x27;, compensate: (o) => cancelOrder(o.id) }  );  return order;});// If createOrder fails, reservation is released, then payment is refunded (LIFO)\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>\u003Cstrong>Good for:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Financial transactions (charge → reserve → fulfill)\u003C/li>\n\u003Cli>Multi-service orchestration\u003C/li>\n\u003Cli>Operations with external side effects\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Bad for:\u003C/strong>\u003C/p>\n\u003Cul>\n\u003Cli>Single-step operations (no need for compensation)\u003C/li>\n\u003Cli>Operations that can’t be undone (sent emails, published events)\u003C/li>\n\u003Cli>Pure data transformations\u003C/li>\n\u003C/ul>\n\u003Cp>\u003Cstrong>Failure mode:\u003C/strong> Compensation itself can fail. Design compensations to be idempotent and handle the case where compensation errors require manual intervention.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"combining-patterns\">Combining Patterns\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#combining-patterns\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Combining Patterns”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Patterns compose. The key is ordering them correctly:\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"retry-inside-saga-step\">Retry inside Saga step\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#retry-inside-saga-step\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Retry inside Saga step”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Good: Retry is scoped to one step\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxAttempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">compensate\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">refundCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// Good: Retry is scoped to one stepconst payment = await saga.step(  () => retry(() => chargeCard(amount), { maxAttempts: 3 }),  { compensate: (p) => refundCard(p.id) });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"circuit-breaker-wrapping-retry\">Circuit Breaker wrapping Retry\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#circuit-breaker-wrapping-retry\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Circuit Breaker wrapping Retry”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Good: Circuit breaker prevents retry storms\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">breaker\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createCircuitBreaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">payment-api\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">config\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">breaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">call\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">paymentAPI\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxAttempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// Good: Circuit breaker prevents retry stormsconst breaker = createCircuitBreaker(&#x27;payment-api&#x27;, config);const result = await breaker.call(  () => retry(() => paymentAPI.charge(), { maxAttempts: 3 }));\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"rate-limiter-at-the-outer-layer\">Rate Limiter at the outer layer\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#rate-limiter-at-the-outer-layer\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Rate Limiter at the outer layer”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Good: Rate limiter prevents exceeding quotas\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">limiter\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createRateLimiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">payment-api\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxRequests\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">100\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">windowMs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">60000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">limiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">call\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">breaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">call\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">paymentAPI\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxAttempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// Good: Rate limiter prevents exceeding quotasconst limiter = createRateLimiter(&#x27;payment-api&#x27;, { maxRequests: 100, windowMs: 60000 });const result = await limiter.call(  () => breaker.call(    () => retry(() => paymentAPI.charge(), { maxAttempts: 3 })  ));\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"anti-patterns\">Anti-patterns\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#anti-patterns\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Anti-patterns”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"retrying-non-transient-errors\">Retrying non-transient errors\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#retrying-non-transient-errors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Retrying non-transient errors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Bad: Validation errors won't change on retry\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">email\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">invalid\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxAttempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Wastes 3 attempts\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Good: Only retry transient errors\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">email\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxAttempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">shouldRetry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">===\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">TIMEOUT\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">||\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">===\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">CONNECTION_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// Bad: Validation errors won&#x27;t change on retryawait retry(  () => createUser({ email: &#x27;invalid&#x27; }),  { maxAttempts: 3 }  // Wastes 3 attempts);// Good: Only retry transient errorsawait retry(  () => createUser({ email }),  {    maxAttempts: 3,    shouldRetry: (error) => error === &#x27;TIMEOUT&#x27; || error === &#x27;CONNECTION_ERROR&#x27;,  });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"retrying-when-downstream-is-overloaded\">Retrying when downstream is overloaded\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#retrying-when-downstream-is-overloaded\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Retrying when downstream is overloaded”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Bad: Makes overload worse\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">for\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> of\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">users\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">notifyUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxAttempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">10\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Good: Circuit breaker protects the service\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">breaker\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createCircuitBreaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">notification-service\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">config\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">for\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> of\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">users\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">breaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">call\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">notifyUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isCircuitOpenError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">break\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Stop when circuit opens\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// Bad: Makes overload worsefor (const user of users) {  await retry(() => notifyUser(user), { maxAttempts: 10 });}// Good: Circuit breaker protects the serviceconst breaker = createCircuitBreaker(&#x27;notification-service&#x27;, config);for (const user of users) {  const result = await breaker.call(() => notifyUser(user));  if (isCircuitOpenError(result.error)) break; // Stop when circuit opens}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"saga-without-idempotent-compensations\">Saga without idempotent compensations\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#saga-without-idempotent-compensations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Saga without idempotent compensations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Bad: Compensation can double-refund\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">compensate\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">refundCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Good: Idempotent compensation\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">compensate\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">existing\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getRefund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">existing\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">existing\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Already refunded\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">refundCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">idempotencyKey\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">refund-\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">id\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// Bad: Compensation can double-refundcompensate: (payment) => refundCard(payment.id)// Good: Idempotent compensationcompensate: async (payment) => {  const existing = await getRefund(payment.id);  if (existing) return ok(existing); // Already refunded  return refundCard(payment.id, { idempotencyKey: &#x60;refund-${payment.id}&#x60; });}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"when-each-pattern-fails\">When Each Pattern Fails\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#when-each-pattern-fails\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “When Each Pattern Fails”\u003C/span>\u003C/a>\u003C/div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Pattern\u003C/th>\u003Cth>Failure Mode\u003C/th>\u003Cth>Mitigation\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Retry\u003C/td>\u003Ctd>Exhausts attempts, returns last error\u003C/td>\u003Ctd>Add circuit breaker, adjust attempt count\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Circuit Breaker\u003C/td>\u003Ctd>All requests fail when open\u003C/td>\u003Ctd>Provide fallback, monitor for flapping\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Saga\u003C/td>\u003Ctd>Compensation can fail\u003C/td>\u003Ctd>Make compensations idempotent, alert on failure\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Rate Limiter\u003C/td>\u003Ctd>Requests queued or rejected\u003C/td>\u003Ctd>Increase limits, add backpressure\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"the-right-questions\">The Right Questions\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#the-right-questions\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “The Right Questions”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Before choosing a pattern, ask:\u003C/p>\n\u003Col>\n\u003Cli>\u003Cstrong>Is this error transient?\u003C/strong> → Retry\u003C/li>\n\u003Cli>\u003Cstrong>Is the downstream service healthy?\u003C/strong> → If no, Circuit Breaker\u003C/li>\n\u003Cli>\u003Cstrong>Did I create side effects I need to undo?\u003C/strong> → Saga\u003C/li>\n\u003Cli>\u003Cstrong>Am I at risk of hitting rate limits?\u003C/strong> → Rate Limiter\u003C/li>\n\u003Cli>\u003Cstrong>Is this a permanent error?\u003C/strong> → Just return it\u003C/li>\n\u003C/ol>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"example-full-stack\">Example: Full Stack\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#example-full-stack\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Example: Full Stack”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createCircuitBreaker\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/circuit-breaker\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createRateLimiter\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/ratelimit\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createSagaWorkflow\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">paymentBreaker\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createCircuitBreaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">payment-api\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">failureThreshold\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">paymentLimiter\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createRateLimiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">payment-api\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxRequests\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">100\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">windowMs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">60000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">checkout\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createSagaWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">checkout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Step 1: Charge with retry + circuit breaker + rate limiting\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">paymentLimiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">call\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">paymentBreaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">call\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">          \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxAttempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">            \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">shouldRetry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">===\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">TIMEOUT\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">          \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">})\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">charge\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">compensate\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">refundCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Step 2: Reserve (simpler, internal service)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reservation\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">reserveInventory\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">reserve\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">compensate\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">r\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">releaseInventory\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">r\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reservation\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createCircuitBreaker } from &#x27;awaitly/circuit-breaker&#x27;;import { createRateLimiter } from &#x27;awaitly/ratelimit&#x27;;import { createSagaWorkflow } from &#x27;awaitly/workflow&#x27;;const paymentBreaker = createCircuitBreaker(&#x27;payment-api&#x27;, { failureThreshold: 5 });const paymentLimiter = createRateLimiter(&#x27;payment-api&#x27;, { maxRequests: 100, windowMs: 60000 });const checkout = createSagaWorkflow(deps);const result = await checkout(async (saga) => {  // Step 1: Charge with retry + circuit breaker + rate limiting  const payment = await saga.step(    async () => {      return paymentLimiter.call(() =>        paymentBreaker.call(() =>          retry(() => chargeCard(amount), {            maxAttempts: 3,            shouldRetry: (e) => e === &#x27;TIMEOUT&#x27;,          })        )      );    },    { name: &#x27;charge&#x27;, compensate: (p) => refundCard(p.id) }  );  // Step 2: Reserve (simpler, internal service)  const reservation = await saga.step(    () => reserveInventory(items),    { name: &#x27;reserve&#x27;, compensate: (r) => releaseInventory(r.id) }  );  return { payment, reservation };});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>This stack provides:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Rate limiting\u003C/strong> prevents quota exhaustion\u003C/li>\n\u003Cli>\u003Cstrong>Circuit breaker\u003C/strong> protects failing services\u003C/li>\n\u003Cli>\u003Cstrong>Retry\u003C/strong> handles transient errors\u003C/li>\n\u003Cli>\u003Cstrong>Saga\u003C/strong> rolls back on partial failure\u003C/li>\n\u003C/ul>",{"headings":1213,"localImagePaths":1258,"remoteImagePaths":1259,"frontmatter":1260,"imagePaths":1261},[1214,1217,1220,1222,1225,1228,1231,1234,1237,1240,1243,1246,1249,1252,1255],{"depth":57,"slug":1215,"text":1216},"the-decision-matrix","The Decision Matrix",{"depth":57,"slug":1218,"text":1219},"retry","Retry",{"depth":57,"slug":1221,"text":88},"circuit-breaker",{"depth":57,"slug":1223,"text":1224},"saga-compensation","Saga (Compensation)",{"depth":57,"slug":1226,"text":1227},"combining-patterns","Combining Patterns",{"depth":212,"slug":1229,"text":1230},"retry-inside-saga-step","Retry inside Saga step",{"depth":212,"slug":1232,"text":1233},"circuit-breaker-wrapping-retry","Circuit Breaker wrapping Retry",{"depth":212,"slug":1235,"text":1236},"rate-limiter-at-the-outer-layer","Rate Limiter at the outer layer",{"depth":57,"slug":1238,"text":1239},"anti-patterns","Anti-patterns",{"depth":212,"slug":1241,"text":1242},"retrying-non-transient-errors","Retrying non-transient errors",{"depth":212,"slug":1244,"text":1245},"retrying-when-downstream-is-overloaded","Retrying when downstream is overloaded",{"depth":212,"slug":1247,"text":1248},"saga-without-idempotent-compensations","Saga without idempotent compensations",{"depth":57,"slug":1250,"text":1251},"when-each-pattern-fails","When Each Pattern Fails",{"depth":57,"slug":1253,"text":1254},"the-right-questions","The Right Questions",{"depth":57,"slug":1256,"text":1257},"example-full-stack","Example: Full Stack",[],[],{"title":1202,"description":1203},[],"patterns/payment-retries",{"id":1262,"data":1264,"body":1270,"filePath":1271,"digest":1272,"rendered":1273},{"title":1265,"description":1266,"editUrl":16,"head":1267,"template":46,"sidebar":1268,"pagefind":16,"draft":35},"Safe Payment Retries","Avoid double-charging with idempotent payment workflows",[],{"hidden":35,"attrs":1269},{},"The scariest failure mode in payments: **charge succeeded, but persistence failed**. If you retry naively, you charge the customer twice.\n\n## The problem\n\n```typescript\n// DANGEROUS: No idempotency\nasync function processPayment(order: Order) {\n  const charge = await paymentProvider.charge(order.total); // Succeeds\n\n  await db.orders.update(order.id, { paymentId: charge.id }); // Fails!\n\n  // Retry? You'll charge again\n}\n```\n\n## The solution\n\nUse step keys and persistence to make the workflow resumable:\n\n```typescript\nimport { createWorkflow, createResumeStateCollector } from 'awaitly/workflow';\nimport { stringifyState, parseState } from 'awaitly/persistence';\n\nconst processPayment = createWorkflow({\n  validateCard,\n  chargeProvider,\n  persistResult,\n});\n\n// Collect state for persistence\nconst collector = createResumeStateCollector();\n\nconst workflow = createWorkflow(deps, {\n  onEvent: collector.handleEvent,\n});\n\nconst result = await workflow(async (step) => {\n  // Validate - can retry safely\n  const card = await step(\n    () => validateCard(input),\n    { key: `validate:${orderId}` }\n  );\n\n  // CRITICAL: This step must not repeat\n  const charge = await step(\n    () => chargeProvider(card, amount),\n    { key: `charge:${idempotencyKey}` }\n  );\n\n  // Persist - if this fails, we can resume\n  await step(\n    () => persistResult(charge),\n    { key: `persist:${charge.id}` }\n  );\n\n  return { paymentId: charge.id };\n});\n```\n\n## Save state after each run\n\n```typescript\n// Always save state (success or failure)\nconst state = collector.getResumeState();\nconst json = stringifyState(state, { orderId });\n\nawait db.workflowStates.upsert({\n  where: { idempotencyKey },\n  update: { state: json, updatedAt: new Date() },\n  create: { idempotencyKey, state: json },\n});\n```\n\n## Crash recovery\n\nIf the workflow crashes after charging but before persisting:\n\n```typescript\n// On restart, check for existing state\nconst saved = await db.workflowStates.findUnique({\n  where: { idempotencyKey },\n});\n\nif (saved) {\n  // Resume from saved state\n  const resumeState = parseState(saved.state);\n\n  const workflow = createWorkflow(deps, { resumeState });\n\n  const result = await workflow(async (step) => {\n    const card = await step(\n      () => validateCard(input),\n      { key: `validate:${orderId}` }\n    ); // Cache hit\n\n    const charge = await step(\n      () => chargeProvider(card, amount),\n      { key: `charge:${idempotencyKey}` }\n    ); // Cache hit - returns previous charge\n\n    await step(\n      () => persistResult(charge),\n      { key: `persist:${charge.id}` }\n    ); // Runs fresh\n\n    return { paymentId: charge.id };\n  });\n}\n```\n\nThe charge step returns its cached result. No double-billing.\n\n## Idempotency key design\n\nGenerate a unique key per payment attempt:\n\n```typescript\n// Good: Stable across retries\nconst idempotencyKey = `order:${orderId}:attempt:${attemptNumber}`;\n\n// Good: Based on cart contents\nconst idempotencyKey = `cart:${hashCart(items)}:user:${userId}`;\n\n// Bad: Changes every call\nconst idempotencyKey = `payment:${Date.now()}`;\n```\n\n## Full example\n\n```typescript\nimport { ok, err, type AsyncResult } from 'awaitly';\nimport { createWorkflow, createResumeStateCollector } from 'awaitly/workflow';\nimport { stringifyState, parseState } from 'awaitly/persistence';\n\nconst validateCard = async (\n  cardToken: string\n): AsyncResult\u003CCard, 'INVALID_CARD'> => {\n  const card = await stripe.tokens.retrieve(cardToken);\n  return card ? ok(card) : err('INVALID_CARD');\n};\n\nconst chargeProvider = async (\n  card: Card,\n  amount: number\n): AsyncResult\u003CCharge, 'DECLINED' | 'PROVIDER_ERROR'> => {\n  try {\n    const charge = await stripe.charges.create({\n      amount,\n      source: card.id,\n    });\n    return ok(charge);\n  } catch (e) {\n    if (e.code === 'card_declined') return err('DECLINED');\n    return err('PROVIDER_ERROR');\n  }\n};\n\nconst persistResult = async (\n  charge: Charge\n): AsyncResult\u003Cvoid, 'DB_ERROR'> => {\n  try {\n    await db.payments.create({\n      chargeId: charge.id,\n      amount: charge.amount,\n      status: 'completed',\n    });\n    return ok(undefined);\n  } catch {\n    return err('DB_ERROR');\n  }\n};\n\n// Main function\nasync function handlePayment(orderId: string, cardToken: string, amount: number) {\n  const idempotencyKey = `payment:${orderId}`;\n\n  // Check for existing attempt\n  const existing = await db.workflowStates.findUnique({\n    where: { id: idempotencyKey },\n  });\n\n  const collector = createResumeStateCollector();\n  const resumeState = existing ? parseState(existing.state) : undefined;\n\n  const workflow = createWorkflow(\n    { validateCard, chargeProvider, persistResult },\n    {\n      resumeState,\n      onEvent: collector.handleEvent,\n    }\n  );\n\n  const result = await workflow(async (step) => {\n    const card = await step(() => validateCard(cardToken), {\n      key: `validate:${orderId}`,\n    });\n\n    const charge = await step(() => chargeProvider(card, amount), {\n      key: `charge:${idempotencyKey}`,\n    });\n\n    await step(() => persistResult(charge), {\n      key: `persist:${charge.id}`,\n    });\n\n    return { chargeId: charge.id };\n  });\n\n  // Always save state\n  const state = collector.getResumeState();\n  await db.workflowStates.upsert({\n    where: { id: idempotencyKey },\n    update: { state: stringifyState(state), updatedAt: new Date() },\n    create: { id: idempotencyKey, state: stringifyState(state) },\n  });\n\n  return result;\n}\n```\n\n## Key takeaways\n\n1. **Use idempotency keys** for payment operations\n2. **Save state** after every run (success or failure)\n3. **Resume with saved state** on retry\n4. **Cached steps return previous results** without re-executing","src/content/docs/patterns/payment-retries.md","b94076b883776e02",{"html":1274,"metadata":1275},"\u003Cp>The scariest failure mode in payments: \u003Cstrong>charge succeeded, but persistence failed\u003C/strong>. If you retry naively, you charge the customer twice.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"the-problem\">The problem\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#the-problem\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “The problem”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// DANGEROUS: No idempotency\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">function\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processPayment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">paymentProvider\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">total\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Succeeds\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">orders\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">update\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">order\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">paymentId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Fails!\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Retry? You'll charge again\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// DANGEROUS: No idempotencyasync function processPayment(order: Order) {  const charge = await paymentProvider.charge(order.total); // Succeeds  await db.orders.update(order.id, { paymentId: charge.id }); // Fails!  // Retry? You&#x27;ll charge again}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"the-solution\">The solution\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#the-solution\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “The solution”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use step keys and persistence to make the workflow resumable:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createResumeStateCollector\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stringifyState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">parseState\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/persistence\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">processPayment\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">validateCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">chargeProvider\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">persistResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Collect state for persistence\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createResumeStateCollector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Validate - can retry safely\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">card\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">validateCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">input\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">validate:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">orderId\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// CRITICAL: This step must not repeat\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">chargeProvider\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">card\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">charge:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">idempotencyKey\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Persist - if this fails, we can resume\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">persistResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">persist:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">id\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">paymentId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createWorkflow, createResumeStateCollector } from &#x27;awaitly/workflow&#x27;;import { stringifyState, parseState } from &#x27;awaitly/persistence&#x27;;const processPayment = createWorkflow({  validateCard,  chargeProvider,  persistResult,});// Collect state for persistenceconst collector = createResumeStateCollector();const workflow = createWorkflow(deps, {  onEvent: collector.handleEvent,});const result = await workflow(async (step) => {  // Validate - can retry safely  const card = await step(    () => validateCard(input),    { key: &#x60;validate:${orderId}&#x60; }  );  // CRITICAL: This step must not repeat  const charge = await step(    () => chargeProvider(card, amount),    { key: &#x60;charge:${idempotencyKey}&#x60; }  );  // Persist - if this fails, we can resume  await step(    () => persistResult(charge),    { key: &#x60;persist:${charge.id}&#x60; }  );  return { paymentId: charge.id };});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"save-state-after-each-run\">Save state after each run\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#save-state-after-each-run\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Save state after each run”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Always save state (success or failure)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getResumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">json\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">stringifyState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">orderId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflowStates\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">upsert\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">where\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">idempotencyKey\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">update\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">updatedAt\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">new\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">Date\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">() },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">create\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">idempotencyKey\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// Always save state (success or failure)const state = collector.getResumeState();const json = stringifyState(state, { orderId });await db.workflowStates.upsert({  where: { idempotencyKey },  update: { state: json, updatedAt: new Date() },  create: { idempotencyKey, state: json },});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"crash-recovery\">Crash recovery\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#crash-recovery\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Crash recovery”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>If the workflow crashes after charging but before persisting:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// On restart, check for existing state\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saved\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflowStates\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">findUnique\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">where\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">idempotencyKey\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saved\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Resume from saved state\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">resumeState\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">parseState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saved\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">resumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">card\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">validateCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">input\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">validate:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">orderId\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Cache hit\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">chargeProvider\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">card\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">charge:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">idempotencyKey\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Cache hit - returns previous charge\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">persistResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">persist:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">id\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Runs fresh\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">paymentId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// On restart, check for existing stateconst saved = await db.workflowStates.findUnique({  where: { idempotencyKey },});if (saved) {  // Resume from saved state  const resumeState = parseState(saved.state);  const workflow = createWorkflow(deps, { resumeState });  const result = await workflow(async (step) => {    const card = await step(      () => validateCard(input),      { key: &#x60;validate:${orderId}&#x60; }    ); // Cache hit    const charge = await step(      () => chargeProvider(card, amount),      { key: &#x60;charge:${idempotencyKey}&#x60; }    ); // Cache hit - returns previous charge    await step(      () => persistResult(charge),      { key: &#x60;persist:${charge.id}&#x60; }    ); // Runs fresh    return { paymentId: charge.id };  });}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>The charge step returns its cached result. No double-billing.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"idempotency-key-design\">Idempotency key design\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#idempotency-key-design\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Idempotency key design”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Generate a unique key per payment attempt:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Good: Stable across retries\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">idempotencyKey\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">order:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">orderId\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">:attempt:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">attemptNumber\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Good: Based on cart contents\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">idempotencyKey\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">cart:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">hashCart\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">:user:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">userId\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Bad: Changes every call\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">idempotencyKey\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">payment:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Date\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">now\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// Good: Stable across retriesconst idempotencyKey = &#x60;order:${orderId}:attempt:${attemptNumber}&#x60;;// Good: Based on cart contentsconst idempotencyKey = &#x60;cart:${hashCart(items)}:user:${userId}&#x60;;// Bad: Changes every callconst idempotencyKey = &#x60;payment:${Date.now()}&#x60;;\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"full-example\">Full example\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#full-example\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Full example”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createResumeStateCollector\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stringifyState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">parseState\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/persistence\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">validateCard\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cardToken\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Card\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">INVALID_CARD\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">card\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stripe\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">tokens\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retrieve\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cardToken\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">card\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> ? \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">card\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> : \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">INVALID_CARD\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">chargeProvider\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">card\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Card\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">number\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">DECLINED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">|\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">PROVIDER_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">try\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stripe\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charges\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">create\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">source\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">card\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">catch\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">code\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> === \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">card_declined\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">DECLINED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">PROVIDER_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">persistResult\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Charge\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">void\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">DB_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">try\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payments\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">create\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">chargeId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">completed\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">undefined\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">catch\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">DB_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Main function\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">function\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">handlePayment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">orderId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cardToken\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">idempotencyKey\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">payment:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">orderId\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Check for existing attempt\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">existing\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflowStates\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">findUnique\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">where\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">idempotencyKey\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createResumeStateCollector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">resumeState\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">existing\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> ? \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">parseState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">existing\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> : undefined\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">validateCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">chargeProvider\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">persistResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">resumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">card\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">validateCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cardToken\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">validate:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">orderId\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">chargeProvider\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">card\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">charge:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">idempotencyKey\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">persistResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">persist:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">id\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">chargeId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Always save state\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getResumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflowStates\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">upsert\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">where\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">idempotencyKey\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">update\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">stringifyState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">), \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">updatedAt\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">new\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">Date\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">() },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">create\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">idempotencyKey\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">stringifyState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { ok, err, type AsyncResult } from &#x27;awaitly&#x27;;import { createWorkflow, createResumeStateCollector } from &#x27;awaitly/workflow&#x27;;import { stringifyState, parseState } from &#x27;awaitly/persistence&#x27;;const validateCard = async (  cardToken: string): AsyncResult\u003CCard, &#x27;INVALID_CARD&#x27;> => {  const card = await stripe.tokens.retrieve(cardToken);  return card ? ok(card) : err(&#x27;INVALID_CARD&#x27;);};const chargeProvider = async (  card: Card,  amount: number): AsyncResult\u003CCharge, &#x27;DECLINED&#x27; | &#x27;PROVIDER_ERROR&#x27;> => {  try {    const charge = await stripe.charges.create({      amount,      source: card.id,    });    return ok(charge);  } catch (e) {    if (e.code === &#x27;card_declined&#x27;) return err(&#x27;DECLINED&#x27;);    return err(&#x27;PROVIDER_ERROR&#x27;);  }};const persistResult = async (  charge: Charge): AsyncResult\u003Cvoid, &#x27;DB_ERROR&#x27;> => {  try {    await db.payments.create({      chargeId: charge.id,      amount: charge.amount,      status: &#x27;completed&#x27;,    });    return ok(undefined);  } catch {    return err(&#x27;DB_ERROR&#x27;);  }};// Main functionasync function handlePayment(orderId: string, cardToken: string, amount: number) {  const idempotencyKey = &#x60;payment:${orderId}&#x60;;  // Check for existing attempt  const existing = await db.workflowStates.findUnique({    where: { id: idempotencyKey },  });  const collector = createResumeStateCollector();  const resumeState = existing ? parseState(existing.state) : undefined;  const workflow = createWorkflow(    { validateCard, chargeProvider, persistResult },    {      resumeState,      onEvent: collector.handleEvent,    }  );  const result = await workflow(async (step) => {    const card = await step(() => validateCard(cardToken), {      key: &#x60;validate:${orderId}&#x60;,    });    const charge = await step(() => chargeProvider(card, amount), {      key: &#x60;charge:${idempotencyKey}&#x60;,    });    await step(() => persistResult(charge), {      key: &#x60;persist:${charge.id}&#x60;,    });    return { chargeId: charge.id };  });  // Always save state  const state = collector.getResumeState();  await db.workflowStates.upsert({    where: { id: idempotencyKey },    update: { state: stringifyState(state), updatedAt: new Date() },    create: { id: idempotencyKey, state: stringifyState(state) },  });  return result;}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"key-takeaways\">Key takeaways\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#key-takeaways\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Key takeaways”\u003C/span>\u003C/a>\u003C/div>\n\u003Col>\n\u003Cli>\u003Cstrong>Use idempotency keys\u003C/strong> for payment operations\u003C/li>\n\u003Cli>\u003Cstrong>Save state\u003C/strong> after every run (success or failure)\u003C/li>\n\u003Cli>\u003Cstrong>Resume with saved state\u003C/strong> on retry\u003C/li>\n\u003Cli>\u003Cstrong>Cached steps return previous results\u003C/strong> without re-executing\u003C/li>\n\u003C/ol>",{"headings":1276,"localImagePaths":1294,"remoteImagePaths":1295,"frontmatter":1296,"imagePaths":1297},[1277,1278,1281,1284,1287,1290,1291],{"depth":57,"slug":883,"text":884},{"depth":57,"slug":1279,"text":1280},"the-solution","The solution",{"depth":57,"slug":1282,"text":1283},"save-state-after-each-run","Save state after each run",{"depth":57,"slug":1285,"text":1286},"crash-recovery","Crash recovery",{"depth":57,"slug":1288,"text":1289},"idempotency-key-design","Idempotency key design",{"depth":57,"slug":708,"text":709},{"depth":57,"slug":1292,"text":1293},"key-takeaways","Key takeaways",[],[],{"title":1265,"description":1266},[],"patterns/parallel-operations",{"id":1298,"data":1300,"body":1306,"filePath":1307,"digest":1308,"rendered":1309},{"title":1301,"description":1302,"editUrl":16,"head":1303,"template":46,"sidebar":1304,"pagefind":16,"draft":35},"Parallel Operations","Run multiple operations concurrently",[],{"hidden":35,"attrs":1305},{},"Execute multiple operations in parallel while maintaining typed error handling.\n\n## Basic parallel execution\n\nUse `allAsync` to run operations concurrently:\n\n```typescript\nimport { allAsync } from 'awaitly';\nimport { createWorkflow } from 'awaitly/workflow';\n\nconst workflow = createWorkflow({ fetchUser, fetchPosts, fetchComments });\n\nconst result = await workflow(async (step) => {\n  const [user, posts, comments] = await step(() =>\n    allAsync([\n      fetchUser('1'),\n      fetchPosts('1'),\n      fetchComments('1'),\n    ])\n  );\n\n  return { user, posts, comments };\n});\n```\n\n## Fail-fast behavior\n\n`allAsync` stops on the first error:\n\n```typescript\nconst result = await allAsync([\n  fetchUser('1'),        // Takes 100ms, succeeds\n  fetchPosts('999'),     // Takes 50ms, fails with 'NOT_FOUND'\n  fetchComments('1'),    // Takes 200ms, never completes\n]);\n\n// result.ok === false\n// result.error === 'NOT_FOUND'\n```\n\n## Collect all errors\n\nUse `allSettledAsync` to run all operations and collect all errors (if any fail):\n\n```typescript\nimport { allSettledAsync } from 'awaitly';\n\nconst result = await allSettledAsync([\n  fetchUser('1'),      // Succeeds\n  fetchPosts('999'),   // Fails\n  fetchComments('1'),  // Succeeds\n]);\n\n// Returns ok([values]) only if ALL succeed\n// Returns err([SettledError]) if ANY fail, collecting all errors\nif (result.ok) {\n  // All operations succeeded\n  const [user, posts, comments] = result.value;\n  console.log('All succeeded:', user, posts, comments);\n} else {\n  // At least one failed - result.error is SettledError[]\n  for (const settled of result.error) {\n    console.log('Failed:', settled.error);\n  }\n}\n```\n\n**Note**: Unlike `Promise.allSettled()`, this returns a Result - `ok` if all succeed, `err` if any fail. This is consistent with awaitly's philosophy that all functions return Results. If you need partial success, use `partition()` after `Promise.all()` of Results.\n\n## Partition successes and failures\n\n```typescript\nimport { partition } from 'awaitly';\n\nconst results = await Promise.all([\n  fetchUser('1'),\n  fetchUser('2'),\n  fetchUser('999'),\n]);\n\nconst [successes, failures] = partition(results);\n// successes: [User, User]\n// failures: ['NOT_FOUND']\n```\n\n## Named parallel operations\n\nGive parallel groups a name for visualization:\n\n```typescript\nconst result = await workflow(async (step) => {\n  const [user, posts] = await step(\n    () => allAsync([fetchUser('1'), fetchPosts('1')]),\n    { name: 'Fetch user data' }\n  );\n\n  return { user, posts };\n});\n```\n\n## Race to first success\n\nUse `anyAsync` to get the first successful result:\n\n```typescript\nimport { anyAsync } from 'awaitly';\n\n// Try multiple API endpoints, use first to respond\nconst result = await anyAsync([\n  fetchFromPrimary(id),\n  fetchFromBackup(id),\n  fetchFromCache(id),\n]);\n\nif (result.ok) {\n  // Got data from whichever responded first\n  console.log(result.value);\n}\n```\n\n## Bounded concurrency\n\nFor large sets, use `processInBatches`:\n\n```typescript\nimport { processInBatches } from 'awaitly/batch';\n\nconst result = await processInBatches(\n  userIds,\n  (id) => fetchUser(id),\n  { batchSize: 20, concurrency: 5 }\n);\n```\n\nSee [Batch Processing](/guides/batch-processing/) for details.\n\n## Parallel with dependencies\n\nSome operations depend on others:\n\n```typescript\nconst result = await workflow(async (step) => {\n  // Fetch user first\n  const user = await step(fetchUser('1'));\n\n  // Then fetch user's data in parallel\n  const [posts, friends, settings] = await step(() =>\n    allAsync([\n      fetchPosts(user.id),\n      fetchFriends(user.id),\n      fetchSettings(user.id),\n    ])\n  );\n\n  return { user, posts, friends, settings };\n});\n```\n\n## Error handling in parallel operations\n\nErrors from parallel operations are typed:\n\n```typescript\nconst fetchUser = async (id: string): AsyncResult\u003CUser, 'USER_NOT_FOUND'> => { ... };\nconst fetchPosts = async (id: string): AsyncResult\u003CPost[], 'POSTS_FETCH_ERROR'> => { ... };\n\nconst result = await allAsync([fetchUser('1'), fetchPosts('1')]);\n// result.error is: 'USER_NOT_FOUND' | 'POSTS_FETCH_ERROR'\n```\n\n## Mapping over arrays\n\nProcess an array with typed errors:\n\n```typescript\nconst userIds = ['1', '2', '3'];\n\nconst results = await allAsync(\n  userIds.map((id) => fetchUser(id))\n);\n\nif (results.ok) {\n  // results.value is User[]\n  console.log(results.value.map((u) => u.name));\n}\n```\n\n## With timeout\n\nAdd a timeout to parallel operations:\n\n```typescript\nconst result = await workflow(async (step) => {\n  const data = await step.withTimeout(\n    () => allAsync([fetchUser('1'), fetchPosts('1')]),\n    { ms: 5000, name: 'Fetch user data' }\n  );\n\n  return data;\n});\n```\n\n## Full example\n\n```typescript\nimport {\n  allAsync,\n  partition,\n  ok,\n  err,\n  type AsyncResult,\n} from 'awaitly';\nimport { createWorkflow } from 'awaitly/workflow';\n\ntype User = { id: string; name: string };\ntype Notification = { id: string; message: string };\n\nconst fetchUser = async (id: string): AsyncResult\u003CUser, 'USER_NOT_FOUND'> => {\n  const user = await db.users.find(id);\n  return user ? ok(user) : err('USER_NOT_FOUND');\n};\n\nconst sendNotification = async (\n  userId: string,\n  message: string\n): AsyncResult\u003CNotification, 'SEND_FAILED'> => {\n  try {\n    const notification = await notificationService.send(userId, message);\n    return ok(notification);\n  } catch {\n    return err('SEND_FAILED');\n  }\n};\n\nconst notifyUsers = createWorkflow({ fetchUser, sendNotification });\n\nconst result = await notifyUsers(async (step) => {\n  const userIds = ['1', '2', '3', '4', '5'];\n\n  // Fetch all users in parallel\n  const usersResult = await step(() =>\n    allAsync(userIds.map((id) => fetchUser(id)))\n  );\n\n  // Send notifications in parallel\n  const notifications = await step(() =>\n    allAsync(\n      usersResult.map((user) =>\n        sendNotification(user.id, 'Hello!')\n      )\n    )\n  );\n\n  return {\n    notified: notifications.length,\n  };\n});\n```","src/content/docs/patterns/parallel-operations.md","ee74082c8ad3cb20",{"html":1310,"metadata":1311},"\u003Cp>Execute multiple operations in parallel while maintaining typed error handling.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"basic-parallel-execution\">Basic parallel execution\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#basic-parallel-execution\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Basic parallel execution”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">allAsync\u003C/code> to run operations concurrently:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">allAsync\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchComments\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">comments\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">allAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchComments\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">])\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">comments\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { allAsync } from &#x27;awaitly&#x27;;import { createWorkflow } from &#x27;awaitly/workflow&#x27;;const workflow = createWorkflow({ fetchUser, fetchPosts, fetchComments });const result = await workflow(async (step) => {  const [user, posts, comments] = await step(() =>    allAsync([      fetchUser(&#x27;1&#x27;),      fetchPosts(&#x27;1&#x27;),      fetchComments(&#x27;1&#x27;),    ])  );  return { user, posts, comments };});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"fail-fast-behavior\">Fail-fast behavior\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#fail-fast-behavior\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Fail-fast behavior”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ccode dir=\"auto\">allAsync\u003C/code> stops on the first error:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">allAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Takes 100ms, succeeds\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">999\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Takes 50ms, fails with 'NOT_FOUND'\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchComments\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Takes 200ms, never completes\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// result.ok === false\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// result.error === 'NOT_FOUND'\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await allAsync([  fetchUser(&#x27;1&#x27;),        // Takes 100ms, succeeds  fetchPosts(&#x27;999&#x27;),     // Takes 50ms, fails with &#x27;NOT_FOUND&#x27;  fetchComments(&#x27;1&#x27;),    // Takes 200ms, never completes]);// result.ok === false// result.error === &#x27;NOT_FOUND&#x27;\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"collect-all-errors\">Collect all errors\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#collect-all-errors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Collect all errors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">allSettledAsync\u003C/code> to run all operations and collect all errors (if any fail):\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">allSettledAsync\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">allSettledAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Succeeds\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">999\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">   \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Fails\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchComments\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Succeeds\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Returns ok([values]) only if ALL succeed\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Returns err([SettledError]) if ANY fail, collecting all errors\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// All operations succeeded\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">comments\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">All succeeded:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">comments\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">else\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// At least one failed - result.error is SettledError[]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">for\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">settled\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> of\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Failed:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">settled\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { allSettledAsync } from &#x27;awaitly&#x27;;const result = await allSettledAsync([  fetchUser(&#x27;1&#x27;),      // Succeeds  fetchPosts(&#x27;999&#x27;),   // Fails  fetchComments(&#x27;1&#x27;),  // Succeeds]);// Returns ok([values]) only if ALL succeed// Returns err([SettledError]) if ANY fail, collecting all errorsif (result.ok) {  // All operations succeeded  const [user, posts, comments] = result.value;  console.log(&#x27;All succeeded:&#x27;, user, posts, comments);} else {  // At least one failed - result.error is SettledError[]  for (const settled of result.error) {    console.log(&#x27;Failed:&#x27;, settled.error);  }}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>\u003Cstrong>Note\u003C/strong>: Unlike \u003Ccode dir=\"auto\">Promise.allSettled()\u003C/code>, this returns a Result - \u003Ccode dir=\"auto\">ok\u003C/code> if all succeed, \u003Ccode dir=\"auto\">err\u003C/code> if any fail. This is consistent with awaitly’s philosophy that all functions return Results. If you need partial success, use \u003Ccode dir=\"auto\">partition()\u003C/code> after \u003Ccode dir=\"auto\">Promise.all()\u003C/code> of Results.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"partition-successes-and-failures\">Partition successes and failures\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#partition-successes-and-failures\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Partition successes and failures”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">partition\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">results\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">Promise\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">all\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">2\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">999\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">successes\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">failures\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">partition\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">results\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// successes: [User, User]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// failures: ['NOT_FOUND']\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { partition } from &#x27;awaitly&#x27;;const results = await Promise.all([  fetchUser(&#x27;1&#x27;),  fetchUser(&#x27;2&#x27;),  fetchUser(&#x27;999&#x27;),]);const [successes, failures] = partition(results);// successes: [User, User]// failures: [&#x27;NOT_FOUND&#x27;]\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"named-parallel-operations\">Named parallel operations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#named-parallel-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Named parallel operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Give parallel groups a name for visualization:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">allAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)]),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Fetch user data\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await workflow(async (step) => {  const [user, posts] = await step(    () => allAsync([fetchUser(&#x27;1&#x27;), fetchPosts(&#x27;1&#x27;)]),    { name: &#x27;Fetch user data&#x27; }  );  return { user, posts };});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"race-to-first-success\">Race to first success\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#race-to-first-success\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Race to first success”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">anyAsync\u003C/code> to get the first successful result:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">anyAsync\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Try multiple API endpoints, use first to respond\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">anyAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchFromPrimary\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchFromBackup\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchFromCache\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Got data from whichever responded first\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { anyAsync } from &#x27;awaitly&#x27;;// Try multiple API endpoints, use first to respondconst result = await anyAsync([  fetchFromPrimary(id),  fetchFromBackup(id),  fetchFromCache(id),]);if (result.ok) {  // Got data from whichever responded first  console.log(result.value);}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"bounded-concurrency\">Bounded concurrency\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#bounded-concurrency\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Bounded concurrency”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>For large sets, use \u003Ccode dir=\"auto\">processInBatches\u003C/code>:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">processInBatches\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/batch\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processInBatches\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">userIds\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">batchSize\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">20\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">concurrency\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { processInBatches } from &#x27;awaitly/batch&#x27;;const result = await processInBatches(  userIds,  (id) => fetchUser(id),  { batchSize: 20, concurrency: 5 });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>See \u003Ca href=\"/guides/batch-processing/\">Batch Processing\u003C/a> for details.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"parallel-with-dependencies\">Parallel with dependencies\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#parallel-with-dependencies\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Parallel with dependencies”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Some operations depend on others:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Fetch user first\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Then fetch user's data in parallel\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">friends\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">settings\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">allAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchFriends\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchSettings\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">])\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">friends\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">settings\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await workflow(async (step) => {  // Fetch user first  const user = await step(fetchUser(&#x27;1&#x27;));  // Then fetch user&#x27;s data in parallel  const [posts, friends, settings] = await step(() =>    allAsync([      fetchPosts(user.id),      fetchFriends(user.id),      fetchSettings(user.id),    ])  );  return { user, posts, friends, settings };});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"error-handling-in-parallel-operations\">Error handling in parallel operations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#error-handling-in-parallel-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Error handling in parallel operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Errors from parallel operations are typed:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">User\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">USER_NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Post\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[],\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">POSTS_FETCH_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">allAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)]);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// result.error is: 'USER_NOT_FOUND' | 'POSTS_FETCH_ERROR'\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const fetchUser = async (id: string): AsyncResult\u003CUser, &#x27;USER_NOT_FOUND&#x27;> => { ... };const fetchPosts = async (id: string): AsyncResult\u003CPost[], &#x27;POSTS_FETCH_ERROR&#x27;> => { ... };const result = await allAsync([fetchUser(&#x27;1&#x27;), fetchPosts(&#x27;1&#x27;)]);// result.error is: &#x27;USER_NOT_FOUND&#x27; | &#x27;POSTS_FETCH_ERROR&#x27;\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"mapping-over-arrays\">Mapping over arrays\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#mapping-over-arrays\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Mapping over arrays”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Process an array with typed errors:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">userIds\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">2\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">3\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">];\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">results\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">allAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">userIds\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">map\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">((\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">results\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// results.value is User[]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">results\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">map\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">((\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">u\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">u\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const userIds = [&#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;];const results = await allAsync(  userIds.map((id) => fetchUser(id)));if (results.ok) {  // results.value is User[]  console.log(results.value.map((u) => u.name));}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"with-timeout\">With timeout\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#with-timeout\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “With timeout”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Add a timeout to parallel operations:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withTimeout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">allAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)]),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">ms\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Fetch user data\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await workflow(async (step) => {  const data = await step.withTimeout(    () => allAsync([fetchUser(&#x27;1&#x27;), fetchPosts(&#x27;1&#x27;)]),    { ms: 5000, name: &#x27;Fetch user data&#x27; }  );  return data;});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"full-example\">Full example\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#full-example\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Full example”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">allAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">partition\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">User\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Notification\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">User\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">USER_NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">users\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">find\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> ? \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> : \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">USER_NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">sendNotification\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">userId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Notification\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">SEND_FAILED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">try\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">notification\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">notificationService\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">send\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">userId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">notification\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">catch\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">SEND_FAILED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">notifyUsers\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">sendNotification\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">notifyUsers\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">userIds\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">2\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">3\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">4\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">5\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">];\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Fetch all users in parallel\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">usersResult\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">allAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">userIds\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">map\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">((\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)))\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Send notifications in parallel\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">notifications\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">allAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">usersResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">map\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">((\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">sendNotification\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Hello!\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">notified\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">notifications\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">length\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import {  allAsync,  partition,  ok,  err,  type AsyncResult,} from &#x27;awaitly&#x27;;import { createWorkflow } from &#x27;awaitly/workflow&#x27;;type User = { id: string; name: string };type Notification = { id: string; message: string };const fetchUser = async (id: string): AsyncResult\u003CUser, &#x27;USER_NOT_FOUND&#x27;> => {  const user = await db.users.find(id);  return user ? ok(user) : err(&#x27;USER_NOT_FOUND&#x27;);};const sendNotification = async (  userId: string,  message: string): AsyncResult\u003CNotification, &#x27;SEND_FAILED&#x27;> => {  try {    const notification = await notificationService.send(userId, message);    return ok(notification);  } catch {    return err(&#x27;SEND_FAILED&#x27;);  }};const notifyUsers = createWorkflow({ fetchUser, sendNotification });const result = await notifyUsers(async (step) => {  const userIds = [&#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;];  // Fetch all users in parallel  const usersResult = await step(() =>    allAsync(userIds.map((id) => fetchUser(id)))  );  // Send notifications in parallel  const notifications = await step(() =>    allAsync(      usersResult.map((user) =>        sendNotification(user.id, &#x27;Hello!&#x27;)      )    )  );  return {    notified: notifications.length,  };});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>",{"headings":1312,"localImagePaths":1347,"remoteImagePaths":1348,"frontmatter":1349,"imagePaths":1350},[1313,1316,1319,1322,1325,1328,1331,1334,1337,1340,1343,1346],{"depth":57,"slug":1314,"text":1315},"basic-parallel-execution","Basic parallel execution",{"depth":57,"slug":1317,"text":1318},"fail-fast-behavior","Fail-fast behavior",{"depth":57,"slug":1320,"text":1321},"collect-all-errors","Collect all errors",{"depth":57,"slug":1323,"text":1324},"partition-successes-and-failures","Partition successes and failures",{"depth":57,"slug":1326,"text":1327},"named-parallel-operations","Named parallel operations",{"depth":57,"slug":1329,"text":1330},"race-to-first-success","Race to first success",{"depth":57,"slug":1332,"text":1333},"bounded-concurrency","Bounded concurrency",{"depth":57,"slug":1335,"text":1336},"parallel-with-dependencies","Parallel with dependencies",{"depth":57,"slug":1338,"text":1339},"error-handling-in-parallel-operations","Error handling in parallel operations",{"depth":57,"slug":1341,"text":1342},"mapping-over-arrays","Mapping over arrays",{"depth":57,"slug":1344,"text":1345},"with-timeout","With timeout",{"depth":57,"slug":708,"text":709},[],[],{"title":1301,"description":1302},[],"patterns/resource-management",{"id":1351,"data":1353,"body":1359,"filePath":1360,"digest":1361,"rendered":1362},{"title":1354,"description":1355,"editUrl":16,"head":1356,"template":46,"sidebar":1357,"pagefind":16,"draft":35},"Resource Management","RAII-style resource cleanup for database connections and files",[],{"hidden":35,"attrs":1358},{},"Manage resources (database connections, file handles, API clients) with guaranteed cleanup using `withScope`.\n\n## Basic usage\n\n```typescript\nimport { withScope, createResource, ok } from 'awaitly/resource';\n\nconst result = await withScope(async (scope) => {\n  // Resources are tracked for automatic cleanup\n  const db = scope.add(await createDatabaseClient());\n  const cache = scope.add(await createCacheClient());\n\n  // Do work\n  const user = await db.query('SELECT * FROM users WHERE id = ?', [userId]);\n  await cache.set(`user:${userId}`, user);\n\n  return ok(user);\n});\n// cache closed first, then db (LIFO order) - even on errors!\n```\n\n## Create reusable resources\n\nUse `createResource` to wrap acquire/release logic:\n\n```typescript\nimport { createResource } from 'awaitly/resource';\n\nconst createDbResource = async (connectionString: string) =>\n  createResource(\n    // Acquire\n    async () => {\n      const client = new DatabaseClient(connectionString);\n      await client.connect();\n      return client;\n    },\n    // Release\n    async (client) => {\n      await client.disconnect();\n    }\n  );\n\nconst createFileResource = async (path: string, mode: string) =>\n  createResource(\n    async () => {\n      const handle = await fs.open(path, mode);\n      return handle;\n    },\n    async (handle) => {\n      await handle.close();\n    }\n  );\n```\n\n## Use in workflows\n\n```typescript\nimport { withScope, createResource, ok, err } from 'awaitly/resource';\n\nconst result = await withScope(async (scope) => {\n  const db = scope.add(await createDbResource(process.env.DATABASE_URL));\n\n  const user = await db.query('SELECT * FROM users WHERE id = ?', ['123']);\n  if (!user) {\n    return err('NOT_FOUND' as const);\n  }\n\n  return ok(user);\n});\n// Database disconnected automatically\n```\n\n## LIFO cleanup order\n\nResources are closed in reverse order of acquisition:\n\n```typescript\nconst result = await withScope(async (scope) => {\n  const db = scope.add(await createDbResource());        // Acquired 1st\n  const cache = scope.add(await createCacheClient());    // Acquired 2nd\n  const apiClient = scope.add(await createApiClient());  // Acquired 3rd\n\n  // ... work ...\n\n  return ok(data);\n});\n// Cleanup order: apiClient → cache → db\n```\n\nThis matters when resources depend on each other (close connections before connection pools).\n\n## Cleanup on error\n\nResources are cleaned up even when the workflow fails:\n\n```typescript\nconst result = await withScope(async (scope) => {\n  const db = scope.add(await createDbResource());\n\n  // This fails\n  const user = await db.query('SELECT * FROM missing_table');\n  return ok(user);\n});\n// db.disconnect() still called\n```\n\n## Cleanup on exception\n\nResources are cleaned up even when code throws:\n\n```typescript\nconst result = await withScope(async (scope) => {\n  const db = scope.add(await createDbResource());\n\n  throw new Error('Something broke');\n\n  return ok(data);\n});\n// db.disconnect() still called\n```\n\n## Nested scopes\n\nScopes can be nested:\n\n```typescript\nconst result = await withScope(async (outer) => {\n  const db = outer.add(await createDbResource());\n\n  // Inner scope for temporary resources\n  const tempResult = await withScope(async (inner) => {\n    const tempFile = inner.add(await createTempFile());\n    await tempFile.write(data);\n    return ok(await tempFile.path());\n  });\n  // tempFile closed here\n\n  if (!tempResult.ok) {\n    return tempResult;\n  }\n\n  await db.query('INSERT INTO files (path) VALUES (?)', [tempResult.value]);\n  return ok({ path: tempResult.value });\n});\n// db closed here\n```\n\n## Manual scope control\n\nFor cases where you need explicit control:\n\n```typescript\nimport { createResourceScope } from 'awaitly/resource';\n\nconst scope = createResourceScope();\n\ntry {\n  const db = scope.add(await createDbResource());\n  const cache = scope.add(await createCacheClient());\n\n  // ... work ...\n} finally {\n  await scope.close();\n}\n```\n\n## Handling cleanup errors\n\nIf cleanup fails, you get a `ResourceCleanupError`:\n\n```typescript\nimport { isResourceCleanupError } from 'awaitly/resource';\n\nconst result = await withScope(async (scope) => {\n  const db = scope.add(await createDbResource());\n  return ok(data);\n});\n\nif (!result.ok && isResourceCleanupError(result.error)) {\n  console.error('Failed to clean up:', result.error.errors);\n  // errors: Array of individual cleanup failures\n}\n```\n\n## Real-world example: Database transaction\n\n```typescript\nconst createTransaction = async (db: Database) =>\n  createResource(\n    async () => {\n      await db.query('BEGIN');\n      return db;\n    },\n    async (tx) => {\n      // Rollback if not committed\n      try {\n        await tx.query('ROLLBACK');\n      } catch {\n        // Already committed or connection lost\n      }\n    }\n  );\n\nconst transferFunds = async (from: string, to: string, amount: number) => {\n  return await withScope(async (scope) => {\n    const db = scope.add(await createDbResource());\n    const tx = scope.add(await createTransaction(db));\n\n    // Debit\n    const fromAccount = await tx.query(\n      'UPDATE accounts SET balance = balance - ? WHERE id = ? RETURNING balance',\n      [amount, from]\n    );\n\n    if (fromAccount.balance \u003C 0) {\n      return err('INSUFFICIENT_FUNDS' as const);\n      // Transaction rolled back automatically\n    }\n\n    // Credit\n    await tx.query(\n      'UPDATE accounts SET balance = balance + ? WHERE id = ?',\n      [amount, to]\n    );\n\n    // Commit\n    await tx.query('COMMIT');\n\n    return ok({ from, to, amount });\n  });\n};\n```","src/content/docs/patterns/resource-management.md","bb4a488db609a444",{"html":1363,"metadata":1364},"\u003Cp>Manage resources (database connections, file handles, API clients) with guaranteed cleanup using \u003Ccode dir=\"auto\">withScope\u003C/code>.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"basic-usage\">Basic usage\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#basic-usage\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Basic usage”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">withScope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createResource\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/resource\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withScope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">scope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Resources are tracked for automatic cleanup\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">scope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">add\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createDatabaseClient\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cache\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">scope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">add\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createCacheClient\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Do work\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">query\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">SELECT * FROM users WHERE id = ?\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">userId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cache\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">set\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user:\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">userId\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// cache closed first, then db (LIFO order) - even on errors!\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { withScope, createResource, ok } from &#x27;awaitly/resource&#x27;;const result = await withScope(async (scope) => {  // Resources are tracked for automatic cleanup  const db = scope.add(await createDatabaseClient());  const cache = scope.add(await createCacheClient());  // Do work  const user = await db.query(&#x27;SELECT * FROM users WHERE id = ?&#x27;, [userId]);  await cache.set(&#x60;user:${userId}&#x60;, user);  return ok(user);});// cache closed first, then db (LIFO order) - even on errors!\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"create-reusable-resources\">Create reusable resources\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#create-reusable-resources\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Create reusable resources”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">createResource\u003C/code> to wrap acquire/release logic:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createResource\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/resource\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createDbResource\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">connectionString\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createResource\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Acquire\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">client\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> new \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">DatabaseClient\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">connectionString\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">client\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">connect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">client\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Release\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">client\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">client\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">disconnect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createFileResource\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">path\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mode\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createResource\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">      \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handle\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">open\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">path\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mode\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handle\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handle\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handle\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">close\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createResource } from &#x27;awaitly/resource&#x27;;const createDbResource = async (connectionString: string) =>  createResource(    // Acquire    async () => {      const client = new DatabaseClient(connectionString);      await client.connect();      return client;    },    // Release    async (client) => {      await client.disconnect();    }  );const createFileResource = async (path: string, mode: string) =>  createResource(    async () => {      const handle = await fs.open(path, mode);      return handle;    },    async (handle) => {      await handle.close();    }  );\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"use-in-workflows\">Use in workflows\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#use-in-workflows\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Use in workflows”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">withScope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createResource\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">err\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/resource\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withScope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">scope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">scope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">add\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createDbResource\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">process\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">env\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">DATABASE_URL\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">query\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">SELECT * FROM users WHERE id = ?\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">as\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> const\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Database disconnected automatically\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { withScope, createResource, ok, err } from &#x27;awaitly/resource&#x27;;const result = await withScope(async (scope) => {  const db = scope.add(await createDbResource(process.env.DATABASE_URL));  const user = await db.query(&#x27;SELECT * FROM users WHERE id = ?&#x27;, [&#x27;123&#x27;]);  if (!user) {    return err(&#x27;NOT_FOUND&#x27; as const);  }  return ok(user);});// Database disconnected automatically\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"lifo-cleanup-order\">LIFO cleanup order\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#lifo-cleanup-order\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “LIFO cleanup order”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Resources are closed in reverse order of acquisition:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withScope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">scope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">scope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">add\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createDbResource\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Acquired 1st\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cache\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">scope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">add\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createCacheClient\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Acquired 2nd\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">apiClient\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">scope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">add\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createApiClient\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Acquired 3rd\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// ... work ...\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Cleanup order: apiClient → cache → db\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await withScope(async (scope) => {  const db = scope.add(await createDbResource());        // Acquired 1st  const cache = scope.add(await createCacheClient());    // Acquired 2nd  const apiClient = scope.add(await createApiClient());  // Acquired 3rd  // ... work ...  return ok(data);});// Cleanup order: apiClient → cache → db\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cp>This matters when resources depend on each other (close connections before connection pools).\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"cleanup-on-error\">Cleanup on error\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#cleanup-on-error\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Cleanup on error”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Resources are cleaned up even when the workflow fails:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withScope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">scope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">scope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">add\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createDbResource\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// This fails\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">query\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">SELECT * FROM missing_table\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// db.disconnect() still called\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await withScope(async (scope) => {  const db = scope.add(await createDbResource());  // This fails  const user = await db.query(&#x27;SELECT * FROM missing_table&#x27;);  return ok(user);});// db.disconnect() still called\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"cleanup-on-exception\">Cleanup on exception\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#cleanup-on-exception\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Cleanup on exception”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Resources are cleaned up even when code throws:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withScope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">scope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">scope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">add\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createDbResource\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">throw\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> new \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">Error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Something broke\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// db.disconnect() still called\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await withScope(async (scope) => {  const db = scope.add(await createDbResource());  throw new Error(&#x27;Something broke&#x27;);  return ok(data);});// db.disconnect() still called\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"nested-scopes\">Nested scopes\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#nested-scopes\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Nested scopes”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Scopes can be nested:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withScope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">outer\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">outer\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">add\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createDbResource\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Inner scope for temporary resources\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">tempResult\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withScope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">inner\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">tempFile\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">inner\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">add\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createTempFile\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">tempFile\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">write\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">tempFile\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">path\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// tempFile closed here\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">tempResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">tempResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">query\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">INSERT INTO files (path) VALUES (?)\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">tempResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">path\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">tempResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// db closed here\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await withScope(async (outer) => {  const db = outer.add(await createDbResource());  // Inner scope for temporary resources  const tempResult = await withScope(async (inner) => {    const tempFile = inner.add(await createTempFile());    await tempFile.write(data);    return ok(await tempFile.path());  });  // tempFile closed here  if (!tempResult.ok) {    return tempResult;  }  await db.query(&#x27;INSERT INTO files (path) VALUES (?)&#x27;, [tempResult.value]);  return ok({ path: tempResult.value });});// db closed here\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"manual-scope-control\">Manual scope control\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#manual-scope-control\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Manual scope control”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>For cases where you need explicit control:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createResourceScope\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/resource\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">scope\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createResourceScope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">try\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">scope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">add\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createDbResource\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cache\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">scope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">add\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createCacheClient\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// ... work ...\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">finally\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">scope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">close\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createResourceScope } from &#x27;awaitly/resource&#x27;;const scope = createResourceScope();try {  const db = scope.add(await createDbResource());  const cache = scope.add(await createCacheClient());  // ... work ...} finally {  await scope.close();}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"handling-cleanup-errors\">Handling cleanup errors\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#handling-cleanup-errors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Handling cleanup errors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>If cleanup fails, you get a \u003Ccode dir=\"auto\">ResourceCleanupError\u003C/code>:\u003C/p>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isResourceCleanupError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/resource\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withScope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">scope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">scope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">add\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createDbResource\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">&#x26;&#x26;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isResourceCleanupError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Failed to clean up:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">errors\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// errors: Array of individual cleanup failures\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { isResourceCleanupError } from &#x27;awaitly/resource&#x27;;const result = await withScope(async (scope) => {  const db = scope.add(await createDbResource());  return ok(data);});if (!result.ok &#x26;&#x26; isResourceCleanupError(result.error)) {  console.error(&#x27;Failed to clean up:&#x27;, result.error.errors);  // errors: Array of individual cleanup failures}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"real-world-example-database-transaction\">Real-world example: Database transaction\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#real-world-example-database-transaction\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Real-world example: Database transaction”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createTransaction\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Database\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createResource\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">query\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">BEGIN\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">tx\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Rollback if not committed\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">try\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">tx\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">query\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">ROLLBACK\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">catch\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Already committed or connection lost\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">transferFunds\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">from\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">to\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">number\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withScope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">scope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">scope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">add\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createDbResource\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">tx\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">scope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">add\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createTransaction\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Debit\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">    \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fromAccount\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">tx\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">query\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">UPDATE accounts SET balance = balance - ? WHERE id = ? RETURNING balance\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">from\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fromAccount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">balance\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">0\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">INSUFFICIENT_FUNDS\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">as\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> const\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Transaction rolled back automatically\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Credit\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">tx\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">query\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">UPDATE accounts SET balance = balance + ? WHERE id = ?\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">      \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">to\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Commit\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">tx\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">query\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">COMMIT\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">from\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">to\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">};\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const createTransaction = async (db: Database) =>  createResource(    async () => {      await db.query(&#x27;BEGIN&#x27;);      return db;    },    async (tx) => {      // Rollback if not committed      try {        await tx.query(&#x27;ROLLBACK&#x27;);      } catch {        // Already committed or connection lost      }    }  );const transferFunds = async (from: string, to: string, amount: number) => {  return await withScope(async (scope) => {    const db = scope.add(await createDbResource());    const tx = scope.add(await createTransaction(db));    // Debit    const fromAccount = await tx.query(      &#x27;UPDATE accounts SET balance = balance - ? WHERE id = ? RETURNING balance&#x27;,      [amount, from]    );    if (fromAccount.balance \u003C 0) {      return err(&#x27;INSUFFICIENT_FUNDS&#x27; as const);      // Transaction rolled back automatically    }    // Credit    await tx.query(      &#x27;UPDATE accounts SET balance = balance + ? WHERE id = ?&#x27;,      [amount, to]    );    // Commit    await tx.query(&#x27;COMMIT&#x27;);    return ok({ from, to, amount });  });};\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>",{"headings":1365,"localImagePaths":1394,"remoteImagePaths":1395,"frontmatter":1396,"imagePaths":1397},[1366,1367,1370,1373,1376,1379,1382,1385,1388,1391],{"depth":57,"slug":58,"text":59},{"depth":57,"slug":1368,"text":1369},"create-reusable-resources","Create reusable resources",{"depth":57,"slug":1371,"text":1372},"use-in-workflows","Use in workflows",{"depth":57,"slug":1374,"text":1375},"lifo-cleanup-order","LIFO cleanup order",{"depth":57,"slug":1377,"text":1378},"cleanup-on-error","Cleanup on error",{"depth":57,"slug":1380,"text":1381},"cleanup-on-exception","Cleanup on exception",{"depth":57,"slug":1383,"text":1384},"nested-scopes","Nested scopes",{"depth":57,"slug":1386,"text":1387},"manual-scope-control","Manual scope control",{"depth":57,"slug":1389,"text":1390},"handling-cleanup-errors","Handling cleanup errors",{"depth":57,"slug":1392,"text":1393},"real-world-example-database-transaction","Real-world example: Database transaction",[],[],{"title":1354,"description":1355},[],"reference/api",{"id":1398,"data":1400,"body":1406,"filePath":1407,"digest":1408,"rendered":1409},{"title":1401,"description":1402,"editUrl":16,"head":1403,"template":46,"sidebar":1404,"pagefind":16,"draft":35},"API Reference","Complete API documentation",[],{"hidden":35,"attrs":1405},{},"## Workflows\n\n### createWorkflow\n\n```typescript\ncreateWorkflow(deps)                                    // Auto-inferred error types\ncreateWorkflow(deps, { strict: true, catchUnexpected }) // Closed error union\ncreateWorkflow(deps, { onEvent, createContext })        // Event stream + context\ncreateWorkflow(deps, { cache })                         // Step caching\ncreateWorkflow(deps, { resumeState })                   // Resume from saved state\n\n// Callback signatures:\nworkflow(async (step, deps, ctx) => { ... })           // ctx is WorkflowContext\nworkflow(args, async (step, deps, args, ctx) => { ... }) // With typed args\n```\n\n### step\n\n```typescript\nstep(result)                        // Unwrap Result or exit early\nstep(result, { name, key })         // With tracing/caching options\nstep(() => result)                  // Lazy form (for caching/resume)\nstep(() => result, { name, key })   // Lazy with options\n```\n\n### step.try\n\n```typescript\nstep.try(fn, { error })             // Static error type\nstep.try(fn, { onError })           // Dynamic error from caught value\nstep.try(fn, { error, name, key })  // With tracing options\n```\n\n### Low-level run\n\n```typescript\nrun(fn)                             // One-off workflow\nrun(fn, { onError })                // With error callback\nrun(fn, { onEvent, context })       // With event stream\nrun.strict(fn, { catchUnexpected }) // Closed error union\n```\n\n## Results\n\n### Constructors\n\n```typescript\nok(value)                           // Create success\nerr(error)                          // Create error\nerr(error, { cause })               // Create error with cause\n```\n\n### Type guards\n\n```typescript\nisOk(result)                        // result is { ok: true, value }\nisErr(result)                       // result is { ok: false, error }\nisUnexpectedError(error)            // error is UnexpectedError\n```\n\n## Unwrap\n\n```typescript\nunwrap(result)                      // Value or throw UnwrapError\nunwrapOr(result, defaultValue)      // Value or default\nunwrapOrElse(result, fn)            // Value or compute from error\n```\n\n## Wrap\n\n```typescript\nfrom(fn)                            // Sync throwing → Result\nfrom(fn, onError)                   // With error mapper\nfromPromise(promise)                // Promise → Result\nfromPromise(promise, onError)       // With error mapper\ntryAsync(fn)                        // Async fn → Result\ntryAsync(fn, onError)               // With error mapper\nfromNullable(value, onNull)         // Nullable → Result\n```\n\n## Transform\n\n```typescript\nmap(result, fn)                     // Transform value\nmapError(result, fn)                // Transform error\nmapTry(result, fn, onError)         // Transform value, catch throws\nmapErrorTry(result, fn, onError)    // Transform error, catch throws\nandThen(result, fn)                 // Chain (flatMap)\nmatch(result, { ok, err })          // Pattern match\ntap(result, fn)                     // Side effect on success\ntapError(result, fn)                // Side effect on error\n```\n\n## Batch Operations\n\n```typescript\nall(results)                        // All succeed (sync, short-circuits)\nallAsync(results)                   // All succeed (async, short-circuits)\nany(results)                        // First success (sync)\nanyAsync(results)                   // First success (async)\nallSettled(results)                 // Collect all errors (sync)\nallSettledAsync(results)            // Collect all errors (async)\npartition(results)                  // Split into { values, errors }\nzip(a, b)                           // Combine two Results into tuple\nzipAsync(a, b)                      // Combine two async Results into tuple\n```\n\n## Batch Processing\n\n```typescript\nprocessInBatches(items, fn, config)         // Process with bounded concurrency\nprocessInBatches(items, fn, config, hooks)  // With progress/checkpoint hooks\n\n// Config\n{ batchSize: 20, concurrency: 3, batchDelayMs: 50 }\n\n// Hooks\n{ onProgress: (p) => {}, afterBatch: async () => ok(undefined) }\n\n// Presets\nbatchPresets.conservative  // batchSize: 20, concurrency: 3\nbatchPresets.balanced      // batchSize: 50, concurrency: 5\nbatchPresets.aggressive    // batchSize: 100, concurrency: 10\n```\n\n## Resource Management\n\n```typescript\nwithScope(async (scope) => { ... }) // RAII-style resource cleanup\ncreateResource(acquire, release)    // Create reusable resource\ncreateResourceScope()               // Manual scope control\nisResourceCleanupError(error)       // Check for cleanup failure\n```\n\n## Human-in-the-Loop (HITL)\n\n### Creating approval steps\n\n```typescript\ncreateApprovalStep\u003CT>(options)      // Create approval-gated step function\n// options: { key, checkApproval, pendingReason?, rejectedReason? }\n```\n\n### Checking approval status\n\n```typescript\nisPendingApproval(error)            // error is PendingApproval\nisApprovalRejected(error)           // error is ApprovalRejected\npendingApproval(stepKey, options?)  // Create PendingApproval error\n```\n\n### Managing approval state\n\n```typescript\ncreateApprovalStateCollector()      // Collect full resume state + pending approvals\ninjectApproval(state, { stepKey, value })  // Add approval to resume state\nclearStep(state, stepKey)           // Remove step from resume state (immutable)\nhasPendingApproval(state, stepKey)  // Check if step is pending\ngetPendingApprovals(state)          // Get all pending step keys\n```\n\n## Circuit Breaker\n\n```typescript\ncreateCircuitBreaker(name, config)  // Create circuit breaker instance\nisCircuitOpenError(error)           // Check if error is circuit open\ncircuitBreakerPresets.critical      // Preset configurations\ncircuitBreakerPresets.lenient\n```\n\n## Saga / Compensation\n\n```typescript\ncreateSagaWorkflow(deps, options)   // Create saga with auto-inferred errors\nrunSaga(fn, options)                // Low-level saga execution\nisSagaCompensationError(error)      // Check for compensation failure\n```\n\n## Rate Limiting\n\n```typescript\ncreateRateLimiter(name, config)     // Token bucket rate limiter\ncreateConcurrencyLimiter(name, cfg) // Concurrent execution limiter\ncreateCombinedLimiter(name, config) // Rate + concurrency combined\nrateLimiterPresets.api              // Preset configurations\nisRateLimitExceededError(error)     // Check if rate limited\nisQueueFullError(error)             // Check if queue full\n```\n\n## Conditional Execution\n\n```typescript\nwhen(condition, operation, opts)           // Run if true\nunless(condition, operation, opts)         // Run if false\nwhenOr(cond, op, default, opts)            // Run if true, else default\nunlessOr(cond, op, default, opts)          // Run if false, else default\ncreateConditionalHelpers(ctx)              // Factory for bound helpers\n```\n\n## Webhook / Event Triggers\n\n```typescript\ncreateWebhookHandler(workflow, fn, config) // Create HTTP handler\ncreateSimpleHandler(config)                // Simple endpoint handler\ncreateEventHandler(workflow, fn, config)   // Queue event handler\ncreateResultMapper(mappings, options)      // Map errors to HTTP codes\ncreateExpressHandler(handler)              // Express middleware\nvalidationError(message, field, details)   // Create validation error\nrequireFields(fields)                      // Field validator\n```\n\n## Policy Middleware\n\n```typescript\nmergePolicies(...policies)          // Combine policies\ncreatePolicyApplier(...policies)    // Create policy applier\nwithPolicy(policy, options)         // Apply single policy\nwithPolicies(policies, name)        // Apply multiple policies\ncreatePolicyRegistry()              // Create policy registry\nstepOptions()                       // Fluent builder\nretryPolicies.standard              // Retry presets\ntimeoutPolicies.api                 // Timeout presets\nservicePolicies.httpApi             // Combined presets\n```\n\n## Persistence\n\n```typescript\ncreateMemoryCache(options)          // In-memory cache\ncreateFileCache(options)            // File-based cache\ncreateKVCache(options)              // Key-value store cache\ncreateStatePersistence(store, prefix)      // State persistence\ncreateHydratingCache(memory, persist, id)  // Hydrating cache\nstringifyState(state, meta)         // JSON stringify\nparseState(json)                    // JSON parse\ncreateResumeStateCollector()        // Collect step events for resume state\n```\n\n## Versioning\n\n```typescript\nmigrateState(state, target, migrations)    // Apply migrations\ncreateVersionedStateLoader(config)         // Create loader with migrations\ncreateVersionedState(state, version)       // Wrap state with version\nparseVersionedState(json)                  // Parse from JSON\nstringifyVersionedState(state)             // Serialize to JSON\ncreateKeyRenameMigration(renames)          // Migration helper\ncreateKeyRemoveMigration(keys)             // Migration helper\ncreateValueTransformMigration(transforms)  // Migration helper\ncomposeMigrations(migrations)              // Combine migrations\n```\n\n## Devtools\n\n```typescript\ncreateDevtools(options)             // Create devtools instance\ncreateVisualizer(options)           // Create visualizer\nrenderDiff(diff)                    // Render run diff\nquickVisualize(events)              // Quick visualization\ncreateConsoleLogger(options)        // Console event logger\n```\n\n## Testing\n\n```typescript\ncreateWorkflowHarness(deps, options)       // Create test harness\ncreateMockFn\u003CT, E>()                       // Create mock function\ncreateTestClock(startTime)                 // Deterministic clock\ncreateSnapshot(invocations, result)        // Create snapshot\ncompareSnapshots(snapshot1, snapshot2)     // Compare snapshots\nokOutcome(value)                           // Helper for ok outcome\nerrOutcome(error)                          // Helper for err outcome\n```\n\n## OpenTelemetry (Autotel)\n\n```typescript\ncreateAutotelAdapter(config)        // Create metrics adapter\ncreateAutotelEventHandler(options)  // Event handler for debug\nwithAutotelTracing(trace, options)  // Wrap with tracing\n```\n\n## Types\n\n### Core Result types\n\n```typescript\nResult\u003CT, E, C>                     // { ok: true, value: T } | { ok: false, error: E, cause?: C }\nAsyncResult\u003CT, E, C>                // Promise\u003CResult\u003CT, E, C>>\nUnexpectedError                     // { type: 'UNEXPECTED_ERROR', cause: unknown }\n```\n\n### Workflow types\n\n```typescript\nWorkflow\u003CE, Deps, C>                // Non-strict workflow return type\nWorkflowStrict\u003CE, U, Deps, C>       // Strict workflow return type\nWorkflowOptions\u003CE, C>               // Options for createWorkflow\nWorkflowContext\u003CC>                  // Context: { workflowId, onEvent?, context? }\nStepOptions                         // { name?: string, key?: string }\nWorkflowEvent\u003CE, C>                 // Union of all event types\n```\n\n### Type extraction utilities\n\n```typescript\nErrorOf\u003CFn>                         // Extract error type from function\nCauseOf\u003CFn>                         // Extract cause type from function\nErrors\u003C[Fn1, Fn2, ...]>             // Union of error types from functions\nErrorsOfDeps\u003CDeps>                  // Extract errors from deps object\nExtractValue\u003CResult>                // Extract value type from Result\nExtractError\u003CResult>                // Extract error type from Result\n```\n\n### Cache & Resume types\n\n```typescript\nStepCache                           // Cache interface (get/set/has/delete/clear)\nResumeState                         // { steps: Map\u003Cstring, ResumeStateEntry> }\nResumeStateEntry                    // { result: Result, meta?: StepFailureMeta }\n```\n\n### HITL types\n\n```typescript\nPendingApproval                     // { type: 'PENDING_APPROVAL', stepKey, reason? }\nApprovalRejected                    // { type: 'APPROVAL_REJECTED', stepKey, reason? }\nApprovalStore                       // Approval storage interface\nWorkflowStateStore                  // State storage interface\n```\n\n### Circuit Breaker types\n\n```typescript\nCircuitState                        // 'CLOSED' | 'OPEN' | 'HALF_OPEN'\nCircuitBreakerConfig                // Configuration options\nCircuitBreakerStats                 // Runtime statistics\nCircuitOpenError                    // Error when circuit is open\n```\n\n### Saga types\n\n```typescript\nSagaContext\u003CE>                      // Context with step() and tryStep()\nSagaStepOptions\u003CT>                  // Step options with compensate\nSagaCompensationError               // Error with compensation details\n```\n\n### Rate Limiter types\n\n```typescript\nRateLimiterConfig                   // Rate limiter configuration\nConcurrencyLimiterConfig            // Concurrency limiter config\nRateLimitExceededError              // Error when rate exceeded\nQueueFullError                      // Error when queue full\n```\n\n### Resource types\n\n```typescript\nResource\u003CT>                         // Resource with value and release\nResourceScope                       // Scope for tracking resources\nResourceCleanupError                // Error during cleanup\n```\n\n### Testing types\n\n```typescript\nWorkflowHarness\u003CE, Deps>            // Test harness interface\nMockFunction\u003CT, E>                  // Mock function interface\nScriptedOutcome\u003CT, E>               // Scripted step outcome\nWorkflowSnapshot                    // Snapshot for comparison\n```","src/content/docs/reference/api.md","4bd77e9e4b84f9e8",{"html":1410,"metadata":1411},"\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"workflows\">Workflows\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#workflows\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Workflows”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"createworkflow\">createWorkflow\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#createworkflow\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “createWorkflow”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                                    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Auto-inferred error types\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">strict\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">true\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">catchUnexpected\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Closed error union\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createContext\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Event stream + context\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cache\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                         \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Step caching\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">resumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                   \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Resume from saved state\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Callback signatures:\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ctx\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">})\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">           \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// ctx is WorkflowContext\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">args\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">args\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ctx\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">})\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// With typed args\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"createWorkflow(deps)                                    // Auto-inferred error typescreateWorkflow(deps, { strict: true, catchUnexpected }) // Closed error unioncreateWorkflow(deps, { onEvent, createContext })        // Event stream + contextcreateWorkflow(deps, { cache })                         // Step cachingcreateWorkflow(deps, { resumeState })                   // Resume from saved state// Callback signatures:workflow(async (step, deps, ctx) => { ... })           // ctx is WorkflowContextworkflow(args, async (step, deps, args, ctx) => { ... }) // With typed args\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"step\">step\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#step\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “step”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Unwrap Result or exit early\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">         \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// With tracing/caching options\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Lazy form (for caching/resume)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">   \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Lazy with options\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"step(result)                        // Unwrap Result or exit earlystep(result, { name, key })         // With tracing/caching optionsstep(() => result)                  // Lazy form (for caching/resume)step(() => result, { name, key })   // Lazy with options\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"steptry\">step.try\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#steptry\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “step.try”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">try\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">             \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Static error type\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">try\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">onError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">           \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Dynamic error from caught value\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">try\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// With tracing options\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"step.try(fn, { error })             // Static error typestep.try(fn, { onError })           // Dynamic error from caught valuestep.try(fn, { error, name, key })  // With tracing options\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"low-level-run\">Low-level run\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#low-level-run\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Low-level run”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">run\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                             \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// One-off workflow\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">run\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">onError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// With error callback\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">run\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">context\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">       \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// With event stream\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">run\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">strict\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">catchUnexpected\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Closed error union\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"run(fn)                             // One-off workflowrun(fn, { onError })                // With error callbackrun(fn, { onEvent, context })       // With event streamrun.strict(fn, { catchUnexpected }) // Closed error union\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"results\">Results\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#results\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Results”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"constructors\">Constructors\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#constructors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Constructors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                           \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create success\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                          \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create error\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cause\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">               \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create error with cause\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"ok(value)                           // Create successerr(error)                          // Create errorerr(error, { cause })               // Create error with cause\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"type-guards\">Type guards\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#type-guards\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Type guards”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isOk\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// result is { ok: true, value }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isErr\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                       \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// result is { ok: false, error }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isUnexpectedError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">            \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// error is UnexpectedError\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"isOk(result)                        // result is { ok: true, value }isErr(result)                       // result is { ok: false, error }isUnexpectedError(error)            // error is UnexpectedError\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"unwrap\">Unwrap\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#unwrap\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Unwrap”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">unwrap\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Value or throw UnwrapError\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">unwrapOr\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">defaultValue\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Value or default\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">unwrapOrElse\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">            \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Value or compute from error\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"unwrap(result)                      // Value or throw UnwrapErrorunwrapOr(result, defaultValue)      // Value or defaultunwrapOrElse(result, fn)            // Value or compute from error\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"wrap\">Wrap\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#wrap\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Wrap”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">from\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                            \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Sync throwing → Result\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">from\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">onError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                   \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// With error mapper\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fromPromise\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">promise\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Promise → Result\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fromPromise\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">promise\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">onError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">       \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// With error mapper\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">tryAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Async fn → Result\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">tryAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">onError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">               \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// With error mapper\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fromNullable\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">onNull\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">         \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Nullable → Result\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"from(fn)                            // Sync throwing → Resultfrom(fn, onError)                   // With error mapperfromPromise(promise)                // Promise → ResultfromPromise(promise, onError)       // With error mappertryAsync(fn)                        // Async fn → ResulttryAsync(fn, onError)               // With error mapperfromNullable(value, onNull)         // Nullable → Result\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"transform\">Transform\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#transform\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Transform”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">map\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Transform value\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">mapError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Transform error\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">mapTry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">onError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">         \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Transform value, catch throws\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">mapErrorTry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">onError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Transform error, catch throws\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">andThen\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                 \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Chain (flatMap)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">match\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">          \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Pattern match\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">tap\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Side effect on success\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">tapError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Side effect on error\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"map(result, fn)                     // Transform valuemapError(result, fn)                // Transform errormapTry(result, fn, onError)         // Transform value, catch throwsmapErrorTry(result, fn, onError)    // Transform error, catch throwsandThen(result, fn)                 // Chain (flatMap)match(result, { ok, err })          // Pattern matchtap(result, fn)                     // Side effect on successtapError(result, fn)                // Side effect on error\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"batch-operations\">Batch Operations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#batch-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Batch Operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">all\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">results\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// All succeed (sync, short-circuits)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">allAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">results\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                   \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// All succeed (async, short-circuits)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">any\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">results\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// First success (sync)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">anyAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">results\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                   \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// First success (async)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">allSettled\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">results\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                 \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Collect all errors (sync)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">allSettledAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">results\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">            \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Collect all errors (async)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">partition\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">results\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Split into { values, errors }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">zip\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">a\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">b\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                           \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Combine two Results into tuple\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">zipAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">a\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">b\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Combine two async Results into tuple\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"all(results)                        // All succeed (sync, short-circuits)allAsync(results)                   // All succeed (async, short-circuits)any(results)                        // First success (sync)anyAsync(results)                   // First success (async)allSettled(results)                 // Collect all errors (sync)allSettledAsync(results)            // Collect all errors (async)partition(results)                  // Split into { values, errors }zip(a, b)                           // Combine two Results into tuplezipAsync(a, b)                      // Combine two async Results into tuple\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"batch-processing\">Batch Processing\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#batch-processing\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Batch Processing”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processInBatches\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">config\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">         \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Process with bounded concurrency\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processInBatches\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">config\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">hooks\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// With progress/checkpoint hooks\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Config\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">batchSize\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">20\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">concurrency\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">batchDelayMs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">50\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Hooks\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onProgress\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{},\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">afterBatch\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">undefined\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Presets\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">batchPresets\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">conservative\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// batchSize: 20, concurrency: 3\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">batchPresets\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">balanced\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// batchSize: 50, concurrency: 5\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">batchPresets\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">aggressive\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// batchSize: 100, concurrency: 10\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"processInBatches(items, fn, config)         // Process with bounded concurrencyprocessInBatches(items, fn, config, hooks)  // With progress/checkpoint hooks// Config{ batchSize: 20, concurrency: 3, batchDelayMs: 50 }// Hooks{ onProgress: (p) => {}, afterBatch: async () => ok(undefined) }// PresetsbatchPresets.conservative  // batchSize: 20, concurrency: 3batchPresets.balanced      // batchSize: 50, concurrency: 5batchPresets.aggressive    // batchSize: 100, concurrency: 10\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"resource-management\">Resource Management\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#resource-management\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Resource Management”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withScope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">scope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">})\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// RAII-style resource cleanup\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createResource\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">acquire\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">release\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create reusable resource\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createResourceScope\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">               \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Manual scope control\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isResourceCleanupError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">       \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Check for cleanup failure\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"withScope(async (scope) => { ... }) // RAII-style resource cleanupcreateResource(acquire, release)    // Create reusable resourcecreateResourceScope()               // Manual scope controlisResourceCleanupError(error)       // Check for cleanup failure\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"human-in-the-loop-hitl\">Human-in-the-Loop (HITL)\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#human-in-the-loop-hitl\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Human-in-the-Loop (HITL)”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"creating-approval-steps\">Creating approval steps\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#creating-approval-steps\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Creating approval steps”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createApprovalStep\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">T\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">options\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create approval-gated step function\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// options: { key, checkApproval, pendingReason?, rejectedReason? }\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"createApprovalStep\u003CT>(options)      // Create approval-gated step function// options: { key, checkApproval, pendingReason?, rejectedReason? }\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"checking-approval-status\">Checking approval status\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#checking-approval-status\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Checking approval status”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isPendingApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">            \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// error is PendingApproval\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isApprovalRejected\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">           \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// error is ApprovalRejected\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">pendingApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stepKey\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">options\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">)  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create PendingApproval error\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"isPendingApproval(error)            // error is PendingApprovalisApprovalRejected(error)           // error is ApprovalRejectedpendingApproval(stepKey, options?)  // Create PendingApproval error\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"managing-approval-state\">Managing approval state\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#managing-approval-state\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Managing approval state”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createApprovalStateCollector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Collect full resume state + pending approvals\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">injectApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stepKey\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> })\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Add approval to resume state\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">clearStep\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stepKey\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">           \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Remove step from resume state (immutable)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">hasPendingApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stepKey\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Check if step is pending\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getPendingApprovals\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">          \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Get all pending step keys\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"createApprovalStateCollector()      // Collect full resume state + pending approvalsinjectApproval(state, { stepKey, value })  // Add approval to resume stateclearStep(state, stepKey)           // Remove step from resume state (immutable)hasPendingApproval(state, stepKey)  // Check if step is pendinggetPendingApprovals(state)          // Get all pending step keys\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"circuit-breaker\">Circuit Breaker\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#circuit-breaker\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Circuit Breaker”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createCircuitBreaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">config\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create circuit breaker instance\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isCircuitOpenError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">           \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Check if error is circuit open\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">circuitBreakerPresets\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">critical\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Preset configurations\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">circuitBreakerPresets\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">lenient\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"createCircuitBreaker(name, config)  // Create circuit breaker instanceisCircuitOpenError(error)           // Check if error is circuit opencircuitBreakerPresets.critical      // Preset configurationscircuitBreakerPresets.lenient\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"saga--compensation\">Saga / Compensation\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#saga--compensation\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Saga / Compensation”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createSagaWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">options\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">   \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create saga with auto-inferred errors\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">runSaga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">options\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Low-level saga execution\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isSagaCompensationError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Check for compensation failure\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"createSagaWorkflow(deps, options)   // Create saga with auto-inferred errorsrunSaga(fn, options)                // Low-level saga executionisSagaCompensationError(error)      // Check for compensation failure\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"rate-limiting\">Rate Limiting\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#rate-limiting\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Rate Limiting”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createRateLimiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">config\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Token bucket rate limiter\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createConcurrencyLimiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cfg\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Concurrent execution limiter\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createCombinedLimiter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">config\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Rate + concurrency combined\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">rateLimiterPresets\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">api\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">              \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Preset configurations\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isRateLimitExceededError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Check if rate limited\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isQueueFullError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">             \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Check if queue full\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"createRateLimiter(name, config)     // Token bucket rate limitercreateConcurrencyLimiter(name, cfg) // Concurrent execution limitercreateCombinedLimiter(name, config) // Rate + concurrency combinedrateLimiterPresets.api              // Preset configurationsisRateLimitExceededError(error)     // Check if rate limitedisQueueFullError(error)             // Check if queue full\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"conditional-execution\">Conditional Execution\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#conditional-execution\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Conditional Execution”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">when\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">condition\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">operation\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">opts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">           \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Run if true\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">unless\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">condition\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">operation\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">opts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">         \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Run if false\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">whenOr\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cond\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">op\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">default\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">opts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">            \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Run if true, else default\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">unlessOr\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">cond\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">op\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">default\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">opts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">          \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Run if false, else default\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createConditionalHelpers\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ctx\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">              \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Factory for bound helpers\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"when(condition, operation, opts)           // Run if trueunless(condition, operation, opts)         // Run if falsewhenOr(cond, op, default, opts)            // Run if true, else defaultunlessOr(cond, op, default, opts)          // Run if false, else defaultcreateConditionalHelpers(ctx)              // Factory for bound helpers\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"webhook--event-triggers\">Webhook / Event Triggers\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#webhook--event-triggers\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Webhook / Event Triggers”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWebhookHandler\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">config\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create HTTP handler\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createSimpleHandler\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">config\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Simple endpoint handler\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createEventHandler\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">config\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">   \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Queue event handler\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createResultMapper\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mappings\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">options\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Map errors to HTTP codes\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createExpressHandler\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handler\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">              \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Express middleware\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">validationError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">message\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">field\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">details\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">   \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create validation error\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">requireFields\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fields\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Field validator\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"createWebhookHandler(workflow, fn, config) // Create HTTP handlercreateSimpleHandler(config)                // Simple endpoint handlercreateEventHandler(workflow, fn, config)   // Queue event handlercreateResultMapper(mappings, options)      // Map errors to HTTP codescreateExpressHandler(handler)              // Express middlewarevalidationError(message, field, details)   // Create validation errorrequireFields(fields)                      // Field validator\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"policy-middleware\">Policy Middleware\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#policy-middleware\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Policy Middleware”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">mergePolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(...\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">policies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">          \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Combine policies\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createPolicyApplier\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(...\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">policies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create policy applier\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withPolicy\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">policy\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">options\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">         \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Apply single policy\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withPolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">policies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Apply multiple policies\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createPolicyRegistry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">              \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create policy registry\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">stepOptions\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                       \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Fluent builder\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">retryPolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">standard\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">              \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Retry presets\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">timeoutPolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">api\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                 \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Timeout presets\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">servicePolicies\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">httpApi\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">             \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Combined presets\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"mergePolicies(...policies)          // Combine policiescreatePolicyApplier(...policies)    // Create policy applierwithPolicy(policy, options)         // Apply single policywithPolicies(policies, name)        // Apply multiple policiescreatePolicyRegistry()              // Create policy registrystepOptions()                       // Fluent builderretryPolicies.standard              // Retry presetstimeoutPolicies.api                 // Timeout presetsservicePolicies.httpApi             // Combined presets\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"persistence\">Persistence\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#persistence\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Persistence”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createMemoryCache\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">options\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">          \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// In-memory cache\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createFileCache\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">options\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">            \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// File-based cache\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createKVCache\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">options\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">              \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Key-value store cache\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createStatePersistence\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">store\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">prefix\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// State persistence\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createHydratingCache\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">memory\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">persist\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Hydrating cache\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">stringifyState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">meta\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">         \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// JSON stringify\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">parseState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// JSON parse\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createResumeStateCollector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Collect step events for resume state\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"createMemoryCache(options)          // In-memory cachecreateFileCache(options)            // File-based cachecreateKVCache(options)              // Key-value store cachecreateStatePersistence(store, prefix)      // State persistencecreateHydratingCache(memory, persist, id)  // Hydrating cachestringifyState(state, meta)         // JSON stringifyparseState(json)                    // JSON parsecreateResumeStateCollector()        // Collect step events for resume state\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"versioning\">Versioning\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#versioning\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Versioning”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">migrateState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">target\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migrations\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Apply migrations\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createVersionedStateLoader\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">config\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">         \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create loader with migrations\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createVersionedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">version\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">       \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Wrap state with version\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">parseVersionedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Parse from JSON\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">stringifyVersionedState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">state\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">             \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Serialize to JSON\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createKeyRenameMigration\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">renames\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">          \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Migration helper\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createKeyRemoveMigration\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">keys\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">             \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Migration helper\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createValueTransformMigration\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">transforms\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Migration helper\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">composeMigrations\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">migrations\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">              \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Combine migrations\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"migrateState(state, target, migrations)    // Apply migrationscreateVersionedStateLoader(config)         // Create loader with migrationscreateVersionedState(state, version)       // Wrap state with versionparseVersionedState(json)                  // Parse from JSONstringifyVersionedState(state)             // Serialize to JSONcreateKeyRenameMigration(renames)          // Migration helpercreateKeyRemoveMigration(keys)             // Migration helpercreateValueTransformMigration(transforms)  // Migration helpercomposeMigrations(migrations)              // Combine migrations\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"devtools\">Devtools\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#devtools\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Devtools”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createDevtools\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">options\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">             \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create devtools instance\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createVisualizer\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">options\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">           \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create visualizer\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">renderDiff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">diff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Render run diff\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">quickVisualize\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">events\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">              \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Quick visualization\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createConsoleLogger\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">options\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Console event logger\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"createDevtools(options)             // Create devtools instancecreateVisualizer(options)           // Create visualizerrenderDiff(diff)                    // Render run diffquickVisualize(events)              // Quick visualizationcreateConsoleLogger(options)        // Console event logger\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"testing\">Testing\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#testing\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Testing”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflowHarness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">options\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">       \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create test harness\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createMockFn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">T\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">E\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>()\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                       \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create mock function\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createTestClock\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">startTime\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                 \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Deterministic clock\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createSnapshot\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">invocations\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create snapshot\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">compareSnapshots\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">snapshot1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">snapshot2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Compare snapshots\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">okOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                           \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Helper for ok outcome\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">errOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                          \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Helper for err outcome\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"createWorkflowHarness(deps, options)       // Create test harnesscreateMockFn\u003CT, E>()                       // Create mock functioncreateTestClock(startTime)                 // Deterministic clockcreateSnapshot(invocations, result)        // Create snapshotcompareSnapshots(snapshot1, snapshot2)     // Compare snapshotsokOutcome(value)                           // Helper for ok outcomeerrOutcome(error)                          // Helper for err outcome\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"opentelemetry-autotel\">OpenTelemetry (Autotel)\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#opentelemetry-autotel\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “OpenTelemetry (Autotel)”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createAutotelAdapter\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">config\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Create metrics adapter\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createAutotelEventHandler\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">options\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Event handler for debug\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withAutotelTracing\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">trace\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">options\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Wrap with tracing\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"createAutotelAdapter(config)        // Create metrics adaptercreateAutotelEventHandler(options)  // Event handler for debugwithAutotelTracing(trace, options)  // Wrap with tracing\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"types\">Types\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#types\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Types”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"core-result-types\">Core Result types\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#core-result-types\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Core Result types”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">Result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">T\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">E\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">C\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// { ok: true, value: T } | { ok: false, error: E, cause?: C }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">T\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">E\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">C\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Promise&#x3C;Result&#x3C;T, E, C>>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">UnexpectedError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// { type: 'UNEXPECTED_ERROR', cause: unknown }\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"Result\u003CT, E, C>                     // { ok: true, value: T } | { ok: false, error: E, cause?: C }AsyncResult\u003CT, E, C>                // Promise\u003CResult\u003CT, E, C>>UnexpectedError                     // { type: &#x27;UNEXPECTED_ERROR&#x27;, cause: unknown }\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"workflow-types\">Workflow types\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#workflow-types\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Workflow types”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">Workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">E\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">Deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">C\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Non-strict workflow return type\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">WorkflowStrict\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">E\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">U\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">Deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">C\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">       \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Strict workflow return type\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">WorkflowOptions\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">E\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">C\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">               \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Options for createWorkflow\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">WorkflowContext\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">C\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Context: { workflowId, onEvent?, context? }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">StepOptions\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                         \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// { name?: string, key?: string }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">WorkflowEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">E\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">C\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                 \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Union of all event types\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"Workflow\u003CE, Deps, C>                // Non-strict workflow return typeWorkflowStrict\u003CE, U, Deps, C>       // Strict workflow return typeWorkflowOptions\u003CE, C>               // Options for createWorkflowWorkflowContext\u003CC>                  // Context: { workflowId, onEvent?, context? }StepOptions                         // { name?: string, key?: string }WorkflowEvent\u003CE, C>                 // Union of all event types\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"type-extraction-utilities\">Type extraction utilities\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#type-extraction-utilities\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Type extraction utilities”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">ErrorOf\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">Fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                         \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Extract error type from function\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">CauseOf\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">Fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                         \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Extract cause type from function\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">Errors\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;[\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">Fn1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">Fn2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">...]>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">             \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Union of error types from functions\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">ErrorsOfDeps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">Deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Extract errors from deps object\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">ExtractValue\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">Result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Extract value type from Result\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">ExtractError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">Result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Extract error type from Result\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"ErrorOf\u003CFn>                         // Extract error type from functionCauseOf\u003CFn>                         // Extract cause type from functionErrors\u003C[Fn1, Fn2, ...]>             // Union of error types from functionsErrorsOfDeps\u003CDeps>                  // Extract errors from deps objectExtractValue\u003CResult>                // Extract value type from ResultExtractError\u003CResult>                // Extract error type from Result\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"cache--resume-types\">Cache &#x26; Resume types\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#cache--resume-types\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Cache &#x26; Resume types”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">StepCache\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                           \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Cache interface (get/set/has/delete/clear)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">ResumeState\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                         \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// { steps: Map&#x3C;string, ResumeStateEntry> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">ResumeStateEntry\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// { result: Result, meta?: StepFailureMeta }\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"StepCache                           // Cache interface (get/set/has/delete/clear)ResumeState                         // { steps: Map\u003Cstring, ResumeStateEntry> }ResumeStateEntry                    // { result: Result, meta?: StepFailureMeta }\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"hitl-types\">HITL types\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#hitl-types\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “HITL types”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">PendingApproval\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                     \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// { type: 'PENDING_APPROVAL', stepKey, reason? }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">ApprovalRejected\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// { type: 'APPROVAL_REJECTED', stepKey, reason? }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">ApprovalStore\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                       \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Approval storage interface\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">WorkflowStateStore\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// State storage interface\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"PendingApproval                     // { type: &#x27;PENDING_APPROVAL&#x27;, stepKey, reason? }ApprovalRejected                    // { type: &#x27;APPROVAL_REJECTED&#x27;, stepKey, reason? }ApprovalStore                       // Approval storage interfaceWorkflowStateStore                  // State storage interface\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"circuit-breaker-types\">Circuit Breaker types\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#circuit-breaker-types\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Circuit Breaker types”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">CircuitState\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                        \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 'CLOSED' | 'OPEN' | 'HALF_OPEN'\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">CircuitBreakerConfig\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Configuration options\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">CircuitBreakerStats\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                 \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Runtime statistics\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">CircuitOpenError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Error when circuit is open\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"CircuitState                        // &#x27;CLOSED&#x27; | &#x27;OPEN&#x27; | &#x27;HALF_OPEN&#x27;CircuitBreakerConfig                // Configuration optionsCircuitBreakerStats                 // Runtime statisticsCircuitOpenError                    // Error when circuit is open\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"saga-types\">Saga types\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#saga-types\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Saga types”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">SagaContext\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">E\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Context with step() and tryStep()\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">SagaStepOptions\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">T\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Step options with compensate\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">SagaCompensationError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">               \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Error with compensation details\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"SagaContext\u003CE>                      // Context with step() and tryStep()SagaStepOptions\u003CT>                  // Step options with compensateSagaCompensationError               // Error with compensation details\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"rate-limiter-types\">Rate Limiter types\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#rate-limiter-types\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Rate Limiter types”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">RateLimiterConfig\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                   \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Rate limiter configuration\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">ConcurrencyLimiterConfig\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">            \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Concurrency limiter config\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">RateLimitExceededError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">              \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Error when rate exceeded\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">QueueFullError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                      \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Error when queue full\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"RateLimiterConfig                   // Rate limiter configurationConcurrencyLimiterConfig            // Concurrency limiter configRateLimitExceededError              // Error when rate exceededQueueFullError                      // Error when queue full\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"resource-types\">Resource types\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#resource-types\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Resource types”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">Resource\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">T\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                         \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Resource with value and release\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">ResourceScope\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                       \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Scope for tracking resources\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">ResourceCleanupError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Error during cleanup\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"Resource\u003CT>                         // Resource with value and releaseResourceScope                       // Scope for tracking resourcesResourceCleanupError                // Error during cleanup\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"testing-types\">Testing types\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#testing-types\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Testing types”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">WorkflowHarness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">E\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">Deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">            \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Test harness interface\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">MockFunction\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">T\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">E\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Mock function interface\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">ScriptedOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">T\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">E\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">               \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Scripted step outcome\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">WorkflowSnapshot\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\">                    \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Snapshot for comparison\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"WorkflowHarness\u003CE, Deps>            // Test harness interfaceMockFunction\u003CT, E>                  // Mock function interfaceScriptedOutcome\u003CT, E>               // Scripted step outcomeWorkflowSnapshot                    // Snapshot for comparison\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>",{"headings":1412,"localImagePaths":1514,"remoteImagePaths":1515,"frontmatter":1516,"imagePaths":1517},[1413,1415,1416,1418,1421,1424,1426,1429,1430,1433,1436,1439,1441,1443,1445,1448,1451,1454,1457,1458,1460,1462,1464,1467,1470,1472,1475,1476,1478,1481,1484,1487,1490,1493,1496,1499,1502,1505,1508,1511],{"depth":57,"slug":1414,"text":524},"workflows",{"depth":212,"slug":537,"text":538},{"depth":212,"slug":1417,"text":1417},"step",{"depth":212,"slug":1419,"text":1420},"steptry","step.try",{"depth":212,"slug":1422,"text":1423},"low-level-run","Low-level run",{"depth":57,"slug":1425,"text":343},"results",{"depth":212,"slug":1427,"text":1428},"constructors","Constructors",{"depth":212,"slug":362,"text":363},{"depth":57,"slug":1431,"text":1432},"unwrap","Unwrap",{"depth":57,"slug":1434,"text":1435},"wrap","Wrap",{"depth":57,"slug":1437,"text":1438},"transform","Transform",{"depth":57,"slug":258,"text":1440},"Batch Operations",{"depth":57,"slug":1442,"text":733},"batch-processing",{"depth":57,"slug":1444,"text":1354},"resource-management",{"depth":57,"slug":1446,"text":1447},"human-in-the-loop-hitl","Human-in-the-Loop (HITL)",{"depth":212,"slug":1449,"text":1450},"creating-approval-steps","Creating approval steps",{"depth":212,"slug":1452,"text":1453},"checking-approval-status","Checking approval status",{"depth":212,"slug":1455,"text":1456},"managing-approval-state","Managing approval state",{"depth":57,"slug":1221,"text":88},{"depth":57,"slug":1459,"text":43},"saga--compensation",{"depth":57,"slug":1461,"text":235},"rate-limiting",{"depth":57,"slug":1463,"text":575},"conditional-execution",{"depth":57,"slug":1465,"text":1466},"webhook--event-triggers","Webhook / Event Triggers",{"depth":57,"slug":1468,"text":1469},"policy-middleware","Policy Middleware",{"depth":57,"slug":1471,"text":774},"persistence",{"depth":57,"slug":1473,"text":1474},"versioning","Versioning",{"depth":57,"slug":1023,"text":1024},{"depth":57,"slug":1477,"text":928},"testing",{"depth":57,"slug":1479,"text":1480},"opentelemetry-autotel","OpenTelemetry (Autotel)",{"depth":57,"slug":1482,"text":1483},"types","Types",{"depth":212,"slug":1485,"text":1486},"core-result-types","Core Result types",{"depth":212,"slug":1488,"text":1489},"workflow-types","Workflow types",{"depth":212,"slug":1491,"text":1492},"type-extraction-utilities","Type extraction utilities",{"depth":212,"slug":1494,"text":1495},"cache--resume-types","Cache & Resume types",{"depth":212,"slug":1497,"text":1498},"hitl-types","HITL types",{"depth":212,"slug":1500,"text":1501},"circuit-breaker-types","Circuit Breaker types",{"depth":212,"slug":1503,"text":1504},"saga-types","Saga types",{"depth":212,"slug":1506,"text":1507},"rate-limiter-types","Rate Limiter types",{"depth":212,"slug":1509,"text":1510},"resource-types","Resource types",{"depth":212,"slug":1512,"text":1513},"testing-types","Testing types",[],[],{"title":1401,"description":1402},[],"reference/quick-reference",{"id":1518,"data":1520,"body":1526,"filePath":1527,"digest":1528,"rendered":1529},{"title":1521,"description":1522,"editUrl":16,"head":1523,"template":46,"sidebar":1524,"pagefind":16,"draft":35},"Quick Reference","Decision guide for choosing the right awaitly APIs",[],{"hidden":35,"attrs":1525},{},"## I want to...\n\n### Handle errors without exceptions\n\n```typescript\nimport { ok, err, type AsyncResult } from 'awaitly';\n\nasync function fetchUser(id: string): AsyncResult\u003CUser, 'NOT_FOUND'> {\n  const user = await db.find(id);\n  return user ? ok(user) : err('NOT_FOUND');\n}\n```\n\n### Compose multiple Result-returning functions\n\n```typescript\nimport { createWorkflow } from 'awaitly/workflow';\n\nconst workflow = createWorkflow({ fetchUser, chargeCard });\nconst result = await workflow(async (step) => {\n  const user = await step(() => fetchUser('1'));\n  const charge = await step(() => chargeCard(user.id, 100));\n  return { user, charge };\n});\n// result.error is: 'NOT_FOUND' | 'CARD_DECLINED' | UnexpectedError\n```\n\n### Run multiple operations in parallel\n\n```typescript\nimport { allAsync, anyAsync, allSettledAsync } from 'awaitly';\n\n// All must succeed (fail-fast on first error)\nconst [user, posts] = await allAsync([fetchUser('1'), fetchPosts('1')]);\n\n// First success wins (failover pattern)\nconst data = await anyAsync([fetchFromPrimary(), fetchFromBackup()]);\n\n// Collect ALL errors (if any fail)\nconst result = await allSettledAsync([op1(), op2(), op3()]);\nif (!result.ok) console.log('Errors:', result.error.map(e => e.error));\n```\n\n### Combine two Results into a tuple\n\n```typescript\nimport { zip, zipAsync, andThen } from 'awaitly';\n\n// Sync: combine two Results\nconst combined = zip(userResult, postsResult);\n// combined: Result\u003C[User, Post[]], UserError | PostsError>\n\n// Async: run two fetches in parallel\nconst data = await zipAsync(fetchUser('1'), fetchPosts('1'));\nif (data.ok) {\n  const [user, posts] = data.value;\n}\n\n// Chain with andThen\nconst dashboard = andThen(\n  zip(userResult, postsResult),\n  ([user, posts]) => createDashboard(user, posts)\n);\n```\n\n### Undo completed steps when one fails\n\n```typescript\nimport { createSagaWorkflow } from 'awaitly/workflow';\n\nconst saga = createSagaWorkflow({ charge, refund, reserve, release });\nconst result = await saga(async (s) => {\n  const payment = await s.step(\n    () => charge({ amount: 100 }),\n    { name: 'charge', compensate: (p) => refund({ id: p.id }) }\n  );\n  // If next step fails, charge is automatically refunded (LIFO order)\n  const reservation = await s.step(\n    () => reserve({ items }),\n    { name: 'reserve', compensate: (r) => release({ id: r.id }) }\n  );\n  return { payment, reservation };\n});\n```\n\n### Wait for human approval\n\n```typescript\nimport { createApprovalStep, isPendingApproval, injectApproval } from 'awaitly/hitl';\nimport { stringifyState, parseState } from 'awaitly/persistence';\n\nconst approvalStep = createApprovalStep({\n  key: 'manager-approval',\n  checkApproval: async () => {\n    const record = await db.approvals.find('workflow-123');\n    if (!record) return { status: 'pending' };\n    return record.approved ? { status: 'approved', value: record } : { status: 'rejected' };\n  },\n});\n\n// Workflow pauses at approval step\nconst result = await workflow(async (step) => {\n  const data = await step(() => fetchData());\n  const approval = await step(approvalStep);\n  return finalize(data);\n});\n\nif (!result.ok && isPendingApproval(result.error)) {\n  // Save state and wait for approval...\n}\n```\n\n### Persist and resume workflow state\n\n```typescript\nimport { createResumeStateCollector, createWorkflow } from 'awaitly/workflow';\nimport { stringifyState, parseState } from 'awaitly/persistence';\n\n// Capture state as workflow executes\nconst collector = createResumeStateCollector();\nawait workflow(fn, { onEvent: collector.handleEvent });\n\n// Persist state\nconst json = stringifyState(collector.getResumeState());\nawait db.save(workflowId, json);\n\n// Resume later\nconst saved = await db.load(workflowId);\nconst resumeState = parseState(saved);\nconst workflow = createWorkflow(deps, { resumeState });\n```\n\n### Retry failed operations\n\n```typescript\nimport { createWorkflow } from 'awaitly/workflow';\n\nconst workflow = createWorkflow(deps);\nconst result = await workflow(async (step) => {\n  // Retry up to 3 times with exponential backoff\n  const data = await step.retry(\n    () => fetchUnreliableAPI(),\n    { maxAttempts: 3, backoff: 'exponential', baseDelay: 100 }\n  );\n  return data;\n});\n```\n\n### Add timeouts to operations\n\n```typescript\nconst result = await workflow(async (step) => {\n  // Timeout after 5 seconds\n  const data = await step.withTimeout(\n    () => slowOperation(),\n    { ms: 5000, name: 'slow-op' }\n  );\n  return data;\n});\n```\n\n### Process large datasets in batches\n\n```typescript\nimport { processInBatches, batchPresets } from 'awaitly/batch';\n\nconst result = await processInBatches(\n  users,\n  async (user) => migrateUser(user),\n  { batchSize: 50, concurrency: 5 },\n  { onProgress: (p) => console.log(`${p.percent}%`) }\n);\n```\n\n### Prevent cascading failures\n\n```typescript\nimport { createCircuitBreaker, isCircuitOpenError } from 'awaitly/circuit-breaker';\n\nconst breaker = createCircuitBreaker('payment-api', {\n  failureThreshold: 5,\n  resetTimeMs: 30000,\n});\n\nconst result = await breaker.call(() => paymentAPI.charge());\nif (!result.ok && isCircuitOpenError(result.error)) {\n  // Circuit is open - fail fast without calling the API\n}\n```\n\n### Test workflows deterministically\n\n```typescript\nimport { createWorkflowHarness, okOutcome, errOutcome } from 'awaitly/testing';\n\nconst harness = createWorkflowHarness(deps);\nharness.script([\n  okOutcome({ id: '1', name: 'Alice' }),\n  errOutcome('PAYMENT_DECLINED'),\n]);\n\nconst result = await harness.run(async (step) => {\n  const user = await step(() => fetchUser('1'));\n  const charge = await step(() => chargeCard(100));\n  return { user, charge };\n});\n\nexpect(result.ok).toBe(false);\nharness.assertSteps(['fetch-user', 'charge-card']);\n```\n\n---\n\n## Import Cheatsheet\n\n| Need | Import from |\n|------|-------------|\n| Result types + composition (`ok`, `err`, `isOk`, `isErr`, `map`, `mapError`, `andThen`, `tap`, `from`, `fromPromise`, `all`, `allAsync`, `partition`, `match`, `run`, `TaggedError`) | `awaitly` |\n| Workflow engine (`createWorkflow`, `Duration`, `isStepComplete`, `createResumeStateCollector`, step types, `ResumeState`) | `awaitly/workflow` |\n| Saga pattern (`createSagaWorkflow`) | `awaitly/workflow` |\n| Parallel ops (`allAsync`, `allSettledAsync`, `zip`, `zipAsync`) | `awaitly` |\n| HITL (`pendingApproval`, `createApprovalStep`, `gatedStep`, `injectApproval`, `isPendingApproval`) | `awaitly/hitl` |\n| State persistence (`stringifyState`, `parseState`) | `awaitly/persistence` |\n| Batch processing (`processInBatches`) | `awaitly/batch` |\n| Circuit breaker | `awaitly/circuit-breaker` |\n| Rate limiting | `awaitly/ratelimit` |\n| Testing utilities | `awaitly/testing` |\n| Visualization | `awaitly/visualize` |\n| Duration helpers | `awaitly/workflow` |\n| Tagged errors | `awaitly` |\n| Pattern matching | `awaitly` |\n\n---\n\n## Module Sizes\n\nFor optimal bundle size, import from specific entry points:\n\n| Entry Point | Use Case |\n|-------------|----------|\n| `awaitly` | Result types, transforms, and `run()` for composition |\n| `awaitly/workflow` | Workflow engine (`createWorkflow`, `Duration`, etc.) |\n| `awaitly/hitl` | Human-in-the-loop (`createApprovalStep`, `isPendingApproval`, etc.) |\n| `awaitly/persistence` | State serialization (`stringifyState`, `parseState`) |\n| `awaitly/batch` | Batch processing only |\n\n---\n\n## Decision Matrix\n\n| Scenario | Pattern | Key APIs |\n|----------|---------|----------|\n| Linear multi-step operations | Workflow | `createWorkflow`, `step()` |\n| Steps that may need rollback | Saga | `createSagaWorkflow`, `compensate` |\n| Independent parallel calls | Parallel | `allAsync()`, `allSettledAsync()` |\n| First success wins (failover) | Race | `anyAsync()` |\n| Human approval gates | HITL | `createApprovalStep()`, `injectApproval()` |\n| High-volume processing | Batch | `processInBatches()` |\n| Flaky external APIs | Circuit Breaker | `createCircuitBreaker()` |\n| Rate-limited APIs | Rate Limiter | `createRateLimiter()` |\n\n---\n\n## Common Patterns\n\n### Typed error domains\n\n```typescript\n// Define error types per domain\ntype UserError = 'NOT_FOUND' | 'SUSPENDED';\ntype PaymentError = 'DECLINED' | 'EXPIRED' | 'LIMIT_EXCEEDED';\n\n// Workflows automatically union all possible errors\nconst workflow = createWorkflow({ fetchUser, chargeCard });\n// result.error is: UserError | PaymentError | UnexpectedError\n```\n\n### Extracting error types from functions\n\n```typescript\nimport type { ErrorOf, Errors } from 'awaitly';\n\ntype FetchUserError = ErrorOf\u003Ctypeof fetchUser>; // 'NOT_FOUND' | 'SUSPENDED'\ntype AllErrors = Errors\u003C[typeof fetchUser, typeof chargeCard]>; // Union of all\n```\n\n### Unwrapping results\n\n```typescript\nimport { unwrap, unwrapOr, unwrapOrElse, UnwrapError } from 'awaitly';\n\n// Throws UnwrapError if err\nconst user = unwrap(result);\n\n// Returns default if err\nconst user = unwrapOr(result, defaultUser);\n\n// Compute default from error\nconst user = unwrapOrElse(result, (error) => createGuestUser(error));\n```\n\n### Transforming results\n\n```typescript\nimport { map, mapError, andThen, match } from 'awaitly';\n\n// Transform value (if ok)\nconst name = map(userResult, user => user.name);\n\n// Transform error (if err)\nconst apiError = mapError(result, error => ({ code: 'API_ERROR', cause: error }));\n\n// Chain operations (flatMap)\nconst posts = andThen(userResult, user => fetchPosts(user.id));\n\n// Pattern match\nconst message = match(result, {\n  ok: (user) => `Hello, ${user.name}!`,\n  err: (error) => `Failed: ${error}`,\n});\n```","src/content/docs/reference/quick-reference.md","4c5ecf0652f8a78e",{"html":1530,"metadata":1531},"\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"i-want-to\">I want to…\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#i-want-to\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “I want to…”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"handle-errors-without-exceptions\">Handle errors without exceptions\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#handle-errors-without-exceptions\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Handle errors without exceptions”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Clink rel=\"stylesheet\" href=\"/_astro/ec.t5t0k.css\">\u003Cscript type=\"module\" src=\"/_astro/ec.0vx5m.js\">\u003C/script>\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">function\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">string\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">):\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AsyncResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">User\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">find\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">:\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { ok, err, type AsyncResult } from &#x27;awaitly&#x27;;async function fetchUser(id: string): AsyncResult\u003CUser, &#x27;NOT_FOUND&#x27;> {  const user = await db.find(id);  return user ? ok(user) : err(&#x27;NOT_FOUND&#x27;);}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"compose-multiple-result-returning-functions\">Compose multiple Result-returning functions\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#compose-multiple-result-returning-functions\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Compose multiple Result-returning functions”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">100\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// result.error is: 'NOT_FOUND' | 'CARD_DECLINED' | UnexpectedError\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createWorkflow } from &#x27;awaitly/workflow&#x27;;const workflow = createWorkflow({ fetchUser, chargeCard });const result = await workflow(async (step) => {  const user = await step(() => fetchUser(&#x27;1&#x27;));  const charge = await step(() => chargeCard(user.id, 100));  return { user, charge };});// result.error is: &#x27;NOT_FOUND&#x27; | &#x27;CARD_DECLINED&#x27; | UnexpectedError\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"run-multiple-operations-in-parallel\">Run multiple operations in parallel\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#run-multiple-operations-in-parallel\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Run multiple operations in parallel”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">allAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">anyAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">allSettledAsync\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// All must succeed (fail-fast on first error)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">allAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)]);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// First success wins (failover pattern)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">anyAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchFromPrimary\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchFromBackup\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()]);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Collect ALL errors (if any fail)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">allSettledAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">op1\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">op2\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">op3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()]);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Errors:\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">map\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">e\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { allAsync, anyAsync, allSettledAsync } from &#x27;awaitly&#x27;;// All must succeed (fail-fast on first error)const [user, posts] = await allAsync([fetchUser(&#x27;1&#x27;), fetchPosts(&#x27;1&#x27;)]);// First success wins (failover pattern)const data = await anyAsync([fetchFromPrimary(), fetchFromBackup()]);// Collect ALL errors (if any fail)const result = await allSettledAsync([op1(), op2(), op3()]);if (!result.ok) console.log(&#x27;Errors:&#x27;, result.error.map(e => e.error));\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"combine-two-results-into-a-tuple\">Combine two Results into a tuple\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#combine-two-results-into-a-tuple\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Combine two Results into a tuple”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">zip\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">zipAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">andThen\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Sync: combine two Results\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">combined\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">zip\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">userResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">postsResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// combined: Result&#x3C;[User, Post[]], UserError | PostsError>\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Async: run two fetches in parallel\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">zipAsync\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">[\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Chain with andThen\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">dashboard\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">andThen\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">zip\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">userResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">postsResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">])\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createDashboard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { zip, zipAsync, andThen } from &#x27;awaitly&#x27;;// Sync: combine two Resultsconst combined = zip(userResult, postsResult);// combined: Result\u003C[User, Post[]], UserError | PostsError>// Async: run two fetches in parallelconst data = await zipAsync(fetchUser(&#x27;1&#x27;), fetchPosts(&#x27;1&#x27;));if (data.ok) {  const [user, posts] = data.value;}// Chain with andThenconst dashboard = andThen(  zip(userResult, postsResult),  ([user, posts]) => createDashboard(user, posts));\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"undo-completed-steps-when-one-fails\">Undo completed steps when one fails\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#undo-completed-steps-when-one-fails\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Undo completed steps when one fails”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createSagaWorkflow\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saga\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createSagaWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">refund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reserve\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">release\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">saga\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">s\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">s\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">amount\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">100\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">charge\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">compensate\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">refund\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }) }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// If next step fails, charge is automatically refunded (LIFO order)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reservation\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">s\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">reserve\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">items\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">reserve\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">compensate\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">r\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">release\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">r\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }) }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">payment\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">reservation\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createSagaWorkflow } from &#x27;awaitly/workflow&#x27;;const saga = createSagaWorkflow({ charge, refund, reserve, release });const result = await saga(async (s) => {  const payment = await s.step(    () => charge({ amount: 100 }),    { name: &#x27;charge&#x27;, compensate: (p) => refund({ id: p.id }) }  );  // If next step fails, charge is automatically refunded (LIFO order)  const reservation = await s.step(    () => reserve({ items }),    { name: &#x27;reserve&#x27;, compensate: (r) => release({ id: r.id }) }  );  return { payment, reservation };});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"wait-for-human-approval\">Wait for human approval\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#wait-for-human-approval\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Wait for human approval”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createApprovalStep\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isPendingApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">injectApproval\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/hitl\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stringifyState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">parseState\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/persistence\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">approvalStep\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createApprovalStep\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">key\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">manager-approval\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">checkApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> () => {\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">record\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">approvals\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">find\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">workflow-123\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> (\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">record\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">pending\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">record\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">approved\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">?\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">approved\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">value\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">record\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> } \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">:\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> { \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">status\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">rejected\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">},\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Workflow pauses at approval step\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchData\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">approval\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">approvalStep\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">finalize\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">&#x26;&#x26;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isPendingApproval\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Save state and wait for approval...\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createApprovalStep, isPendingApproval, injectApproval } from &#x27;awaitly/hitl&#x27;;import { stringifyState, parseState } from &#x27;awaitly/persistence&#x27;;const approvalStep = createApprovalStep({  key: &#x27;manager-approval&#x27;,  checkApproval: async () => {    const record = await db.approvals.find(&#x27;workflow-123&#x27;);    if (!record) return { status: &#x27;pending&#x27; };    return record.approved ? { status: &#x27;approved&#x27;, value: record } : { status: &#x27;rejected&#x27; };  },});// Workflow pauses at approval stepconst result = await workflow(async (step) => {  const data = await step(() => fetchData());  const approval = await step(approvalStep);  return finalize(data);});if (!result.ok &#x26;&#x26; isPendingApproval(result.error)) {  // Save state and wait for approval...}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"persist-and-resume-workflow-state\">Persist and resume workflow state\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#persist-and-resume-workflow-state\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Persist and resume workflow state”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createResumeStateCollector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">stringifyState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">parseState\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/persistence\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Capture state as workflow executes\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createResumeStateCollector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">();\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fn\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">onEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">handleEvent\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Persist state\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">json\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">stringifyState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">collector\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">getResumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">save\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflowId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">json\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Resume later\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saved\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">db\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">load\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflowId\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">resumeState\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">parseState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">saved\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">resumeState\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createResumeStateCollector, createWorkflow } from &#x27;awaitly/workflow&#x27;;import { stringifyState, parseState } from &#x27;awaitly/persistence&#x27;;// Capture state as workflow executesconst collector = createResumeStateCollector();await workflow(fn, { onEvent: collector.handleEvent });// Persist stateconst json = stringifyState(collector.getResumeState());await db.save(workflowId, json);// Resume laterconst saved = await db.load(workflowId);const resumeState = parseState(saved);const workflow = createWorkflow(deps, { resumeState });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"retry-failed-operations\">Retry failed operations\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#retry-failed-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Retry failed operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/workflow\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Retry up to 3 times with exponential backoff\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">retry\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUnreliableAPI\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">maxAttempts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">3\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">backoff\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">exponential\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">baseDelay\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">100\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createWorkflow } from &#x27;awaitly/workflow&#x27;;const workflow = createWorkflow(deps);const result = await workflow(async (step) => {  // Retry up to 3 times with exponential backoff  const data = await step.retry(    () => fetchUnreliableAPI(),    { maxAttempts: 3, backoff: &#x27;exponential&#x27;, baseDelay: 100 }  );  return data;});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"add-timeouts-to-operations\">Add timeouts to operations\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#add-timeouts-to-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Add timeouts to operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">workflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Timeout after 5 seconds\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">withTimeout\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">slowOperation\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">    \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">ms\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">slow-op\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">data\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"const result = await workflow(async (step) => {  // Timeout after 5 seconds  const data = await step.withTimeout(    () => slowOperation(),    { ms: 5000, name: &#x27;slow-op&#x27; }  );  return data;});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"process-large-datasets-in-batches\">Process large datasets in batches\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#process-large-datasets-in-batches\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Process large datasets in batches”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">processInBatches\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">batchPresets\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/batch\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">processInBatches\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">users\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">migrateUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">batchSize\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">50\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">concurrency\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> },\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">onProgress\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">console\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">log\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">p\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">percent\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">%\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) }\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { processInBatches, batchPresets } from &#x27;awaitly/batch&#x27;;const result = await processInBatches(  users,  async (user) => migrateUser(user),  { batchSize: 50, concurrency: 5 },  { onProgress: (p) => console.log(&#x60;${p.percent}%&#x60;) });\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"prevent-cascading-failures\">Prevent cascading failures\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#prevent-cascading-failures\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Prevent cascading failures”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createCircuitBreaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">isCircuitOpenError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/circuit-breaker\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">breaker\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createCircuitBreaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">payment-api\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">failureThreshold\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">5\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">resetTimeMs\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">30000\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">breaker\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">call\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">paymentAPI\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">());\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">if\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">!\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">&#x26;&#x26;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">isCircuitOpenError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">))\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Circuit is open - fail fast without calling the API\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createCircuitBreaker, isCircuitOpenError } from &#x27;awaitly/circuit-breaker&#x27;;const breaker = createCircuitBreaker(&#x27;payment-api&#x27;, {  failureThreshold: 5,  resetTimeMs: 30000,});const result = await breaker.call(() => paymentAPI.charge());if (!result.ok &#x26;&#x26; isCircuitOpenError(result.error)) {  // Circuit is open - fail fast without calling the API}\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"test-workflows-deterministically\">Test workflows deterministically\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#test-workflows-deterministically\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Test workflows deterministically”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">createWorkflowHarness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">okOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">errOutcome\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly/testing\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflowHarness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">deps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">script\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">okOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Alice\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">errOutcome\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">PAYMENT_DECLINED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">),\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">run\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">async \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">1\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">  \u003C/span>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">await\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">step\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(()\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#4C9A91;--1:#2C7181\">100\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">return\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">charge\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> };\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#80A665;--1:#4B7231\">expect\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">).\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">toBe\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">false\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#BD976A;--1:#876037\">harness\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">assertSteps\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">([\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">fetch-user\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">charge-card\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]);\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { createWorkflowHarness, okOutcome, errOutcome } from &#x27;awaitly/testing&#x27;;const harness = createWorkflowHarness(deps);harness.script([  okOutcome({ id: &#x27;1&#x27;, name: &#x27;Alice&#x27; }),  errOutcome(&#x27;PAYMENT_DECLINED&#x27;),]);const result = await harness.run(async (step) => {  const user = await step(() => fetchUser(&#x27;1&#x27;));  const charge = await step(() => chargeCard(100));  return { user, charge };});expect(result.ok).toBe(false);harness.assertSteps([&#x27;fetch-user&#x27;, &#x27;charge-card&#x27;]);\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Chr>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"import-cheatsheet\">Import Cheatsheet\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#import-cheatsheet\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Import Cheatsheet”\u003C/span>\u003C/a>\u003C/div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Need\u003C/th>\u003Cth>Import from\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Result types + composition (\u003Ccode dir=\"auto\">ok\u003C/code>, \u003Ccode dir=\"auto\">err\u003C/code>, \u003Ccode dir=\"auto\">isOk\u003C/code>, \u003Ccode dir=\"auto\">isErr\u003C/code>, \u003Ccode dir=\"auto\">map\u003C/code>, \u003Ccode dir=\"auto\">mapError\u003C/code>, \u003Ccode dir=\"auto\">andThen\u003C/code>, \u003Ccode dir=\"auto\">tap\u003C/code>, \u003Ccode dir=\"auto\">from\u003C/code>, \u003Ccode dir=\"auto\">fromPromise\u003C/code>, \u003Ccode dir=\"auto\">all\u003C/code>, \u003Ccode dir=\"auto\">allAsync\u003C/code>, \u003Ccode dir=\"auto\">partition\u003C/code>, \u003Ccode dir=\"auto\">match\u003C/code>, \u003Ccode dir=\"auto\">run\u003C/code>, \u003Ccode dir=\"auto\">TaggedError\u003C/code>)\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">awaitly\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Workflow engine (\u003Ccode dir=\"auto\">createWorkflow\u003C/code>, \u003Ccode dir=\"auto\">Duration\u003C/code>, \u003Ccode dir=\"auto\">isStepComplete\u003C/code>, \u003Ccode dir=\"auto\">createResumeStateCollector\u003C/code>, step types, \u003Ccode dir=\"auto\">ResumeState\u003C/code>)\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">awaitly/workflow\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Saga pattern (\u003Ccode dir=\"auto\">createSagaWorkflow\u003C/code>)\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">awaitly/workflow\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Parallel ops (\u003Ccode dir=\"auto\">allAsync\u003C/code>, \u003Ccode dir=\"auto\">allSettledAsync\u003C/code>, \u003Ccode dir=\"auto\">zip\u003C/code>, \u003Ccode dir=\"auto\">zipAsync\u003C/code>)\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">awaitly\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>HITL (\u003Ccode dir=\"auto\">pendingApproval\u003C/code>, \u003Ccode dir=\"auto\">createApprovalStep\u003C/code>, \u003Ccode dir=\"auto\">gatedStep\u003C/code>, \u003Ccode dir=\"auto\">injectApproval\u003C/code>, \u003Ccode dir=\"auto\">isPendingApproval\u003C/code>)\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">awaitly/hitl\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>State persistence (\u003Ccode dir=\"auto\">stringifyState\u003C/code>, \u003Ccode dir=\"auto\">parseState\u003C/code>)\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">awaitly/persistence\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Batch processing (\u003Ccode dir=\"auto\">processInBatches\u003C/code>)\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">awaitly/batch\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Circuit breaker\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">awaitly/circuit-breaker\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Rate limiting\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">awaitly/ratelimit\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Testing utilities\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">awaitly/testing\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Visualization\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">awaitly/visualize\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Duration helpers\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">awaitly/workflow\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Tagged errors\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">awaitly\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Pattern matching\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">awaitly\u003C/code>\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Chr>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"module-sizes\">Module Sizes\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#module-sizes\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Module Sizes”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>For optimal bundle size, import from specific entry points:\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Entry Point\u003C/th>\u003Cth>Use Case\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">awaitly\u003C/code>\u003C/td>\u003Ctd>Result types, transforms, and \u003Ccode dir=\"auto\">run()\u003C/code> for composition\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">awaitly/workflow\u003C/code>\u003C/td>\u003Ctd>Workflow engine (\u003Ccode dir=\"auto\">createWorkflow\u003C/code>, \u003Ccode dir=\"auto\">Duration\u003C/code>, etc.)\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">awaitly/hitl\u003C/code>\u003C/td>\u003Ctd>Human-in-the-loop (\u003Ccode dir=\"auto\">createApprovalStep\u003C/code>, \u003Ccode dir=\"auto\">isPendingApproval\u003C/code>, etc.)\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">awaitly/persistence\u003C/code>\u003C/td>\u003Ctd>State serialization (\u003Ccode dir=\"auto\">stringifyState\u003C/code>, \u003Ccode dir=\"auto\">parseState\u003C/code>)\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">awaitly/batch\u003C/code>\u003C/td>\u003Ctd>Batch processing only\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Chr>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"decision-matrix\">Decision Matrix\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#decision-matrix\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Decision Matrix”\u003C/span>\u003C/a>\u003C/div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Scenario\u003C/th>\u003Cth>Pattern\u003C/th>\u003Cth>Key APIs\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Linear multi-step operations\u003C/td>\u003Ctd>Workflow\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">createWorkflow\u003C/code>, \u003Ccode dir=\"auto\">step()\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Steps that may need rollback\u003C/td>\u003Ctd>Saga\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">createSagaWorkflow\u003C/code>, \u003Ccode dir=\"auto\">compensate\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Independent parallel calls\u003C/td>\u003Ctd>Parallel\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">allAsync()\u003C/code>, \u003Ccode dir=\"auto\">allSettledAsync()\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>First success wins (failover)\u003C/td>\u003Ctd>Race\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">anyAsync()\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Human approval gates\u003C/td>\u003Ctd>HITL\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">createApprovalStep()\u003C/code>, \u003Ccode dir=\"auto\">injectApproval()\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>High-volume processing\u003C/td>\u003Ctd>Batch\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">processInBatches()\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Flaky external APIs\u003C/td>\u003Ctd>Circuit Breaker\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">createCircuitBreaker()\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Rate-limited APIs\u003C/td>\u003Ctd>Rate Limiter\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">createRateLimiter()\u003C/code>\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Chr>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"common-patterns\">Common Patterns\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#common-patterns\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Common Patterns”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"typed-error-domains\">Typed error domains\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#typed-error-domains\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Typed error domains”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Define error types per domain\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">UserError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">NOT_FOUND\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">|\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">SUSPENDED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">PaymentError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">DECLINED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">|\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">EXPIRED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">|\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">LIMIT_EXCEEDED\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Workflows automatically union all possible errors\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">workflow\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createWorkflow\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> });\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// result.error is: UserError | PaymentError | UnexpectedError\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"// Define error types per domaintype UserError = &#x27;NOT_FOUND&#x27; | &#x27;SUSPENDED&#x27;;type PaymentError = &#x27;DECLINED&#x27; | &#x27;EXPIRED&#x27; | &#x27;LIMIT_EXCEEDED&#x27;;// Workflows automatically union all possible errorsconst workflow = createWorkflow({ fetchUser, chargeCard });// result.error is: UserError | PaymentError | UnexpectedError\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"extracting-error-types-from-functions\">Extracting error types from functions\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#extracting-error-types-from-functions\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Extracting error types from functions”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">ErrorOf\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">Errors\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">FetchUserError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">ErrorOf\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">typeof\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">>;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// 'NOT_FOUND' | 'SUSPENDED'\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">type\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">AllErrors\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#5DA994;--1:#25746A\">Errors\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">&#x3C;[\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">typeof\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">fetchUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">typeof\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">chargeCard\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">]>;\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Union of all\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import type { ErrorOf, Errors } from &#x27;awaitly&#x27;;type FetchUserError = ErrorOf\u003Ctypeof fetchUser>; // &#x27;NOT_FOUND&#x27; | &#x27;SUSPENDED&#x27;type AllErrors = Errors\u003C[typeof fetchUser, typeof chargeCard]>; // Union of all\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"unwrapping-results\">Unwrapping results\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#unwrapping-results\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Unwrapping results”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">unwrap\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">unwrapOr\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">unwrapOrElse\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">UnwrapError\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Throws UnwrapError if err\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">unwrap\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Returns default if err\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">unwrapOr\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">defaultUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Compute default from error\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">unwrapOrElse\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">)\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">createGuestUser\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { unwrap, unwrapOr, unwrapOrElse, UnwrapError } from &#x27;awaitly&#x27;;// Throws UnwrapError if errconst user = unwrap(result);// Returns default if errconst user = unwrapOr(result, defaultUser);// Compute default from errorconst user = unwrapOrElse(result, (error) => createGuestUser(error));\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"transforming-results\">Transforming results\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#transforming-results\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Transforming results”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"expressive-code\">\u003Cfigure class=\"frame not-content\">\u003Cfigcaption class=\"header\">\u003C/figcaption>\u003Cpre data-language=\"typescript\">\u003Ccode>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#55987B;--1:#1E754F\">import\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">map\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">mapError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">andThen\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">match\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">}\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">from\u003C/span>\u003Cspan style=\"--0:#DBD7CAEE;--1:#393A34\"> \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">awaitly\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">;\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Transform value (if ok)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">name\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">map\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">userResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">name\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">);\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Transform error (if err)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">apiError\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">mapError\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">({ \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">code\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">API_ERROR\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">'\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">, \u003C/span>\u003Cspan style=\"--0:#B8A965;--1:#786713\">cause\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\"> }));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Chain operations (flatMap)\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">posts\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">andThen\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">userResult\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=>\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">fetchPosts\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">id\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">));\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\n\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#818F81FE;--1:#636B63\">// Pattern match\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#CB7676;--1:#9E5252\">const \u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">message\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">=\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">match\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">(\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">result\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003Cspan style=\"--0:#CB7676;--1:#9E5252\"> \u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">{\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">ok\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Hello, \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">user\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">.\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">name\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">!\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan class=\"indent\">  \u003C/span>\u003Cspan style=\"--0:#80A665;--1:#4B7231\">err\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">: (\u003C/span>\u003Cspan style=\"--0:#BD976A;--1:#876037\">error\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">) => \u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">Failed: \u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">${\u003C/span>\u003Cspan style=\"--0:#C98A7D;--1:#96574A\">error\u003C/span>\u003Cspan style=\"--0:#55987B;--1:#1E754F\">}\u003C/span>\u003Cspan style=\"--0:#C98A7DE4;--1:#96574AFD\">`\u003C/span>\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">,\u003C/span>\u003C/div>\u003C/div>\u003Cdiv class=\"ec-line\">\u003Cdiv class=\"code\">\u003Cspan style=\"--0:#8B8B8B;--1:#686868\">});\u003C/span>\u003C/div>\u003C/div>\u003C/code>\u003C/pre>\u003Cdiv class=\"copy\">\u003Cdiv aria-live=\"polite\">\u003C/div>\u003Cbutton title=\"Copy to clipboard\" data-copied=\"Copied!\" data-code=\"import { map, mapError, andThen, match } from &#x27;awaitly&#x27;;// Transform value (if ok)const name = map(userResult, user => user.name);// Transform error (if err)const apiError = mapError(result, error => ({ code: &#x27;API_ERROR&#x27;, cause: error }));// Chain operations (flatMap)const posts = andThen(userResult, user => fetchPosts(user.id));// Pattern matchconst message = match(result, {  ok: (user) => &#x60;Hello, ${user.name}!&#x60;,  err: (error) => &#x60;Failed: ${error}&#x60;,});\">\u003Cdiv>\u003C/div>\u003C/button>\u003C/div>\u003C/figure>\u003C/div>",{"headings":1532,"localImagePaths":1594,"remoteImagePaths":1595,"frontmatter":1596,"imagePaths":1597},[1533,1536,1539,1542,1545,1548,1551,1554,1557,1560,1563,1566,1569,1571,1574,1577,1580,1583,1586,1589,1592],{"depth":57,"slug":1534,"text":1535},"i-want-to","I want to…",{"depth":212,"slug":1537,"text":1538},"handle-errors-without-exceptions","Handle errors without exceptions",{"depth":212,"slug":1540,"text":1541},"compose-multiple-result-returning-functions","Compose multiple Result-returning functions",{"depth":212,"slug":1543,"text":1544},"run-multiple-operations-in-parallel","Run multiple operations in parallel",{"depth":212,"slug":1546,"text":1547},"combine-two-results-into-a-tuple","Combine two Results into a tuple",{"depth":212,"slug":1549,"text":1550},"undo-completed-steps-when-one-fails","Undo completed steps when one fails",{"depth":212,"slug":1552,"text":1553},"wait-for-human-approval","Wait for human approval",{"depth":212,"slug":1555,"text":1556},"persist-and-resume-workflow-state","Persist and resume workflow state",{"depth":212,"slug":1558,"text":1559},"retry-failed-operations","Retry failed operations",{"depth":212,"slug":1561,"text":1562},"add-timeouts-to-operations","Add timeouts to operations",{"depth":212,"slug":1564,"text":1565},"process-large-datasets-in-batches","Process large datasets in batches",{"depth":212,"slug":1567,"text":1568},"prevent-cascading-failures","Prevent cascading failures",{"depth":212,"slug":1570,"text":929},"test-workflows-deterministically",{"depth":57,"slug":1572,"text":1573},"import-cheatsheet","Import Cheatsheet",{"depth":57,"slug":1575,"text":1576},"module-sizes","Module Sizes",{"depth":57,"slug":1578,"text":1579},"decision-matrix","Decision Matrix",{"depth":57,"slug":1581,"text":1582},"common-patterns","Common Patterns",{"depth":212,"slug":1584,"text":1585},"typed-error-domains","Typed error domains",{"depth":212,"slug":1587,"text":1588},"extracting-error-types-from-functions","Extracting error types from functions",{"depth":212,"slug":1590,"text":1591},"unwrapping-results","Unwrapping results",{"depth":212,"slug":365,"text":1593},"Transforming results",[],[],{"title":1521,"description":1522},[]]