[["Map",1,2,9,10],"meta::meta",["Map",3,4,5,6,7,8],"astro-version","5.16.8","content-config-digest","28e7bc87492477d9","astro-config-digest","{\"root\":{},\"srcDir\":{},\"publicDir\":{},\"outDir\":{},\"cacheDir\":{},\"site\":\"https://jagreehal.github.io\",\"compressHTML\":true,\"base\":\"/\",\"trailingSlash\":\"ignore\",\"output\":\"static\",\"scopedStyleStrategy\":\"where\",\"build\":{\"format\":\"directory\",\"client\":{},\"server\":{},\"assets\":\"_astro\",\"serverEntry\":\"entry.mjs\",\"redirects\":true,\"inlineStylesheets\":\"auto\",\"concurrency\":1},\"server\":{\"open\":false,\"host\":false,\"port\":4321,\"streaming\":true,\"allowedHosts\":[]},\"redirects\":{},\"image\":{\"endpoint\":{\"route\":\"/_image\"},\"service\":{\"entrypoint\":\"astro/assets/services/sharp\",\"config\":{}},\"domains\":[],\"remotePatterns\":[],\"responsiveStyles\":false},\"devToolbar\":{\"enabled\":true},\"markdown\":{\"syntaxHighlight\":{\"type\":\"shiki\",\"excludeLangs\":[\"math\"]},\"shikiConfig\":{\"langs\":[],\"langAlias\":{},\"theme\":\"github-dark\",\"themes\":{\"light\":\"one-light\",\"dark\":\"github-dark-dimmed\"},\"wrap\":false,\"transformers\":[{\"name\":\"@shikijs/transformers:meta-highlight\"},{\"name\":\"@shikijs/transformers:meta-word-highlight\"},{\"name\":\"@shikijs/transformers:notation-diff\"},{\"name\":\"@shikijs/transformers:notation-highlight\"},{\"name\":\"@shikijs/transformers:notation-highlight-word\"},{\"name\":\"@shikijs/transformers:remove-notation-escape\"},{\"name\":\"starlight-theme-nova-shiki-transformer-container\"},{}],\"defaultColor\":false},\"remarkPlugins\":[[null,{\"logger\":{\"options\":{\"dest\":{},\"level\":\"info\"},\"label\":\"astro-mermaid\"}}],null,null,null,null],\"rehypePlugins\":[[null,{\"logger\":{\"options\":{\"dest\":{},\"level\":\"info\"},\"label\":\"astro-mermaid\"}}],[null,{\"experimentalHeadingIdCompat\":false}],null],\"remarkRehype\":{},\"gfm\":true,\"smartypants\":true},\"security\":{\"checkOrigin\":true,\"allowedDomains\":[]},\"env\":{\"schema\":{},\"validateSecrets\":false},\"experimental\":{\"clientPrerender\":false,\"contentIntellisense\":false,\"headingIdCompat\":false,\"preserveScriptOrder\":false,\"liveContentCollections\":false,\"csp\":false,\"staticImportMetaEnv\":false,\"chromeDevtoolsWorkspace\":false,\"failOnPrerenderConflict\":false,\"svgo\":false},\"legacy\":{\"collections\":false},\"prefetch\":{\"prefetchAll\":true},\"i18n\":{\"defaultLocale\":\"en\",\"locales\":[\"en\"],\"routing\":{\"prefixDefaultLocale\":false,\"redirectToDefaultLocale\":false,\"fallbackType\":\"redirect\"}}}","docs",["Map",11,12,40,41,85,86,126,127,180,181,232,233,285,286,340,341,390,391,471,472,521,522,572,573,611,612,649,650,692,693,741,742,773,774,820,821,869,870,913,914,958,959,1045,1046,1101,1102,1146,1147,1181,1182,1234,1235,1281,1282,1317,1318],"index",{"id":11,"data":13,"body":37,"filePath":38,"digest":39,"deferredRender":16},{"title":14,"description":15,"editUrl":16,"head":17,"template":18,"hero":19,"sidebar":34,"pagefind":16,"draft":35},"@jagreehal/workflow","Typed async workflows with Result types and automatic error inference",true,[],"splash",{"tagline":15,"actions":20},[21,28],{"text":22,"link":23,"variant":24,"icon":25},"Get Started","/workflow/getting-started/installation/","primary",{"type":26,"name":27},"icon","right-arrow",{"text":29,"link":30,"variant":31,"icon":32},"View on GitHub","https://github.com/jagreehal/workflow","minimal",{"type":26,"name":33},"external",{"hidden":35,"attrs":36},false,{},"import { Card, CardGrid } from '@astrojs/starlight/components';\n\n## What it does\n\n- Wraps async operations in `Result\u003CT, E>` instead of try/catch\n- Infers error types from your dependencies automatically\n- Provides step caching, retries, and timeouts when you need them\n- Supports pause/resume for long-running workflows\n\n## Install\n\n```bash\nnpm install @jagreehal/workflow\n```\n\n## Basic example\n\n```typescript\nimport { createWorkflow, ok, err, type AsyncResult } from '@jagreehal/workflow';\n\n// Define operations that return Results\nconst fetchUser = async (id: string): AsyncResult\u003CUser, 'NOT_FOUND'> =>\n  id === '1' ? ok({ id, name: 'Alice' }) : err('NOT_FOUND');\n\n// Create workflow - error types are inferred\nconst workflow = createWorkflow({ fetchUser });\n\n// Run it\nconst result = await workflow(async (step) => {\n  const user = await step(fetchUser('1'));\n  return user;\n});\n\nif (result.ok) {\n  console.log(result.value.name);\n} else {\n  // TypeScript knows: result.error is 'NOT_FOUND' | UnexpectedError\n}\n```\n\n## When to use this\n\n\u003CCardGrid>\n  \u003CCard title=\"Typed errors with async/await\" icon=\"pencil\">\n    You want compile-time error checking without giving up familiar syntax\n  \u003C/Card>\n  \u003CCard title=\"Reliability primitives\" icon=\"setting\">\n    You need retries, timeouts, circuit breakers built into your workflow\n  \u003C/Card>\n  \u003CCard title=\"Long-running workflows\" icon=\"document\">\n    You're building workflows that pause for approval or persist across restarts\n  \u003C/Card>\n  \u003CCard title=\"Automatic error inference\" icon=\"approve-check\">\n    You want error types computed from dependencies, not maintained manually\n  \u003C/Card>\n\u003C/CardGrid>\n\n## When not to use this\n\n- **Simple scripts** - If you don't need typed errors, try/catch works fine\n- **Functional chaining preferred** - If you prefer `.andThen()` chains, consider [neverthrow](https://github.com/supermacro/neverthrow)\n- **Bundle size critical** - If you only need Result types without workflow features, a smaller library may suffice\n\n## Next steps\n\n\u003CCardGrid>\n  \u003CCard title=\"Installation\" icon=\"laptop\">\n    [Install the package](/workflow/getting-started/installation/) and set up your first project\n  \u003C/Card>\n  \u003CCard title=\"Your First Workflow\" icon=\"rocket\">\n    [Build a simple workflow](/workflow/getting-started/first-workflow/) in 5 minutes\n  \u003C/Card>\n  \u003CCard title=\"Core Concepts\" icon=\"open-book\">\n    [Understand Results, Steps, and Workflows](/workflow/concepts/results/)\n  \u003C/Card>\n  \u003CCard title=\"API Reference\" icon=\"list-format\">\n    [Full API documentation](/workflow/reference/api/)\n  \u003C/Card>\n\u003C/CardGrid>","src/content/docs/index.mdx","1b1c6ada16835463","advanced/saga-compensation",{"id":40,"data":42,"body":49,"filePath":50,"digest":51,"rendered":52},{"title":43,"description":44,"editUrl":16,"head":45,"template":46,"sidebar":47,"pagefind":16,"draft":35},"Saga / Compensation","Define compensating actions for rollback on failures",[],"doc",{"hidden":35,"attrs":48},{},"Define compensating actions for steps that need rollback on downstream failures. When a step fails, compensations run in reverse order.\n\n## Basic usage\n\n```typescript\nimport { createSagaWorkflow, isSagaCompensationError } from '@jagreehal/workflow';\n\n// Create saga with deps (error types inferred automatically)\nconst checkoutSaga = createSagaWorkflow(\n  { reserveInventory, chargeCard, sendConfirmation },\n  { onEvent: (event) => console.log(event) }\n);\n\nconst result = await checkoutSaga(async (saga, deps) => {\n  // Reserve inventory with compensation\n  const reservation = await saga.step(\n    () => deps.reserveInventory(items),\n    {\n      name: 'reserve-inventory',\n      compensate: (res) => releaseInventory(res.reservationId),\n    }\n  );\n\n  // Charge card with compensation\n  const payment = await saga.step(\n    () => deps.chargeCard(amount),\n    {\n      name: 'charge-card',\n      compensate: (p) => refundPayment(p.transactionId),\n    }\n  );\n\n  // If sendConfirmation fails, compensations run in reverse order:\n  // 1. refundPayment(payment.transactionId)\n  // 2. releaseInventory(reservation.reservationId)\n  await saga.step(\n    () => deps.sendConfirmation(email),\n    { name: 'send-confirmation' }\n  );\n\n  return { reservation, payment };\n});\n```\n\n## Compensation order\n\nCompensations run in reverse order of completion (LIFO):\n\n```\nStep 1: reserve-inventory ✓\nStep 2: charge-card ✓\nStep 3: send-confirmation ✗\n\nCompensation order:\n1. refund charge-card\n2. release reserve-inventory\n```\n\n## Handling compensation errors\n\n```typescript\nif (!result.ok && isSagaCompensationError(result.error)) {\n  console.log('Saga failed, compensations may have partially succeeded');\n  console.log('Compensation errors:', result.error.compensationErrors);\n  // Manual intervention may be needed\n}\n```\n\n## Steps without compensation\n\nNot every step needs compensation:\n\n```typescript\nconst result = await checkoutSaga(async (saga, deps) => {\n  // No compensation needed for reads\n  const user = await saga.step(\n    () => deps.fetchUser(userId),\n    { name: 'fetch-user' }\n  );\n\n  // Needs compensation\n  const payment = await saga.step(\n    () => deps.chargeCard(amount),\n    {\n      name: 'charge-card',\n      compensate: (p) => deps.refundPayment(p.transactionId),\n    }\n  );\n\n  // Idempotent operation - no compensation\n  await saga.step(\n    () => deps.sendEmail(user.email),\n    { name: 'send-email' }\n  );\n\n  return { payment };\n});\n```\n\n## tryStep for throwing code\n\nUse `tryStep` to catch exceptions from external libraries:\n\n```typescript\nimport { runSaga } from '@jagreehal/workflow';\n\nconst result = await runSaga\u003COrderResult, OrderError>(async (saga) => {\n  const reservation = await saga.step(\n    () => reserveInventory(items),\n    { compensate: (res) => releaseInventory(res.id) }\n  );\n\n  // tryStep catches throws and converts to error\n  const payment = await saga.tryStep(\n    () => externalPaymentApi.charge(amount), // May throw\n    {\n      error: 'PAYMENT_FAILED' as const,\n      compensate: (p) => externalPaymentApi.refund(p.txId),\n    }\n  );\n\n  return { reservation, payment };\n});\n```\n\n## Low-level runSaga\n\nFor explicit error typing without deps-based inference:\n\n```typescript\nimport { runSaga } from '@jagreehal/workflow';\n\ntype CheckoutResult = { orderId: string; chargeId: string };\ntype CheckoutError = 'INVENTORY_UNAVAILABLE' | 'PAYMENT_FAILED' | 'SEND_FAILED';\n\nconst result = await runSaga\u003CCheckoutResult, CheckoutError>(async (saga) => {\n  const reservation = await saga.step(\n    () => reserveInventory(items),\n    { compensate: (res) => releaseInventory(res.id) }\n  );\n\n  const charge = await saga.step(\n    () => chargeCard(amount),\n    { compensate: (c) => refundCharge(c.id) }\n  );\n\n  await saga.step(() => sendConfirmation(email));\n\n  return { orderId: reservation.id, chargeId: charge.id };\n});\n```\n\n## Real-world example: Order fulfillment\n\n```typescript\nconst fulfillOrder = createSagaWorkflow({\n  reserveStock,\n  createShipment,\n  chargePayment,\n  updateOrder,\n  notifyCustomer,\n});\n\nconst result = await fulfillOrder(async (saga, deps) => {\n  // Reserve inventory\n  const stock = await saga.step(\n    () => deps.reserveStock(order.items),\n    {\n      name: 'reserve-stock',\n      compensate: (s) => deps.releaseStock(s.reservationId),\n    }\n  );\n\n  // Create shipment record\n  const shipment = await saga.step(\n    () => deps.createShipment(order.address, stock),\n    {\n      name: 'create-shipment',\n      compensate: (s) => deps.cancelShipment(s.trackingId),\n    }\n  );\n\n  // Charge customer\n  const payment = await saga.step(\n    () => deps.chargePayment(order.total, order.paymentMethod),\n    {\n      name: 'charge-payment',\n      compensate: (p) => deps.refundPayment(p.transactionId),\n    }\n  );\n\n  // Update order status (idempotent, no compensation)\n  await saga.step(\n    () => deps.updateOrder(order.id, { status: 'FULFILLED', shipment, payment }),\n    { name: 'update-order' }\n  );\n\n  // Notify customer (can't really undo this)\n  await saga.step(\n    () => deps.notifyCustomer(order.customerId, { shipment, payment }),\n    { name: 'notify-customer' }\n  );\n\n  return { shipment, payment };\n});\n\nif (!result.ok) {\n  if (isSagaCompensationError(result.error)) {\n    // Log for manual review\n    await alertOps('Saga compensation had errors', result.error);\n  }\n}\n```\n\n## Best practices\n\n1. **Compensations should be idempotent** - They may run multiple times on retries\n2. **Not everything needs compensation** - Read operations and truly idempotent writes don't\n3. **Plan for compensation failures** - Have alerting and manual recovery procedures\n4. **Keep compensations simple** - Complex compensation logic is a code smell\n5. **Test the failure paths** - Saga value comes from handling failures correctly","src/content/docs/advanced/saga-compensation.md","d590b55b40476af0",{"html":53,"metadata":54},"\u003Cp>Define compensating actions for steps that need rollback on downstream failures. When a step fails, compensations run in reverse order.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"basic-usage\">Basic usage\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#basic-usage\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Basic usage”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createSagaWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">isSagaCompensationError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create saga with deps (error types inferred automatically)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> checkoutSaga\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createSagaWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { reserveInventory, chargeCard, sendConfirmation },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">event\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(event) }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> checkoutSaga\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">saga\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">deps\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Reserve inventory with compensation\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> reservation\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> saga.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> deps.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">reserveInventory\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(items),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'reserve-inventory'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      compensate\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">res\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> releaseInventory\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(res.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reservationId\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Charge card with compensation\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> payment\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> saga.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> deps.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">chargeCard\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(amount),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'charge-card'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      compensate\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">p\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> refundPayment\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(p.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">transactionId\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // If sendConfirmation fails, compensations run in reverse order:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // 1. refundPayment(payment.transactionId)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // 2. releaseInventory(reservation.reservationId)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> saga.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> deps.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">sendConfirmation\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(email),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'send-confirmation'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { reservation, payment };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createSagaWorkflow, isSagaCompensationError } from &#x27;@jagreehal/workflow&#x27;;\n\n// Create saga with deps (error types inferred automatically)\nconst checkoutSaga = createSagaWorkflow(\n  { reserveInventory, chargeCard, sendConfirmation },\n  { onEvent: (event) => console.log(event) }\n);\n\nconst result = await checkoutSaga(async (saga, deps) => {\n  // Reserve inventory with compensation\n  const reservation = await saga.step(\n    () => deps.reserveInventory(items),\n    {\n      name: &#x27;reserve-inventory&#x27;,\n      compensate: (res) => releaseInventory(res.reservationId),\n    }\n  );\n\n  // Charge card with compensation\n  const payment = await saga.step(\n    () => deps.chargeCard(amount),\n    {\n      name: &#x27;charge-card&#x27;,\n      compensate: (p) => refundPayment(p.transactionId),\n    }\n  );\n\n  // If sendConfirmation fails, compensations run in reverse order:\n  // 1. refundPayment(payment.transactionId)\n  // 2. releaseInventory(reservation.reservationId)\n  await saga.step(\n    () => deps.sendConfirmation(email),\n    { name: &#x27;send-confirmation&#x27; }\n  );\n\n  return { reservation, payment };\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"compensation-order\">Compensation order\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#compensation-order\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Compensation order”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Compensations run in reverse order of completion (LIFO):\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"plaintext\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan>Step 1: reserve-inventory ✓\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>Step 2: charge-card ✓\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>Step 3: send-confirmation ✗\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>Compensation order:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>1. refund charge-card\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>2. release reserve-inventory\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"Step 1: reserve-inventory ✓\nStep 2: charge-card ✓\nStep 3: send-confirmation ✗\n\nCompensation order:\n1. refund charge-card\n2. release reserve-inventory\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"handling-compensation-errors\">Handling compensation errors\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#handling-compensation-errors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Handling compensation errors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> &#x26;&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> isSagaCompensationError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Saga failed, compensations may have partially succeeded'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Compensation errors:'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">compensationErrors\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Manual intervention may be needed\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"if (!result.ok &#x26;&#x26; isSagaCompensationError(result.error)) {\n  console.log(&#x27;Saga failed, compensations may have partially succeeded&#x27;);\n  console.log(&#x27;Compensation errors:&#x27;, result.error.compensationErrors);\n  // Manual intervention may be needed\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"steps-without-compensation\">Steps without compensation\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#steps-without-compensation\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Steps without compensation”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Not every step needs compensation:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> checkoutSaga\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">saga\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">deps\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // No compensation needed for reads\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> saga.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> deps.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(userId),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'fetch-user'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Needs compensation\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> payment\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> saga.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> deps.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">chargeCard\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(amount),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'charge-card'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      compensate\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">p\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> deps.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">refundPayment\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(p.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">transactionId\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Idempotent operation - no compensation\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> saga.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> deps.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">sendEmail\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">email\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'send-email'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { payment };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await checkoutSaga(async (saga, deps) => {\n  // No compensation needed for reads\n  const user = await saga.step(\n    () => deps.fetchUser(userId),\n    { name: &#x27;fetch-user&#x27; }\n  );\n\n  // Needs compensation\n  const payment = await saga.step(\n    () => deps.chargeCard(amount),\n    {\n      name: &#x27;charge-card&#x27;,\n      compensate: (p) => deps.refundPayment(p.transactionId),\n    }\n  );\n\n  // Idempotent operation - no compensation\n  await saga.step(\n    () => deps.sendEmail(user.email),\n    { name: &#x27;send-email&#x27; }\n  );\n\n  return { payment };\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"trystep-for-throwing-code\">tryStep for throwing code\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#trystep-for-throwing-code\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “tryStep for throwing code”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">tryStep\u003C/code> to catch exceptions from external libraries:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">runSaga\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> runSaga\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">OrderResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">OrderError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">>(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">saga\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> reservation\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> saga.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> reserveInventory\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(items),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">compensate\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">res\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> releaseInventory\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(res.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // tryStep catches throws and converts to error\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> payment\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> saga.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">tryStep\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> externalPaymentApi.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">charge\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(amount), \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// May throw\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'PAYMENT_FAILED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F47067\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> const\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      compensate\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">p\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> externalPaymentApi.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">refund\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(p.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">txId\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { reservation, payment };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { runSaga } from &#x27;@jagreehal/workflow&#x27;;\n\nconst result = await runSaga\u003COrderResult, OrderError>(async (saga) => {\n  const reservation = await saga.step(\n    () => reserveInventory(items),\n    { compensate: (res) => releaseInventory(res.id) }\n  );\n\n  // tryStep catches throws and converts to error\n  const payment = await saga.tryStep(\n    () => externalPaymentApi.charge(amount), // May throw\n    {\n      error: &#x27;PAYMENT_FAILED&#x27; as const,\n      compensate: (p) => externalPaymentApi.refund(p.txId),\n    }\n  );\n\n  return { reservation, payment };\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"low-level-runsaga\">Low-level runSaga\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#low-level-runsaga\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Low-level runSaga”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>For explicit error typing without deps-based inference:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">runSaga\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> CheckoutResult\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">orderId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">; \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">chargeId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> CheckoutError\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'INVENTORY_UNAVAILABLE'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'PAYMENT_FAILED'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'SEND_FAILED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> runSaga\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">CheckoutResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">CheckoutError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">>(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">saga\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> reservation\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> saga.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> reserveInventory\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(items),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">compensate\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">res\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> releaseInventory\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(res.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> charge\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> saga.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> chargeCard\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(amount),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">compensate\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">c\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> refundCharge\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(c.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> saga.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> sendConfirmation\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(email));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">orderId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> reservation.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">chargeId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> charge.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { runSaga } from &#x27;@jagreehal/workflow&#x27;;\n\ntype CheckoutResult = { orderId: string; chargeId: string };\ntype CheckoutError = &#x27;INVENTORY_UNAVAILABLE&#x27; | &#x27;PAYMENT_FAILED&#x27; | &#x27;SEND_FAILED&#x27;;\n\nconst result = await runSaga\u003CCheckoutResult, CheckoutError>(async (saga) => {\n  const reservation = await saga.step(\n    () => reserveInventory(items),\n    { compensate: (res) => releaseInventory(res.id) }\n  );\n\n  const charge = await saga.step(\n    () => chargeCard(amount),\n    { compensate: (c) => refundCharge(c.id) }\n  );\n\n  await saga.step(() => sendConfirmation(email));\n\n  return { orderId: reservation.id, chargeId: charge.id };\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"real-world-example-order-fulfillment\">Real-world example: Order fulfillment\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#real-world-example-order-fulfillment\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Real-world example: Order fulfillment”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> fulfillOrder\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createSagaWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  reserveStock,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  createShipment,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  chargePayment,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  updateOrder,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  notifyCustomer,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fulfillOrder\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">saga\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">deps\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Reserve inventory\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> stock\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> saga.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> deps.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">reserveStock\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(order.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">items\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'reserve-stock'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      compensate\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">s\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> deps.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">releaseStock\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(s.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reservationId\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Create shipment record\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> shipment\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> saga.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> deps.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createShipment\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(order.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">address\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, stock),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'create-shipment'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      compensate\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">s\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> deps.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">cancelShipment\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(s.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">trackingId\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Charge customer\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> payment\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> saga.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> deps.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">chargePayment\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(order.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">total\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, order.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">paymentMethod\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'charge-payment'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      compensate\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">p\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> deps.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">refundPayment\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(p.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">transactionId\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Update order status (idempotent, no compensation)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> saga.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> deps.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">updateOrder\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(order.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'FULFILLED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, shipment, payment }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'update-order'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Notify customer (can't really undo this)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> saga.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> deps.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">notifyCustomer\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(order.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">customerId\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, { shipment, payment }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'notify-customer'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { shipment, payment };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">isSagaCompensationError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">    // Log for manual review\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> alertOps\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Saga compensation had errors'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const fulfillOrder = createSagaWorkflow({\n  reserveStock,\n  createShipment,\n  chargePayment,\n  updateOrder,\n  notifyCustomer,\n});\n\nconst result = await fulfillOrder(async (saga, deps) => {\n  // Reserve inventory\n  const stock = await saga.step(\n    () => deps.reserveStock(order.items),\n    {\n      name: &#x27;reserve-stock&#x27;,\n      compensate: (s) => deps.releaseStock(s.reservationId),\n    }\n  );\n\n  // Create shipment record\n  const shipment = await saga.step(\n    () => deps.createShipment(order.address, stock),\n    {\n      name: &#x27;create-shipment&#x27;,\n      compensate: (s) => deps.cancelShipment(s.trackingId),\n    }\n  );\n\n  // Charge customer\n  const payment = await saga.step(\n    () => deps.chargePayment(order.total, order.paymentMethod),\n    {\n      name: &#x27;charge-payment&#x27;,\n      compensate: (p) => deps.refundPayment(p.transactionId),\n    }\n  );\n\n  // Update order status (idempotent, no compensation)\n  await saga.step(\n    () => deps.updateOrder(order.id, { status: &#x27;FULFILLED&#x27;, shipment, payment }),\n    { name: &#x27;update-order&#x27; }\n  );\n\n  // Notify customer (can&#x27;t really undo this)\n  await saga.step(\n    () => deps.notifyCustomer(order.customerId, { shipment, payment }),\n    { name: &#x27;notify-customer&#x27; }\n  );\n\n  return { shipment, payment };\n});\n\nif (!result.ok) {\n  if (isSagaCompensationError(result.error)) {\n    // Log for manual review\n    await alertOps(&#x27;Saga compensation had errors&#x27;, result.error);\n  }\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"best-practices\">Best practices\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#best-practices\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Best practices”\u003C/span>\u003C/a>\u003C/div>\n\u003Col>\n\u003Cli>\u003Cstrong>Compensations should be idempotent\u003C/strong> - They may run multiple times on retries\u003C/li>\n\u003Cli>\u003Cstrong>Not everything needs compensation\u003C/strong> - Read operations and truly idempotent writes don’t\u003C/li>\n\u003Cli>\u003Cstrong>Plan for compensation failures\u003C/strong> - Have alerting and manual recovery procedures\u003C/li>\n\u003Cli>\u003Cstrong>Keep compensations simple\u003C/strong> - Complex compensation logic is a code smell\u003C/li>\n\u003Cli>\u003Cstrong>Test the failure paths\u003C/strong> - Saga value comes from handling failures correctly\u003C/li>\n\u003C/ol>",{"headings":55,"localImagePaths":81,"remoteImagePaths":82,"frontmatter":83,"imagePaths":84},[56,60,63,66,69,72,75,78],{"depth":57,"slug":58,"text":59},2,"basic-usage","Basic usage",{"depth":57,"slug":61,"text":62},"compensation-order","Compensation order",{"depth":57,"slug":64,"text":65},"handling-compensation-errors","Handling compensation errors",{"depth":57,"slug":67,"text":68},"steps-without-compensation","Steps without compensation",{"depth":57,"slug":70,"text":71},"trystep-for-throwing-code","tryStep for throwing code",{"depth":57,"slug":73,"text":74},"low-level-runsaga","Low-level runSaga",{"depth":57,"slug":76,"text":77},"real-world-example-order-fulfillment","Real-world example: Order fulfillment",{"depth":57,"slug":79,"text":80},"best-practices","Best practices",[],[],{"title":43,"description":44},[],"advanced/circuit-breaker",{"id":85,"data":87,"body":93,"filePath":94,"digest":95,"rendered":96},{"title":88,"description":89,"editUrl":16,"head":90,"template":46,"sidebar":91,"pagefind":16,"draft":35},"Circuit Breaker","Prevent cascading failures with failure tracking",[],{"hidden":35,"attrs":92},{},"Prevent cascading failures by tracking step failure rates and short-circuiting calls when a threshold is exceeded.\n\n## Basic usage\n\n```typescript\nimport {\n  createCircuitBreaker,\n  isCircuitOpenError,\n  circuitBreakerPresets,\n  ok,\n} from '@jagreehal/workflow';\n\n// Create a circuit breaker (name is required)\nconst breaker = createCircuitBreaker('external-api', {\n  failureThreshold: 5,      // Open after 5 failures\n  resetTimeout: 30000,      // Try again after 30 seconds\n  halfOpenMax: 3,           // Allow 3 test requests in half-open state\n  windowSize: 60000,        // Count failures within this window (1 minute)\n});\n\n// Execute with the breaker\ntry {\n  const data = await breaker.execute(async () => {\n    return await fetchFromExternalApi();\n  });\n  console.log('Got data:', data);\n} catch (error) {\n  if (isCircuitOpenError(error)) {\n    console.log(`Circuit is open, retry after ${error.retryAfterMs}ms`);\n  } else {\n    console.log('Operation failed:', error);\n  }\n}\n```\n\n## Using presets\n\n```typescript\nimport { createCircuitBreaker, circuitBreakerPresets } from '@jagreehal/workflow';\n\n// For critical services - opens quickly, recovers slowly\nconst criticalBreaker = createCircuitBreaker(\n  'payment-api',\n  circuitBreakerPresets.critical\n);\n\n// For lenient services - tolerates more failures\nconst lenientBreaker = createCircuitBreaker(\n  'recommendation-api',\n  circuitBreakerPresets.lenient\n);\n```\n\n## Result-returning operations\n\nUse `executeResult` instead of `execute` if your operation returns a `Result`:\n\n```typescript\nconst result = await breaker.executeResult(async () => {\n  return ok(await fetchFromExternalApi());\n});\n\nif (!result.ok) {\n  if (isCircuitOpenError(result.error)) {\n    console.log('Circuit is open, try again later');\n  }\n}\n```\n\n## Circuit states\n\nThe circuit breaker has three states:\n\n| State | Description |\n|-------|-------------|\n| `CLOSED` | Normal operation. Failures are tracked. |\n| `OPEN` | Circuit tripped. All calls fail immediately. |\n| `HALF_OPEN` | Testing recovery. Limited calls allowed. |\n\n```typescript\nconst stats = breaker.getStats();\nconsole.log(stats.state);          // 'CLOSED' | 'OPEN' | 'HALF_OPEN'\nconsole.log(stats.failureCount);   // Failures in current window\nconsole.log(stats.successCount);   // Successes in current window\nconsole.log(stats.halfOpenSuccesses); // Successful test calls\n```\n\n## State transitions\n\n```\nCLOSED → OPEN: When failureThreshold is reached\nOPEN → HALF_OPEN: After resetTimeout elapses\nHALF_OPEN → CLOSED: After halfOpenMax successes\nHALF_OPEN → OPEN: On any failure\n```\n\n## In workflows\n\n```typescript\nconst breaker = createCircuitBreaker('api', circuitBreakerPresets.standard);\n\nconst result = await workflow(async (step) => {\n  const data = await step(async () => {\n    const apiResult = await breaker.executeResult(() =>\n      ok(await externalApi.fetch())\n    );\n    return apiResult;\n  });\n\n  return data;\n});\n```\n\n## Multiple services\n\nCreate separate breakers for independent failure domains:\n\n```typescript\nconst paymentBreaker = createCircuitBreaker('payment', {\n  failureThreshold: 3,\n  resetTimeout: 60000, // Conservative for payments\n});\n\nconst inventoryBreaker = createCircuitBreaker('inventory', {\n  failureThreshold: 10,\n  resetTimeout: 10000, // Can recover faster\n});\n\nconst emailBreaker = createCircuitBreaker('email', {\n  failureThreshold: 20,\n  resetTimeout: 5000, // Non-critical, aggressive recovery\n});\n```\n\n## Configuration reference\n\n```typescript\n{\n  failureThreshold: number;  // Failures before opening (required)\n  resetTimeout: number;      // Ms before half-open (required)\n  halfOpenMax?: number;      // Test calls allowed (default: 1)\n  windowSize?: number;       // Failure counting window (default: 60000)\n}\n```","src/content/docs/advanced/circuit-breaker.md","143b4735fa2a8ab2",{"html":97,"metadata":98},"\u003Cp>Prevent cascading failures by tracking step failure rates and short-circuiting calls when a threshold is exceeded.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"basic-usage\">Basic usage\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#basic-usage\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Basic usage”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createCircuitBreaker\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  isCircuitOpenError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  circuitBreakerPresets\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">} \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create a circuit breaker (name is required)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> breaker\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createCircuitBreaker\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'external-api'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  failureThreshold\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 5\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,      \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Open after 5 failures\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  resetTimeout\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 30000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,      \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Try again after 30 seconds\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  halfOpenMax\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,           \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Allow 3 test requests in half-open state\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  windowSize\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 60000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,        \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Count failures within this window (1 minute)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Execute with the breaker\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">try\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> data\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> breaker.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">execute\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchFromExternalApi\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Got data:'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, data);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">} \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">catch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (error) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">isCircuitOpenError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(error)) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`Circuit is open, retry after \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">retryAfterMs\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">ms`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">else\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Operation failed:'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, error);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import {\n  createCircuitBreaker,\n  isCircuitOpenError,\n  circuitBreakerPresets,\n  ok,\n} from &#x27;@jagreehal/workflow&#x27;;\n\n// Create a circuit breaker (name is required)\nconst breaker = createCircuitBreaker(&#x27;external-api&#x27;, {\n  failureThreshold: 5,      // Open after 5 failures\n  resetTimeout: 30000,      // Try again after 30 seconds\n  halfOpenMax: 3,           // Allow 3 test requests in half-open state\n  windowSize: 60000,        // Count failures within this window (1 minute)\n});\n\n// Execute with the breaker\ntry {\n  const data = await breaker.execute(async () => {\n    return await fetchFromExternalApi();\n  });\n  console.log(&#x27;Got data:&#x27;, data);\n} catch (error) {\n  if (isCircuitOpenError(error)) {\n    console.log(&#x60;Circuit is open, retry after ${error.retryAfterMs}ms&#x60;);\n  } else {\n    console.log(&#x27;Operation failed:&#x27;, error);\n  }\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"using-presets\">Using presets\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#using-presets\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Using presets”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createCircuitBreaker\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">circuitBreakerPresets\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// For critical services - opens quickly, recovers slowly\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> criticalBreaker\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createCircuitBreaker\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">  'payment-api'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  circuitBreakerPresets.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">critical\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// For lenient services - tolerates more failures\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> lenientBreaker\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createCircuitBreaker\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">  'recommendation-api'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  circuitBreakerPresets.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">lenient\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createCircuitBreaker, circuitBreakerPresets } from &#x27;@jagreehal/workflow&#x27;;\n\n// For critical services - opens quickly, recovers slowly\nconst criticalBreaker = createCircuitBreaker(\n  &#x27;payment-api&#x27;,\n  circuitBreakerPresets.critical\n);\n\n// For lenient services - tolerates more failures\nconst lenientBreaker = createCircuitBreaker(\n  &#x27;recommendation-api&#x27;,\n  circuitBreakerPresets.lenient\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"result-returning-operations\">Result-returning operations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#result-returning-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Result-returning operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">executeResult\u003C/code> instead of \u003Ccode dir=\"auto\">execute\u003C/code> if your operation returns a \u003Ccode dir=\"auto\">Result\u003C/code>:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> breaker.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">executeResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchFromExternalApi\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">isCircuitOpenError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Circuit is open, try again later'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await breaker.executeResult(async () => {\n  return ok(await fetchFromExternalApi());\n});\n\nif (!result.ok) {\n  if (isCircuitOpenError(result.error)) {\n    console.log(&#x27;Circuit is open, try again later&#x27;);\n  }\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"circuit-states\">Circuit states\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#circuit-states\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Circuit states”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>The circuit breaker has three states:\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>State\u003C/th>\u003Cth>Description\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">CLOSED\u003C/code>\u003C/td>\u003Ctd>Normal operation. Failures are tracked.\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">OPEN\u003C/code>\u003C/td>\u003Ctd>Circuit tripped. All calls fail immediately.\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">HALF_OPEN\u003C/code>\u003C/td>\u003Ctd>Testing recovery. Limited calls allowed.\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> stats\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> breaker.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">getStats\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(stats.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">state\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);          \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// 'CLOSED' | 'OPEN' | 'HALF_OPEN'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(stats.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">failureCount\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);   \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Failures in current window\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(stats.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">successCount\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);   \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Successes in current window\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(stats.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">halfOpenSuccesses\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">); \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Successful test calls\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const stats = breaker.getStats();\nconsole.log(stats.state);          // &#x27;CLOSED&#x27; | &#x27;OPEN&#x27; | &#x27;HALF_OPEN&#x27;\nconsole.log(stats.failureCount);   // Failures in current window\nconsole.log(stats.successCount);   // Successes in current window\nconsole.log(stats.halfOpenSuccesses); // Successful test calls\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"state-transitions\">State transitions\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#state-transitions\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “State transitions”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"plaintext\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan>CLOSED → OPEN: When failureThreshold is reached\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>OPEN → HALF_OPEN: After resetTimeout elapses\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>HALF_OPEN → CLOSED: After halfOpenMax successes\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>HALF_OPEN → OPEN: On any failure\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"CLOSED → OPEN: When failureThreshold is reached\nOPEN → HALF_OPEN: After resetTimeout elapses\nHALF_OPEN → CLOSED: After halfOpenMax successes\nHALF_OPEN → OPEN: On any failure\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"in-workflows\">In workflows\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#in-workflows\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “In workflows”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> breaker\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createCircuitBreaker\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'api'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, circuitBreakerPresets.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">standard\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> data\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> apiResult\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> breaker.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">executeResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> externalApi.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">())\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> apiResult;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> data;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const breaker = createCircuitBreaker(&#x27;api&#x27;, circuitBreakerPresets.standard);\n\nconst result = await workflow(async (step) => {\n  const data = await step(async () => {\n    const apiResult = await breaker.executeResult(() =>\n      ok(await externalApi.fetch())\n    );\n    return apiResult;\n  });\n\n  return data;\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"multiple-services\">Multiple services\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#multiple-services\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Multiple services”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Create separate breakers for independent failure domains:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> paymentBreaker\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createCircuitBreaker\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'payment'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  failureThreshold\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  resetTimeout\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 60000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Conservative for payments\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> inventoryBreaker\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createCircuitBreaker\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'inventory'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  failureThreshold\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 10\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  resetTimeout\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 10000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Can recover faster\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> emailBreaker\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createCircuitBreaker\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'email'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  failureThreshold\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 20\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  resetTimeout\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 5000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Non-critical, aggressive recovery\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const paymentBreaker = createCircuitBreaker(&#x27;payment&#x27;, {\n  failureThreshold: 3,\n  resetTimeout: 60000, // Conservative for payments\n});\n\nconst inventoryBreaker = createCircuitBreaker(&#x27;inventory&#x27;, {\n  failureThreshold: 10,\n  resetTimeout: 10000, // Can recover faster\n});\n\nconst emailBreaker = createCircuitBreaker(&#x27;email&#x27;, {\n  failureThreshold: 20,\n  resetTimeout: 5000, // Non-critical, aggressive recovery\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"configuration-reference\">Configuration reference\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#configuration-reference\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Configuration reference”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  failureThreshold\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: number;  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Failures before opening (required)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  resetTimeout\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: number;      \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Ms before half-open (required)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  halfOpenMax\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> number;      \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Test calls allowed (default: 1)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  windowSize\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> number;       \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Failure counting window (default: 60000)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"{\n  failureThreshold: number;  // Failures before opening (required)\n  resetTimeout: number;      // Ms before half-open (required)\n  halfOpenMax?: number;      // Test calls allowed (default: 1)\n  windowSize?: number;       // Failure counting window (default: 60000)\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>",{"headings":99,"localImagePaths":122,"remoteImagePaths":123,"frontmatter":124,"imagePaths":125},[100,101,104,107,110,113,116,119],{"depth":57,"slug":58,"text":59},{"depth":57,"slug":102,"text":103},"using-presets","Using presets",{"depth":57,"slug":105,"text":106},"result-returning-operations","Result-returning operations",{"depth":57,"slug":108,"text":109},"circuit-states","Circuit states",{"depth":57,"slug":111,"text":112},"state-transitions","State transitions",{"depth":57,"slug":114,"text":115},"in-workflows","In workflows",{"depth":57,"slug":117,"text":118},"multiple-services","Multiple services",{"depth":57,"slug":120,"text":121},"configuration-reference","Configuration reference",[],[],{"title":88,"description":89},[],"advanced/policies",{"id":126,"data":128,"body":134,"filePath":135,"digest":136,"rendered":137},{"title":129,"description":130,"editUrl":16,"head":131,"template":46,"sidebar":132,"pagefind":16,"draft":35},"Policies","Reusable bundles of step options",[],{"hidden":35,"attrs":133},{},"Reusable bundles of `StepOptions` (retry, timeout, cache keys) that can be composed and applied per-workflow or per-step.\n\n## Using service policies\n\nApply pre-built policies for common scenarios:\n\n```typescript\nimport { withPolicy, servicePolicies } from '@jagreehal/workflow';\n\nconst result = await workflow(async (step) => {\n  // HTTP API: 5s timeout, 3 retries\n  const user = await step(\n    () => fetchUser(id),\n    withPolicy(servicePolicies.httpApi, { name: 'fetch-user' })\n  );\n\n  // Database: 30s timeout, 2 retries\n  const orders = await step(\n    () => db.query('SELECT * FROM orders'),\n    withPolicy(servicePolicies.database, { name: 'fetch-orders' })\n  );\n\n  // Cache: 1s timeout, no retry\n  const cached = await step(\n    () => cache.get(key),\n    withPolicy(servicePolicies.cache, { name: 'cache-lookup' })\n  );\n\n  return { user, orders, cached };\n});\n```\n\n## Combining policies\n\nMerge multiple policies together:\n\n```typescript\nimport { withPolicies, timeoutPolicies, retryPolicies } from '@jagreehal/workflow';\n\nconst data = await step(\n  () => fetchData(),\n  withPolicies([timeoutPolicies.api, retryPolicies.standard], 'fetch-data')\n);\n```\n\n## Policy applier\n\nCreate a reusable applier for consistent defaults:\n\n```typescript\nimport { createPolicyApplier, timeoutPolicies, retryPolicies } from '@jagreehal/workflow';\n\nconst applyPolicy = createPolicyApplier(\n  timeoutPolicies.api,\n  retryPolicies.transient\n);\n\nconst result = await step(\n  () => callApi(),\n  applyPolicy({ name: 'api-call', key: 'cache:api' })\n);\n```\n\n## Fluent builder\n\nBuild step options with a fluent API:\n\n```typescript\nimport { stepOptions } from '@jagreehal/workflow';\n\nconst options = stepOptions()\n  .name('fetch-user')\n  .key('user:123')\n  .timeout(5000)\n  .retries(3)\n  .build();\n\nconst user = await step(() => fetchUser('123'), options);\n```\n\n## Policy registry\n\nCreate organization-wide policy standards:\n\n```typescript\nimport { createPolicyRegistry, servicePolicies } from '@jagreehal/workflow';\n\nconst registry = createPolicyRegistry();\nregistry.register('api', servicePolicies.httpApi);\nregistry.register('db', servicePolicies.database);\nregistry.register('cache', servicePolicies.cache);\nregistry.register('queue', servicePolicies.messageQueue);\n\n// Use in workflows\nconst user = await step(\n  () => fetchUser(id),\n  registry.apply('api', { name: 'fetch-user' })\n);\n\nconst data = await step(\n  () => db.query(sql),\n  registry.apply('db', { name: 'query-data' })\n);\n```\n\n## Available presets\n\n### Retry policies\n\n```typescript\nimport { retryPolicies } from '@jagreehal/workflow';\n\nretryPolicies.none           // No retry\nretryPolicies.transient      // 3 attempts, fast backoff\nretryPolicies.standard       // 3 attempts, moderate backoff\nretryPolicies.aggressive     // 5 attempts, longer backoff\nretryPolicies.fixed(3, 1000) // 3 attempts, 1s fixed delay\nretryPolicies.linear(3, 100) // 3 attempts, linear backoff\n```\n\n### Timeout policies\n\n```typescript\nimport { timeoutPolicies } from '@jagreehal/workflow';\n\ntimeoutPolicies.fast         // 1 second\ntimeoutPolicies.api          // 5 seconds\ntimeoutPolicies.extended     // 30 seconds\ntimeoutPolicies.long         // 2 minutes\ntimeoutPolicies.ms(3000)     // Custom milliseconds\n```\n\n### Service policies\n\nCombined retry + timeout for specific scenarios:\n\n```typescript\nimport { servicePolicies } from '@jagreehal/workflow';\n\nservicePolicies.httpApi      // 5s timeout, 3 retries\nservicePolicies.database     // 30s timeout, 2 retries\nservicePolicies.cache        // 1s timeout, no retry\nservicePolicies.messageQueue // 30s timeout, 5 retries\nservicePolicies.fileSystem   // 2min timeout, 3 retries\nservicePolicies.rateLimited  // 10s timeout, 5 linear retries\n```\n\n## Custom policies\n\nCreate your own policies:\n\n```typescript\nimport { mergePolicies } from '@jagreehal/workflow';\n\nconst myApiPolicy = {\n  timeout: { ms: 10000 },\n  retry: {\n    attempts: 4,\n    backoff: 'exponential',\n    delayMs: 200,\n    maxDelayMs: 5000,\n  },\n};\n\nconst myDbPolicy = {\n  timeout: { ms: 60000 },\n  retry: {\n    attempts: 2,\n    backoff: 'fixed',\n    delayMs: 1000,\n  },\n};\n\n// Combine with existing policies\nconst criticalApiPolicy = mergePolicies(\n  servicePolicies.httpApi,\n  { retry: { attempts: 5 } }\n);\n```\n\n## When to use policies\n\n| Scenario | Recommended Policy |\n|----------|-------------------|\n| External HTTP APIs | `servicePolicies.httpApi` |\n| Database queries | `servicePolicies.database` |\n| Cache operations | `servicePolicies.cache` |\n| Message queue consumers | `servicePolicies.messageQueue` |\n| File system operations | `servicePolicies.fileSystem` |\n| Rate-limited APIs | `servicePolicies.rateLimited` |\n\n## Best practices\n\n1. **Use policies consistently** - Same service type should use same policy\n2. **Register in one place** - Use `createPolicyRegistry` for organization-wide standards\n3. **Don't over-configure** - Presets handle most cases well\n4. **Adjust for criticality** - Payment APIs may need more retries than logging\n5. **Monitor and tune** - Adjust based on actual failure patterns","src/content/docs/advanced/policies.md","fb7e2a767edf3bc7",{"html":138,"metadata":139},"\u003Cp>Reusable bundles of \u003Ccode dir=\"auto\">StepOptions\u003C/code> (retry, timeout, cache keys) that can be composed and applied per-workflow or per-step.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"using-service-policies\">Using service policies\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#using-service-policies\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Using service policies”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Apply pre-built policies for common scenarios:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">withPolicy\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">servicePolicies\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // HTTP API: 5s timeout, 3 retries\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(id),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    withPolicy\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(servicePolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">httpApi\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'fetch-user'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Database: 30s timeout, 2 retries\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> orders\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">query\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'SELECT * FROM orders'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    withPolicy\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(servicePolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">database\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'fetch-orders'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Cache: 1s timeout, no retry\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> cached\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> cache.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">get\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(key),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    withPolicy\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(servicePolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">cache\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'cache-lookup'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { user, orders, cached };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { withPolicy, servicePolicies } from &#x27;@jagreehal/workflow&#x27;;\n\nconst result = await workflow(async (step) => {\n  // HTTP API: 5s timeout, 3 retries\n  const user = await step(\n    () => fetchUser(id),\n    withPolicy(servicePolicies.httpApi, { name: &#x27;fetch-user&#x27; })\n  );\n\n  // Database: 30s timeout, 2 retries\n  const orders = await step(\n    () => db.query(&#x27;SELECT * FROM orders&#x27;),\n    withPolicy(servicePolicies.database, { name: &#x27;fetch-orders&#x27; })\n  );\n\n  // Cache: 1s timeout, no retry\n  const cached = await step(\n    () => cache.get(key),\n    withPolicy(servicePolicies.cache, { name: &#x27;cache-lookup&#x27; })\n  );\n\n  return { user, orders, cached };\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"combining-policies\">Combining policies\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#combining-policies\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Combining policies”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Merge multiple policies together:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">withPolicies\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">timeoutPolicies\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">retryPolicies\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> data\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchData\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  withPolicies\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([timeoutPolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#ADBAC7\">api\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, retryPolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#ADBAC7\">standard\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">], \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'fetch-data'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { withPolicies, timeoutPolicies, retryPolicies } from &#x27;@jagreehal/workflow&#x27;;\n\nconst data = await step(\n  () => fetchData(),\n  withPolicies([timeoutPolicies.api, retryPolicies.standard], &#x27;fetch-data&#x27;)\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"policy-applier\">Policy applier\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#policy-applier\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Policy applier”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Create a reusable applier for consistent defaults:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createPolicyApplier\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">timeoutPolicies\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">retryPolicies\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> applyPolicy\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createPolicyApplier\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  timeoutPolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">api\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  retryPolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">transient\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> callApi\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  applyPolicy\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'api-call'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'cache:api'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createPolicyApplier, timeoutPolicies, retryPolicies } from &#x27;@jagreehal/workflow&#x27;;\n\nconst applyPolicy = createPolicyApplier(\n  timeoutPolicies.api,\n  retryPolicies.transient\n);\n\nconst result = await step(\n  () => callApi(),\n  applyPolicy({ name: &#x27;api-call&#x27;, key: &#x27;cache:api&#x27; })\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"fluent-builder\">Fluent builder\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#fluent-builder\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Fluent builder”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Build step options with a fluent API:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">stepOptions\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> options\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> stepOptions\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  .\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">name\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'fetch-user'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  .\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">key\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'user:123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  .\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">timeout\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">5000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  .\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">retries\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  .\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">build\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), options);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { stepOptions } from &#x27;@jagreehal/workflow&#x27;;\n\nconst options = stepOptions()\n  .name(&#x27;fetch-user&#x27;)\n  .key(&#x27;user:123&#x27;)\n  .timeout(5000)\n  .retries(3)\n  .build();\n\nconst user = await step(() => fetchUser(&#x27;123&#x27;), options);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"policy-registry\">Policy registry\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#policy-registry\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Policy registry”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Create organization-wide policy standards:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createPolicyRegistry\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">servicePolicies\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> registry\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createPolicyRegistry\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">registry.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">register\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'api'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, servicePolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">httpApi\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">registry.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">register\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'db'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, servicePolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">database\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">registry.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">register\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'cache'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, servicePolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">cache\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">registry.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">register\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'queue'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, servicePolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">messageQueue\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Use in workflows\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(id),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  registry.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">apply\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'api'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'fetch-user'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> data\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">query\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(sql),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  registry.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">apply\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'db'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'query-data'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createPolicyRegistry, servicePolicies } from &#x27;@jagreehal/workflow&#x27;;\n\nconst registry = createPolicyRegistry();\nregistry.register(&#x27;api&#x27;, servicePolicies.httpApi);\nregistry.register(&#x27;db&#x27;, servicePolicies.database);\nregistry.register(&#x27;cache&#x27;, servicePolicies.cache);\nregistry.register(&#x27;queue&#x27;, servicePolicies.messageQueue);\n\n// Use in workflows\nconst user = await step(\n  () => fetchUser(id),\n  registry.apply(&#x27;api&#x27;, { name: &#x27;fetch-user&#x27; })\n);\n\nconst data = await step(\n  () => db.query(sql),\n  registry.apply(&#x27;db&#x27;, { name: &#x27;query-data&#x27; })\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"available-presets\">Available presets\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#available-presets\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Available presets”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"retry-policies\">Retry policies\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#retry-policies\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Retry policies”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">retryPolicies\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">retryPolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">none\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">           // No retry\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">retryPolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">transient\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">      // 3 attempts, fast backoff\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">retryPolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">standard\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">       // 3 attempts, moderate backoff\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">retryPolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">aggressive\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">     // 5 attempts, longer backoff\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">retryPolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fixed\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">1000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// 3 attempts, 1s fixed delay\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">retryPolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">linear\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">100\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// 3 attempts, linear backoff\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { retryPolicies } from &#x27;@jagreehal/workflow&#x27;;\n\nretryPolicies.none           // No retry\nretryPolicies.transient      // 3 attempts, fast backoff\nretryPolicies.standard       // 3 attempts, moderate backoff\nretryPolicies.aggressive     // 5 attempts, longer backoff\nretryPolicies.fixed(3, 1000) // 3 attempts, 1s fixed delay\nretryPolicies.linear(3, 100) // 3 attempts, linear backoff\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"timeout-policies\">Timeout policies\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#timeout-policies\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Timeout policies”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">timeoutPolicies\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">timeoutPolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">fast\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">         // 1 second\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">timeoutPolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">api\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">          // 5 seconds\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">timeoutPolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">extended\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">     // 30 seconds\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">timeoutPolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">long\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">         // 2 minutes\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">timeoutPolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">ms\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">3000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)     \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Custom milliseconds\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { timeoutPolicies } from &#x27;@jagreehal/workflow&#x27;;\n\ntimeoutPolicies.fast         // 1 second\ntimeoutPolicies.api          // 5 seconds\ntimeoutPolicies.extended     // 30 seconds\ntimeoutPolicies.long         // 2 minutes\ntimeoutPolicies.ms(3000)     // Custom milliseconds\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"service-policies\">Service policies\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#service-policies\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Service policies”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Combined retry + timeout for specific scenarios:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">servicePolicies\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">servicePolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">httpApi\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">      // 5s timeout, 3 retries\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">servicePolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">database\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">     // 30s timeout, 2 retries\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">servicePolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">cache\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">        // 1s timeout, no retry\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">servicePolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">messageQueue\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\"> // 30s timeout, 5 retries\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">servicePolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">fileSystem\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">   // 2min timeout, 3 retries\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">servicePolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">rateLimited\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // 10s timeout, 5 linear retries\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { servicePolicies } from &#x27;@jagreehal/workflow&#x27;;\n\nservicePolicies.httpApi      // 5s timeout, 3 retries\nservicePolicies.database     // 30s timeout, 2 retries\nservicePolicies.cache        // 1s timeout, no retry\nservicePolicies.messageQueue // 30s timeout, 5 retries\nservicePolicies.fileSystem   // 2min timeout, 3 retries\nservicePolicies.rateLimited  // 10s timeout, 5 linear retries\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"custom-policies\">Custom policies\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#custom-policies\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Custom policies”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Create your own policies:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">mergePolicies\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> myApiPolicy\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  timeout\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ms\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 10000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  retry\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    attempts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 4\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    backoff\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'exponential'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    delayMs\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 200\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    maxDelayMs\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 5000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> myDbPolicy\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  timeout\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ms\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 60000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  retry\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    attempts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 2\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    backoff\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'fixed'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    delayMs\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 1000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Combine with existing policies\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> criticalApiPolicy\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> mergePolicies\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  servicePolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">httpApi\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">retry\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">attempts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 5\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { mergePolicies } from &#x27;@jagreehal/workflow&#x27;;\n\nconst myApiPolicy = {\n  timeout: { ms: 10000 },\n  retry: {\n    attempts: 4,\n    backoff: &#x27;exponential&#x27;,\n    delayMs: 200,\n    maxDelayMs: 5000,\n  },\n};\n\nconst myDbPolicy = {\n  timeout: { ms: 60000 },\n  retry: {\n    attempts: 2,\n    backoff: &#x27;fixed&#x27;,\n    delayMs: 1000,\n  },\n};\n\n// Combine with existing policies\nconst criticalApiPolicy = mergePolicies(\n  servicePolicies.httpApi,\n  { retry: { attempts: 5 } }\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"when-to-use-policies\">When to use policies\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#when-to-use-policies\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “When to use policies”\u003C/span>\u003C/a>\u003C/div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Scenario\u003C/th>\u003Cth>Recommended Policy\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>External HTTP APIs\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">servicePolicies.httpApi\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Database queries\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">servicePolicies.database\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Cache operations\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">servicePolicies.cache\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Message queue consumers\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">servicePolicies.messageQueue\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>File system operations\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">servicePolicies.fileSystem\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Rate-limited APIs\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">servicePolicies.rateLimited\u003C/code>\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"best-practices\">Best practices\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#best-practices\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Best practices”\u003C/span>\u003C/a>\u003C/div>\n\u003Col>\n\u003Cli>\u003Cstrong>Use policies consistently\u003C/strong> - Same service type should use same policy\u003C/li>\n\u003Cli>\u003Cstrong>Register in one place\u003C/strong> - Use \u003Ccode dir=\"auto\">createPolicyRegistry\u003C/code> for organization-wide standards\u003C/li>\n\u003Cli>\u003Cstrong>Don’t over-configure\u003C/strong> - Presets handle most cases well\u003C/li>\n\u003Cli>\u003Cstrong>Adjust for criticality\u003C/strong> - Payment APIs may need more retries than logging\u003C/li>\n\u003Cli>\u003Cstrong>Monitor and tune\u003C/strong> - Adjust based on actual failure patterns\u003C/li>\n\u003C/ol>",{"headings":140,"localImagePaths":176,"remoteImagePaths":177,"frontmatter":178,"imagePaths":179},[141,144,147,150,153,156,159,163,166,169,172,175],{"depth":57,"slug":142,"text":143},"using-service-policies","Using service policies",{"depth":57,"slug":145,"text":146},"combining-policies","Combining policies",{"depth":57,"slug":148,"text":149},"policy-applier","Policy applier",{"depth":57,"slug":151,"text":152},"fluent-builder","Fluent builder",{"depth":57,"slug":154,"text":155},"policy-registry","Policy registry",{"depth":57,"slug":157,"text":158},"available-presets","Available presets",{"depth":160,"slug":161,"text":162},3,"retry-policies","Retry policies",{"depth":160,"slug":164,"text":165},"timeout-policies","Timeout policies",{"depth":160,"slug":167,"text":168},"service-policies","Service policies",{"depth":57,"slug":170,"text":171},"custom-policies","Custom policies",{"depth":57,"slug":173,"text":174},"when-to-use-policies","When to use policies",{"depth":57,"slug":79,"text":80},[],[],{"title":129,"description":130},[],"advanced/opentelemetry",{"id":180,"data":182,"body":188,"filePath":189,"digest":190,"rendered":191},{"title":183,"description":184,"editUrl":16,"head":185,"template":46,"sidebar":186,"pagefind":16,"draft":35},"OpenTelemetry","Observability with traces and metrics",[],{"hidden":35,"attrs":187},{},"First-class OpenTelemetry metrics from the workflow event stream.\n\n## Autotel adapter\n\nCreate an adapter that tracks metrics and optionally creates spans:\n\n```typescript\nimport { createAutotelAdapter } from '@jagreehal/workflow';\n\nconst autotel = createAutotelAdapter({\n  serviceName: 'checkout-service',\n  createStepSpans: true,        // Create spans for each step\n  recordMetrics: true,          // Record step metrics\n  recordRetryEvents: true,      // Record retry events\n  markErrorsOnSpan: true,       // Mark errors on spans\n  defaultAttributes: {          // Custom attributes for all spans\n    environment: 'production',\n  },\n});\n\n// Use with workflow\nconst workflow = createWorkflow(deps, {\n  onEvent: autotel.handleEvent,\n});\n\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser(id), { name: 'fetch-user' });\n  const charge = await step(() => chargeCard(100), { name: 'charge-card' });\n  return { user, charge };\n});\n```\n\n## Access metrics\n\n```typescript\nconst metrics = autotel.getMetrics();\n\nconsole.log(metrics.stepDurations);\n// [{ name: 'fetch-user', durationMs: 45, success: true }, ...]\n\nconsole.log(metrics.retryCount);     // Total retry count\nconsole.log(metrics.errorCount);     // Total error count\nconsole.log(metrics.cacheHits);      // Cache hit count\nconsole.log(metrics.cacheMisses);    // Cache miss count\n```\n\n## Simple event handler\n\nFor debug logging without full metrics collection:\n\n```typescript\nimport { createAutotelEventHandler } from '@jagreehal/workflow';\n\nconst workflow = createWorkflow(deps, {\n  onEvent: createAutotelEventHandler({\n    serviceName: 'checkout',\n    includeStepDetails: true,\n  }),\n});\n\n// Set AUTOTEL_DEBUG=true to see console output\n```\n\n## With autotel tracing\n\nWrap workflows with actual OpenTelemetry spans:\n\n```typescript\nimport { withAutotelTracing } from '@jagreehal/workflow';\nimport { trace } from 'autotel';\n\nconst traced = withAutotelTracing(trace, { serviceName: 'checkout' });\n\nconst result = await traced('process-order', async () => {\n  return workflow(async (step) => {\n    const user = await step(() => fetchUser(id), { name: 'fetch-user' });\n    const charge = await step(() => chargeCard(100), { name: 'charge' });\n    return { user, charge };\n  });\n}, { orderId: '123' }); // Optional attributes\n```\n\n## Configuration options\n\n```typescript\n{\n  serviceName: string;           // Required: identifies the service\n  createStepSpans?: boolean;     // Create spans for steps (default: false)\n  recordMetrics?: boolean;       // Collect metrics (default: true)\n  recordRetryEvents?: boolean;   // Track retries (default: true)\n  markErrorsOnSpan?: boolean;    // Mark errors on spans (default: true)\n  defaultAttributes?: Record\u003Cstring, string>; // Added to all spans\n}\n```\n\n## Span attributes\n\nWhen `createStepSpans` is enabled, spans include:\n\n| Attribute | Description |\n|-----------|-------------|\n| `workflow.step.name` | Step name from options |\n| `workflow.step.key` | Step cache key (if set) |\n| `workflow.step.cached` | Whether result was cached |\n| `workflow.step.retry_count` | Number of retries |\n| `workflow.step.duration_ms` | Step duration |\n| `workflow.step.success` | Whether step succeeded |\n| `workflow.step.error` | Error type (if failed) |\n\n## Multiple workflows\n\nCreate separate adapters for different workflows:\n\n```typescript\nconst checkoutTelemetry = createAutotelAdapter({\n  serviceName: 'checkout-service',\n  defaultAttributes: { workflow: 'checkout' },\n});\n\nconst inventoryTelemetry = createAutotelAdapter({\n  serviceName: 'inventory-service',\n  defaultAttributes: { workflow: 'inventory' },\n});\n\nconst checkoutWorkflow = createWorkflow(checkoutDeps, {\n  onEvent: checkoutTelemetry.handleEvent,\n});\n\nconst inventoryWorkflow = createWorkflow(inventoryDeps, {\n  onEvent: inventoryTelemetry.handleEvent,\n});\n```\n\n## Combining with other event handlers\n\n```typescript\nimport { createAutotelAdapter, createVisualizer } from '@jagreehal/workflow';\n\nconst autotel = createAutotelAdapter({ serviceName: 'checkout' });\nconst viz = createVisualizer({ workflowName: 'checkout' });\n\nconst workflow = createWorkflow(deps, {\n  onEvent: (event) => {\n    autotel.handleEvent(event);\n    viz.handleEvent(event);\n  },\n});\n```\n\n## Custom metrics\n\nExtend the adapter output with your own metrics:\n\n```typescript\nconst autotel = createAutotelAdapter({ serviceName: 'checkout' });\n\nconst workflow = createWorkflow(deps, {\n  onEvent: (event) => {\n    autotel.handleEvent(event);\n\n    // Custom metric tracking\n    if (event.type === 'step_complete' && !event.result.ok) {\n      customMetrics.increment('checkout.step.failures', {\n        step: event.stepName,\n        error: String(event.result.error),\n      });\n    }\n  },\n});\n```\n\n## Environment variables\n\n| Variable | Description |\n|----------|-------------|\n| `AUTOTEL_DEBUG` | Set to `true` for console output |\n| `OTEL_SERVICE_NAME` | Default service name (overridden by config) |\n\n## Integration with OTEL collectors\n\nThe adapter works with standard OpenTelemetry collectors. Configure your collector endpoint:\n\n```typescript\nimport { trace } from 'autotel';\n\n// Configure your OTEL exporter\ntrace.configure({\n  endpoint: process.env.OTEL_EXPORTER_OTLP_ENDPOINT,\n  headers: {\n    'api-key': process.env.OTEL_API_KEY,\n  },\n});\n\nconst traced = withAutotelTracing(trace, { serviceName: 'checkout' });\n```","src/content/docs/advanced/opentelemetry.md","002bb9bd2dbd3784",{"html":192,"metadata":193},"\u003Cp>First-class OpenTelemetry metrics from the workflow event stream.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"autotel-adapter\">Autotel adapter\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#autotel-adapter\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Autotel adapter”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Create an adapter that tracks metrics and optionally creates spans:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createAutotelAdapter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> autotel\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createAutotelAdapter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  serviceName\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'checkout-service'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createStepSpans\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,        \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create spans for each step\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  recordMetrics\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,          \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Record step metrics\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  recordRetryEvents\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,      \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Record retry events\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  markErrorsOnSpan\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,       \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Mark errors on spans\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  defaultAttributes\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {          \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Custom attributes for all spans\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    environment\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'production'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Use with workflow\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> autotel.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(id), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'fetch-user'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> charge\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> chargeCard\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">100\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'charge-card'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { user, charge };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createAutotelAdapter } from &#x27;@jagreehal/workflow&#x27;;\n\nconst autotel = createAutotelAdapter({\n  serviceName: &#x27;checkout-service&#x27;,\n  createStepSpans: true,        // Create spans for each step\n  recordMetrics: true,          // Record step metrics\n  recordRetryEvents: true,      // Record retry events\n  markErrorsOnSpan: true,       // Mark errors on spans\n  defaultAttributes: {          // Custom attributes for all spans\n    environment: &#x27;production&#x27;,\n  },\n});\n\n// Use with workflow\nconst workflow = createWorkflow(deps, {\n  onEvent: autotel.handleEvent,\n});\n\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser(id), { name: &#x27;fetch-user&#x27; });\n  const charge = await step(() => chargeCard(100), { name: &#x27;charge-card&#x27; });\n  return { user, charge };\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"access-metrics\">Access metrics\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#access-metrics\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Access metrics”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> metrics\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> autotel.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">getMetrics\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(metrics.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">stepDurations\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// [{ name: 'fetch-user', durationMs: 45, success: true }, ...]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(metrics.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">retryCount\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);     \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Total retry count\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(metrics.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">errorCount\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);     \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Total error count\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(metrics.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">cacheHits\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);      \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Cache hit count\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(metrics.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">cacheMisses\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);    \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Cache miss count\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const metrics = autotel.getMetrics();\n\nconsole.log(metrics.stepDurations);\n// [{ name: &#x27;fetch-user&#x27;, durationMs: 45, success: true }, ...]\n\nconsole.log(metrics.retryCount);     // Total retry count\nconsole.log(metrics.errorCount);     // Total error count\nconsole.log(metrics.cacheHits);      // Cache hit count\nconsole.log(metrics.cacheMisses);    // Cache miss count\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"simple-event-handler\">Simple event handler\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#simple-event-handler\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Simple event handler”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>For debug logging without full metrics collection:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createAutotelEventHandler\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createAutotelEventHandler\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    serviceName\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'checkout'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    includeStepDetails\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Set AUTOTEL_DEBUG=true to see console output\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createAutotelEventHandler } from &#x27;@jagreehal/workflow&#x27;;\n\nconst workflow = createWorkflow(deps, {\n  onEvent: createAutotelEventHandler({\n    serviceName: &#x27;checkout&#x27;,\n    includeStepDetails: true,\n  }),\n});\n\n// Set AUTOTEL_DEBUG=true to see console output\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"with-autotel-tracing\">With autotel tracing\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#with-autotel-tracing\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “With autotel tracing”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Wrap workflows with actual OpenTelemetry spans:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">withAutotelTracing\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">trace\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'autotel'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> traced\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> withAutotelTracing\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(trace, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">serviceName\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'checkout'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> traced\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'process-order'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(id), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'fetch-user'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> charge\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> chargeCard\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">100\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'charge'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { user, charge };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">orderId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }); \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Optional attributes\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { withAutotelTracing } from &#x27;@jagreehal/workflow&#x27;;\nimport { trace } from &#x27;autotel&#x27;;\n\nconst traced = withAutotelTracing(trace, { serviceName: &#x27;checkout&#x27; });\n\nconst result = await traced(&#x27;process-order&#x27;, async () => {\n  return workflow(async (step) => {\n    const user = await step(() => fetchUser(id), { name: &#x27;fetch-user&#x27; });\n    const charge = await step(() => chargeCard(100), { name: &#x27;charge&#x27; });\n    return { user, charge };\n  });\n}, { orderId: &#x27;123&#x27; }); // Optional attributes\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"configuration-options\">Configuration options\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#configuration-options\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Configuration options”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  serviceName\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: string;           \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Required: identifies the service\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  createStepSpans\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> boolean;     \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create spans for steps (default: false)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  recordMetrics\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> boolean;       \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Collect metrics (default: true)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  recordRetryEvents\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> boolean;   \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Track retries (default: true)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  markErrorsOnSpan\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> boolean;    \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Mark errors on spans (default: true)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  defaultAttributes\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> Record\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">string, string\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">; \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Added to all spans\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"{\n  serviceName: string;           // Required: identifies the service\n  createStepSpans?: boolean;     // Create spans for steps (default: false)\n  recordMetrics?: boolean;       // Collect metrics (default: true)\n  recordRetryEvents?: boolean;   // Track retries (default: true)\n  markErrorsOnSpan?: boolean;    // Mark errors on spans (default: true)\n  defaultAttributes?: Record\u003Cstring, string>; // Added to all spans\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"span-attributes\">Span attributes\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#span-attributes\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Span attributes”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>When \u003Ccode dir=\"auto\">createStepSpans\u003C/code> is enabled, spans include:\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Attribute\u003C/th>\u003Cth>Description\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">workflow.step.name\u003C/code>\u003C/td>\u003Ctd>Step name from options\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">workflow.step.key\u003C/code>\u003C/td>\u003Ctd>Step cache key (if set)\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">workflow.step.cached\u003C/code>\u003C/td>\u003Ctd>Whether result was cached\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">workflow.step.retry_count\u003C/code>\u003C/td>\u003Ctd>Number of retries\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">workflow.step.duration_ms\u003C/code>\u003C/td>\u003Ctd>Step duration\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">workflow.step.success\u003C/code>\u003C/td>\u003Ctd>Whether step succeeded\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">workflow.step.error\u003C/code>\u003C/td>\u003Ctd>Error type (if failed)\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"multiple-workflows\">Multiple workflows\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#multiple-workflows\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Multiple workflows”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Create separate adapters for different workflows:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> checkoutTelemetry\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createAutotelAdapter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  serviceName\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'checkout-service'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  defaultAttributes\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'checkout'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> inventoryTelemetry\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createAutotelAdapter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  serviceName\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'inventory-service'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  defaultAttributes\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'inventory'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> checkoutWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(checkoutDeps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> checkoutTelemetry.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> inventoryWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(inventoryDeps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> inventoryTelemetry.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const checkoutTelemetry = createAutotelAdapter({\n  serviceName: &#x27;checkout-service&#x27;,\n  defaultAttributes: { workflow: &#x27;checkout&#x27; },\n});\n\nconst inventoryTelemetry = createAutotelAdapter({\n  serviceName: &#x27;inventory-service&#x27;,\n  defaultAttributes: { workflow: &#x27;inventory&#x27; },\n});\n\nconst checkoutWorkflow = createWorkflow(checkoutDeps, {\n  onEvent: checkoutTelemetry.handleEvent,\n});\n\nconst inventoryWorkflow = createWorkflow(inventoryDeps, {\n  onEvent: inventoryTelemetry.handleEvent,\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"combining-with-other-event-handlers\">Combining with other event handlers\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#combining-with-other-event-handlers\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Combining with other event handlers”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createAutotelAdapter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createVisualizer\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> autotel\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createAutotelAdapter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">serviceName\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'checkout'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> viz\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createVisualizer\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">workflowName\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'checkout'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">event\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    autotel.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(event);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    viz.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(event);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createAutotelAdapter, createVisualizer } from &#x27;@jagreehal/workflow&#x27;;\n\nconst autotel = createAutotelAdapter({ serviceName: &#x27;checkout&#x27; });\nconst viz = createVisualizer({ workflowName: &#x27;checkout&#x27; });\n\nconst workflow = createWorkflow(deps, {\n  onEvent: (event) => {\n    autotel.handleEvent(event);\n    viz.handleEvent(event);\n  },\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"custom-metrics\">Custom metrics\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#custom-metrics\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Custom metrics”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Extend the adapter output with your own metrics:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> autotel\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createAutotelAdapter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">serviceName\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'checkout'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">event\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    autotel.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(event);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">    // Custom metric tracking\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (event.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">type\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> ===\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'step_complete'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> &#x26;&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> !\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">event.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">result\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      customMetrics.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">increment\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'checkout.step.failures'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">        step\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> event.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">stepName\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">        error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> String\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(event.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">result\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const autotel = createAutotelAdapter({ serviceName: &#x27;checkout&#x27; });\n\nconst workflow = createWorkflow(deps, {\n  onEvent: (event) => {\n    autotel.handleEvent(event);\n\n    // Custom metric tracking\n    if (event.type === &#x27;step_complete&#x27; &#x26;&#x26; !event.result.ok) {\n      customMetrics.increment(&#x27;checkout.step.failures&#x27;, {\n        step: event.stepName,\n        error: String(event.result.error),\n      });\n    }\n  },\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"environment-variables\">Environment variables\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#environment-variables\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Environment variables”\u003C/span>\u003C/a>\u003C/div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Variable\u003C/th>\u003Cth>Description\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">AUTOTEL_DEBUG\u003C/code>\u003C/td>\u003Ctd>Set to \u003Ccode dir=\"auto\">true\u003C/code> for console output\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">OTEL_SERVICE_NAME\u003C/code>\u003C/td>\u003Ctd>Default service name (overridden by config)\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"integration-with-otel-collectors\">Integration with OTEL collectors\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#integration-with-otel-collectors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Integration with OTEL collectors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>The adapter works with standard OpenTelemetry collectors. Configure your collector endpoint:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">trace\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'autotel'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Configure your OTEL exporter\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">trace.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">configure\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  endpoint\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> process.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">env\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">OTEL_EXPORTER_OTLP_ENDPOINT\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  headers\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">    'api-key'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> process.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">env\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">OTEL_API_KEY\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> traced\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> withAutotelTracing\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(trace, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">serviceName\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'checkout'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { trace } from &#x27;autotel&#x27;;\n\n// Configure your OTEL exporter\ntrace.configure({\n  endpoint: process.env.OTEL_EXPORTER_OTLP_ENDPOINT,\n  headers: {\n    &#x27;api-key&#x27;: process.env.OTEL_API_KEY,\n  },\n});\n\nconst traced = withAutotelTracing(trace, { serviceName: &#x27;checkout&#x27; });\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>",{"headings":194,"localImagePaths":228,"remoteImagePaths":229,"frontmatter":230,"imagePaths":231},[195,198,201,204,207,210,213,216,219,222,225],{"depth":57,"slug":196,"text":197},"autotel-adapter","Autotel adapter",{"depth":57,"slug":199,"text":200},"access-metrics","Access metrics",{"depth":57,"slug":202,"text":203},"simple-event-handler","Simple event handler",{"depth":57,"slug":205,"text":206},"with-autotel-tracing","With autotel tracing",{"depth":57,"slug":208,"text":209},"configuration-options","Configuration options",{"depth":57,"slug":211,"text":212},"span-attributes","Span attributes",{"depth":57,"slug":214,"text":215},"multiple-workflows","Multiple workflows",{"depth":57,"slug":217,"text":218},"combining-with-other-event-handlers","Combining with other event handlers",{"depth":57,"slug":220,"text":221},"custom-metrics","Custom metrics",{"depth":57,"slug":223,"text":224},"environment-variables","Environment variables",{"depth":57,"slug":226,"text":227},"integration-with-otel-collectors","Integration with OTEL collectors",[],[],{"title":183,"description":184},[],"advanced/rate-limiting",{"id":232,"data":234,"body":240,"filePath":241,"digest":242,"rendered":243},{"title":235,"description":236,"editUrl":16,"head":237,"template":46,"sidebar":238,"pagefind":16,"draft":35},"Rate Limiting","Control throughput with token bucket and concurrency limiters",[],{"hidden":35,"attrs":239},{},"Control throughput for steps that hit rate-limited APIs or limited resources.\n\n## Rate limiter\n\nToken bucket algorithm for requests-per-second limits:\n\n```typescript\nimport { createRateLimiter, rateLimiterPresets } from '@jagreehal/workflow';\n\n// Custom config\nconst rateLimiter = createRateLimiter('api-calls', {\n  maxPerSecond: 10,        // Maximum operations per second\n  burstCapacity: 20,       // Allow brief spikes (default: maxPerSecond * 2)\n  strategy: 'wait',        // 'wait' (default) or 'reject'\n});\n\n// Wrap operations\nconst data = await rateLimiter.execute(async () => {\n  return await callExternalApi();\n});\n\n// Or use presets\nconst apiLimiter = createRateLimiter('external-api', rateLimiterPresets.api);\n// { maxPerSecond: 10, burstCapacity: 20, strategy: 'wait' }\n\nconst externalLimiter = createRateLimiter('partner-api', rateLimiterPresets.external);\n// { maxPerSecond: 5, burstCapacity: 10, strategy: 'wait' }\n```\n\n## Concurrency limiter\n\nLimit parallel operations (for database connections, file handles, etc.):\n\n```typescript\nimport { createConcurrencyLimiter, rateLimiterPresets } from '@jagreehal/workflow';\n\nconst concurrencyLimiter = createConcurrencyLimiter('db-pool', {\n  maxConcurrent: 5,        // Max 5 concurrent operations\n  maxQueueSize: 100,       // Queue up to 100 waiting requests\n  strategy: 'queue',       // 'queue' (default) or 'reject'\n});\n\nconst data = await concurrencyLimiter.execute(async () => {\n  return await db.query('SELECT * FROM users');\n});\n\n// Or use preset\nconst dbLimiter = createConcurrencyLimiter('database', rateLimiterPresets.database);\n// { maxConcurrent: 10, strategy: 'queue', maxQueueSize: 100 }\n```\n\n## Combined limiter\n\nApply both rate and concurrency limits:\n\n```typescript\nimport { createCombinedLimiter } from '@jagreehal/workflow';\n\nconst limiter = createCombinedLimiter('api', {\n  rate: { maxPerSecond: 10 },\n  concurrency: { maxConcurrent: 3 },\n});\n\nconst data = await limiter.execute(async () => callApi());\n```\n\n## Result-returning operations\n\n```typescript\nconst result = await rateLimiter.executeResult(async () => {\n  return ok(await callExternalApi());\n});\n\nif (!result.ok) {\n  // Handle error (could be rate limit rejection or operation error)\n}\n```\n\n## Batch operations\n\nProcess many items with bounded concurrency:\n\n```typescript\nconst results = await concurrencyLimiter.executeAll(\n  ids.map(id => async () => fetchItem(id))\n);\n\n// results: Array of outcomes\n```\n\n## Monitoring\n\n```typescript\nconst stats = rateLimiter.getStats();\nconsole.log(stats.availableTokens);  // Current available tokens\nconsole.log(stats.waitingCount);     // Requests waiting for tokens\n```\n\n## Strategies\n\n### Wait strategy (default)\n\nRequests wait until capacity is available:\n\n```typescript\nconst limiter = createRateLimiter('api', {\n  maxPerSecond: 10,\n  strategy: 'wait', // Queues requests\n});\n```\n\n### Reject strategy\n\nRequests fail immediately when at capacity:\n\n```typescript\nconst limiter = createRateLimiter('api', {\n  maxPerSecond: 10,\n  strategy: 'reject', // Throws RateLimitExceededError\n});\n\ntry {\n  await limiter.execute(() => callApi());\n} catch (error) {\n  if (isRateLimitExceededError(error)) {\n    console.log('Rate limit exceeded, try later');\n  }\n}\n```\n\n## In workflows\n\n```typescript\nconst apiLimiter = createRateLimiter('partner-api', rateLimiterPresets.external);\n\nconst result = await workflow(async (step) => {\n  // Rate-limited API calls\n  const users = await step(async () => {\n    const ids = ['1', '2', '3', '4', '5'];\n    return await apiLimiter.executeAll(\n      ids.map(id => async () => fetchUser(id))\n    );\n  });\n\n  return users;\n});\n```\n\n## Configuration reference\n\n### Rate limiter\n\n```typescript\n{\n  maxPerSecond: number;      // Operations per second (required)\n  burstCapacity?: number;    // Max burst (default: maxPerSecond * 2)\n  strategy?: 'wait' | 'reject';\n}\n```\n\n### Concurrency limiter\n\n```typescript\n{\n  maxConcurrent: number;     // Max parallel operations (required)\n  maxQueueSize?: number;     // Max waiting requests (default: Infinity)\n  strategy?: 'queue' | 'reject';\n}\n```\n\n### Presets\n\n| Preset | Type | Config |\n|--------|------|--------|\n| `rateLimiterPresets.api` | Rate | 10/s, burst 20 |\n| `rateLimiterPresets.external` | Rate | 5/s, burst 10 |\n| `rateLimiterPresets.database` | Concurrency | 10 concurrent, queue 100 |","src/content/docs/advanced/rate-limiting.md","e358812a2bf46c1d",{"html":244,"metadata":245},"\u003Cp>Control throughput for steps that hit rate-limited APIs or limited resources.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"rate-limiter\">Rate limiter\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#rate-limiter\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Rate limiter”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Token bucket algorithm for requests-per-second limits:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createRateLimiter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">rateLimiterPresets\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Custom config\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> rateLimiter\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createRateLimiter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'api-calls'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  maxPerSecond\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 10\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,        \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Maximum operations per second\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  burstCapacity\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 20\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,       \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Allow brief spikes (default: maxPerSecond * 2)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  strategy\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'wait'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,        \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// 'wait' (default) or 'reject'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Wrap operations\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> data\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> rateLimiter.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">execute\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> callExternalApi\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Or use presets\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> apiLimiter\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createRateLimiter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'external-api'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, rateLimiterPresets.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">api\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// { maxPerSecond: 10, burstCapacity: 20, strategy: 'wait' }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> externalLimiter\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createRateLimiter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'partner-api'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, rateLimiterPresets.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">external\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// { maxPerSecond: 5, burstCapacity: 10, strategy: 'wait' }\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createRateLimiter, rateLimiterPresets } from &#x27;@jagreehal/workflow&#x27;;\n\n// Custom config\nconst rateLimiter = createRateLimiter(&#x27;api-calls&#x27;, {\n  maxPerSecond: 10,        // Maximum operations per second\n  burstCapacity: 20,       // Allow brief spikes (default: maxPerSecond * 2)\n  strategy: &#x27;wait&#x27;,        // &#x27;wait&#x27; (default) or &#x27;reject&#x27;\n});\n\n// Wrap operations\nconst data = await rateLimiter.execute(async () => {\n  return await callExternalApi();\n});\n\n// Or use presets\nconst apiLimiter = createRateLimiter(&#x27;external-api&#x27;, rateLimiterPresets.api);\n// { maxPerSecond: 10, burstCapacity: 20, strategy: &#x27;wait&#x27; }\n\nconst externalLimiter = createRateLimiter(&#x27;partner-api&#x27;, rateLimiterPresets.external);\n// { maxPerSecond: 5, burstCapacity: 10, strategy: &#x27;wait&#x27; }\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"concurrency-limiter\">Concurrency limiter\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#concurrency-limiter\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Concurrency limiter”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Limit parallel operations (for database connections, file handles, etc.):\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createConcurrencyLimiter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">rateLimiterPresets\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> concurrencyLimiter\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createConcurrencyLimiter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'db-pool'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  maxConcurrent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 5\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,        \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Max 5 concurrent operations\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  maxQueueSize\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 100\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,       \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Queue up to 100 waiting requests\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  strategy\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'queue'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,       \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// 'queue' (default) or 'reject'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> data\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> concurrencyLimiter.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">execute\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">query\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'SELECT * FROM users'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Or use preset\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> dbLimiter\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createConcurrencyLimiter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'database'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, rateLimiterPresets.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">database\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// { maxConcurrent: 10, strategy: 'queue', maxQueueSize: 100 }\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createConcurrencyLimiter, rateLimiterPresets } from &#x27;@jagreehal/workflow&#x27;;\n\nconst concurrencyLimiter = createConcurrencyLimiter(&#x27;db-pool&#x27;, {\n  maxConcurrent: 5,        // Max 5 concurrent operations\n  maxQueueSize: 100,       // Queue up to 100 waiting requests\n  strategy: &#x27;queue&#x27;,       // &#x27;queue&#x27; (default) or &#x27;reject&#x27;\n});\n\nconst data = await concurrencyLimiter.execute(async () => {\n  return await db.query(&#x27;SELECT * FROM users&#x27;);\n});\n\n// Or use preset\nconst dbLimiter = createConcurrencyLimiter(&#x27;database&#x27;, rateLimiterPresets.database);\n// { maxConcurrent: 10, strategy: &#x27;queue&#x27;, maxQueueSize: 100 }\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"combined-limiter\">Combined limiter\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#combined-limiter\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Combined limiter”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Apply both rate and concurrency limits:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createCombinedLimiter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> limiter\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createCombinedLimiter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'api'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  rate\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">maxPerSecond\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 10\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  concurrency\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">maxConcurrent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> data\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> limiter.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">execute\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> callApi\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createCombinedLimiter } from &#x27;@jagreehal/workflow&#x27;;\n\nconst limiter = createCombinedLimiter(&#x27;api&#x27;, {\n  rate: { maxPerSecond: 10 },\n  concurrency: { maxConcurrent: 3 },\n});\n\nconst data = await limiter.execute(async () => callApi());\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"result-returning-operations\">Result-returning operations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#result-returning-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Result-returning operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> rateLimiter.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">executeResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> callExternalApi\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Handle error (could be rate limit rejection or operation error)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await rateLimiter.executeResult(async () => {\n  return ok(await callExternalApi());\n});\n\nif (!result.ok) {\n  // Handle error (could be rate limit rejection or operation error)\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"batch-operations\">Batch operations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#batch-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Batch operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Process many items with bounded concurrency:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> results\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> concurrencyLimiter.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">executeAll\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  ids.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">map\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> =>\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchItem\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(id))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// results: Array of outcomes\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const results = await concurrencyLimiter.executeAll(\n  ids.map(id => async () => fetchItem(id))\n);\n\n// results: Array of outcomes\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"monitoring\">Monitoring\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#monitoring\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Monitoring”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> stats\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> rateLimiter.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">getStats\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(stats.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">availableTokens\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Current available tokens\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(stats.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">waitingCount\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);     \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Requests waiting for tokens\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const stats = rateLimiter.getStats();\nconsole.log(stats.availableTokens);  // Current available tokens\nconsole.log(stats.waitingCount);     // Requests waiting for tokens\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"strategies\">Strategies\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#strategies\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Strategies”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"wait-strategy-default\">Wait strategy (default)\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#wait-strategy-default\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Wait strategy (default)”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Requests wait until capacity is available:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> limiter\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createRateLimiter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'api'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  maxPerSecond\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 10\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  strategy\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'wait'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Queues requests\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const limiter = createRateLimiter(&#x27;api&#x27;, {\n  maxPerSecond: 10,\n  strategy: &#x27;wait&#x27;, // Queues requests\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"reject-strategy\">Reject strategy\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#reject-strategy\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Reject strategy”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Requests fail immediately when at capacity:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> limiter\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createRateLimiter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'api'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  maxPerSecond\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 10\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  strategy\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'reject'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Throws RateLimitExceededError\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">try\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> limiter.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">execute\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> callApi\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">} \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">catch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (error) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">isRateLimitExceededError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(error)) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Rate limit exceeded, try later'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const limiter = createRateLimiter(&#x27;api&#x27;, {\n  maxPerSecond: 10,\n  strategy: &#x27;reject&#x27;, // Throws RateLimitExceededError\n});\n\ntry {\n  await limiter.execute(() => callApi());\n} catch (error) {\n  if (isRateLimitExceededError(error)) {\n    console.log(&#x27;Rate limit exceeded, try later&#x27;);\n  }\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"in-workflows\">In workflows\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#in-workflows\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “In workflows”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> apiLimiter\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createRateLimiter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'partner-api'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, rateLimiterPresets.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">external\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Rate-limited API calls\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> users\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> ids\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> [\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'2'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'3'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'4'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'5'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">];\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> apiLimiter.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">executeAll\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      ids.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">map\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> =>\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(id))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> users;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const apiLimiter = createRateLimiter(&#x27;partner-api&#x27;, rateLimiterPresets.external);\n\nconst result = await workflow(async (step) => {\n  // Rate-limited API calls\n  const users = await step(async () => {\n    const ids = [&#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;];\n    return await apiLimiter.executeAll(\n      ids.map(id => async () => fetchUser(id))\n    );\n  });\n\n  return users;\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"configuration-reference\">Configuration reference\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#configuration-reference\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Configuration reference”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"rate-limiter-1\">Rate limiter\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#rate-limiter-1\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Rate limiter”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  maxPerSecond\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: number;      \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Operations per second (required)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  burstCapacity\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> number;    \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Max burst (default: maxPerSecond * 2)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  strategy\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'wait'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'reject'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"{\n  maxPerSecond: number;      // Operations per second (required)\n  burstCapacity?: number;    // Max burst (default: maxPerSecond * 2)\n  strategy?: &#x27;wait&#x27; | &#x27;reject&#x27;;\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"concurrency-limiter-1\">Concurrency limiter\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#concurrency-limiter-1\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Concurrency limiter”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  maxConcurrent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: number;     \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Max parallel operations (required)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  maxQueueSize\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> number;     \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Max waiting requests (default: Infinity)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  strategy\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'queue'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'reject'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"{\n  maxConcurrent: number;     // Max parallel operations (required)\n  maxQueueSize?: number;     // Max waiting requests (default: Infinity)\n  strategy?: &#x27;queue&#x27; | &#x27;reject&#x27;;\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"presets\">Presets\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#presets\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Presets”\u003C/span>\u003C/a>\u003C/div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Preset\u003C/th>\u003Cth>Type\u003C/th>\u003Cth>Config\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">rateLimiterPresets.api\u003C/code>\u003C/td>\u003Ctd>Rate\u003C/td>\u003Ctd>10/s, burst 20\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">rateLimiterPresets.external\u003C/code>\u003C/td>\u003Ctd>Rate\u003C/td>\u003Ctd>5/s, burst 10\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">rateLimiterPresets.database\u003C/code>\u003C/td>\u003Ctd>Concurrency\u003C/td>\u003Ctd>10 concurrent, queue 100\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>",{"headings":246,"localImagePaths":281,"remoteImagePaths":282,"frontmatter":283,"imagePaths":284},[247,250,253,256,257,260,263,266,269,272,273,274,276,278],{"depth":57,"slug":248,"text":249},"rate-limiter","Rate limiter",{"depth":57,"slug":251,"text":252},"concurrency-limiter","Concurrency limiter",{"depth":57,"slug":254,"text":255},"combined-limiter","Combined limiter",{"depth":57,"slug":105,"text":106},{"depth":57,"slug":258,"text":259},"batch-operations","Batch operations",{"depth":57,"slug":261,"text":262},"monitoring","Monitoring",{"depth":57,"slug":264,"text":265},"strategies","Strategies",{"depth":160,"slug":267,"text":268},"wait-strategy-default","Wait strategy (default)",{"depth":160,"slug":270,"text":271},"reject-strategy","Reject strategy",{"depth":57,"slug":114,"text":115},{"depth":57,"slug":120,"text":121},{"depth":160,"slug":275,"text":249},"rate-limiter-1",{"depth":160,"slug":277,"text":252},"concurrency-limiter-1",{"depth":160,"slug":279,"text":280},"presets","Presets",[],[],{"title":235,"description":236},[],"advanced/webhooks",{"id":285,"data":287,"body":293,"filePath":294,"digest":295,"rendered":296},{"title":288,"description":289,"editUrl":16,"head":290,"template":46,"sidebar":291,"pagefind":16,"draft":35},"Webhooks & Events","Expose workflows as HTTP endpoints or event consumers",[],{"hidden":35,"attrs":292},{},"Expose workflows as HTTP endpoints or event consumers with built-in validation and error mapping.\n\n## Webhook handler\n\nCreate HTTP handlers for workflows:\n\n```typescript\nimport {\n  createWebhookHandler,\n  createResultMapper,\n  createExpressHandler,\n  requireFields,\n  ok,\n} from '@jagreehal/workflow';\n\n// Create a webhook handler\nconst handler = createWebhookHandler(\n  checkoutWorkflow,\n  async (step, deps, input: CheckoutInput) => {\n    const charge = await step(() => deps.chargeCard(input.amount));\n    await step(() => deps.sendEmail(input.email, charge.receiptUrl));\n    return { chargeId: charge.id };\n  },\n  {\n    validateInput: (req) => {\n      const validation = requireFields(['amount', 'email'])(req.body);\n      if (!validation.ok) return validation;\n      return ok({ amount: req.body.amount, email: req.body.email });\n    },\n    mapResult: createResultMapper([\n      { error: 'CARD_DECLINED', status: 402, message: 'Payment failed' },\n      { error: 'INVALID_EMAIL', status: 400, message: 'Invalid email address' },\n    ]),\n  }\n);\n```\n\n## With Express\n\n```typescript\nimport express from 'express';\nimport { createExpressHandler } from '@jagreehal/workflow';\n\nconst app = express();\napp.use(express.json());\n\n// Use the built-in adapter\napp.post('/checkout', createExpressHandler(handler));\n\n// Or handle manually\napp.post('/checkout', async (req, res) => {\n  const response = await handler({\n    method: req.method,\n    path: req.path,\n    headers: req.headers,\n    body: req.body,\n    query: req.query,\n    params: req.params,\n  });\n  res.status(response.status).json(response.body);\n});\n```\n\n## Input validation\n\nUse built-in validators or write your own:\n\n```typescript\nimport { requireFields, validationError, ok, err } from '@jagreehal/workflow';\n\n// Built-in field checker\nconst validate = requireFields(['amount', 'email', 'items']);\n\n// Custom validation\nconst validateInput = (req) => {\n  if (!req.body.amount || req.body.amount \u003C= 0) {\n    return err(validationError('Amount must be positive'));\n  }\n  if (!req.body.email?.includes('@')) {\n    return err(validationError('Invalid email format'));\n  }\n  return ok({\n    amount: req.body.amount,\n    email: req.body.email,\n  });\n};\n```\n\n## Result mapping\n\nMap workflow errors to HTTP responses:\n\n```typescript\nimport { createResultMapper } from '@jagreehal/workflow';\n\nconst mapResult = createResultMapper([\n  { error: 'NOT_FOUND', status: 404, message: 'Resource not found' },\n  { error: 'UNAUTHORIZED', status: 401, message: 'Authentication required' },\n  { error: 'FORBIDDEN', status: 403, message: 'Access denied' },\n  { error: 'VALIDATION_ERROR', status: 400, message: 'Invalid input' },\n  { error: 'CARD_DECLINED', status: 402, message: 'Payment declined' },\n  // Unmapped errors return 500 with generic message\n]);\n```\n\n## Event handlers\n\nFor message queues (SQS, RabbitMQ, etc.):\n\n```typescript\nimport { createEventHandler } from '@jagreehal/workflow';\n\nconst handler = createEventHandler(\n  checkoutWorkflow,\n  async (step, deps, payload: CheckoutPayload) => {\n    const charge = await step(() => deps.chargeCard(payload.amount));\n    return { chargeId: charge.id };\n  },\n  {\n    validatePayload: (event) => {\n      if (!event.payload.amount) {\n        return err(validationError('Missing amount'));\n      }\n      return ok(event.payload);\n    },\n    mapResult: (result) => ({\n      success: result.ok,\n      ack: result.ok || !isRetryableError(result.error),\n      error: result.ok ? undefined : { type: String(result.error) },\n    }),\n  }\n);\n\n// Use with SQS, RabbitMQ, etc.\nqueue.consume(async (message) => {\n  const result = await handler({\n    id: message.id,\n    type: message.type,\n    payload: message.body,\n  });\n  if (result.ack) await message.ack();\n  else await message.nack();\n});\n```\n\n## Simple handlers\n\nFor straightforward use cases without workflow context:\n\n```typescript\nimport { createSimpleHandler, ok } from '@jagreehal/workflow';\n\nconst handler = createSimpleHandler(\n  async (input: { userId: string }) => {\n    const user = await db.users.find(input.userId);\n    if (!user) return err('NOT_FOUND' as const);\n    return ok(user);\n  },\n  {\n    validateInput: (req) => {\n      if (!req.params.userId) {\n        return err(validationError('Missing userId'));\n      }\n      return ok({ userId: req.params.userId });\n    },\n  }\n);\n```\n\n## Request/response types\n\n### WebhookRequest\n\n```typescript\ninterface WebhookRequest {\n  method: string;\n  path: string;\n  headers: Record\u003Cstring, string | string[]>;\n  body: unknown;\n  query: Record\u003Cstring, string>;\n  params: Record\u003Cstring, string>;\n}\n```\n\n### WebhookResponse\n\n```typescript\ninterface WebhookResponse {\n  status: number;\n  body: unknown;\n  headers?: Record\u003Cstring, string>;\n}\n```\n\n### EventRequest\n\n```typescript\ninterface EventRequest\u003CT> {\n  id: string;\n  type: string;\n  payload: T;\n  metadata?: Record\u003Cstring, unknown>;\n}\n```\n\n### EventResponse\n\n```typescript\ninterface EventResponse {\n  success: boolean;\n  ack: boolean;  // Whether to acknowledge the message\n  error?: { type: string; message?: string };\n}\n```\n\n## Error handling patterns\n\n```typescript\n// Determine if error is retryable\nconst isRetryableError = (error: unknown): boolean => {\n  const retryable = ['TIMEOUT', 'SERVICE_UNAVAILABLE', 'RATE_LIMITED'];\n  return typeof error === 'string' && retryable.includes(error);\n};\n\n// Custom result mapper with retry logic\nconst mapResult = (result) => ({\n  success: result.ok,\n  ack: result.ok || !isRetryableError(result.error),\n  error: result.ok ? undefined : {\n    type: String(result.error),\n    retryable: isRetryableError(result.error),\n  },\n});\n```","src/content/docs/advanced/webhooks.md","0ed280fe0ebbfbb7",{"html":297,"metadata":298},"\u003Cp>Expose workflows as HTTP endpoints or event consumers with built-in validation and error mapping.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"webhook-handler\">Webhook handler\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#webhook-handler\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Webhook handler”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Create HTTP handlers for workflows:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createWebhookHandler\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createResultMapper\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createExpressHandler\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  requireFields\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">} \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create a webhook handler\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> handler\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWebhookHandler\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  checkoutWorkflow,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">deps\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">input\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> CheckoutInput\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> charge\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> deps.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">chargeCard\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(input.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">amount\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> deps.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">sendEmail\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(input.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">email\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, charge.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">receiptUrl\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">chargeId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> charge.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    validateInput\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">req\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> validation\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> requireFields\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'amount'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'email'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">])(req.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">body\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">validation.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> validation;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">amount\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> req.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">body\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">amount\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">email\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> req.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">body\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">email\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    mapResult\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createResultMapper\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'CARD_DECLINED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 402\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">message\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Payment failed'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'INVALID_EMAIL'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 400\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">message\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Invalid email address'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    ]),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import {\n  createWebhookHandler,\n  createResultMapper,\n  createExpressHandler,\n  requireFields,\n  ok,\n} from &#x27;@jagreehal/workflow&#x27;;\n\n// Create a webhook handler\nconst handler = createWebhookHandler(\n  checkoutWorkflow,\n  async (step, deps, input: CheckoutInput) => {\n    const charge = await step(() => deps.chargeCard(input.amount));\n    await step(() => deps.sendEmail(input.email, charge.receiptUrl));\n    return { chargeId: charge.id };\n  },\n  {\n    validateInput: (req) => {\n      const validation = requireFields([&#x27;amount&#x27;, &#x27;email&#x27;])(req.body);\n      if (!validation.ok) return validation;\n      return ok({ amount: req.body.amount, email: req.body.email });\n    },\n    mapResult: createResultMapper([\n      { error: &#x27;CARD_DECLINED&#x27;, status: 402, message: &#x27;Payment failed&#x27; },\n      { error: &#x27;INVALID_EMAIL&#x27;, status: 400, message: &#x27;Invalid email address&#x27; },\n    ]),\n  }\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"with-express\">With Express\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#with-express\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “With Express”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\"> express\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'express'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createExpressHandler\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> app\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> express\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">app.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">use\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(express.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">json\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Use the built-in adapter\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">app.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">post\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'/checkout'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createExpressHandler\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(handler));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Or handle manually\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">app.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">post\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'/checkout'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">req\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">res\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> response\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> handler\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    method\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> req.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">method\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    path\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> req.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">path\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    headers\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> req.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">headers\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    body\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> req.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">body\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    query\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> req.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">query\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    params\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> req.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">params\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  res.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">status\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(response.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">json\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(response.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">body\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import express from &#x27;express&#x27;;\nimport { createExpressHandler } from &#x27;@jagreehal/workflow&#x27;;\n\nconst app = express();\napp.use(express.json());\n\n// Use the built-in adapter\napp.post(&#x27;/checkout&#x27;, createExpressHandler(handler));\n\n// Or handle manually\napp.post(&#x27;/checkout&#x27;, async (req, res) => {\n  const response = await handler({\n    method: req.method,\n    path: req.path,\n    headers: req.headers,\n    body: req.body,\n    query: req.query,\n    params: req.params,\n  });\n  res.status(response.status).json(response.body);\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"input-validation\">Input validation\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#input-validation\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Input validation”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use built-in validators or write your own:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">requireFields\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">validationError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Built-in field checker\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> validate\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> requireFields\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'amount'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'email'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'items'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">]);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Custom validation\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> validateInput\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">req\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">req.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">body\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">amount\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> ||\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> req.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">body\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">amount\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> &#x3C;=\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 0\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">validationError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Amount must be positive'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">req.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">body\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">email\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">?.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">includes\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'@'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">validationError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Invalid email format'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    amount\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> req.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">body\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">amount\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    email\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> req.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">body\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">email\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { requireFields, validationError, ok, err } from &#x27;@jagreehal/workflow&#x27;;\n\n// Built-in field checker\nconst validate = requireFields([&#x27;amount&#x27;, &#x27;email&#x27;, &#x27;items&#x27;]);\n\n// Custom validation\nconst validateInput = (req) => {\n  if (!req.body.amount || req.body.amount \u003C= 0) {\n    return err(validationError(&#x27;Amount must be positive&#x27;));\n  }\n  if (!req.body.email?.includes(&#x27;@&#x27;)) {\n    return err(validationError(&#x27;Invalid email format&#x27;));\n  }\n  return ok({\n    amount: req.body.amount,\n    email: req.body.email,\n  });\n};\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"result-mapping\">Result mapping\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#result-mapping\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Result mapping”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Map workflow errors to HTTP responses:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createResultMapper\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> mapResult\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createResultMapper\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 404\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">message\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Resource not found'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'UNAUTHORIZED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 401\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">message\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Authentication required'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'FORBIDDEN'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 403\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">message\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Access denied'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'VALIDATION_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 400\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">message\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Invalid input'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'CARD_DECLINED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 402\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">message\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Payment declined'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Unmapped errors return 500 with generic message\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">]);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createResultMapper } from &#x27;@jagreehal/workflow&#x27;;\n\nconst mapResult = createResultMapper([\n  { error: &#x27;NOT_FOUND&#x27;, status: 404, message: &#x27;Resource not found&#x27; },\n  { error: &#x27;UNAUTHORIZED&#x27;, status: 401, message: &#x27;Authentication required&#x27; },\n  { error: &#x27;FORBIDDEN&#x27;, status: 403, message: &#x27;Access denied&#x27; },\n  { error: &#x27;VALIDATION_ERROR&#x27;, status: 400, message: &#x27;Invalid input&#x27; },\n  { error: &#x27;CARD_DECLINED&#x27;, status: 402, message: &#x27;Payment declined&#x27; },\n  // Unmapped errors return 500 with generic message\n]);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"event-handlers\">Event handlers\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#event-handlers\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Event handlers”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>For message queues (SQS, RabbitMQ, etc.):\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createEventHandler\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> handler\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createEventHandler\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  checkoutWorkflow,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">deps\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">payload\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> CheckoutPayload\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> charge\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> deps.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">chargeCard\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(payload.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">amount\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">chargeId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> charge.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    validatePayload\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">event\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">event.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">payload\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">amount\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">        return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">validationError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Missing amount'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(event.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">payload\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    mapResult\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">result\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> ({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      success\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      ack\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> ||\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> !\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">isRetryableError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> ?\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> undefined\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> :\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">type\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> String\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Use with SQS, RabbitMQ, etc.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">queue.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">consume\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">message\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> handler\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> message.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    type\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> message.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">type\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    payload\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> message.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">body\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ack\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> message.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">ack\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  else\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> message.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">nack\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createEventHandler } from &#x27;@jagreehal/workflow&#x27;;\n\nconst handler = createEventHandler(\n  checkoutWorkflow,\n  async (step, deps, payload: CheckoutPayload) => {\n    const charge = await step(() => deps.chargeCard(payload.amount));\n    return { chargeId: charge.id };\n  },\n  {\n    validatePayload: (event) => {\n      if (!event.payload.amount) {\n        return err(validationError(&#x27;Missing amount&#x27;));\n      }\n      return ok(event.payload);\n    },\n    mapResult: (result) => ({\n      success: result.ok,\n      ack: result.ok || !isRetryableError(result.error),\n      error: result.ok ? undefined : { type: String(result.error) },\n    }),\n  }\n);\n\n// Use with SQS, RabbitMQ, etc.\nqueue.consume(async (message) => {\n  const result = await handler({\n    id: message.id,\n    type: message.type,\n    payload: message.body,\n  });\n  if (result.ack) await message.ack();\n  else await message.nack();\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"simple-handlers\">Simple handlers\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#simple-handlers\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Simple handlers”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>For straightforward use cases without workflow context:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createSimpleHandler\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> handler\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createSimpleHandler\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">input\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">userId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">users\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">find\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(input.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">userId\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">user) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F47067\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> const\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    validateInput\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">req\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">req.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">params\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">userId\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">        return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">validationError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Missing userId'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">userId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> req.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">params\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">userId\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createSimpleHandler, ok } from &#x27;@jagreehal/workflow&#x27;;\n\nconst handler = createSimpleHandler(\n  async (input: { userId: string }) => {\n    const user = await db.users.find(input.userId);\n    if (!user) return err(&#x27;NOT_FOUND&#x27; as const);\n    return ok(user);\n  },\n  {\n    validateInput: (req) => {\n      if (!req.params.userId) {\n        return err(validationError(&#x27;Missing userId&#x27;));\n      }\n      return ok({ userId: req.params.userId });\n    },\n  }\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"requestresponse-types\">Request/response types\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#requestresponse-types\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Request/response types”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"webhookrequest\">WebhookRequest\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#webhookrequest\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “WebhookRequest”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">interface\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> WebhookRequest\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  method\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  path\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  headers\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> Record\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\">string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\">string\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">[]>;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  body\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> unknown\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  query\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> Record\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\">string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\">string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">>;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  params\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> Record\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\">string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\">string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">>;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"interface WebhookRequest {\n  method: string;\n  path: string;\n  headers: Record\u003Cstring, string | string[]>;\n  body: unknown;\n  query: Record\u003Cstring, string>;\n  params: Record\u003Cstring, string>;\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"webhookresponse\">WebhookResponse\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#webhookresponse\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “WebhookResponse”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">interface\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> WebhookResponse\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> number\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  body\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> unknown\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  headers\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> Record\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\">string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\">string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">>;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"interface WebhookResponse {\n  status: number;\n  body: unknown;\n  headers?: Record\u003Cstring, string>;\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"eventrequest\">EventRequest\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#eventrequest\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “EventRequest”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">interface\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> EventRequest\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">T\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  type\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  payload\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> T\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  metadata\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> Record\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\">string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\">unknown\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">>;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"interface EventRequest\u003CT> {\n  id: string;\n  type: string;\n  payload: T;\n  metadata?: Record\u003Cstring, unknown>;\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"eventresponse\">EventResponse\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#eventresponse\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “EventResponse”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">interface\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> EventResponse\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  success\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> boolean\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  ack\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> boolean\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Whether to acknowledge the message\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">type\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">; \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">message\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"interface EventResponse {\n  success: boolean;\n  ack: boolean;  // Whether to acknowledge the message\n  error?: { type: string; message?: string };\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"error-handling-patterns\">Error handling patterns\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#error-handling-patterns\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Error handling patterns”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Determine if error is retryable\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> isRetryableError\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> unknown\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> boolean\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> =>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> retryable\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> [\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'TIMEOUT'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'SERVICE_UNAVAILABLE'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'RATE_LIMITED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">];\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> typeof\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> error \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">===\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'string'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> &#x26;&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> retryable.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">includes\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(error);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Custom result mapper with retry logic\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> mapResult\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">result\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> ({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  success\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  ack\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> ||\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> !\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">isRetryableError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> ?\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> undefined\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> :\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    type\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> String\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    retryable\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> isRetryableError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"// Determine if error is retryable\nconst isRetryableError = (error: unknown): boolean => {\n  const retryable = [&#x27;TIMEOUT&#x27;, &#x27;SERVICE_UNAVAILABLE&#x27;, &#x27;RATE_LIMITED&#x27;];\n  return typeof error === &#x27;string&#x27; &#x26;&#x26; retryable.includes(error);\n};\n\n// Custom result mapper with retry logic\nconst mapResult = (result) => ({\n  success: result.ok,\n  ack: result.ok || !isRetryableError(result.error),\n  error: result.ok ? undefined : {\n    type: String(result.error),\n    retryable: isRetryableError(result.error),\n  },\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>",{"headings":299,"localImagePaths":336,"remoteImagePaths":337,"frontmatter":338,"imagePaths":339},[300,303,306,309,312,315,318,321,324,327,330,333],{"depth":57,"slug":301,"text":302},"webhook-handler","Webhook handler",{"depth":57,"slug":304,"text":305},"with-express","With Express",{"depth":57,"slug":307,"text":308},"input-validation","Input validation",{"depth":57,"slug":310,"text":311},"result-mapping","Result mapping",{"depth":57,"slug":313,"text":314},"event-handlers","Event handlers",{"depth":57,"slug":316,"text":317},"simple-handlers","Simple handlers",{"depth":57,"slug":319,"text":320},"requestresponse-types","Request/response types",{"depth":160,"slug":322,"text":323},"webhookrequest","WebhookRequest",{"depth":160,"slug":325,"text":326},"webhookresponse","WebhookResponse",{"depth":160,"slug":328,"text":329},"eventrequest","EventRequest",{"depth":160,"slug":331,"text":332},"eventresponse","EventResponse",{"depth":57,"slug":334,"text":335},"error-handling-patterns","Error handling patterns",[],[],{"title":288,"description":289},[],"concepts/step",{"id":340,"data":342,"body":348,"filePath":349,"digest":350,"rendered":351},{"title":343,"description":344,"editUrl":16,"head":345,"template":46,"sidebar":346,"pagefind":16,"draft":35},"Steps","The step() function and its variants",[],{"hidden":35,"attrs":347},{},"`step()` executes an operation within a workflow. If the operation fails, the workflow exits early.\n\n## Basic usage\n\n```typescript\nconst workflow = createWorkflow({ fetchUser, fetchPosts });\n\nconst result = await workflow(async (step) => {\n  const user = await step(fetchUser('1'));\n  // If fetchUser returns err(), execution stops here\n  const posts = await step(fetchPosts(user.id));\n  return { user, posts };\n});\n```\n\n## Using thunks for caching\n\nPass a function (thunk) instead of calling directly to enable caching:\n\n```typescript\n// Without thunk - always executes\nconst user = await step(fetchUser('1'));\n\n// With thunk - can be cached\nconst user = await step(() => fetchUser('1'), { key: 'user:1' });\n```\n\n## Step options\n\n```typescript\nconst user = await step(() => fetchUser('1'), {\n  name: 'Fetch user',       // For visualization/logging\n  key: 'user:1',            // For caching/deduplication\n  retry: { attempts: 3 },   // Retry on failure\n  timeout: { ms: 5000 },    // Timeout after 5 seconds\n});\n```\n\n## step.try - wrap throwing code\n\nConvert exceptions into typed errors:\n\n```typescript\nconst data = await step.try(\n  async () => {\n    const res = await fetch('/api/data');\n    if (!res.ok) throw new Error(`HTTP ${res.status}`);\n    return res.json();\n  },\n  { error: 'FETCH_FAILED' as const }\n);\n```\n\nThe error type is added to the workflow's error union.\n\n## step.fromResult - preserve error details\n\nWhen your operation returns a Result with rich error objects:\n\n```typescript\ntype ApiError = { code: number; message: string };\n\nconst callApi = async (): AsyncResult\u003CData, ApiError> => {\n  // Returns err({ code: 429, message: 'Rate limited' })\n};\n\nconst data = await step.fromResult(\n  () => callApi(),\n  {\n    onError: (apiError) => ({\n      type: 'API_ERROR' as const,\n      ...apiError,\n    }),\n  }\n);\n```\n\n## step.retry - retry with backoff\n\n```typescript\nconst user = await step.retry(\n  () => fetchUser('1'),\n  {\n    attempts: 3,\n    backoff: 'exponential',  // 'fixed' | 'linear' | 'exponential'\n    delayMs: 100,            // Base delay\n    maxDelayMs: 5000,        // Cap for exponential\n    jitter: true,            // Add randomness\n    retryOn: (error) => error !== 'NOT_FOUND', // Don't retry NOT_FOUND\n  }\n);\n```\n\nBackoff strategies:\n- **fixed**: Same delay every time\n- **linear**: delay, delay*2, delay*3, ...\n- **exponential**: delay, delay*2, delay*4, delay*8, ...\n\n## step.withTimeout - add timeout\n\n```typescript\nconst data = await step.withTimeout(\n  () => slowOperation(),\n  {\n    ms: 5000,\n    name: 'Slow operation', // For error messages\n  }\n);\n```\n\nIf the timeout is reached, the workflow gets a `StepTimeoutError`.\n\n## Combining retry and timeout\n\n```typescript\nconst data = await step.retry(\n  () => step.withTimeout(() => fetchData(), { ms: 2000 }),\n  { attempts: 3, backoff: 'exponential' }\n);\n```\n\nEach attempt has a 2-second timeout. The whole operation retries up to 3 times.\n\n## Parallel steps\n\nRun multiple steps concurrently:\n\n```typescript\nimport { allAsync } from '@jagreehal/workflow';\n\nconst result = await workflow(async (step) => {\n  const [user, posts, comments] = await step(() =>\n    allAsync([\n      fetchUser('1'),\n      fetchPosts('1'),\n      fetchComments('1'),\n    ])\n  );\n  return { user, posts, comments };\n});\n```\n\n## Named steps for visualization\n\nGive steps names to see them in workflow diagrams:\n\n```typescript\nconst user = await step(() => fetchUser('1'), { name: 'Fetch user' });\nconst posts = await step(() => fetchPosts(user.id), { name: 'Fetch posts' });\n```\n\nSee [Visualization](/workflow/guides/visualization/) for details.\n\n## Next\n\n[Learn about Workflows →](/workflow/concepts/workflows/)","src/content/docs/concepts/step.md","aeac717c1d64108c",{"html":352,"metadata":353},"\u003Cp>\u003Ccode dir=\"auto\">step()\u003C/code> executes an operation within a workflow. If the operation fails, the workflow exits early.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"basic-usage\">Basic usage\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#basic-usage\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Basic usage”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ fetchUser, fetchPosts });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // If fetchUser returns err(), execution stops here\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> posts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { user, posts };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const workflow = createWorkflow({ fetchUser, fetchPosts });\n\nconst result = await workflow(async (step) => {\n  const user = await step(fetchUser(&#x27;1&#x27;));\n  // If fetchUser returns err(), execution stops here\n  const posts = await step(fetchPosts(user.id));\n  return { user, posts };\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"using-thunks-for-caching\">Using thunks for caching\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#using-thunks-for-caching\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Using thunks for caching”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Pass a function (thunk) instead of calling directly to enable caching:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Without thunk - always executes\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// With thunk - can be cached\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'user:1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"// Without thunk - always executes\nconst user = await step(fetchUser(&#x27;1&#x27;));\n\n// With thunk - can be cached\nconst user = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"step-options\">Step options\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#step-options\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Step options”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Fetch user'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,       \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// For visualization/logging\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'user:1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,            \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// For caching/deduplication\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  retry\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">attempts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },   \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Retry on failure\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  timeout\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ms\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 5000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },    \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Timeout after 5 seconds\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const user = await step(() => fetchUser(&#x27;1&#x27;), {\n  name: &#x27;Fetch user&#x27;,       // For visualization/logging\n  key: &#x27;user:1&#x27;,            // For caching/deduplication\n  retry: { attempts: 3 },   // Retry on failure\n  timeout: { ms: 5000 },    // Timeout after 5 seconds\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"steptry---wrap-throwing-code\">step.try - wrap throwing code\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#steptry---wrap-throwing-code\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “step.try - wrap throwing code”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Convert exceptions into typed errors:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> data\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> step.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">try\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> res\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'/api/data'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">res.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">throw\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> new\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> Error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`HTTP \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">res\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> res.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">json\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'FETCH_FAILED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F47067\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> const\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const data = await step.try(\n  async () => {\n    const res = await fetch(&#x27;/api/data&#x27;);\n    if (!res.ok) throw new Error(&#x60;HTTP ${res.status}&#x60;);\n    return res.json();\n  },\n  { error: &#x27;FETCH_FAILED&#x27; as const }\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>The error type is added to the workflow’s error union.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"stepfromresult---preserve-error-details\">step.fromResult - preserve error details\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#stepfromresult---preserve-error-details\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “step.fromResult - preserve error details”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>When your operation returns a Result with rich error objects:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> ApiError\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">code\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> number\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">; \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">message\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> callApi\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> ()\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">Data\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">ApiError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Returns err({ code: 429, message: 'Rate limited' })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> data\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> step.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fromResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> callApi\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    onError\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">apiError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> ({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      type\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'API_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F47067\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> const\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">      ...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">apiError,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"type ApiError = { code: number; message: string };\n\nconst callApi = async (): AsyncResult\u003CData, ApiError> => {\n  // Returns err({ code: 429, message: &#x27;Rate limited&#x27; })\n};\n\nconst data = await step.fromResult(\n  () => callApi(),\n  {\n    onError: (apiError) => ({\n      type: &#x27;API_ERROR&#x27; as const,\n      ...apiError,\n    }),\n  }\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"stepretry---retry-with-backoff\">step.retry - retry with backoff\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#stepretry---retry-with-backoff\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “step.retry - retry with backoff”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> step.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">retry\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    attempts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    backoff\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'exponential'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// 'fixed' | 'linear' | 'exponential'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    delayMs\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 100\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,            \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Base delay\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    maxDelayMs\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 5000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,        \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Cap for exponential\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    jitter\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,            \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Add randomness\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    retryOn\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> error \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!==\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Don't retry NOT_FOUND\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const user = await step.retry(\n  () => fetchUser(&#x27;1&#x27;),\n  {\n    attempts: 3,\n    backoff: &#x27;exponential&#x27;,  // &#x27;fixed&#x27; | &#x27;linear&#x27; | &#x27;exponential&#x27;\n    delayMs: 100,            // Base delay\n    maxDelayMs: 5000,        // Cap for exponential\n    jitter: true,            // Add randomness\n    retryOn: (error) => error !== &#x27;NOT_FOUND&#x27;, // Don&#x27;t retry NOT_FOUND\n  }\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>Backoff strategies:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>fixed\u003C/strong>: Same delay every time\u003C/li>\n\u003Cli>\u003Cstrong>linear\u003C/strong>: delay, delay\u003Cem>2, delay\u003C/em>3, …\u003C/li>\n\u003Cli>\u003Cstrong>exponential\u003C/strong>: delay, delay\u003Cem>2, delay\u003C/em>4, delay*8, …\u003C/li>\n\u003C/ul>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"stepwithtimeout---add-timeout\">step.withTimeout - add timeout\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#stepwithtimeout---add-timeout\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “step.withTimeout - add timeout”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> data\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> step.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">withTimeout\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> slowOperation\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    ms\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 5000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Slow operation'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// For error messages\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const data = await step.withTimeout(\n  () => slowOperation(),\n  {\n    ms: 5000,\n    name: &#x27;Slow operation&#x27;, // For error messages\n  }\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>If the timeout is reached, the workflow gets a \u003Ccode dir=\"auto\">StepTimeoutError\u003C/code>.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"combining-retry-and-timeout\">Combining retry and timeout\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#combining-retry-and-timeout\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Combining retry and timeout”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> data\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> step.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">retry\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> step.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">withTimeout\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchData\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ms\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 2000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">attempts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">backoff\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'exponential'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const data = await step.retry(\n  () => step.withTimeout(() => fetchData(), { ms: 2000 }),\n  { attempts: 3, backoff: &#x27;exponential&#x27; }\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>Each attempt has a 2-second timeout. The whole operation retries up to 3 times.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"parallel-steps\">Parallel steps\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#parallel-steps\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Parallel steps”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Run multiple steps concurrently:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">allAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> [\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">user\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">posts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">comments\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">] \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">=\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    allAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      fetchComments\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    ])\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { user, posts, comments };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { allAsync } from &#x27;@jagreehal/workflow&#x27;;\n\nconst result = await workflow(async (step) => {\n  const [user, posts, comments] = await step(() =>\n    allAsync([\n      fetchUser(&#x27;1&#x27;),\n      fetchPosts(&#x27;1&#x27;),\n      fetchComments(&#x27;1&#x27;),\n    ])\n  );\n  return { user, posts, comments };\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"named-steps-for-visualization\">Named steps for visualization\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#named-steps-for-visualization\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Named steps for visualization”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Give steps names to see them in workflow diagrams:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Fetch user'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> posts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Fetch posts'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const user = await step(() => fetchUser(&#x27;1&#x27;), { name: &#x27;Fetch user&#x27; });\nconst posts = await step(() => fetchPosts(user.id), { name: &#x27;Fetch posts&#x27; });\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>See \u003Ca href=\"/workflow/guides/visualization/\">Visualization\u003C/a> for details.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/workflow/concepts/workflows/\">Learn about Workflows →\u003C/a>\u003C/p>",{"headings":354,"localImagePaths":386,"remoteImagePaths":387,"frontmatter":388,"imagePaths":389},[355,356,359,362,365,368,371,374,377,380,383],{"depth":57,"slug":58,"text":59},{"depth":57,"slug":357,"text":358},"using-thunks-for-caching","Using thunks for caching",{"depth":57,"slug":360,"text":361},"step-options","Step options",{"depth":57,"slug":363,"text":364},"steptry---wrap-throwing-code","step.try - wrap throwing code",{"depth":57,"slug":366,"text":367},"stepfromresult---preserve-error-details","step.fromResult - preserve error details",{"depth":57,"slug":369,"text":370},"stepretry---retry-with-backoff","step.retry - retry with backoff",{"depth":57,"slug":372,"text":373},"stepwithtimeout---add-timeout","step.withTimeout - add timeout",{"depth":57,"slug":375,"text":376},"combining-retry-and-timeout","Combining retry and timeout",{"depth":57,"slug":378,"text":379},"parallel-steps","Parallel steps",{"depth":57,"slug":381,"text":382},"named-steps-for-visualization","Named steps for visualization",{"depth":57,"slug":384,"text":385},"next","Next",[],[],{"title":343,"description":344},[],"concepts/results",{"id":390,"data":392,"body":398,"filePath":399,"digest":400,"rendered":401},{"title":393,"description":394,"editUrl":16,"head":395,"template":46,"sidebar":396,"pagefind":16,"draft":35},"Results","The Result type and how to work with it",[],{"hidden":35,"attrs":397},{},"A `Result\u003CT, E>` represents either success (`ok`) or failure (`err`). It replaces try/catch with explicit typing.\n\n## Creating Results\n\n```typescript\nimport { ok, err, type AsyncResult } from '@jagreehal/workflow';\n\n// Synchronous\nconst divide = (a: number, b: number): Result\u003Cnumber, 'DIVIDE_BY_ZERO'> =>\n  b === 0 ? err('DIVIDE_BY_ZERO') : ok(a / b);\n\n// Asynchronous\nconst fetchUser = async (id: string): AsyncResult\u003CUser, 'NOT_FOUND'> => {\n  const user = await db.users.find(id);\n  return user ? ok(user) : err('NOT_FOUND');\n};\n```\n\n## Checking Results\n\n```typescript\nconst result = divide(10, 2);\n\nif (result.ok) {\n  console.log(result.value); // 5 - TypeScript knows it's a number\n} else {\n  console.log(result.error); // TypeScript knows it's 'DIVIDE_BY_ZERO'\n}\n```\n\n## Type guards\n\n```typescript\nimport { isOk, isErr } from '@jagreehal/workflow';\n\nif (isOk(result)) {\n  // result.value is accessible\n}\n\nif (isErr(result)) {\n  // result.error is accessible\n}\n```\n\n## Transforming Results\n\n### map - transform the value\n\n```typescript\nimport { map } from '@jagreehal/workflow';\n\nconst result = ok(5);\nconst doubled = map(result, (n) => n * 2);\n// ok(10)\n```\n\n### mapError - transform the error\n\n```typescript\nimport { mapError } from '@jagreehal/workflow';\n\nconst result = err('NOT_FOUND');\nconst mapped = mapError(result, (e) => ({ type: e, status: 404 }));\n// err({ type: 'NOT_FOUND', status: 404 })\n```\n\n### andThen - chain operations\n\n```typescript\nimport { andThen } from '@jagreehal/workflow';\n\nconst result = ok(10);\nconst chained = andThen(result, (n) =>\n  n > 0 ? ok(n * 2) : err('NEGATIVE')\n);\n// ok(20)\n```\n\n### match - pattern match\n\n```typescript\nimport { match } from '@jagreehal/workflow';\n\nconst message = match(\n  result,\n  (value) => `Success: ${value}`,\n  (error) => `Error: ${error}`\n);\n```\n\n## Unwrapping\n\n### unwrap - get value or throw\n\n```typescript\nimport { unwrap } from '@jagreehal/workflow';\n\nconst value = unwrap(result); // Throws if err\n```\n\n### unwrapOr - get value or default\n\n```typescript\nimport { unwrapOr } from '@jagreehal/workflow';\n\nconst value = unwrapOr(result, 0); // Returns 0 if err\n```\n\n### unwrapOrElse - get value or compute default\n\n```typescript\nimport { unwrapOrElse } from '@jagreehal/workflow';\n\nconst value = unwrapOrElse(result, (error) => {\n  console.log('Failed with:', error);\n  return 0;\n});\n```\n\n## Wrapping throwing code\n\n### from - wrap sync function\n\n```typescript\nimport { from } from '@jagreehal/workflow';\n\nconst result = from(() => JSON.parse(jsonString));\n// ok(parsed) or err(Error)\n```\n\n### fromPromise - wrap async function\n\n```typescript\nimport { fromPromise } from '@jagreehal/workflow';\n\nconst result = await fromPromise(fetch('/api/data'));\n// ok(Response) or err(Error)\n```\n\n### tryAsync - wrap with custom error\n\n```typescript\nimport { tryAsync } from '@jagreehal/workflow';\n\nconst result = await tryAsync(\n  () => fetch('/api/data').then(r => r.json()),\n  (thrown) => ({ type: 'FETCH_FAILED' as const, cause: thrown })\n);\n```\n\n## Batch operations\n\n### all - fail fast\n\n```typescript\nimport { all } from '@jagreehal/workflow';\n\nconst results = [ok(1), ok(2), ok(3)];\nconst combined = all(results);\n// ok([1, 2, 3])\n\nconst withError = [ok(1), err('FAILED'), ok(3)];\nconst failed = all(withError);\n// err('FAILED')\n```\n\n### allSettled - collect all\n\n```typescript\nimport { allSettled } from '@jagreehal/workflow';\n\nconst results = [ok(1), err('A'), ok(3), err('B')];\nconst settled = allSettled(results);\n// ok([\n//   { status: 'ok', value: 1 },\n//   { status: 'err', error: 'A' },\n//   { status: 'ok', value: 3 },\n//   { status: 'err', error: 'B' },\n// ])\n```\n\n### partition - separate successes and failures\n\n```typescript\nimport { partition } from '@jagreehal/workflow';\n\nconst results = [ok(1), err('A'), ok(3)];\nconst [successes, failures] = partition(results);\n// successes: [1, 3]\n// failures: ['A']\n```\n\n## Async versions\n\nMost operations have async variants for working with promises:\n\n```typescript\nimport { allAsync, anyAsync } from '@jagreehal/workflow';\n\nconst results = await allAsync([\n  fetchUser('1'),\n  fetchPosts('1'),\n  fetchComments('1'),\n]);\n```\n\n## Next\n\n[Learn about Steps →](/workflow/concepts/step/)","src/content/docs/concepts/results.md","9caa224e36c8a9d8",{"html":402,"metadata":403},"\u003Cp>A \u003Ccode dir=\"auto\">Result&#x3C;T, E>\u003C/code> represents either success (\u003Ccode dir=\"auto\">ok\u003C/code>) or failure (\u003Ccode dir=\"auto\">err\u003C/code>). It replaces try/catch with explicit typing.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"creating-results\">Creating Results\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#creating-results\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Creating Results”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Synchronous\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> divide\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">a\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> number\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">b\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> number\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> Result\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\">number\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'DIVIDE_BY_ZERO'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  b \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">===\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 0\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> ?\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'DIVIDE_BY_ZERO'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(a \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">/\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> b);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Asynchronous\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">User\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">users\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">find\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(id);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> user \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user) \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { ok, err, type AsyncResult } from &#x27;@jagreehal/workflow&#x27;;\n\n// Synchronous\nconst divide = (a: number, b: number): Result\u003Cnumber, &#x27;DIVIDE_BY_ZERO&#x27;> =>\n  b === 0 ? err(&#x27;DIVIDE_BY_ZERO&#x27;) : ok(a / b);\n\n// Asynchronous\nconst fetchUser = async (id: string): AsyncResult\u003CUser, &#x27;NOT_FOUND&#x27;> => {\n  const user = await db.users.find(id);\n  return user ? ok(user) : err(&#x27;NOT_FOUND&#x27;);\n};\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"checking-results\">Checking Results\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#checking-results\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Checking Results”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> divide\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">10\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">2\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">); \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// 5 - TypeScript knows it's a number\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">} \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">else\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">); \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// TypeScript knows it's 'DIVIDE_BY_ZERO'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = divide(10, 2);\n\nif (result.ok) {\n  console.log(result.value); // 5 - TypeScript knows it&#x27;s a number\n} else {\n  console.log(result.error); // TypeScript knows it&#x27;s &#x27;DIVIDE_BY_ZERO&#x27;\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"type-guards\">Type guards\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#type-guards\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Type guards”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">isOk\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">isErr\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">isOk\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result)) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // result.value is accessible\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">isErr\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result)) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // result.error is accessible\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { isOk, isErr } from &#x27;@jagreehal/workflow&#x27;;\n\nif (isOk(result)) {\n  // result.value is accessible\n}\n\nif (isErr(result)) {\n  // result.error is accessible\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"transforming-results\">Transforming Results\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#transforming-results\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Transforming Results”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"map---transform-the-value\">map - transform the value\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#map---transform-the-value\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “map - transform the value”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">map\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">5\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> doubled\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> map\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result, (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">n\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> n \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">*\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 2\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// ok(10)\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { map } from &#x27;@jagreehal/workflow&#x27;;\n\nconst result = ok(5);\nconst doubled = map(result, (n) => n * 2);\n// ok(10)\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"maperror---transform-the-error\">mapError - transform the error\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#maperror---transform-the-error\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “mapError - transform the error”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">mapError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> mapped\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> mapError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result, (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">e\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> ({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">type\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> e, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 404\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// err({ type: 'NOT_FOUND', status: 404 })\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { mapError } from &#x27;@jagreehal/workflow&#x27;;\n\nconst result = err(&#x27;NOT_FOUND&#x27;);\nconst mapped = mapError(result, (e) => ({ type: e, status: 404 }));\n// err({ type: &#x27;NOT_FOUND&#x27;, status: 404 })\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"andthen---chain-operations\">andThen - chain operations\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#andthen---chain-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “andThen - chain operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">andThen\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">10\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> chained\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> andThen\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result, (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">n\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  n \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 0\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> ?\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(n \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">*\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 2\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'NEGATIVE'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// ok(20)\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { andThen } from &#x27;@jagreehal/workflow&#x27;;\n\nconst result = ok(10);\nconst chained = andThen(result, (n) =>\n  n > 0 ? ok(n * 2) : err(&#x27;NEGATIVE&#x27;)\n);\n// ok(20)\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"match---pattern-match\">match - pattern match\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#match---pattern-match\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “match - pattern match”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">match\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> message\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> match\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  result,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">value\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `Success: \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `Error: \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { match } from &#x27;@jagreehal/workflow&#x27;;\n\nconst message = match(\n  result,\n  (value) => &#x60;Success: ${value}&#x60;,\n  (error) => &#x60;Error: ${error}&#x60;\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"unwrapping\">Unwrapping\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#unwrapping\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Unwrapping”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"unwrap---get-value-or-throw\">unwrap - get value or throw\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#unwrap---get-value-or-throw\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “unwrap - get value or throw”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">unwrap\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> value\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> unwrap\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result); \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Throws if err\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { unwrap } from &#x27;@jagreehal/workflow&#x27;;\n\nconst value = unwrap(result); // Throws if err\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"unwrapor---get-value-or-default\">unwrapOr - get value or default\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#unwrapor---get-value-or-default\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “unwrapOr - get value or default”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">unwrapOr\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> value\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> unwrapOr\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">0\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">); \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Returns 0 if err\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { unwrapOr } from &#x27;@jagreehal/workflow&#x27;;\n\nconst value = unwrapOr(result, 0); // Returns 0 if err\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"unwraporelse---get-value-or-compute-default\">unwrapOrElse - get value or compute default\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#unwraporelse---get-value-or-compute-default\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “unwrapOrElse - get value or compute default”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">unwrapOrElse\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> value\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> unwrapOrElse\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result, (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Failed with:'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, error);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 0\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { unwrapOrElse } from &#x27;@jagreehal/workflow&#x27;;\n\nconst value = unwrapOrElse(result, (error) => {\n  console.log(&#x27;Failed with:&#x27;, error);\n  return 0;\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"wrapping-throwing-code\">Wrapping throwing code\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#wrapping-throwing-code\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Wrapping throwing code”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"from---wrap-sync-function\">from - wrap sync function\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#from---wrap-sync-function\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “from - wrap sync function”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">from\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> from\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> JSON\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">parse\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(jsonString));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// ok(parsed) or err(Error)\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { from } from &#x27;@jagreehal/workflow&#x27;;\n\nconst result = from(() => JSON.parse(jsonString));\n// ok(parsed) or err(Error)\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"frompromise---wrap-async-function\">fromPromise - wrap async function\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#frompromise---wrap-async-function\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “fromPromise - wrap async function”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">fromPromise\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fromPromise\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'/api/data'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// ok(Response) or err(Error)\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { fromPromise } from &#x27;@jagreehal/workflow&#x27;;\n\nconst result = await fromPromise(fetch(&#x27;/api/data&#x27;));\n// ok(Response) or err(Error)\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"tryasync---wrap-with-custom-error\">tryAsync - wrap with custom error\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#tryasync---wrap-with-custom-error\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “tryAsync - wrap with custom error”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">tryAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> tryAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'/api/data'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">then\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">r\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> =>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> r.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">json\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">()),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">thrown\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> ({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">type\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'FETCH_FAILED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F47067\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> const\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">cause\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> thrown })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { tryAsync } from &#x27;@jagreehal/workflow&#x27;;\n\nconst result = await tryAsync(\n  () => fetch(&#x27;/api/data&#x27;).then(r => r.json()),\n  (thrown) => ({ type: &#x27;FETCH_FAILED&#x27; as const, cause: thrown })\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"batch-operations\">Batch operations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#batch-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Batch operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"all---fail-fast\">all - fail fast\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#all---fail-fast\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “all - fail fast”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">all\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> results\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> [\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">1\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), \u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">2\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), \u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)];\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> combined\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> all\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(results);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// ok([1, 2, 3])\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> withError\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> [\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">1\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), \u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'FAILED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), \u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)];\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> failed\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> all\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(withError);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// err('FAILED')\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { all } from &#x27;@jagreehal/workflow&#x27;;\n\nconst results = [ok(1), ok(2), ok(3)];\nconst combined = all(results);\n// ok([1, 2, 3])\n\nconst withError = [ok(1), err(&#x27;FAILED&#x27;), ok(3)];\nconst failed = all(withError);\n// err(&#x27;FAILED&#x27;)\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"allsettled---collect-all\">allSettled - collect all\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#allsettled---collect-all\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “allSettled - collect all”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">allSettled\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> results\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> [\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">1\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), \u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'A'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), \u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), \u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'B'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)];\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> settled\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> allSettled\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(results);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// ok([\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">//   { status: 'ok', value: 1 },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">//   { status: 'err', error: 'A' },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">//   { status: 'ok', value: 3 },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">//   { status: 'err', error: 'B' },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// ])\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { allSettled } from &#x27;@jagreehal/workflow&#x27;;\n\nconst results = [ok(1), err(&#x27;A&#x27;), ok(3), err(&#x27;B&#x27;)];\nconst settled = allSettled(results);\n// ok([\n//   { status: &#x27;ok&#x27;, value: 1 },\n//   { status: &#x27;err&#x27;, error: &#x27;A&#x27; },\n//   { status: &#x27;ok&#x27;, value: 3 },\n//   { status: &#x27;err&#x27;, error: &#x27;B&#x27; },\n// ])\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"partition---separate-successes-and-failures\">partition - separate successes and failures\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#partition---separate-successes-and-failures\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “partition - separate successes and failures”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">partition\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> results\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> [\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">1\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), \u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'A'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), \u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)];\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> [\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">successes\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">failures\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">] \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">=\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> partition\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(results);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// successes: [1, 3]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// failures: ['A']\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { partition } from &#x27;@jagreehal/workflow&#x27;;\n\nconst results = [ok(1), err(&#x27;A&#x27;), ok(3)];\nconst [successes, failures] = partition(results);\n// successes: [1, 3]\n// failures: [&#x27;A&#x27;]\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"async-versions\">Async versions\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#async-versions\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Async versions”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Most operations have async variants for working with promises:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">allAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">anyAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> results\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> allAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  fetchComments\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">]);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { allAsync, anyAsync } from &#x27;@jagreehal/workflow&#x27;;\n\nconst results = await allAsync([\n  fetchUser(&#x27;1&#x27;),\n  fetchPosts(&#x27;1&#x27;),\n  fetchComments(&#x27;1&#x27;),\n]);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/workflow/concepts/step/\">Learn about Steps →\u003C/a>\u003C/p>",{"headings":404,"localImagePaths":467,"remoteImagePaths":468,"frontmatter":469,"imagePaths":470},[405,408,411,414,417,420,423,426,429,432,435,438,441,444,447,450,453,454,457,460,463,466],{"depth":57,"slug":406,"text":407},"creating-results","Creating Results",{"depth":57,"slug":409,"text":410},"checking-results","Checking Results",{"depth":57,"slug":412,"text":413},"type-guards","Type guards",{"depth":57,"slug":415,"text":416},"transforming-results","Transforming Results",{"depth":160,"slug":418,"text":419},"map---transform-the-value","map - transform the value",{"depth":160,"slug":421,"text":422},"maperror---transform-the-error","mapError - transform the error",{"depth":160,"slug":424,"text":425},"andthen---chain-operations","andThen - chain operations",{"depth":160,"slug":427,"text":428},"match---pattern-match","match - pattern match",{"depth":57,"slug":430,"text":431},"unwrapping","Unwrapping",{"depth":160,"slug":433,"text":434},"unwrap---get-value-or-throw","unwrap - get value or throw",{"depth":160,"slug":436,"text":437},"unwrapor---get-value-or-default","unwrapOr - get value or default",{"depth":160,"slug":439,"text":440},"unwraporelse---get-value-or-compute-default","unwrapOrElse - get value or compute default",{"depth":57,"slug":442,"text":443},"wrapping-throwing-code","Wrapping throwing code",{"depth":160,"slug":445,"text":446},"from---wrap-sync-function","from - wrap sync function",{"depth":160,"slug":448,"text":449},"frompromise---wrap-async-function","fromPromise - wrap async function",{"depth":160,"slug":451,"text":452},"tryasync---wrap-with-custom-error","tryAsync - wrap with custom error",{"depth":57,"slug":258,"text":259},{"depth":160,"slug":455,"text":456},"all---fail-fast","all - fail fast",{"depth":160,"slug":458,"text":459},"allsettled---collect-all","allSettled - collect all",{"depth":160,"slug":461,"text":462},"partition---separate-successes-and-failures","partition - separate successes and failures",{"depth":57,"slug":464,"text":465},"async-versions","Async versions",{"depth":57,"slug":384,"text":385},[],[],{"title":393,"description":394},[],"concepts/tagged-errors",{"id":471,"data":473,"body":479,"filePath":480,"digest":481,"rendered":482},{"title":474,"description":475,"editUrl":16,"head":476,"template":46,"sidebar":477,"pagefind":16,"draft":35},"Tagged Errors","Rich error types with exhaustive pattern matching",[],{"hidden":35,"attrs":478},{},"String literal errors like `'NOT_FOUND'` work for simple cases. When you need errors with contextual data, use `TaggedError`.\n\n## When to use what\n\n| Use case | Recommendation |\n|----------|---------------|\n| Simple distinct states | String literals: `'NOT_FOUND' \\| 'UNAUTHORIZED'` |\n| Errors with context | TaggedError: `NotFoundError { id, resource }` |\n| Multiple variants to handle | TaggedError with `match()` |\n| API responses | TaggedError for structured data |\n\n## Creating tagged errors\n\n```typescript\nimport { TaggedError } from '@jagreehal/workflow';\n\n// Pattern 1: Props via generic\nclass NotFoundError extends TaggedError('NotFoundError')\u003C{\n  resource: string;\n  id: string;\n}> {}\n\n// Pattern 2: Custom message\nclass ValidationError extends TaggedError('ValidationError', {\n  message: (p: { field: string; reason: string }) =>\n    `Validation failed for ${p.field}: ${p.reason}`,\n}) {}\n\n// Pattern 3: No props\nclass UnauthorizedError extends TaggedError('UnauthorizedError') {}\n```\n\n## Using tagged errors\n\n```typescript\nconst fetchUser = async (id: string): AsyncResult\u003CUser, NotFoundError | UnauthorizedError> => {\n  if (!session.isValid) {\n    return err(new UnauthorizedError());\n  }\n  const user = await db.users.find(id);\n  if (!user) {\n    return err(new NotFoundError({ resource: 'User', id }));\n  }\n  return ok(user);\n};\n```\n\n## Pattern matching with match()\n\n`TaggedError.match` forces exhaustive handling:\n\n```typescript\nconst workflow = createWorkflow({ fetchUser, updateProfile });\n\nconst result = await workflow(async (step) => {\n  const user = await step(fetchUser('123'));\n  return await step(updateProfile(user.id, data));\n});\n\nif (!result.ok) {\n  const response = TaggedError.match(result.error, {\n    NotFoundError: (e) => ({\n      status: 404,\n      body: { error: 'not_found', resource: e.resource, id: e.id },\n    }),\n    UnauthorizedError: () => ({\n      status: 401,\n      body: { error: 'unauthorized' },\n    }),\n    ValidationError: (e) => ({\n      status: 400,\n      body: { error: 'validation', field: e.field, reason: e.reason },\n    }),\n  });\n\n  return res.status(response.status).json(response.body);\n}\n```\n\nAdd a new error type? TypeScript errors until you handle it.\n\n## Partial matching\n\nHandle specific errors with a fallback:\n\n```typescript\nconst message = TaggedError.matchPartial(\n  result.error,\n  {\n    RateLimitError: (e) => `Please wait ${e.retryAfter} seconds`,\n  },\n  (e) => `Something went wrong: ${e.message}` // Fallback\n);\n```\n\n## Type helpers\n\n```typescript\nimport { type TagOf, type ErrorByTag } from '@jagreehal/workflow';\n\ntype AllErrors = NotFoundError | ValidationError | RateLimitError;\n\n// Extract tag literals\ntype Tags = TagOf\u003CAllErrors>;\n// 'NotFoundError' | 'ValidationError' | 'RateLimitError'\n\n// Extract specific variant\ntype NotFound = ErrorByTag\u003CAllErrors, 'NotFoundError'>;\n// NotFoundError\n```\n\n## Runtime checks\n\nTagged errors support `instanceof`:\n\n```typescript\nconst error = new NotFoundError({ resource: 'User', id: '123' });\n\nconsole.log(error instanceof TaggedError);  // true\nconsole.log(error instanceof NotFoundError); // true\nconsole.log(error._tag);                     // 'NotFoundError'\nconsole.log(error.resource);                 // 'User'\nconsole.log(error.message);                  // 'NotFoundError'\n```\n\n## Error chaining\n\nLink to the original error via `ErrorOptions.cause`:\n\n```typescript\ntry {\n  await fetch('/api');\n} catch (original) {\n  throw new NetworkError(\n    { url: '/api', statusCode: 500 },\n    { cause: original } // Chain to original error\n  );\n}\n```\n\n## Real-world example\n\n```typescript\n// Define error types\nclass PaymentDeclinedError extends TaggedError('PaymentDeclinedError', {\n  message: (p: { reason: 'insufficient_funds' | 'card_expired' | 'fraud' }) =>\n    `Payment declined: ${p.reason}`,\n}) {}\n\nclass PaymentProviderError extends TaggedError('PaymentProviderError', {\n  message: (p: { provider: string; statusCode: number }) =>\n    `${p.provider} returned ${p.statusCode}`,\n}) {}\n\n// Use in workflow\nconst processPayment = async (\n  amount: number\n): AsyncResult\u003CReceipt, PaymentDeclinedError | PaymentProviderError> => {\n  const response = await paymentProvider.charge(amount);\n\n  if (response.declined) {\n    return err(new PaymentDeclinedError({ reason: response.declineReason }));\n  }\n  if (!response.ok) {\n    return err(new PaymentProviderError({\n      provider: 'Stripe',\n      statusCode: response.status,\n    }));\n  }\n  return ok(response.receipt);\n};\n\n// Handle errors\nif (!result.ok) {\n  TaggedError.match(result.error, {\n    PaymentDeclinedError: (e) => {\n      switch (e.reason) {\n        case 'insufficient_funds':\n          notifyUser('Please use a different card');\n          break;\n        case 'card_expired':\n          notifyUser('Your card has expired');\n          break;\n        case 'fraud':\n          alertFraudTeam(e);\n          break;\n      }\n    },\n    PaymentProviderError: (e) => {\n      logToDatadog({ provider: e.provider, status: e.statusCode });\n      retryWithBackup(e.provider);\n    },\n  });\n}\n```\n\n## Reserved keys\n\nThese property names are reserved and cannot be used in props:\n\n| Key | Reason |\n|-----|--------|\n| `_tag` | Discriminant for pattern matching |\n| `name` | Error.name (stack traces) |\n| `message` | Error.message (logs) |\n| `stack` | Error.stack (stack trace) |\n\n```typescript\n// Don't do this\nclass BadExample extends TaggedError('BadExample')\u003C{\n  message: string; // Won't work - use 'details' instead\n}> {}\n\n// Do this\nclass GoodExample extends TaggedError('GoodExample')\u003C{\n  details: string;\n}> {}\n```\n\n## Next\n\n[Learn about Retries & Timeouts →](/workflow/guides/retries-timeouts/)","src/content/docs/concepts/tagged-errors.md","13dddd7a8fb464f1",{"html":483,"metadata":484},"\u003Cp>String literal errors like \u003Ccode dir=\"auto\">'NOT_FOUND'\u003C/code> work for simple cases. When you need errors with contextual data, use \u003Ccode dir=\"auto\">TaggedError\u003C/code>.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"when-to-use-what\">When to use what\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#when-to-use-what\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “When to use what”\u003C/span>\u003C/a>\u003C/div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Use case\u003C/th>\u003Cth>Recommendation\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Simple distinct states\u003C/td>\u003Ctd>String literals: \u003Ccode dir=\"auto\">'NOT_FOUND' | 'UNAUTHORIZED'\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Errors with context\u003C/td>\u003Ctd>TaggedError: \u003Ccode dir=\"auto\">NotFoundError { id, resource }\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Multiple variants to handle\u003C/td>\u003Ctd>TaggedError with \u003Ccode dir=\"auto\">match()\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>API responses\u003C/td>\u003Ctd>TaggedError for structured data\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"creating-tagged-errors\">Creating tagged errors\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#creating-tagged-errors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Creating tagged errors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">TaggedError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Pattern 1: Props via generic\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">class\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> NotFoundError\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> extends\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> TaggedError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'NotFoundError'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)&#x3C;{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  resource\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}> {}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Pattern 2: Custom message\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">class\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> ValidationError\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> extends\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> TaggedError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'ValidationError'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  message\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">p\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">field\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">; \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">    `Validation failed for \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">p\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">field\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">: \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">p\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}) {}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Pattern 3: No props\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">class\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> UnauthorizedError\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> extends\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> TaggedError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'UnauthorizedError'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { TaggedError } from &#x27;@jagreehal/workflow&#x27;;\n\n// Pattern 1: Props via generic\nclass NotFoundError extends TaggedError(&#x27;NotFoundError&#x27;)\u003C{\n  resource: string;\n  id: string;\n}> {}\n\n// Pattern 2: Custom message\nclass ValidationError extends TaggedError(&#x27;ValidationError&#x27;, {\n  message: (p: { field: string; reason: string }) =>\n    &#x60;Validation failed for ${p.field}: ${p.reason}&#x60;,\n}) {}\n\n// Pattern 3: No props\nclass UnauthorizedError extends TaggedError(&#x27;UnauthorizedError&#x27;) {}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"using-tagged-errors\">Using tagged errors\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#using-tagged-errors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Using tagged errors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">User\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">NotFoundError\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> UnauthorizedError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">session.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">isValid\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">new\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> UnauthorizedError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">users\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">find\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(id);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">user) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">new\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> NotFoundError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">resource\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'User'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, id }));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const fetchUser = async (id: string): AsyncResult\u003CUser, NotFoundError | UnauthorizedError> => {\n  if (!session.isValid) {\n    return err(new UnauthorizedError());\n  }\n  const user = await db.users.find(id);\n  if (!user) {\n    return err(new NotFoundError({ resource: &#x27;User&#x27;, id }));\n  }\n  return ok(user);\n};\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"pattern-matching-with-match\">Pattern matching with match()\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#pattern-matching-with-match\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Pattern matching with match()”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ccode dir=\"auto\">TaggedError.match\u003C/code> forces exhaustive handling:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ fetchUser, updateProfile });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">updateProfile\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, data));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> response\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> TaggedError.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">match\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    NotFoundError\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">e\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> ({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 404\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      body\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'not_found'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">resource\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> e.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">resource\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> e.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    UnauthorizedError\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> ({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 401\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      body\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'unauthorized'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    ValidationError\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">e\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> ({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 400\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      body\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'validation'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">field\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> e.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">field\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> e.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> res.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">status\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(response.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">json\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(response.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">body\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const workflow = createWorkflow({ fetchUser, updateProfile });\n\nconst result = await workflow(async (step) => {\n  const user = await step(fetchUser(&#x27;123&#x27;));\n  return await step(updateProfile(user.id, data));\n});\n\nif (!result.ok) {\n  const response = TaggedError.match(result.error, {\n    NotFoundError: (e) => ({\n      status: 404,\n      body: { error: &#x27;not_found&#x27;, resource: e.resource, id: e.id },\n    }),\n    UnauthorizedError: () => ({\n      status: 401,\n      body: { error: &#x27;unauthorized&#x27; },\n    }),\n    ValidationError: (e) => ({\n      status: 400,\n      body: { error: &#x27;validation&#x27;, field: e.field, reason: e.reason },\n    }),\n  });\n\n  return res.status(response.status).json(response.body);\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>Add a new error type? TypeScript errors until you handle it.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"partial-matching\">Partial matching\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#partial-matching\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Partial matching”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Handle specific errors with a fallback:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> message\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> TaggedError.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">matchPartial\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    RateLimitError\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">e\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `Please wait \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">e\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">retryAfter\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> seconds`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">e\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `Something went wrong: \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">e\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">message\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\"> // Fallback\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const message = TaggedError.matchPartial(\n  result.error,\n  {\n    RateLimitError: (e) => &#x60;Please wait ${e.retryAfter} seconds&#x60;,\n  },\n  (e) => &#x60;Something went wrong: ${e.message}&#x60; // Fallback\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"type-helpers\">Type helpers\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#type-helpers\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Type helpers”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\"> TagOf\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\"> ErrorByTag\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AllErrors\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> NotFoundError\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> ValidationError\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> RateLimitError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Extract tag literals\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> Tags\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> TagOf\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">AllErrors\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">>;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// 'NotFoundError' | 'ValidationError' | 'RateLimitError'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Extract specific variant\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> NotFound\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> ErrorByTag\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">AllErrors\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'NotFoundError'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">>;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// NotFoundError\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { type TagOf, type ErrorByTag } from &#x27;@jagreehal/workflow&#x27;;\n\ntype AllErrors = NotFoundError | ValidationError | RateLimitError;\n\n// Extract tag literals\ntype Tags = TagOf\u003CAllErrors>;\n// &#x27;NotFoundError&#x27; | &#x27;ValidationError&#x27; | &#x27;RateLimitError&#x27;\n\n// Extract specific variant\ntype NotFound = ErrorByTag\u003CAllErrors, &#x27;NotFoundError&#x27;>;\n// NotFoundError\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"runtime-checks\">Runtime checks\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#runtime-checks\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Runtime checks”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Tagged errors support \u003Ccode dir=\"auto\">instanceof\u003C/code>:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> new\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> NotFoundError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">resource\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'User'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(error \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">instanceof\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> TaggedError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// true\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(error \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">instanceof\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> NotFoundError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">); \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// true\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(error.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">_tag\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);                     \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// 'NotFoundError'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(error.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">resource\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);                 \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// 'User'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(error.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">message\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);                  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// 'NotFoundError'\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const error = new NotFoundError({ resource: &#x27;User&#x27;, id: &#x27;123&#x27; });\n\nconsole.log(error instanceof TaggedError);  // true\nconsole.log(error instanceof NotFoundError); // true\nconsole.log(error._tag);                     // &#x27;NotFoundError&#x27;\nconsole.log(error.resource);                 // &#x27;User&#x27;\nconsole.log(error.message);                  // &#x27;NotFoundError&#x27;\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"error-chaining\">Error chaining\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#error-chaining\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Error chaining”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Link to the original error via \u003Ccode dir=\"auto\">ErrorOptions.cause\u003C/code>:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">try\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'/api'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">} \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">catch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (original) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  throw\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> new\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> NetworkError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">url\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '/api'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">statusCode\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 500\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">cause\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> original } \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Chain to original error\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"try {\n  await fetch(&#x27;/api&#x27;);\n} catch (original) {\n  throw new NetworkError(\n    { url: &#x27;/api&#x27;, statusCode: 500 },\n    { cause: original } // Chain to original error\n  );\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"real-world-example\">Real-world example\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#real-world-example\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Real-world example”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Define error types\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">class\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> PaymentDeclinedError\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> extends\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> TaggedError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'PaymentDeclinedError'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  message\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">p\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'insufficient_funds'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'card_expired'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'fraud'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">    `Payment declined: \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">p\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}) {}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">class\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> PaymentProviderError\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> extends\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> TaggedError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'PaymentProviderError'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  message\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">p\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">provider\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">; \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">statusCode\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> number\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">    `\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">p\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">provider\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> returned \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">p\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">statusCode\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}) {}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Use in workflow\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> processPayment\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  amount\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> number\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">Receipt\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">PaymentDeclinedError\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> PaymentProviderError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> response\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> paymentProvider.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">charge\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(amount);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (response.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">declined\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">new\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> PaymentDeclinedError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> response.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">declineReason\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">response.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">new\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> PaymentProviderError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      provider\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Stripe'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      statusCode\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> response.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(response.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">receipt\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Handle errors\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  TaggedError.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">match\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    PaymentDeclinedError\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">e\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      switch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (e.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">        case\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'insufficient_funds'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">          notifyUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Please use a different card'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">          break\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">        case\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'card_expired'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">          notifyUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Your card has expired'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">          break\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">        case\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'fraud'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">          alertFraudTeam\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(e);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">          break\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    PaymentProviderError\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">e\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      logToDatadog\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">provider\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> e.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">provider\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> e.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">statusCode\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      retryWithBackup\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(e.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">provider\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"// Define error types\nclass PaymentDeclinedError extends TaggedError(&#x27;PaymentDeclinedError&#x27;, {\n  message: (p: { reason: &#x27;insufficient_funds&#x27; | &#x27;card_expired&#x27; | &#x27;fraud&#x27; }) =>\n    &#x60;Payment declined: ${p.reason}&#x60;,\n}) {}\n\nclass PaymentProviderError extends TaggedError(&#x27;PaymentProviderError&#x27;, {\n  message: (p: { provider: string; statusCode: number }) =>\n    &#x60;${p.provider} returned ${p.statusCode}&#x60;,\n}) {}\n\n// Use in workflow\nconst processPayment = async (\n  amount: number\n): AsyncResult\u003CReceipt, PaymentDeclinedError | PaymentProviderError> => {\n  const response = await paymentProvider.charge(amount);\n\n  if (response.declined) {\n    return err(new PaymentDeclinedError({ reason: response.declineReason }));\n  }\n  if (!response.ok) {\n    return err(new PaymentProviderError({\n      provider: &#x27;Stripe&#x27;,\n      statusCode: response.status,\n    }));\n  }\n  return ok(response.receipt);\n};\n\n// Handle errors\nif (!result.ok) {\n  TaggedError.match(result.error, {\n    PaymentDeclinedError: (e) => {\n      switch (e.reason) {\n        case &#x27;insufficient_funds&#x27;:\n          notifyUser(&#x27;Please use a different card&#x27;);\n          break;\n        case &#x27;card_expired&#x27;:\n          notifyUser(&#x27;Your card has expired&#x27;);\n          break;\n        case &#x27;fraud&#x27;:\n          alertFraudTeam(e);\n          break;\n      }\n    },\n    PaymentProviderError: (e) => {\n      logToDatadog({ provider: e.provider, status: e.statusCode });\n      retryWithBackup(e.provider);\n    },\n  });\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"reserved-keys\">Reserved keys\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#reserved-keys\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Reserved keys”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>These property names are reserved and cannot be used in props:\u003C/p>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Key\u003C/th>\u003Cth>Reason\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">_tag\u003C/code>\u003C/td>\u003Ctd>Discriminant for pattern matching\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">name\u003C/code>\u003C/td>\u003Ctd>Error.name (stack traces)\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">message\u003C/code>\u003C/td>\u003Ctd>Error.message (logs)\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>\u003Ccode dir=\"auto\">stack\u003C/code>\u003C/td>\u003Ctd>Error.stack (stack trace)\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Don't do this\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">class\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> BadExample\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> extends\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> TaggedError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'BadExample'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)&#x3C;{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  message\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">; \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Won't work - use 'details' instead\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}> {}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Do this\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">class\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> GoodExample\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> extends\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> TaggedError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'GoodExample'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)&#x3C;{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  details\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}> {}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"// Don&#x27;t do this\nclass BadExample extends TaggedError(&#x27;BadExample&#x27;)\u003C{\n  message: string; // Won&#x27;t work - use &#x27;details&#x27; instead\n}> {}\n\n// Do this\nclass GoodExample extends TaggedError(&#x27;GoodExample&#x27;)\u003C{\n  details: string;\n}> {}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/workflow/guides/retries-timeouts/\">Learn about Retries &#x26; Timeouts →\u003C/a>\u003C/p>",{"headings":485,"localImagePaths":517,"remoteImagePaths":518,"frontmatter":519,"imagePaths":520},[486,489,492,495,498,501,504,507,510,513,516],{"depth":57,"slug":487,"text":488},"when-to-use-what","When to use what",{"depth":57,"slug":490,"text":491},"creating-tagged-errors","Creating tagged errors",{"depth":57,"slug":493,"text":494},"using-tagged-errors","Using tagged errors",{"depth":57,"slug":496,"text":497},"pattern-matching-with-match","Pattern matching with match()",{"depth":57,"slug":499,"text":500},"partial-matching","Partial matching",{"depth":57,"slug":502,"text":503},"type-helpers","Type helpers",{"depth":57,"slug":505,"text":506},"runtime-checks","Runtime checks",{"depth":57,"slug":508,"text":509},"error-chaining","Error chaining",{"depth":57,"slug":511,"text":512},"real-world-example","Real-world example",{"depth":57,"slug":514,"text":515},"reserved-keys","Reserved keys",{"depth":57,"slug":384,"text":385},[],[],{"title":474,"description":475},[],"concepts/workflows",{"id":521,"data":523,"body":529,"filePath":530,"digest":531,"rendered":532},{"title":524,"description":525,"editUrl":16,"head":526,"template":46,"sidebar":527,"pagefind":16,"draft":35},"Workflows","createWorkflow vs run() and when to use each",[],{"hidden":35,"attrs":528},{},"There are two ways to run workflows: `createWorkflow` for reusable workflows with dependency inference, and `run` for one-off operations.\n\n## createWorkflow\n\nCreates a reusable workflow with automatic error type inference from dependencies:\n\n```typescript\nimport { createWorkflow, ok, err, type AsyncResult } from '@jagreehal/workflow';\n\nconst fetchUser = async (id: string): AsyncResult\u003CUser, 'NOT_FOUND'> => { ... };\nconst sendEmail = async (to: string): AsyncResult\u003Cvoid, 'EMAIL_FAILED'> => { ... };\n\n// Error types inferred from dependencies\nconst workflow = createWorkflow({ fetchUser, sendEmail });\n\nconst result = await workflow(async (step) => {\n  const user = await step(fetchUser('1'));\n  await step(sendEmail(user.email));\n  return user;\n});\n// result.error is: 'NOT_FOUND' | 'EMAIL_FAILED' | UnexpectedError\n```\n\n### With options\n\n```typescript\nconst workflow = createWorkflow(\n  { fetchUser, sendEmail },\n  {\n    cache: new Map(),                    // Enable step caching\n    onEvent: (event) => console.log(event), // Event stream\n    strict: true,                        // Force explicit error handling\n  }\n);\n```\n\n## run()\n\nFor one-off workflows where you specify error types manually:\n\n```typescript\nimport { run } from '@jagreehal/workflow';\n\nconst result = await run\u003CUser, 'NOT_FOUND' | 'EMAIL_FAILED'>(\n  async (step) => {\n    const user = await step(fetchUser('1'));\n    await step(sendEmail(user.email));\n    return user;\n  }\n);\n```\n\n## When to use each\n\n| Scenario | Use |\n|----------|-----|\n| Dependencies known at compile time | `createWorkflow` |\n| Dependencies passed as parameters | `run` |\n| Need step caching or resume | `createWorkflow` |\n| Need automatic error inference | `createWorkflow` |\n| One-off workflow | `run` |\n| Testing with mocks | `run` |\n\n## Workflow options\n\n### cache\n\nEnable step caching to avoid re-executing completed steps:\n\n```typescript\nconst workflow = createWorkflow(deps, {\n  cache: new Map(),\n});\n\nconst result = await workflow(async (step) => {\n  // This step runs once, even if workflow is called multiple times\n  const user = await step(() => fetchUser('1'), { key: 'user:1' });\n  return user;\n});\n```\n\n### resumeState\n\nResume a workflow from saved state:\n\n```typescript\nconst workflow = createWorkflow(deps, {\n  resumeState: savedState, // From a previous run\n});\n\nconst result = await workflow(async (step) => {\n  // Cached steps return their saved values\n  const user = await step(() => fetchUser('1'), { key: 'user:1' });\n  return user;\n});\n```\n\nSee [Persistence](/workflow/guides/persistence/) for details.\n\n### onEvent\n\nSubscribe to workflow events for logging, visualization, or debugging:\n\n```typescript\nconst workflow = createWorkflow(deps, {\n  onEvent: (event) => {\n    switch (event.type) {\n      case 'step_start':\n        console.log('Starting:', event.name);\n        break;\n      case 'step_complete':\n        console.log('Completed:', event.name, event.durationMs, 'ms');\n        break;\n      case 'step_error':\n        console.error('Failed:', event.name, event.error);\n        break;\n    }\n  },\n});\n```\n\n### strict\n\nForce explicit handling of unexpected errors:\n\n```typescript\nconst workflow = createWorkflow(deps, {\n  strict: true,\n  catchUnexpected: (thrown) => ({\n    type: 'UNEXPECTED' as const,\n    message: String(thrown),\n  }),\n});\n```\n\n## Composing workflows\n\nWorkflows are just functions. Compose them naturally:\n\n```typescript\nconst validateInput = createWorkflow({ validateEmail, validatePassword });\nconst processPayment = createWorkflow({ chargeCard, saveReceipt });\n\nconst checkout = createWorkflow({\n  validateEmail,\n  validatePassword,\n  chargeCard,\n  saveReceipt,\n});\n\nconst result = await checkout(async (step) => {\n  // Use steps from all dependencies\n  await step(validateEmail(input.email));\n  await step(validatePassword(input.password));\n  await step(chargeCard(input.amount));\n  await step(saveReceipt(input.orderId));\n});\n```\n\n## Context\n\nPass context through workflow execution:\n\n```typescript\nconst workflow = createWorkflow(deps);\n\nconst result = await workflow(\n  async (step, context) => {\n    console.log('User ID:', context.userId);\n    const user = await step(fetchUser(context.userId));\n    return user;\n  },\n  { context: { userId: '123', requestId: 'abc' } }\n);\n```\n\n## Next\n\n[Learn about Tagged Errors →](/workflow/concepts/tagged-errors/)","src/content/docs/concepts/workflows.md","5397b544208554ab",{"html":533,"metadata":534},"\u003Cp>There are two ways to run workflows: \u003Ccode dir=\"auto\">createWorkflow\u003C/code> for reusable workflows with dependency inference, and \u003Ccode dir=\"auto\">run\u003C/code> for one-off operations.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"createworkflow\">createWorkflow\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#createworkflow\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “createWorkflow”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Creates a reusable workflow with automatic error type inference from dependencies:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">User\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> sendEmail\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">to\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\">void\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'EMAIL_FAILED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Error types inferred from dependencies\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ fetchUser, sendEmail });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">sendEmail\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">email\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> user;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// result.error is: 'NOT_FOUND' | 'EMAIL_FAILED' | UnexpectedError\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createWorkflow, ok, err, type AsyncResult } from &#x27;@jagreehal/workflow&#x27;;\n\nconst fetchUser = async (id: string): AsyncResult\u003CUser, &#x27;NOT_FOUND&#x27;> => { ... };\nconst sendEmail = async (to: string): AsyncResult\u003Cvoid, &#x27;EMAIL_FAILED&#x27;> => { ... };\n\n// Error types inferred from dependencies\nconst workflow = createWorkflow({ fetchUser, sendEmail });\n\nconst result = await workflow(async (step) => {\n  const user = await step(fetchUser(&#x27;1&#x27;));\n  await step(sendEmail(user.email));\n  return user;\n});\n// result.error is: &#x27;NOT_FOUND&#x27; | &#x27;EMAIL_FAILED&#x27; | UnexpectedError\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"with-options\">With options\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#with-options\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “With options”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { fetchUser, sendEmail },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    cache\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> new\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> Map\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(),                    \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Enable step caching\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">event\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(event), \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Event stream\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    strict\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,                        \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Force explicit error handling\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const workflow = createWorkflow(\n  { fetchUser, sendEmail },\n  {\n    cache: new Map(),                    // Enable step caching\n    onEvent: (event) => console.log(event), // Event stream\n    strict: true,                        // Force explicit error handling\n  }\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"run\">run()\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#run\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “run()”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>For one-off workflows where you specify error types manually:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">run\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> run\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">User\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'EMAIL_FAILED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">>(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">sendEmail\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">email\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> user;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { run } from &#x27;@jagreehal/workflow&#x27;;\n\nconst result = await run\u003CUser, &#x27;NOT_FOUND&#x27; | &#x27;EMAIL_FAILED&#x27;>(\n  async (step) => {\n    const user = await step(fetchUser(&#x27;1&#x27;));\n    await step(sendEmail(user.email));\n    return user;\n  }\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"when-to-use-each\">When to use each\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#when-to-use-each\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “When to use each”\u003C/span>\u003C/a>\u003C/div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Scenario\u003C/th>\u003Cth>Use\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Dependencies known at compile time\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">createWorkflow\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Dependencies passed as parameters\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">run\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Need step caching or resume\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">createWorkflow\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Need automatic error inference\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">createWorkflow\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>One-off workflow\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">run\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Testing with mocks\u003C/td>\u003Ctd>\u003Ccode dir=\"auto\">run\u003C/code>\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"workflow-options\">Workflow options\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#workflow-options\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Workflow options”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"cache\">cache\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#cache\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “cache”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Enable step caching to avoid re-executing completed steps:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  cache\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> new\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> Map\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // This step runs once, even if workflow is called multiple times\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'user:1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> user;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const workflow = createWorkflow(deps, {\n  cache: new Map(),\n});\n\nconst result = await workflow(async (step) => {\n  // This step runs once, even if workflow is called multiple times\n  const user = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });\n  return user;\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"resumestate\">resumeState\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#resumestate\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “resumeState”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Resume a workflow from saved state:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  resumeState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> savedState, \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// From a previous run\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Cached steps return their saved values\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'user:1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> user;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const workflow = createWorkflow(deps, {\n  resumeState: savedState, // From a previous run\n});\n\nconst result = await workflow(async (step) => {\n  // Cached steps return their saved values\n  const user = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });\n  return user;\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>See \u003Ca href=\"/workflow/guides/persistence/\">Persistence\u003C/a> for details.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"onevent\">onEvent\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#onevent\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “onEvent”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Subscribe to workflow events for logging, visualization, or debugging:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">event\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    switch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (event.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">type\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      case\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'step_start'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">        console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Starting:'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, event.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">        break\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      case\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'step_complete'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">        console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Completed:'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, event.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, event.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">durationMs\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'ms'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">        break\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      case\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'step_error'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">        console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Failed:'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, event.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, event.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">        break\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const workflow = createWorkflow(deps, {\n  onEvent: (event) => {\n    switch (event.type) {\n      case &#x27;step_start&#x27;:\n        console.log(&#x27;Starting:&#x27;, event.name);\n        break;\n      case &#x27;step_complete&#x27;:\n        console.log(&#x27;Completed:&#x27;, event.name, event.durationMs, &#x27;ms&#x27;);\n        break;\n      case &#x27;step_error&#x27;:\n        console.error(&#x27;Failed:&#x27;, event.name, event.error);\n        break;\n    }\n  },\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"strict\">strict\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#strict\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “strict”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Force explicit handling of unexpected errors:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  strict\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  catchUnexpected\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">thrown\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> ({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    type\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'UNEXPECTED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F47067\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> const\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    message\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> String\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(thrown),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const workflow = createWorkflow(deps, {\n  strict: true,\n  catchUnexpected: (thrown) => ({\n    type: &#x27;UNEXPECTED&#x27; as const,\n    message: String(thrown),\n  }),\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"composing-workflows\">Composing workflows\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#composing-workflows\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Composing workflows”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Workflows are just functions. Compose them naturally:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> validateInput\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ validateEmail, validatePassword });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> processPayment\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ chargeCard, saveReceipt });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> checkout\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  validateEmail,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  validatePassword,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  chargeCard,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  saveReceipt,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> checkout\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Use steps from all dependencies\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">validateEmail\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(input.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">email\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">validatePassword\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(input.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">password\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">chargeCard\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(input.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">amount\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">saveReceipt\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(input.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">orderId\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const validateInput = createWorkflow({ validateEmail, validatePassword });\nconst processPayment = createWorkflow({ chargeCard, saveReceipt });\n\nconst checkout = createWorkflow({\n  validateEmail,\n  validatePassword,\n  chargeCard,\n  saveReceipt,\n});\n\nconst result = await checkout(async (step) => {\n  // Use steps from all dependencies\n  await step(validateEmail(input.email));\n  await step(validatePassword(input.password));\n  await step(chargeCard(input.amount));\n  await step(saveReceipt(input.orderId));\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"context\">Context\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#context\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Context”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Pass context through workflow execution:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">context\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'User ID:'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, context.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">userId\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(context.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">userId\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> user;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">context\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">userId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">requestId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'abc'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const workflow = createWorkflow(deps);\n\nconst result = await workflow(\n  async (step, context) => {\n    console.log(&#x27;User ID:&#x27;, context.userId);\n    const user = await step(fetchUser(context.userId));\n    return user;\n  },\n  { context: { userId: &#x27;123&#x27;, requestId: &#x27;abc&#x27; } }\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/workflow/concepts/tagged-errors/\">Learn about Tagged Errors →\u003C/a>\u003C/p>",{"headings":535,"localImagePaths":568,"remoteImagePaths":569,"frontmatter":570,"imagePaths":571},[536,539,542,545,548,551,553,556,559,561,564,567],{"depth":57,"slug":537,"text":538},"createworkflow","createWorkflow",{"depth":160,"slug":540,"text":541},"with-options","With options",{"depth":57,"slug":543,"text":544},"run","run()",{"depth":57,"slug":546,"text":547},"when-to-use-each","When to use each",{"depth":57,"slug":549,"text":550},"workflow-options","Workflow options",{"depth":160,"slug":552,"text":552},"cache",{"depth":160,"slug":554,"text":555},"resumestate","resumeState",{"depth":160,"slug":557,"text":558},"onevent","onEvent",{"depth":160,"slug":560,"text":560},"strict",{"depth":57,"slug":562,"text":563},"composing-workflows","Composing workflows",{"depth":57,"slug":565,"text":566},"context","Context",{"depth":57,"slug":384,"text":385},[],[],{"title":524,"description":525},[],"getting-started/error-handling",{"id":572,"data":574,"body":580,"filePath":581,"digest":582,"rendered":583},{"title":575,"description":576,"editUrl":16,"head":577,"template":46,"sidebar":578,"pagefind":16,"draft":35},"Handling Errors","How errors flow through workflows and how to handle them",[],{"hidden":35,"attrs":579},{},"## Error types are inferred\n\nWhen you create a workflow, TypeScript computes the error union from your dependencies:\n\n```typescript\nconst fetchUser = async (id: string): AsyncResult\u003CUser, 'NOT_FOUND'> => { ... };\nconst fetchPosts = async (id: string): AsyncResult\u003CPost[], 'FETCH_ERROR'> => { ... };\nconst sendEmail = async (to: string): AsyncResult\u003Cvoid, 'EMAIL_FAILED'> => { ... };\n\nconst workflow = createWorkflow({ fetchUser, fetchPosts, sendEmail });\n\nconst result = await workflow(async (step) => { ... });\n// result.error is: 'NOT_FOUND' | 'FETCH_ERROR' | 'EMAIL_FAILED' | UnexpectedError\n```\n\nAdd a new dependency? The error union updates automatically.\n\n## UnexpectedError\n\nIf code throws an exception (not a returned error), it becomes an `UnexpectedError`:\n\n```typescript\nconst badOperation = async (): AsyncResult\u003Cstring, 'KNOWN_ERROR'> => {\n  throw new Error('Something broke'); // Throws instead of returning err()\n};\n\nconst workflow = createWorkflow({ badOperation });\nconst result = await workflow(async (step) => {\n  return await step(badOperation());\n});\n\nif (!result.ok && result.error.type === 'UNEXPECTED') {\n  console.log(result.error.cause); // The original Error object\n}\n```\n\n## Wrapping throwing code\n\nUse `step.try` to convert thrown exceptions into typed errors:\n\n```typescript\nconst result = await workflow(async (step) => {\n  const data = await step.try(\n    async () => {\n      const res = await fetch('/api/data');\n      if (!res.ok) throw new Error(`HTTP ${res.status}`);\n      return res.json();\n    },\n    { error: 'FETCH_FAILED' as const }\n  );\n\n  return data;\n});\n// result.error includes 'FETCH_FAILED'\n```\n\n## Preserving error details\n\nIf your function returns rich error objects, use `step.fromResult`:\n\n```typescript\ntype ApiError = { code: string; message: string };\n\nconst callApi = async (): AsyncResult\u003CData, ApiError> => {\n  return err({ code: 'RATE_LIMITED', message: 'Too many requests' });\n};\n\nconst result = await workflow(async (step) => {\n  const data = await step.fromResult(\n    () => callApi(),\n    {\n      onError: (apiError) => ({\n        type: 'API_ERROR' as const,\n        code: apiError.code,\n        message: apiError.message,\n      }),\n    }\n  );\n  return data;\n});\n```\n\n## Handling specific errors\n\nUse a switch statement for exhaustive handling:\n\n```typescript\nif (!result.ok) {\n  switch (result.error) {\n    case 'NOT_FOUND':\n      return res.status(404).json({ error: 'User not found' });\n    case 'UNAUTHORIZED':\n      return res.status(401).json({ error: 'Please log in' });\n    case 'FETCH_ERROR':\n      return res.status(502).json({ error: 'Upstream service failed' });\n    default:\n      // UnexpectedError or unknown error\n      console.error(result.error);\n      return res.status(500).json({ error: 'Internal error' });\n  }\n}\n```\n\nTypeScript ensures you handle all known error cases.\n\n## Strict mode\n\nBy default, thrown exceptions become `UnexpectedError`. Use strict mode to force explicit handling:\n\n```typescript\nconst workflow = createWorkflow(\n  { fetchUser, fetchPosts },\n  {\n    strict: true,\n    catchUnexpected: (thrown) => ({\n      type: 'UNEXPECTED' as const,\n      message: String(thrown),\n    }),\n  }\n);\n```\n\n## When to use string literals vs objects\n\n| Use case | Recommendation |\n|----------|---------------|\n| Simple distinct states | String literals: `'NOT_FOUND' \\| 'UNAUTHORIZED'` |\n| Errors with context | Objects: `{ type: 'NOT_FOUND', id: string }` |\n| API responses | [Tagged Errors](/workflow/concepts/tagged-errors/) for structured data |\n\n## Next\n\n[Learn about Results in depth →](/workflow/concepts/results/)","src/content/docs/getting-started/error-handling.md","7ce0e6a6de966cd2",{"html":584,"metadata":585},"\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"error-types-are-inferred\">Error types are inferred\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#error-types-are-inferred\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Error types are inferred”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>When you create a workflow, TypeScript computes the error union from your dependencies:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">User\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">Post\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">[], \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'FETCH_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> sendEmail\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">to\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\">void\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'EMAIL_FAILED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ fetchUser, fetchPosts, sendEmail });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// result.error is: 'NOT_FOUND' | 'FETCH_ERROR' | 'EMAIL_FAILED' | UnexpectedError\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const fetchUser = async (id: string): AsyncResult\u003CUser, &#x27;NOT_FOUND&#x27;> => { ... };\nconst fetchPosts = async (id: string): AsyncResult\u003CPost[], &#x27;FETCH_ERROR&#x27;> => { ... };\nconst sendEmail = async (to: string): AsyncResult\u003Cvoid, &#x27;EMAIL_FAILED&#x27;> => { ... };\n\nconst workflow = createWorkflow({ fetchUser, fetchPosts, sendEmail });\n\nconst result = await workflow(async (step) => { ... });\n// result.error is: &#x27;NOT_FOUND&#x27; | &#x27;FETCH_ERROR&#x27; | &#x27;EMAIL_FAILED&#x27; | UnexpectedError\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>Add a new dependency? The error union updates automatically.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"unexpectederror\">UnexpectedError\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#unexpectederror\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “UnexpectedError”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>If code throws an exception (not a returned error), it becomes an \u003Ccode dir=\"auto\">UnexpectedError\u003C/code>:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> badOperation\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> ()\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\">string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'KNOWN_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  throw\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> new\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> Error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Something broke'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">); \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Throws instead of returning err()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ badOperation });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">badOperation\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> &#x26;&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">type\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> ===\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'UNEXPECTED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">cause\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">); \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// The original Error object\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const badOperation = async (): AsyncResult\u003Cstring, &#x27;KNOWN_ERROR&#x27;> => {\n  throw new Error(&#x27;Something broke&#x27;); // Throws instead of returning err()\n};\n\nconst workflow = createWorkflow({ badOperation });\nconst result = await workflow(async (step) => {\n  return await step(badOperation());\n});\n\nif (!result.ok &#x26;&#x26; result.error.type === &#x27;UNEXPECTED&#x27;) {\n  console.log(result.error.cause); // The original Error object\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"wrapping-throwing-code\">Wrapping throwing code\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#wrapping-throwing-code\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Wrapping throwing code”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">step.try\u003C/code> to convert thrown exceptions into typed errors:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> data\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> step.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">try\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> res\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'/api/data'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">res.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">throw\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> new\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> Error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`HTTP \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">res\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> res.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">json\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'FETCH_FAILED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F47067\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> const\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> data;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// result.error includes 'FETCH_FAILED'\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await workflow(async (step) => {\n  const data = await step.try(\n    async () => {\n      const res = await fetch(&#x27;/api/data&#x27;);\n      if (!res.ok) throw new Error(&#x60;HTTP ${res.status}&#x60;);\n      return res.json();\n    },\n    { error: &#x27;FETCH_FAILED&#x27; as const }\n  );\n\n  return data;\n});\n// result.error includes &#x27;FETCH_FAILED&#x27;\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"preserving-error-details\">Preserving error details\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#preserving-error-details\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Preserving error details”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>If your function returns rich error objects, use \u003Ccode dir=\"auto\">step.fromResult\u003C/code>:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> ApiError\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">code\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">; \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">message\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> callApi\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> ()\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">Data\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">ApiError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">code\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'RATE_LIMITED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">message\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Too many requests'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> data\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> step.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fromResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> callApi\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      onError\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">apiError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> ({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">        type\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'API_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F47067\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> const\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">        code\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> apiError.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">code\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">        message\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> apiError.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">message\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> data;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"type ApiError = { code: string; message: string };\n\nconst callApi = async (): AsyncResult\u003CData, ApiError> => {\n  return err({ code: &#x27;RATE_LIMITED&#x27;, message: &#x27;Too many requests&#x27; });\n};\n\nconst result = await workflow(async (step) => {\n  const data = await step.fromResult(\n    () => callApi(),\n    {\n      onError: (apiError) => ({\n        type: &#x27;API_ERROR&#x27; as const,\n        code: apiError.code,\n        message: apiError.message,\n      }),\n    }\n  );\n  return data;\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"handling-specific-errors\">Handling specific errors\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#handling-specific-errors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Handling specific errors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use a switch statement for exhaustive handling:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  switch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    case\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> res.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">status\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">404\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">json\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'User not found'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    case\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'UNAUTHORIZED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> res.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">status\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">401\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">json\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Please log in'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    case\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'FETCH_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> res.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">status\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">502\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">json\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Upstream service failed'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    default\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">      // UnexpectedError or unknown error\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> res.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">status\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">500\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">json\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Internal error'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"if (!result.ok) {\n  switch (result.error) {\n    case &#x27;NOT_FOUND&#x27;:\n      return res.status(404).json({ error: &#x27;User not found&#x27; });\n    case &#x27;UNAUTHORIZED&#x27;:\n      return res.status(401).json({ error: &#x27;Please log in&#x27; });\n    case &#x27;FETCH_ERROR&#x27;:\n      return res.status(502).json({ error: &#x27;Upstream service failed&#x27; });\n    default:\n      // UnexpectedError or unknown error\n      console.error(result.error);\n      return res.status(500).json({ error: &#x27;Internal error&#x27; });\n  }\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>TypeScript ensures you handle all known error cases.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"strict-mode\">Strict mode\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#strict-mode\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Strict mode”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>By default, thrown exceptions become \u003Ccode dir=\"auto\">UnexpectedError\u003C/code>. Use strict mode to force explicit handling:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { fetchUser, fetchPosts },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    strict\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    catchUnexpected\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">thrown\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> ({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      type\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'UNEXPECTED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F47067\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> const\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      message\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> String\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(thrown),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const workflow = createWorkflow(\n  { fetchUser, fetchPosts },\n  {\n    strict: true,\n    catchUnexpected: (thrown) => ({\n      type: &#x27;UNEXPECTED&#x27; as const,\n      message: String(thrown),\n    }),\n  }\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"when-to-use-string-literals-vs-objects\">When to use string literals vs objects\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#when-to-use-string-literals-vs-objects\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “When to use string literals vs objects”\u003C/span>\u003C/a>\u003C/div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Use case\u003C/th>\u003Cth>Recommendation\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Simple distinct states\u003C/td>\u003Ctd>String literals: \u003Ccode dir=\"auto\">'NOT_FOUND' | 'UNAUTHORIZED'\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Errors with context\u003C/td>\u003Ctd>Objects: \u003Ccode dir=\"auto\">{ type: 'NOT_FOUND', id: string }\u003C/code>\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>API responses\u003C/td>\u003Ctd>\u003Ca href=\"/workflow/concepts/tagged-errors/\">Tagged Errors\u003C/a> for structured data\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/workflow/concepts/results/\">Learn about Results in depth →\u003C/a>\u003C/p>",{"headings":586,"localImagePaths":607,"remoteImagePaths":608,"frontmatter":609,"imagePaths":610},[587,590,593,594,597,600,603,606],{"depth":57,"slug":588,"text":589},"error-types-are-inferred","Error types are inferred",{"depth":57,"slug":591,"text":592},"unexpectederror","UnexpectedError",{"depth":57,"slug":442,"text":443},{"depth":57,"slug":595,"text":596},"preserving-error-details","Preserving error details",{"depth":57,"slug":598,"text":599},"handling-specific-errors","Handling specific errors",{"depth":57,"slug":601,"text":602},"strict-mode","Strict mode",{"depth":57,"slug":604,"text":605},"when-to-use-string-literals-vs-objects","When to use string literals vs objects",{"depth":57,"slug":384,"text":385},[],[],{"title":575,"description":576},[],"getting-started/first-workflow",{"id":611,"data":613,"body":619,"filePath":620,"digest":621,"rendered":622},{"title":614,"description":615,"editUrl":16,"head":616,"template":46,"sidebar":617,"pagefind":16,"draft":35},"Your First Workflow","Build a simple workflow with typed errors in 5 minutes",[],{"hidden":35,"attrs":618},{},"This guide walks through building a workflow that fetches a user and their posts, with typed error handling.\n\n## Define your operations\n\nOperations return `AsyncResult\u003CT, E>` - either `ok(value)` or `err(error)`:\n\n```typescript\nimport { ok, err, type AsyncResult } from '@jagreehal/workflow';\n\ntype User = { id: string; name: string };\ntype Post = { id: number; title: string };\n\nconst fetchUser = async (id: string): AsyncResult\u003CUser, 'NOT_FOUND'> => {\n  if (id === '1') {\n    return ok({ id: '1', name: 'Alice' });\n  }\n  return err('NOT_FOUND');\n};\n\nconst fetchPosts = async (userId: string): AsyncResult\u003CPost[], 'FETCH_ERROR'> => {\n  return ok([\n    { id: 1, title: 'Hello World' },\n    { id: 2, title: 'Second Post' },\n  ]);\n};\n```\n\n## Create the workflow\n\nPass your operations to `createWorkflow`. Error types are inferred automatically:\n\n```typescript\nimport { createWorkflow } from '@jagreehal/workflow';\n\nconst loadUserData = createWorkflow({ fetchUser, fetchPosts });\n```\n\n## Run it\n\nUse `step()` to execute operations. If any step fails, the workflow exits early:\n\n```typescript\nconst result = await loadUserData(async (step) => {\n  const user = await step(fetchUser('1'));\n  const posts = await step(fetchPosts(user.id));\n  return { user, posts };\n});\n```\n\n## Handle the result\n\nCheck `result.ok` to determine success or failure:\n\n```typescript\nif (result.ok) {\n  console.log(result.value.user.name);\n  console.log(result.value.posts.length, 'posts');\n} else {\n  // TypeScript knows: result.error is 'NOT_FOUND' | 'FETCH_ERROR' | UnexpectedError\n  switch (result.error) {\n    case 'NOT_FOUND':\n      console.log('User not found');\n      break;\n    case 'FETCH_ERROR':\n      console.log('Failed to fetch posts');\n      break;\n    default:\n      // UnexpectedError - something threw an exception\n      console.log('Unexpected error:', result.error);\n  }\n}\n```\n\n## Complete example\n\n```typescript\nimport { createWorkflow, ok, err, type AsyncResult } from '@jagreehal/workflow';\n\ntype User = { id: string; name: string };\ntype Post = { id: number; title: string };\n\nconst fetchUser = async (id: string): AsyncResult\u003CUser, 'NOT_FOUND'> =>\n  id === '1' ? ok({ id: '1', name: 'Alice' }) : err('NOT_FOUND');\n\nconst fetchPosts = async (userId: string): AsyncResult\u003CPost[], 'FETCH_ERROR'> =>\n  ok([{ id: 1, title: 'Hello World' }]);\n\nconst loadUserData = createWorkflow({ fetchUser, fetchPosts });\n\nconst result = await loadUserData(async (step) => {\n  const user = await step(fetchUser('1'));\n  const posts = await step(fetchPosts(user.id));\n  return { user, posts };\n});\n\nif (result.ok) {\n  console.log(`${result.value.user.name} has ${result.value.posts.length} posts`);\n}\n```\n\n## What happens on error?\n\nChange `fetchUser('1')` to `fetchUser('999')`:\n\n```typescript\nconst result = await loadUserData(async (step) => {\n  const user = await step(fetchUser('999')); // Returns err('NOT_FOUND')\n  // This line never runs\n  const posts = await step(fetchPosts(user.id));\n  return { user, posts };\n});\n\nconsole.log(result.ok);    // false\nconsole.log(result.error); // 'NOT_FOUND'\n```\n\nThe workflow exits at the first error. No need for try/catch or manual error checking.\n\n## Next\n\n[Learn about error handling →](/workflow/getting-started/error-handling/)","src/content/docs/getting-started/first-workflow.md","4a74e598f62c2dce",{"html":623,"metadata":624},"\u003Cp>This guide walks through building a workflow that fetches a user and their posts, with typed error handling.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"define-your-operations\">Define your operations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#define-your-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Define your operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Operations return \u003Ccode dir=\"auto\">AsyncResult&#x3C;T, E>\u003C/code> - either \u003Ccode dir=\"auto\">ok(value)\u003C/code> or \u003Ccode dir=\"auto\">err(error)\u003C/code>:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> User\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">; \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> Post\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> number\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">; \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">title\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">User\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (id \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">===\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Alice'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">userId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">Post\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">[], \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'FETCH_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">title\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Hello World'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 2\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">title\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Second Post'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  ]);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { ok, err, type AsyncResult } from &#x27;@jagreehal/workflow&#x27;;\n\ntype User = { id: string; name: string };\ntype Post = { id: number; title: string };\n\nconst fetchUser = async (id: string): AsyncResult\u003CUser, &#x27;NOT_FOUND&#x27;> => {\n  if (id === &#x27;1&#x27;) {\n    return ok({ id: &#x27;1&#x27;, name: &#x27;Alice&#x27; });\n  }\n  return err(&#x27;NOT_FOUND&#x27;);\n};\n\nconst fetchPosts = async (userId: string): AsyncResult\u003CPost[], &#x27;FETCH_ERROR&#x27;> => {\n  return ok([\n    { id: 1, title: &#x27;Hello World&#x27; },\n    { id: 2, title: &#x27;Second Post&#x27; },\n  ]);\n};\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"create-the-workflow\">Create the workflow\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#create-the-workflow\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Create the workflow”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Pass your operations to \u003Ccode dir=\"auto\">createWorkflow\u003C/code>. Error types are inferred automatically:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> loadUserData\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ fetchUser, fetchPosts });\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createWorkflow } from &#x27;@jagreehal/workflow&#x27;;\n\nconst loadUserData = createWorkflow({ fetchUser, fetchPosts });\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"run-it\">Run it\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#run-it\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Run it”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">step()\u003C/code> to execute operations. If any step fails, the workflow exits early:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> loadUserData\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> posts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { user, posts };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await loadUserData(async (step) => {\n  const user = await step(fetchUser(&#x27;1&#x27;));\n  const posts = await step(fetchPosts(user.id));\n  return { user, posts };\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"handle-the-result\">Handle the result\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#handle-the-result\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Handle the result”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Check \u003Ccode dir=\"auto\">result.ok\u003C/code> to determine success or failure:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">user\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">posts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#6CB6FF\">length\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'posts'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">} \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">else\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // TypeScript knows: result.error is 'NOT_FOUND' | 'FETCH_ERROR' | UnexpectedError\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  switch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    case\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'User not found'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      break\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    case\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'FETCH_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Failed to fetch posts'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      break\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    default\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">      // UnexpectedError - something threw an exception\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Unexpected error:'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"if (result.ok) {\n  console.log(result.value.user.name);\n  console.log(result.value.posts.length, &#x27;posts&#x27;);\n} else {\n  // TypeScript knows: result.error is &#x27;NOT_FOUND&#x27; | &#x27;FETCH_ERROR&#x27; | UnexpectedError\n  switch (result.error) {\n    case &#x27;NOT_FOUND&#x27;:\n      console.log(&#x27;User not found&#x27;);\n      break;\n    case &#x27;FETCH_ERROR&#x27;:\n      console.log(&#x27;Failed to fetch posts&#x27;);\n      break;\n    default:\n      // UnexpectedError - something threw an exception\n      console.log(&#x27;Unexpected error:&#x27;, result.error);\n  }\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"complete-example\">Complete example\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#complete-example\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Complete example”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> User\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">; \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> Post\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> number\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">; \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">title\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">User\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  id \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">===\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '1'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> ?\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Alice'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }) \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">userId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">Post\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">[], \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'FETCH_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([{ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">title\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Hello World'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }]);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> loadUserData\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ fetchUser, fetchPosts });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> loadUserData\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> posts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { user, posts };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">result\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">user\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> has \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">result\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">posts\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#6CB6FF\">length\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> posts`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createWorkflow, ok, err, type AsyncResult } from &#x27;@jagreehal/workflow&#x27;;\n\ntype User = { id: string; name: string };\ntype Post = { id: number; title: string };\n\nconst fetchUser = async (id: string): AsyncResult\u003CUser, &#x27;NOT_FOUND&#x27;> =>\n  id === &#x27;1&#x27; ? ok({ id: &#x27;1&#x27;, name: &#x27;Alice&#x27; }) : err(&#x27;NOT_FOUND&#x27;);\n\nconst fetchPosts = async (userId: string): AsyncResult\u003CPost[], &#x27;FETCH_ERROR&#x27;> =>\n  ok([{ id: 1, title: &#x27;Hello World&#x27; }]);\n\nconst loadUserData = createWorkflow({ fetchUser, fetchPosts });\n\nconst result = await loadUserData(async (step) => {\n  const user = await step(fetchUser(&#x27;1&#x27;));\n  const posts = await step(fetchPosts(user.id));\n  return { user, posts };\n});\n\nif (result.ok) {\n  console.log(&#x60;${result.value.user.name} has ${result.value.posts.length} posts&#x60;);\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"what-happens-on-error\">What happens on error?\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#what-happens-on-error\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “What happens on error?”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Change \u003Ccode dir=\"auto\">fetchUser('1')\u003C/code> to \u003Ccode dir=\"auto\">fetchUser('999')\u003C/code>:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> loadUserData\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'999'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)); \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Returns err('NOT_FOUND')\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // This line never runs\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> posts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { user, posts };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);    \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// false\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">); \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// 'NOT_FOUND'\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await loadUserData(async (step) => {\n  const user = await step(fetchUser(&#x27;999&#x27;)); // Returns err(&#x27;NOT_FOUND&#x27;)\n  // This line never runs\n  const posts = await step(fetchPosts(user.id));\n  return { user, posts };\n});\n\nconsole.log(result.ok);    // false\nconsole.log(result.error); // &#x27;NOT_FOUND&#x27;\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>The workflow exits at the first error. No need for try/catch or manual error checking.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/workflow/getting-started/error-handling/\">Learn about error handling →\u003C/a>\u003C/p>",{"headings":625,"localImagePaths":645,"remoteImagePaths":646,"frontmatter":647,"imagePaths":648},[626,629,632,635,638,641,644],{"depth":57,"slug":627,"text":628},"define-your-operations","Define your operations",{"depth":57,"slug":630,"text":631},"create-the-workflow","Create the workflow",{"depth":57,"slug":633,"text":634},"run-it","Run it",{"depth":57,"slug":636,"text":637},"handle-the-result","Handle the result",{"depth":57,"slug":639,"text":640},"complete-example","Complete example",{"depth":57,"slug":642,"text":643},"what-happens-on-error","What happens on error?",{"depth":57,"slug":384,"text":385},[],[],{"title":614,"description":615},[],"guides/batch-processing",{"id":649,"data":651,"body":657,"filePath":658,"digest":659,"rendered":660},{"title":652,"description":653,"editUrl":16,"head":654,"template":46,"sidebar":655,"pagefind":16,"draft":35},"Batch Processing","Process large datasets with bounded concurrency",[],{"hidden":35,"attrs":656},{},"Process items in batches with progress tracking and checkpoint hooks. Useful for embedding generation, bulk API calls, or database migrations.\n\n## Basic usage\n\n```typescript\nimport { processInBatches, ok, err, type AsyncResult } from '@jagreehal/workflow/batch';\n\nconst embedText = async (text: string): AsyncResult\u003Cnumber[], 'EMBED_ERROR'> => {\n  const response = await fetch('/api/embed', { method: 'POST', body: text });\n  return response.ok ? ok(await response.json()) : err('EMBED_ERROR');\n};\n\nconst result = await processInBatches(\n  texts,                    // Array of items\n  embedText,                // Process function\n  { batchSize: 20, concurrency: 3 }\n);\n\nif (result.ok) {\n  console.log(`Processed ${result.value.length} items`);\n}\n```\n\n## Configuration\n\n```typescript\n{\n  batchSize: 20,      // Items per batch\n  concurrency: 3,     // Parallel operations within each batch\n  batchDelayMs: 50,   // Delay between batches (backpressure)\n}\n```\n\n## Progress tracking\n\n```typescript\nconst result = await processInBatches(\n  items,\n  processItem,\n  { batchSize: 20, concurrency: 3 },\n  {\n    onProgress: (progress) => {\n      console.log(`${progress.percent}% complete`);\n      console.log(`Batch ${progress.batch}/${progress.totalBatches}`);\n      console.log(`${progress.processed}/${progress.total} items`);\n    },\n  }\n);\n```\n\n## Checkpoint hooks\n\nRun code between batches (e.g., flush database WAL):\n\n```typescript\nconst result = await processInBatches(\n  records,\n  insertRecord,\n  { batchSize: 100, concurrency: 5 },\n  {\n    afterBatch: async () => {\n      await db.checkpoint();\n      return ok(undefined);\n    },\n  }\n);\n```\n\nIf `afterBatch` returns an error, processing stops.\n\n## Presets\n\nUse presets for common scenarios:\n\n```typescript\nimport { processInBatches, batchPresets } from '@jagreehal/workflow/batch';\n\n// Conservative: batchSize=20, concurrency=3, delay=50ms\n// Good for memory-constrained environments\nawait processInBatches(items, process, batchPresets.conservative);\n\n// Balanced: batchSize=50, concurrency=5, delay=10ms\n// Good for typical workloads\nawait processInBatches(items, process, batchPresets.balanced);\n\n// Aggressive: batchSize=100, concurrency=10, no delay\n// Good when memory isn't a concern\nawait processInBatches(items, process, batchPresets.aggressive);\n```\n\n## Error handling\n\nProcessing stops on the first error:\n\n```typescript\nconst result = await processInBatches(\n  items,\n  async (item, index) => {\n    if (item.invalid) {\n      return err('INVALID_ITEM');\n    }\n    return ok(await process(item));\n  },\n  { batchSize: 20, concurrency: 3 }\n);\n\nif (!result.ok) {\n  if (isBatchProcessingError(result.error)) {\n    console.log('Failed at item:', result.error.itemIndex);\n    console.log('In batch:', result.error.batchNumber);\n    console.log('Underlying error:', result.error.error);\n  }\n}\n```\n\n## Item index\n\nThe process function receives the global index:\n\n```typescript\nconst result = await processInBatches(\n  items,\n  async (item, index) => {\n    console.log(`Processing item ${index + 1} of ${items.length}`);\n    return ok(await process(item));\n  },\n  { batchSize: 20, concurrency: 3 }\n);\n```\n\n## Config validation\n\nInvalid config returns an error immediately:\n\n```typescript\nconst result = await processInBatches(\n  items,\n  process,\n  { batchSize: 0, concurrency: 3 } // Invalid!\n);\n\nif (!result.ok && isInvalidBatchConfigError(result.error)) {\n  console.log(result.error.reason); // \"batchSize must be a positive integer\"\n  console.log(result.error.field);  // \"batchSize\"\n  console.log(result.error.value);  // 0\n}\n```\n\n`batchSize` and `concurrency` must be positive integers.\n\n## Full example\n\n```typescript\nimport {\n  processInBatches,\n  batchPresets,\n  isBatchProcessingError,\n  ok,\n  err,\n} from '@jagreehal/workflow';\n\n// Generate embeddings for documents\nconst generateEmbeddings = async (documents: Document[]) => {\n  let processed = 0;\n\n  const result = await processInBatches(\n    documents,\n    async (doc) => {\n      const response = await fetch('/api/embed', {\n        method: 'POST',\n        body: JSON.stringify({ text: doc.content }),\n      });\n\n      if (!response.ok) {\n        return err('EMBED_FAILED' as const);\n      }\n\n      return ok({\n        docId: doc.id,\n        embedding: await response.json(),\n      });\n    },\n    batchPresets.conservative,\n    {\n      afterBatch: async () => {\n        // Checkpoint after each batch\n        await db.checkpoint();\n        return ok(undefined);\n      },\n      onProgress: (p) => {\n        console.log(`Embedding documents: ${p.percent}%`);\n      },\n    }\n  );\n\n  if (!result.ok) {\n    if (isBatchProcessingError(result.error)) {\n      console.error(`Failed at document ${result.error.itemIndex}`);\n    }\n    return result;\n  }\n\n  // Save all embeddings\n  await db.embeddings.insertMany(result.value);\n  return ok({ count: result.value.length });\n};\n```\n\n## Next\n\n[See Patterns: Checkout Flow →](/workflow/patterns/checkout-flow/)","src/content/docs/guides/batch-processing.md","711c1213546b62ee",{"html":661,"metadata":662},"\u003Cp>Process items in batches with progress tracking and checkpoint hooks. Useful for embedding generation, bulk API calls, or database migrations.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"basic-usage\">Basic usage\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#basic-usage\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Basic usage”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">processInBatches\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/batch'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> embedText\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">text\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\">number\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">[], \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'EMBED_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> response\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'/api/embed'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">method\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'POST'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">body\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> text });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> response.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> ?\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> response.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">json\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">()) \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'EMBED_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> processInBatches\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  texts,                    \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Array of items\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  embedText,                \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Process function\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">batchSize\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 20\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">concurrency\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`Processed \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">result\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#6CB6FF\">length\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> items`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { processInBatches, ok, err, type AsyncResult } from &#x27;@jagreehal/workflow/batch&#x27;;\n\nconst embedText = async (text: string): AsyncResult\u003Cnumber[], &#x27;EMBED_ERROR&#x27;> => {\n  const response = await fetch(&#x27;/api/embed&#x27;, { method: &#x27;POST&#x27;, body: text });\n  return response.ok ? ok(await response.json()) : err(&#x27;EMBED_ERROR&#x27;);\n};\n\nconst result = await processInBatches(\n  texts,                    // Array of items\n  embedText,                // Process function\n  { batchSize: 20, concurrency: 3 }\n);\n\nif (result.ok) {\n  console.log(&#x60;Processed ${result.value.length} items&#x60;);\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"configuration\">Configuration\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#configuration\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Configuration”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  batchSize\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">20\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,      \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Items per batch\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  concurrency\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,     \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Parallel operations within each batch\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  batchDelayMs\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">50\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,   \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Delay between batches (backpressure)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"{\n  batchSize: 20,      // Items per batch\n  concurrency: 3,     // Parallel operations within each batch\n  batchDelayMs: 50,   // Delay between batches (backpressure)\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"progress-tracking\">Progress tracking\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#progress-tracking\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Progress tracking”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> processInBatches\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  items,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  processItem,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">batchSize\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 20\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">concurrency\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    onProgress\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">progress\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">progress\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">percent\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">% complete`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`Batch \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">progress\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">batch\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">/\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">progress\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">totalBatches\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">progress\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">processed\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">/\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">progress\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">total\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> items`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await processInBatches(\n  items,\n  processItem,\n  { batchSize: 20, concurrency: 3 },\n  {\n    onProgress: (progress) => {\n      console.log(&#x60;${progress.percent}% complete&#x60;);\n      console.log(&#x60;Batch ${progress.batch}/${progress.totalBatches}&#x60;);\n      console.log(&#x60;${progress.processed}/${progress.total} items&#x60;);\n    },\n  }\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"checkpoint-hooks\">Checkpoint hooks\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#checkpoint-hooks\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Checkpoint hooks”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Run code between batches (e.g., flush database WAL):\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> processInBatches\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  records,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  insertRecord,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">batchSize\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 100\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">concurrency\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 5\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    afterBatch\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">checkpoint\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">undefined\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await processInBatches(\n  records,\n  insertRecord,\n  { batchSize: 100, concurrency: 5 },\n  {\n    afterBatch: async () => {\n      await db.checkpoint();\n      return ok(undefined);\n    },\n  }\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>If \u003Ccode dir=\"auto\">afterBatch\u003C/code> returns an error, processing stops.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"presets\">Presets\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#presets\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Presets”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use presets for common scenarios:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">processInBatches\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">batchPresets\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/batch'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Conservative: batchSize=20, concurrency=3, delay=50ms\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Good for memory-constrained environments\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> processInBatches\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(items, process, batchPresets.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">conservative\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Balanced: batchSize=50, concurrency=5, delay=10ms\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Good for typical workloads\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> processInBatches\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(items, process, batchPresets.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">balanced\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Aggressive: batchSize=100, concurrency=10, no delay\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Good when memory isn't a concern\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> processInBatches\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(items, process, batchPresets.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">aggressive\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { processInBatches, batchPresets } from &#x27;@jagreehal/workflow/batch&#x27;;\n\n// Conservative: batchSize=20, concurrency=3, delay=50ms\n// Good for memory-constrained environments\nawait processInBatches(items, process, batchPresets.conservative);\n\n// Balanced: batchSize=50, concurrency=5, delay=10ms\n// Good for typical workloads\nawait processInBatches(items, process, batchPresets.balanced);\n\n// Aggressive: batchSize=100, concurrency=10, no delay\n// Good when memory isn&#x27;t a concern\nawait processInBatches(items, process, batchPresets.aggressive);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"error-handling\">Error handling\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#error-handling\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Error handling”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Processing stops on the first error:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> processInBatches\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  items,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">item\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">index\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (item.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">invalid\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'INVALID_ITEM'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> process\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(item));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">batchSize\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 20\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">concurrency\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">isBatchProcessingError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Failed at item:'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">itemIndex\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'In batch:'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">batchNumber\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Underlying error:'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await processInBatches(\n  items,\n  async (item, index) => {\n    if (item.invalid) {\n      return err(&#x27;INVALID_ITEM&#x27;);\n    }\n    return ok(await process(item));\n  },\n  { batchSize: 20, concurrency: 3 }\n);\n\nif (!result.ok) {\n  if (isBatchProcessingError(result.error)) {\n    console.log(&#x27;Failed at item:&#x27;, result.error.itemIndex);\n    console.log(&#x27;In batch:&#x27;, result.error.batchNumber);\n    console.log(&#x27;Underlying error:&#x27;, result.error.error);\n  }\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"item-index\">Item index\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#item-index\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Item index”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>The process function receives the global index:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> processInBatches\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  items,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">item\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">index\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`Processing item \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">index\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> +\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 1\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> of \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">items\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#6CB6FF\">length\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> process\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(item));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">batchSize\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 20\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">concurrency\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await processInBatches(\n  items,\n  async (item, index) => {\n    console.log(&#x60;Processing item ${index + 1} of ${items.length}&#x60;);\n    return ok(await process(item));\n  },\n  { batchSize: 20, concurrency: 3 }\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"config-validation\">Config validation\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#config-validation\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Config validation”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Invalid config returns an error immediately:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> processInBatches\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  items,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  process,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">batchSize\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 0\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">concurrency\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Invalid!\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> &#x26;&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> isInvalidBatchConfigError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">); \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// \"batchSize must be a positive integer\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">field\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// \"batchSize\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// 0\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await processInBatches(\n  items,\n  process,\n  { batchSize: 0, concurrency: 3 } // Invalid!\n);\n\nif (!result.ok &#x26;&#x26; isInvalidBatchConfigError(result.error)) {\n  console.log(result.error.reason); // &#x22;batchSize must be a positive integer&#x22;\n  console.log(result.error.field);  // &#x22;batchSize&#x22;\n  console.log(result.error.value);  // 0\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>\u003Ccode dir=\"auto\">batchSize\u003C/code> and \u003Ccode dir=\"auto\">concurrency\u003C/code> must be positive integers.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"full-example\">Full example\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#full-example\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Full example”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  processInBatches\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  batchPresets\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  isBatchProcessingError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">} \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Generate embeddings for documents\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> generateEmbeddings\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">documents\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> Document\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">[]) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  let\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> processed \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">=\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 0\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> processInBatches\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    documents,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">doc\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> response\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'/api/embed'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">        method\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'POST'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">        body\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> JSON\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">stringify\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">text\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> doc.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">content\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">response.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">        return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'EMBED_FAILED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F47067\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> const\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">        docId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> doc.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">        embedding\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> response.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">json\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    batchPresets.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">conservative\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      afterBatch\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">        // Checkpoint after each batch\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">        await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">checkpoint\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">        return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">undefined\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      onProgress\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">p\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">        console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`Embedding documents: \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">p\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">percent\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">%`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">isBatchProcessingError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`Failed at document \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">result\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">itemIndex\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> result;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Save all embeddings\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">embeddings\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">insertMany\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">count\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#6CB6FF\">length\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import {\n  processInBatches,\n  batchPresets,\n  isBatchProcessingError,\n  ok,\n  err,\n} from &#x27;@jagreehal/workflow&#x27;;\n\n// Generate embeddings for documents\nconst generateEmbeddings = async (documents: Document[]) => {\n  let processed = 0;\n\n  const result = await processInBatches(\n    documents,\n    async (doc) => {\n      const response = await fetch(&#x27;/api/embed&#x27;, {\n        method: &#x27;POST&#x27;,\n        body: JSON.stringify({ text: doc.content }),\n      });\n\n      if (!response.ok) {\n        return err(&#x27;EMBED_FAILED&#x27; as const);\n      }\n\n      return ok({\n        docId: doc.id,\n        embedding: await response.json(),\n      });\n    },\n    batchPresets.conservative,\n    {\n      afterBatch: async () => {\n        // Checkpoint after each batch\n        await db.checkpoint();\n        return ok(undefined);\n      },\n      onProgress: (p) => {\n        console.log(&#x60;Embedding documents: ${p.percent}%&#x60;);\n      },\n    }\n  );\n\n  if (!result.ok) {\n    if (isBatchProcessingError(result.error)) {\n      console.error(&#x60;Failed at document ${result.error.itemIndex}&#x60;);\n    }\n    return result;\n  }\n\n  // Save all embeddings\n  await db.embeddings.insertMany(result.value);\n  return ok({ count: result.value.length });\n};\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/workflow/patterns/checkout-flow/\">See Patterns: Checkout Flow →\u003C/a>\u003C/p>",{"headings":663,"localImagePaths":688,"remoteImagePaths":689,"frontmatter":690,"imagePaths":691},[664,665,668,671,674,675,678,681,684,687],{"depth":57,"slug":58,"text":59},{"depth":57,"slug":666,"text":667},"configuration","Configuration",{"depth":57,"slug":669,"text":670},"progress-tracking","Progress tracking",{"depth":57,"slug":672,"text":673},"checkpoint-hooks","Checkpoint hooks",{"depth":57,"slug":279,"text":280},{"depth":57,"slug":676,"text":677},"error-handling","Error handling",{"depth":57,"slug":679,"text":680},"item-index","Item index",{"depth":57,"slug":682,"text":683},"config-validation","Config validation",{"depth":57,"slug":685,"text":686},"full-example","Full example",{"depth":57,"slug":384,"text":385},[],[],{"title":652,"description":653},[],"guides/conditional-execution",{"id":692,"data":694,"body":700,"filePath":701,"digest":702,"rendered":703},{"title":695,"description":696,"editUrl":16,"head":697,"template":46,"sidebar":698,"pagefind":16,"draft":35},"Conditional Execution","Conditionally execute steps with when/unless helpers",[],{"hidden":35,"attrs":699},{},"Execute steps only when certain conditions are met, with automatic event emission for skipped steps.\n\n## Basic usage\n\n```typescript\nimport { when, unless, createWorkflow, ok, err, type AsyncResult } from '@jagreehal/workflow';\n\nconst fetchUser = async (id: string): AsyncResult\u003CUser, 'NOT_FOUND'> => {\n  // ...\n};\n\nconst sendEmail = async (to: string): AsyncResult\u003Cvoid, 'SEND_FAILED'> => {\n  // ...\n};\n\nconst workflow = createWorkflow({ fetchUser, sendEmail });\n\nconst result = await workflow(async (step) => {\n  const user = await step(fetchUser('123'));\n\n  // Only send email if user is not verified\n  await when(\n    !user.isVerified,\n    () => step(sendEmail(user.email)),\n    { name: 'send-verification', reason: 'User is already verified' }\n  );\n\n  return user;\n});\n```\n\n## when - Execute if condition is true\n\nRun a step only when a condition is true. Returns `undefined` if skipped.\n\n```typescript\nconst result = await workflow(async (step) => {\n  const user = await step(fetchUser('123'));\n\n  // Only fetch premium data if user is premium\n  const premium = await when(\n    user.isPremium,\n    () => step(fetchPremiumData(user.id)),\n    { name: 'premium-data', reason: 'User is not premium' }\n  );\n\n  return { user, premium }; // premium is User | undefined\n});\n```\n\n## unless - Execute if condition is false\n\nRun a step only when a condition is false. Returns `undefined` if skipped.\n\n```typescript\nconst result = await workflow(async (step) => {\n  const user = await step(fetchUser('123'));\n\n  // Only send verification email if user is NOT verified\n  const email = await unless(\n    user.isVerified,\n    () => step(sendVerificationEmail(user.email)),\n    { name: 'send-verification', reason: 'User is already verified' }\n  );\n\n  return { user, email }; // email is void | undefined\n});\n```\n\n## whenOr - Execute if true, else return default\n\nRun a step if condition is true, otherwise return a default value.\n\n```typescript\nconst result = await workflow(async (step) => {\n  const user = await step(fetchUser('123'));\n\n  // Get premium limits or use default for non-premium users\n  const limits = await whenOr(\n    user.isPremium,\n    () => step(fetchPremiumLimits(user.id)),\n    { maxRequests: 100, maxStorage: 1000 }, // default\n    { name: 'premium-limits', reason: 'Using default limits' }\n  );\n\n  return { user, limits }; // limits is PremiumLimits | DefaultLimits\n});\n```\n\n## unlessOr - Execute if false, else return default\n\nRun a step if condition is false, otherwise return a default value.\n\n```typescript\nconst result = await workflow(async (step) => {\n  const user = await step(fetchUser('123'));\n\n  // Generate new token if NOT authenticated, else use existing\n  const token = await unlessOr(\n    user.isAuthenticated,\n    () => step(generateNewToken(user.id)),\n    user.existingToken, // default\n    { name: 'token-generation', reason: 'Using existing token' }\n  );\n\n  return { user, token };\n});\n```\n\n## Event emission\n\nConditional helpers automatically emit `step_skipped` events when steps are skipped:\n\n```typescript\nconst workflow = createWorkflow({ fetchUser }, {\n  onEvent: (event) => {\n    if (event.type === 'step_skipped') {\n      console.log(`Step ${event.name} skipped: ${event.reason}`);\n      // event.decisionId - unique ID for this decision\n    }\n  }\n});\n```\n\n## With workflow context\n\nUse `createConditionalHelpers` to bind helpers to workflow context for automatic event emission:\n\n```typescript\nimport { createConditionalHelpers } from '@jagreehal/workflow';\n\nconst workflow = createWorkflow({ fetchUser }, {\n  onEvent: (event, ctx) => {\n    // ctx is available here\n  }\n});\n\nconst result = await workflow(async (step, deps, args, ctx) => {\n  // Create bound helpers\n  const { when, whenOr } = createConditionalHelpers({\n    workflowId: ctx.workflowId,\n    onEvent: (e) => {\n      // Events automatically include context\n    },\n    context: ctx\n  });\n\n  const user = await step(fetchUser('123'));\n\n  // Helpers automatically emit events with context\n  const premium = await when(\n    user.isPremium,\n    () => step(fetchPremiumData(user.id)),\n    { name: 'premium-data' }\n  );\n\n  return { user, premium };\n});\n```\n\n## With run()\n\nWhen using `run()`, pass context manually:\n\n```typescript\nimport { run } from '@jagreehal/workflow';\nimport { createConditionalHelpers } from '@jagreehal/workflow';\n\nconst result = await run(async (step) => {\n  const ctx = {\n    workflowId: 'workflow-123',\n    onEvent: (event) => {\n      // Handle events\n    },\n    context: { requestId: 'req-456' }\n  };\n\n  const { when } = createConditionalHelpers(ctx);\n\n  const user = await step(fetchUser('123'));\n\n  const premium = await when(\n    user.isPremium,\n    () => step(fetchPremiumData(user.id)),\n    { name: 'premium-data' }\n  );\n\n  return { user, premium };\n}, {\n  onEvent: ctx.onEvent,\n  workflowId: ctx.workflowId,\n  context: ctx.context\n});\n```\n\n## Options\n\nAll conditional helpers accept an optional `ConditionalOptions` object:\n\n```typescript\n{\n  name?: string;      // Human-readable name for the step\n  key?: string;       // Stable identity key for caching/tracking\n  reason?: string;    // Explanation for why step was skipped\n}\n```\n\n## Visualization\n\nSkipped steps appear in workflow visualizations:\n\n```typescript\nimport { createVisualizer } from '@jagreehal/workflow/visualize';\n\nconst viz = createVisualizer();\nconst workflow = createWorkflow(deps, { onEvent: viz.handleEvent });\n\nawait workflow(async (step) => {\n  const user = await step(fetchUser('123'));\n\n  await when(\n    user.isPremium,\n    () => step(fetchPremiumData(user.id)),\n    { name: 'premium-data', reason: 'Not premium' }\n  );\n\n  return user;\n});\n\nconsole.log(viz.render());\n// Shows skipped step with reason\n```\n\n## Real-world example\n\n```typescript\nconst processOrder = createWorkflow({ fetchOrder, chargeCard, sendEmail, applyDiscount });\n\nconst result = await processOrder(async (step) => {\n  const order = await step(fetchOrder(orderId));\n\n  // Apply discount only if order is large enough\n  const discount = await whenOr(\n    order.total > 100,\n    () => step(applyDiscount(order.id, 'BULK_10')),\n    0, // no discount\n    { name: 'apply-discount', reason: 'Order too small for discount' }\n  );\n\n  // Charge card\n  const payment = await step(chargeCard(order.total - discount));\n\n  // Send confirmation email only if payment succeeded\n  await when(\n    payment.status === 'succeeded',\n    () => step(sendEmail(order.email, 'Order confirmed')),\n    { name: 'send-confirmation', reason: 'Payment failed' }\n  );\n\n  return { order, payment, discount };\n});\n```\n\n## Next\n\n[Learn about Testing →](/workflow/guides/testing/)","src/content/docs/guides/conditional-execution.md","b9bd53e20baa3bec",{"html":704,"metadata":705},"\u003Cp>Execute steps only when certain conditions are met, with automatic event emission for skipped steps.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"basic-usage\">Basic usage\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#basic-usage\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Basic usage”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">when\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">unless\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">User\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> sendEmail\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">to\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\">void\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'SEND_FAILED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ fetchUser, sendEmail });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Only send email if user is not verified\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> when\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">    !\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">isVerified\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">sendEmail\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">email\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'send-verification'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'User is already verified'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> user;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { when, unless, createWorkflow, ok, err, type AsyncResult } from &#x27;@jagreehal/workflow&#x27;;\n\nconst fetchUser = async (id: string): AsyncResult\u003CUser, &#x27;NOT_FOUND&#x27;> => {\n  // ...\n};\n\nconst sendEmail = async (to: string): AsyncResult\u003Cvoid, &#x27;SEND_FAILED&#x27;> => {\n  // ...\n};\n\nconst workflow = createWorkflow({ fetchUser, sendEmail });\n\nconst result = await workflow(async (step) => {\n  const user = await step(fetchUser(&#x27;123&#x27;));\n\n  // Only send email if user is not verified\n  await when(\n    !user.isVerified,\n    () => step(sendEmail(user.email)),\n    { name: &#x27;send-verification&#x27;, reason: &#x27;User is already verified&#x27; }\n  );\n\n  return user;\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"when---execute-if-condition-is-true\">when - Execute if condition is true\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#when---execute-if-condition-is-true\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “when - Execute if condition is true”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Run a step only when a condition is true. Returns \u003Ccode dir=\"auto\">undefined\u003C/code> if skipped.\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Only fetch premium data if user is premium\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> premium\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> when\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">isPremium\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchPremiumData\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'premium-data'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'User is not premium'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { user, premium }; \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// premium is User | undefined\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await workflow(async (step) => {\n  const user = await step(fetchUser(&#x27;123&#x27;));\n\n  // Only fetch premium data if user is premium\n  const premium = await when(\n    user.isPremium,\n    () => step(fetchPremiumData(user.id)),\n    { name: &#x27;premium-data&#x27;, reason: &#x27;User is not premium&#x27; }\n  );\n\n  return { user, premium }; // premium is User | undefined\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"unless---execute-if-condition-is-false\">unless - Execute if condition is false\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#unless---execute-if-condition-is-false\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “unless - Execute if condition is false”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Run a step only when a condition is false. Returns \u003Ccode dir=\"auto\">undefined\u003C/code> if skipped.\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Only send verification email if user is NOT verified\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> email\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> unless\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">isVerified\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">sendVerificationEmail\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">email\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'send-verification'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'User is already verified'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { user, email }; \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// email is void | undefined\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await workflow(async (step) => {\n  const user = await step(fetchUser(&#x27;123&#x27;));\n\n  // Only send verification email if user is NOT verified\n  const email = await unless(\n    user.isVerified,\n    () => step(sendVerificationEmail(user.email)),\n    { name: &#x27;send-verification&#x27;, reason: &#x27;User is already verified&#x27; }\n  );\n\n  return { user, email }; // email is void | undefined\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"whenor---execute-if-true-else-return-default\">whenOr - Execute if true, else return default\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#whenor---execute-if-true-else-return-default\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “whenOr - Execute if true, else return default”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Run a step if condition is true, otherwise return a default value.\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Get premium limits or use default for non-premium users\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> limits\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> whenOr\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">isPremium\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchPremiumLimits\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">maxRequests\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 100\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">maxStorage\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 1000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }, \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// default\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'premium-limits'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Using default limits'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { user, limits }; \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// limits is PremiumLimits | DefaultLimits\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await workflow(async (step) => {\n  const user = await step(fetchUser(&#x27;123&#x27;));\n\n  // Get premium limits or use default for non-premium users\n  const limits = await whenOr(\n    user.isPremium,\n    () => step(fetchPremiumLimits(user.id)),\n    { maxRequests: 100, maxStorage: 1000 }, // default\n    { name: &#x27;premium-limits&#x27;, reason: &#x27;Using default limits&#x27; }\n  );\n\n  return { user, limits }; // limits is PremiumLimits | DefaultLimits\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"unlessor---execute-if-false-else-return-default\">unlessOr - Execute if false, else return default\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#unlessor---execute-if-false-else-return-default\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “unlessOr - Execute if false, else return default”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Run a step if condition is false, otherwise return a default value.\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Generate new token if NOT authenticated, else use existing\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> token\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> unlessOr\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">isAuthenticated\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">generateNewToken\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">existingToken\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// default\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'token-generation'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Using existing token'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { user, token };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await workflow(async (step) => {\n  const user = await step(fetchUser(&#x27;123&#x27;));\n\n  // Generate new token if NOT authenticated, else use existing\n  const token = await unlessOr(\n    user.isAuthenticated,\n    () => step(generateNewToken(user.id)),\n    user.existingToken, // default\n    { name: &#x27;token-generation&#x27;, reason: &#x27;Using existing token&#x27; }\n  );\n\n  return { user, token };\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"event-emission\">Event emission\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#event-emission\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Event emission”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Conditional helpers automatically emit \u003Ccode dir=\"auto\">step_skipped\u003C/code> events when steps are skipped:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ fetchUser }, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">event\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (event.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">type\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> ===\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'step_skipped'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`Step \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">event\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> skipped: \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">event\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">      // event.decisionId - unique ID for this decision\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const workflow = createWorkflow({ fetchUser }, {\n  onEvent: (event) => {\n    if (event.type === &#x27;step_skipped&#x27;) {\n      console.log(&#x60;Step ${event.name} skipped: ${event.reason}&#x60;);\n      // event.decisionId - unique ID for this decision\n    }\n  }\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"with-workflow-context\">With workflow context\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#with-workflow-context\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “With workflow context”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">createConditionalHelpers\u003C/code> to bind helpers to workflow context for automatic event emission:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createConditionalHelpers\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ fetchUser }, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">event\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">ctx\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">    // ctx is available here\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">deps\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">args\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">ctx\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Create bound helpers\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">when\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">whenOr\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">=\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createConditionalHelpers\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    workflowId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> ctx.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">workflowId\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">e\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">      // Events automatically include context\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    context\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> ctx\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Helpers automatically emit events with context\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> premium\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> when\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">isPremium\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchPremiumData\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'premium-data'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { user, premium };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createConditionalHelpers } from &#x27;@jagreehal/workflow&#x27;;\n\nconst workflow = createWorkflow({ fetchUser }, {\n  onEvent: (event, ctx) => {\n    // ctx is available here\n  }\n});\n\nconst result = await workflow(async (step, deps, args, ctx) => {\n  // Create bound helpers\n  const { when, whenOr } = createConditionalHelpers({\n    workflowId: ctx.workflowId,\n    onEvent: (e) => {\n      // Events automatically include context\n    },\n    context: ctx\n  });\n\n  const user = await step(fetchUser(&#x27;123&#x27;));\n\n  // Helpers automatically emit events with context\n  const premium = await when(\n    user.isPremium,\n    () => step(fetchPremiumData(user.id)),\n    { name: &#x27;premium-data&#x27; }\n  );\n\n  return { user, premium };\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"with-run\">With run()\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#with-run\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “With run()”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>When using \u003Ccode dir=\"auto\">run()\u003C/code>, pass context manually:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">run\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createConditionalHelpers\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> run\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> ctx\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    workflowId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'workflow-123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">event\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">      // Handle events\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    context\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">requestId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'req-456'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">when\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">=\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createConditionalHelpers\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(ctx);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> premium\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> when\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">isPremium\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchPremiumData\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'premium-data'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { user, premium };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> ctx.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  workflowId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> ctx.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">workflowId\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  context\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> ctx.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">context\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { run } from &#x27;@jagreehal/workflow&#x27;;\nimport { createConditionalHelpers } from &#x27;@jagreehal/workflow&#x27;;\n\nconst result = await run(async (step) => {\n  const ctx = {\n    workflowId: &#x27;workflow-123&#x27;,\n    onEvent: (event) => {\n      // Handle events\n    },\n    context: { requestId: &#x27;req-456&#x27; }\n  };\n\n  const { when } = createConditionalHelpers(ctx);\n\n  const user = await step(fetchUser(&#x27;123&#x27;));\n\n  const premium = await when(\n    user.isPremium,\n    () => step(fetchPremiumData(user.id)),\n    { name: &#x27;premium-data&#x27; }\n  );\n\n  return { user, premium };\n}, {\n  onEvent: ctx.onEvent,\n  workflowId: ctx.workflowId,\n  context: ctx.context\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"options\">Options\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#options\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Options”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>All conditional helpers accept an optional \u003Ccode dir=\"auto\">ConditionalOptions\u003C/code> object:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> string;      \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Human-readable name for the step\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> string;       \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Stable identity key for caching/tracking\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  reason\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> string;    \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Explanation for why step was skipped\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"{\n  name?: string;      // Human-readable name for the step\n  key?: string;       // Stable identity key for caching/tracking\n  reason?: string;    // Explanation for why step was skipped\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"visualization\">Visualization\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#visualization\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Visualization”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Skipped steps appear in workflow visualizations:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createVisualizer\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/visualize'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> viz\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createVisualizer\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> viz.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> when\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">isPremium\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchPremiumData\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'premium-data'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Not premium'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> user;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(viz.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">render\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Shows skipped step with reason\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createVisualizer } from &#x27;@jagreehal/workflow/visualize&#x27;;\n\nconst viz = createVisualizer();\nconst workflow = createWorkflow(deps, { onEvent: viz.handleEvent });\n\nawait workflow(async (step) => {\n  const user = await step(fetchUser(&#x27;123&#x27;));\n\n  await when(\n    user.isPremium,\n    () => step(fetchPremiumData(user.id)),\n    { name: &#x27;premium-data&#x27;, reason: &#x27;Not premium&#x27; }\n  );\n\n  return user;\n});\n\nconsole.log(viz.render());\n// Shows skipped step with reason\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"real-world-example\">Real-world example\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#real-world-example\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Real-world example”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> processOrder\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ fetchOrder, chargeCard, sendEmail, applyDiscount });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> processOrder\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> order\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchOrder\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(orderId));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Apply discount only if order is large enough\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> discount\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> whenOr\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    order.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">total\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> >\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 100\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">applyDiscount\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(order.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'BULK_10'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">    0\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// no discount\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'apply-discount'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Order too small for discount'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Charge card\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> payment\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">chargeCard\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(order.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">total\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> -\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> discount));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Send confirmation email only if payment succeeded\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> when\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    payment.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> ===\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'succeeded'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">sendEmail\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(order.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">email\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Order confirmed'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'send-confirmation'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Payment failed'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { order, payment, discount };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const processOrder = createWorkflow({ fetchOrder, chargeCard, sendEmail, applyDiscount });\n\nconst result = await processOrder(async (step) => {\n  const order = await step(fetchOrder(orderId));\n\n  // Apply discount only if order is large enough\n  const discount = await whenOr(\n    order.total > 100,\n    () => step(applyDiscount(order.id, &#x27;BULK_10&#x27;)),\n    0, // no discount\n    { name: &#x27;apply-discount&#x27;, reason: &#x27;Order too small for discount&#x27; }\n  );\n\n  // Charge card\n  const payment = await step(chargeCard(order.total - discount));\n\n  // Send confirmation email only if payment succeeded\n  await when(\n    payment.status === &#x27;succeeded&#x27;,\n    () => step(sendEmail(order.email, &#x27;Order confirmed&#x27;)),\n    { name: &#x27;send-confirmation&#x27;, reason: &#x27;Payment failed&#x27; }\n  );\n\n  return { order, payment, discount };\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/workflow/guides/testing/\">Learn about Testing →\u003C/a>\u003C/p>",{"headings":706,"localImagePaths":737,"remoteImagePaths":738,"frontmatter":739,"imagePaths":740},[707,708,711,714,717,720,723,726,729,732,735,736],{"depth":57,"slug":58,"text":59},{"depth":57,"slug":709,"text":710},"when---execute-if-condition-is-true","when - Execute if condition is true",{"depth":57,"slug":712,"text":713},"unless---execute-if-condition-is-false","unless - Execute if condition is false",{"depth":57,"slug":715,"text":716},"whenor---execute-if-true-else-return-default","whenOr - Execute if true, else return default",{"depth":57,"slug":718,"text":719},"unlessor---execute-if-false-else-return-default","unlessOr - Execute if false, else return default",{"depth":57,"slug":721,"text":722},"event-emission","Event emission",{"depth":57,"slug":724,"text":725},"with-workflow-context","With workflow context",{"depth":57,"slug":727,"text":728},"with-run","With run()",{"depth":57,"slug":730,"text":731},"options","Options",{"depth":57,"slug":733,"text":734},"visualization","Visualization",{"depth":57,"slug":511,"text":512},{"depth":57,"slug":384,"text":385},[],[],{"title":695,"description":696},[],"getting-started/installation",{"id":741,"data":743,"body":749,"filePath":750,"digest":751,"rendered":752},{"title":744,"description":745,"editUrl":16,"head":746,"template":46,"sidebar":747,"pagefind":16,"draft":35},"Installation","Install @jagreehal/workflow and set up your project",[],{"hidden":35,"attrs":748},{},"## Install the package\n\n```bash\nnpm install @jagreehal/workflow\n```\n\nOr with your preferred package manager:\n\n```bash\npnpm add @jagreehal/workflow\nyarn add @jagreehal/workflow\n```\n\n## TypeScript configuration\n\nThe library requires TypeScript 4.7 or later. Enable strict mode for best results:\n\n```json\n{\n  \"compilerOptions\": {\n    \"strict\": true,\n    \"moduleResolution\": \"bundler\"\n  }\n}\n```\n\n## Import paths\n\nImport from the main entry point:\n\n```typescript\nimport { createWorkflow, ok, err, type AsyncResult } from '@jagreehal/workflow';\n```\n\nOr use tree-shakable imports for smaller bundles:\n\n```typescript\n// Core Result types only (~3KB)\nimport { ok, err, map, andThen } from '@jagreehal/workflow/core';\n\n// Workflow features (~8KB)\nimport { createWorkflow, run } from '@jagreehal/workflow/workflow';\n\n// Visualization (~5KB)\nimport { createVisualizer } from '@jagreehal/workflow/visualize';\n\n// Batch processing (~2KB)\nimport { processInBatches } from '@jagreehal/workflow/batch';\n\n// Resource management (~1KB)\nimport { withScope, createResource } from '@jagreehal/workflow/resource';\n```\n\n## Verify installation\n\nCreate a file and run it to verify everything works:\n\n```typescript\n// test.ts\nimport { ok, err, type AsyncResult } from '@jagreehal/workflow';\n\nconst divide = (a: number, b: number): AsyncResult\u003Cnumber, 'DIVIDE_BY_ZERO'> =>\n  b === 0 ? err('DIVIDE_BY_ZERO') : ok(a / b);\n\nconst result = await divide(10, 2);\n\nif (result.ok) {\n  console.log('Result:', result.value); // Result: 5\n} else {\n  console.log('Error:', result.error);\n}\n```\n\n```bash\nnpx tsx test.ts\n```\n\n## Next\n\n[Build your first workflow →](/workflow/getting-started/first-workflow/)","src/content/docs/getting-started/installation.md","af0d14e7e40f44cb",{"html":753,"metadata":754},"\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"install-the-package\">Install the package\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#install-the-package\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Install the package”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#F69D50\">npm\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> install\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> @jagreehal/workflow\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"npm install @jagreehal/workflow\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>Or with your preferred package manager:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#F69D50\">pnpm\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> add\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> @jagreehal/workflow\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#F69D50\">yarn\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> add\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> @jagreehal/workflow\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"pnpm add @jagreehal/workflow\nyarn add @jagreehal/workflow\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"typescript-configuration\">TypeScript configuration\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#typescript-configuration\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “TypeScript configuration”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>The library requires TypeScript 4.7 or later. Enable strict mode for best results:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"json\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#8DDB8C\">  \"compilerOptions\"\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#8DDB8C\">    \"strict\"\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\">true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#8DDB8C\">    \"moduleResolution\"\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">\"bundler\"\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"{\n  &#x22;compilerOptions&#x22;: {\n    &#x22;strict&#x22;: true,\n    &#x22;moduleResolution&#x22;: &#x22;bundler&#x22;\n  }\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"import-paths\">Import paths\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#import-paths\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Import paths”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Import from the main entry point:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createWorkflow, ok, err, type AsyncResult } from &#x27;@jagreehal/workflow&#x27;;\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>Or use tree-shakable imports for smaller bundles:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Core Result types only (~3KB)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">map\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">andThen\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/core'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Workflow features (~8KB)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">run\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Visualization (~5KB)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createVisualizer\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/visualize'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Batch processing (~2KB)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">processInBatches\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/batch'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Resource management (~1KB)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">withScope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createResource\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/resource'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"// Core Result types only (~3KB)\nimport { ok, err, map, andThen } from &#x27;@jagreehal/workflow/core&#x27;;\n\n// Workflow features (~8KB)\nimport { createWorkflow, run } from &#x27;@jagreehal/workflow/workflow&#x27;;\n\n// Visualization (~5KB)\nimport { createVisualizer } from &#x27;@jagreehal/workflow/visualize&#x27;;\n\n// Batch processing (~2KB)\nimport { processInBatches } from &#x27;@jagreehal/workflow/batch&#x27;;\n\n// Resource management (~1KB)\nimport { withScope, createResource } from &#x27;@jagreehal/workflow/resource&#x27;;\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"verify-installation\">Verify installation\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#verify-installation\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Verify installation”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Create a file and run it to verify everything works:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// test.ts\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> divide\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">a\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> number\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">b\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> number\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\">number\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'DIVIDE_BY_ZERO'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  b \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">===\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 0\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> ?\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'DIVIDE_BY_ZERO'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(a \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">/\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> b);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> divide\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">10\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">2\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Result:'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">); \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Result: 5\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">} \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">else\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Error:'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"// test.ts\nimport { ok, err, type AsyncResult } from &#x27;@jagreehal/workflow&#x27;;\n\nconst divide = (a: number, b: number): AsyncResult\u003Cnumber, &#x27;DIVIDE_BY_ZERO&#x27;> =>\n  b === 0 ? err(&#x27;DIVIDE_BY_ZERO&#x27;) : ok(a / b);\n\nconst result = await divide(10, 2);\n\nif (result.ok) {\n  console.log(&#x27;Result:&#x27;, result.value); // Result: 5\n} else {\n  console.log(&#x27;Error:&#x27;, result.error);\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"bash\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#F69D50\">npx\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> tsx\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> test.ts\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"npx tsx test.ts\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/workflow/getting-started/first-workflow/\">Build your first workflow →\u003C/a>\u003C/p>",{"headings":755,"localImagePaths":769,"remoteImagePaths":770,"frontmatter":771,"imagePaths":772},[756,759,762,765,768],{"depth":57,"slug":757,"text":758},"install-the-package","Install the package",{"depth":57,"slug":760,"text":761},"typescript-configuration","TypeScript configuration",{"depth":57,"slug":763,"text":764},"import-paths","Import paths",{"depth":57,"slug":766,"text":767},"verify-installation","Verify installation",{"depth":57,"slug":384,"text":385},[],[],{"title":744,"description":745},[],"guides/caching",{"id":773,"data":775,"body":781,"filePath":782,"digest":783,"rendered":784},{"title":776,"description":777,"editUrl":16,"head":778,"template":46,"sidebar":779,"pagefind":16,"draft":35},"Caching","Cache step results to avoid duplicate work",[],{"hidden":35,"attrs":780},{},"Cache step results so they don't re-execute if the workflow runs again.\n\n## Enable caching\n\nPass a cache to the workflow:\n\n```typescript\nconst workflow = createWorkflow(deps, {\n  cache: new Map(),\n});\n```\n\n## Use keys to cache steps\n\nGive steps a `key` to enable caching:\n\n```typescript\nconst result = await workflow(async (step) => {\n  // This step is cached with key 'user:1'\n  const user = await step(() => fetchUser('1'), { key: 'user:1' });\n\n  // Subsequent calls with same key return cached value\n  const sameUser = await step(() => fetchUser('1'), { key: 'user:1' });\n\n  return user;\n});\n```\n\n## Key requirements\n\nKeys must be:\n- **Unique per step**: Different steps need different keys\n- **Stable**: Same input should produce same key\n- **Deterministic**: Don't use timestamps or random values\n\n```typescript\n// Good keys\n{ key: 'user:123' }\n{ key: `posts:${userId}` }\n{ key: `order:${orderId}:validate` }\n\n// Bad keys\n{ key: `user:${Date.now()}` }  // Changes every call\n{ key: `user:${Math.random()}` } // Random\n```\n\n## Thunks required for caching\n\nPass a function, not the result of calling the function:\n\n```typescript\n// Without thunk - executes immediately, caching ignored\nconst user = await step(fetchUser('1'), { key: 'user:1' });\n\n// With thunk - can be cached\nconst user = await step(() => fetchUser('1'), { key: 'user:1' });\n```\n\n## Cache scope\n\nThe cache persists across workflow runs:\n\n```typescript\nconst cache = new Map();\nconst workflow = createWorkflow(deps, { cache });\n\n// First run - fetches user\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser('1'), { key: 'user:1' });\n  return user;\n});\n\n// Second run - uses cached value\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser('1'), { key: 'user:1' });\n  return user; // No fetch - returns cached value\n});\n```\n\n## Clearing the cache\n\nClear specific keys or the entire cache:\n\n```typescript\nconst cache = new Map();\n\n// Clear one key\ncache.delete('user:1');\n\n// Clear all\ncache.clear();\n```\n\n## Custom cache implementations\n\nAny object with Map-like `get`, `set`, `has`, `delete` methods works:\n\n```typescript\n// Redis-backed cache\nconst redisCache = {\n  async get(key: string) {\n    const value = await redis.get(key);\n    return value ? JSON.parse(value) : undefined;\n  },\n  async set(key: string, value: unknown) {\n    await redis.set(key, JSON.stringify(value));\n  },\n  async has(key: string) {\n    return await redis.exists(key) > 0;\n  },\n  async delete(key: string) {\n    return await redis.del(key) > 0;\n  },\n};\n\nconst workflow = createWorkflow(deps, { cache: redisCache });\n```\n\n## Caching and errors\n\nErrors are cached by default. If a step fails, subsequent runs return the same error:\n\n```typescript\n// First run - fetchUser returns err('NOT_FOUND')\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser('999'), { key: 'user:999' });\n  return user;\n});\n// result.error === 'NOT_FOUND'\n\n// Second run - returns cached error, no fetch\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser('999'), { key: 'user:999' });\n  return user;\n});\n// result.error === 'NOT_FOUND' (from cache)\n```\n\nTo retry on error, clear the cache key first.\n\n## When to use caching\n\n| Use case | Caching helps |\n|----------|--------------|\n| Idempotent operations | Yes - payments, API calls |\n| Resume after crash | Yes - completed steps skipped |\n| Expensive computations | Yes - don't recompute |\n| Time-sensitive data | No - data may be stale |\n| Non-idempotent operations | Careful - may cause issues |\n\n## Next\n\n[Learn about Persistence →](/workflow/guides/persistence/)","src/content/docs/guides/caching.md","f19654aa7b5574d8",{"html":785,"metadata":786},"\u003Cp>Cache step results so they don’t re-execute if the workflow runs again.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"enable-caching\">Enable caching\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#enable-caching\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Enable caching”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Pass a cache to the workflow:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  cache\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> new\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> Map\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const workflow = createWorkflow(deps, {\n  cache: new Map(),\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"use-keys-to-cache-steps\">Use keys to cache steps\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#use-keys-to-cache-steps\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Use keys to cache steps”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Give steps a \u003Ccode dir=\"auto\">key\u003C/code> to enable caching:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // This step is cached with key 'user:1'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'user:1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Subsequent calls with same key return cached value\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> sameUser\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'user:1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> user;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await workflow(async (step) => {\n  // This step is cached with key &#x27;user:1&#x27;\n  const user = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });\n\n  // Subsequent calls with same key return cached value\n  const sameUser = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });\n\n  return user;\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"key-requirements\">Key requirements\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#key-requirements\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Key requirements”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Keys must be:\u003C/p>\n\u003Cul>\n\u003Cli>\u003Cstrong>Unique per step\u003C/strong>: Different steps need different keys\u003C/li>\n\u003Cli>\u003Cstrong>Stable\u003C/strong>: Same input should produce same key\u003C/li>\n\u003Cli>\u003Cstrong>Deterministic\u003C/strong>: Don’t use timestamps or random values\u003C/li>\n\u003C/ul>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Good keys\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">{ \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">key\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'user:123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">{ \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">key\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`posts:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">userId\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">{ \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">key\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`order:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">orderId\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">:validate`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Bad keys\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">{ \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">key\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`user:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">Date\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">now\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#96D0FF\">()\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Changes every call\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">{ \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">key\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`user:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">Math\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">random\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#96D0FF\">()\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Random\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"// Good keys\n{ key: &#x27;user:123&#x27; }\n{ key: &#x60;posts:${userId}&#x60; }\n{ key: &#x60;order:${orderId}:validate&#x60; }\n\n// Bad keys\n{ key: &#x60;user:${Date.now()}&#x60; }  // Changes every call\n{ key: &#x60;user:${Math.random()}&#x60; } // Random\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"thunks-required-for-caching\">Thunks required for caching\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#thunks-required-for-caching\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Thunks required for caching”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Pass a function, not the result of calling the function:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Without thunk - executes immediately, caching ignored\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'user:1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// With thunk - can be cached\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'user:1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"// Without thunk - executes immediately, caching ignored\nconst user = await step(fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });\n\n// With thunk - can be cached\nconst user = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"cache-scope\">Cache scope\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#cache-scope\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Cache scope”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>The cache persists across workflow runs:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> cache\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> new\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> Map\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, { cache });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// First run - fetches user\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'user:1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> user;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Second run - uses cached value\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'user:1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> user; \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// No fetch - returns cached value\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const cache = new Map();\nconst workflow = createWorkflow(deps, { cache });\n\n// First run - fetches user\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });\n  return user;\n});\n\n// Second run - uses cached value\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });\n  return user; // No fetch - returns cached value\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"clearing-the-cache\">Clearing the cache\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#clearing-the-cache\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Clearing the cache”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Clear specific keys or the entire cache:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> cache\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> new\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> Map\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Clear one key\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">cache.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">delete\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'user:1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Clear all\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">cache.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">clear\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const cache = new Map();\n\n// Clear one key\ncache.delete(&#x27;user:1&#x27;);\n\n// Clear all\ncache.clear();\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"custom-cache-implementations\">Custom cache implementations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#custom-cache-implementations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Custom cache implementations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Any object with Map-like \u003Ccode dir=\"auto\">get\u003C/code>, \u003Ccode dir=\"auto\">set\u003C/code>, \u003Ccode dir=\"auto\">has\u003C/code>, \u003Ccode dir=\"auto\">delete\u003C/code> methods works:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Redis-backed cache\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> redisCache\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  async\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> get\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> value\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> redis.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">get\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(key);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> value \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> JSON\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">parse\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(value) \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> undefined\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  async\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> set\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">value\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> unknown\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> redis.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">set\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(key, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">JSON\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">stringify\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(value));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  async\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> has\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> redis.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">exists\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(key) \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 0\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  async\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> delete\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> redis.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">del\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(key) \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 0\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">cache\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> redisCache });\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"// Redis-backed cache\nconst redisCache = {\n  async get(key: string) {\n    const value = await redis.get(key);\n    return value ? JSON.parse(value) : undefined;\n  },\n  async set(key: string, value: unknown) {\n    await redis.set(key, JSON.stringify(value));\n  },\n  async has(key: string) {\n    return await redis.exists(key) > 0;\n  },\n  async delete(key: string) {\n    return await redis.del(key) > 0;\n  },\n};\n\nconst workflow = createWorkflow(deps, { cache: redisCache });\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"caching-and-errors\">Caching and errors\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#caching-and-errors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Caching and errors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Errors are cached by default. If a step fails, subsequent runs return the same error:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// First run - fetchUser returns err('NOT_FOUND')\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'999'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'user:999'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> user;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// result.error === 'NOT_FOUND'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Second run - returns cached error, no fetch\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'999'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'user:999'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> user;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// result.error === 'NOT_FOUND' (from cache)\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"// First run - fetchUser returns err(&#x27;NOT_FOUND&#x27;)\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser(&#x27;999&#x27;), { key: &#x27;user:999&#x27; });\n  return user;\n});\n// result.error === &#x27;NOT_FOUND&#x27;\n\n// Second run - returns cached error, no fetch\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser(&#x27;999&#x27;), { key: &#x27;user:999&#x27; });\n  return user;\n});\n// result.error === &#x27;NOT_FOUND&#x27; (from cache)\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>To retry on error, clear the cache key first.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"when-to-use-caching\">When to use caching\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#when-to-use-caching\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “When to use caching”\u003C/span>\u003C/a>\u003C/div>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\u003Ctable>\u003Cthead>\u003Ctr>\u003Cth>Use case\u003C/th>\u003Cth>Caching helps\u003C/th>\u003C/tr>\u003C/thead>\u003Ctbody>\u003Ctr>\u003Ctd>Idempotent operations\u003C/td>\u003Ctd>Yes - payments, API calls\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Resume after crash\u003C/td>\u003Ctd>Yes - completed steps skipped\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Expensive computations\u003C/td>\u003Ctd>Yes - don’t recompute\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Time-sensitive data\u003C/td>\u003Ctd>No - data may be stale\u003C/td>\u003C/tr>\u003Ctr>\u003Ctd>Non-idempotent operations\u003C/td>\u003Ctd>Careful - may cause issues\u003C/td>\u003C/tr>\u003C/tbody>\u003C/table>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/workflow/guides/persistence/\">Learn about Persistence →\u003C/a>\u003C/p>",{"headings":787,"localImagePaths":816,"remoteImagePaths":817,"frontmatter":818,"imagePaths":819},[788,791,794,797,800,803,806,809,812,815],{"depth":57,"slug":789,"text":790},"enable-caching","Enable caching",{"depth":57,"slug":792,"text":793},"use-keys-to-cache-steps","Use keys to cache steps",{"depth":57,"slug":795,"text":796},"key-requirements","Key requirements",{"depth":57,"slug":798,"text":799},"thunks-required-for-caching","Thunks required for caching",{"depth":57,"slug":801,"text":802},"cache-scope","Cache scope",{"depth":57,"slug":804,"text":805},"clearing-the-cache","Clearing the cache",{"depth":57,"slug":807,"text":808},"custom-cache-implementations","Custom cache implementations",{"depth":57,"slug":810,"text":811},"caching-and-errors","Caching and errors",{"depth":57,"slug":813,"text":814},"when-to-use-caching","When to use caching",{"depth":57,"slug":384,"text":385},[],[],{"title":776,"description":777},[],"guides/retries-timeouts",{"id":820,"data":822,"body":828,"filePath":829,"digest":830,"rendered":831},{"title":823,"description":824,"editUrl":16,"head":825,"template":46,"sidebar":826,"pagefind":16,"draft":35},"Retries & Timeouts","Add resilience to workflow steps",[],{"hidden":35,"attrs":827},{},"Add retries and timeouts to individual steps without wrapping your entire workflow in try/catch.\n\n## Timeouts\n\nLimit how long a step can run:\n\n```typescript\nconst data = await step.withTimeout(\n  () => slowOperation(),\n  { ms: 5000 }\n);\n```\n\n### With name for debugging\n\n```typescript\nconst data = await step.withTimeout(\n  () => slowOperation(),\n  { ms: 5000, name: 'Slow operation' }\n);\n```\n\nIf it times out, you get a `StepTimeoutError` with the name.\n\n### Checking for timeout errors\n\n```typescript\nimport { isStepTimeoutError, getStepTimeoutMeta } from '@jagreehal/workflow';\n\nif (!result.ok && isStepTimeoutError(result.error)) {\n  const meta = getStepTimeoutMeta(result.error);\n  console.log(`${meta.name} timed out after ${meta.ms}ms`);\n}\n```\n\n## Retries\n\nRetry failed steps with configurable backoff:\n\n```typescript\nconst data = await step.retry(\n  () => fetchData(),\n  { attempts: 3 }\n);\n```\n\n### Backoff strategies\n\n```typescript\n// Fixed: same delay every time\n{ attempts: 3, backoff: 'fixed', delayMs: 100 }\n// Delays: 100ms, 100ms, 100ms\n\n// Linear: delay increases linearly\n{ attempts: 3, backoff: 'linear', delayMs: 100 }\n// Delays: 100ms, 200ms, 300ms\n\n// Exponential: delay doubles each time\n{ attempts: 3, backoff: 'exponential', delayMs: 100 }\n// Delays: 100ms, 200ms, 400ms\n```\n\n### Cap the delay\n\n```typescript\n{\n  attempts: 10,\n  backoff: 'exponential',\n  delayMs: 100,\n  maxDelayMs: 5000, // Never wait more than 5 seconds\n}\n```\n\n### Add jitter\n\nRandomize delays to avoid thundering herd:\n\n```typescript\n{\n  attempts: 3,\n  backoff: 'exponential',\n  delayMs: 100,\n  jitter: true, // Add random variation\n}\n```\n\n### Conditional retry\n\nOnly retry certain errors:\n\n```typescript\nconst user = await step.retry(\n  () => fetchUser('1'),\n  {\n    attempts: 3,\n    backoff: 'exponential',\n    retryOn: (error) => {\n      // Don't retry NOT_FOUND - the user doesn't exist\n      if (error === 'NOT_FOUND') return false;\n      // Retry everything else\n      return true;\n    },\n  }\n);\n```\n\n## Combining retry and timeout\n\nEach attempt has its own timeout:\n\n```typescript\nconst data = await step.retry(\n  () => step.withTimeout(() => fetchData(), { ms: 2000 }),\n  { attempts: 3, backoff: 'exponential' }\n);\n```\n\nThis retries up to 3 times, with each attempt limited to 2 seconds.\n\n## Via step options\n\nYou can also configure retry and timeout directly in step options:\n\n```typescript\nconst user = await step(() => fetchUser('1'), {\n  retry: {\n    attempts: 3,\n    backoff: 'exponential',\n    delayMs: 100,\n  },\n  timeout: {\n    ms: 5000,\n  },\n});\n```\n\n## Full example\n\n```typescript\nconst workflow = createWorkflow({ fetchUserFromApi, cacheUser });\n\nconst result = await workflow(async (step) => {\n  // Retry API calls with exponential backoff\n  const user = await step.retry(\n    () => step.withTimeout(\n      () => fetchUserFromApi('123'),\n      { ms: 3000, name: 'Fetch user' }\n    ),\n    {\n      attempts: 3,\n      backoff: 'exponential',\n      delayMs: 200,\n      maxDelayMs: 2000,\n      retryOn: (error) => error !== 'NOT_FOUND',\n    }\n  );\n\n  // Cache doesn't need retry\n  await step(() => cacheUser(user));\n\n  return user;\n});\n```\n\n## Next\n\n[Learn about Caching →](/workflow/guides/caching/)","src/content/docs/guides/retries-timeouts.md","d4e817cb5827b3bf",{"html":832,"metadata":833},"\u003Cp>Add retries and timeouts to individual steps without wrapping your entire workflow in try/catch.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"timeouts\">Timeouts\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#timeouts\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Timeouts”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Limit how long a step can run:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> data\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> step.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">withTimeout\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> slowOperation\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ms\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 5000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const data = await step.withTimeout(\n  () => slowOperation(),\n  { ms: 5000 }\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"with-name-for-debugging\">With name for debugging\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#with-name-for-debugging\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “With name for debugging”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> data\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> step.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">withTimeout\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> slowOperation\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ms\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 5000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Slow operation'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const data = await step.withTimeout(\n  () => slowOperation(),\n  { ms: 5000, name: &#x27;Slow operation&#x27; }\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>If it times out, you get a \u003Ccode dir=\"auto\">StepTimeoutError\u003C/code> with the name.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"checking-for-timeout-errors\">Checking for timeout errors\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#checking-for-timeout-errors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Checking for timeout errors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">isStepTimeoutError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">getStepTimeoutMeta\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> &#x26;&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> isStepTimeoutError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> meta\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> getStepTimeoutMeta\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">meta\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> timed out after \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">meta\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ms\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">ms`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { isStepTimeoutError, getStepTimeoutMeta } from &#x27;@jagreehal/workflow&#x27;;\n\nif (!result.ok &#x26;&#x26; isStepTimeoutError(result.error)) {\n  const meta = getStepTimeoutMeta(result.error);\n  console.log(&#x60;${meta.name} timed out after ${meta.ms}ms&#x60;);\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"retries\">Retries\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#retries\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Retries”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Retry failed steps with configurable backoff:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> data\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> step.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">retry\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchData\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">attempts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const data = await step.retry(\n  () => fetchData(),\n  { attempts: 3 }\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"backoff-strategies\">Backoff strategies\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#backoff-strategies\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Backoff strategies”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Fixed: same delay every time\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">{ \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">attempts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">backoff\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'fixed'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">delayMs\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">100\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Delays: 100ms, 100ms, 100ms\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Linear: delay increases linearly\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">{ \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">attempts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">backoff\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'linear'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">delayMs\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">100\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Delays: 100ms, 200ms, 300ms\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Exponential: delay doubles each time\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">{ \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">attempts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">backoff\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'exponential'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">delayMs\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">100\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Delays: 100ms, 200ms, 400ms\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"// Fixed: same delay every time\n{ attempts: 3, backoff: &#x27;fixed&#x27;, delayMs: 100 }\n// Delays: 100ms, 100ms, 100ms\n\n// Linear: delay increases linearly\n{ attempts: 3, backoff: &#x27;linear&#x27;, delayMs: 100 }\n// Delays: 100ms, 200ms, 300ms\n\n// Exponential: delay doubles each time\n{ attempts: 3, backoff: &#x27;exponential&#x27;, delayMs: 100 }\n// Delays: 100ms, 200ms, 400ms\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"cap-the-delay\">Cap the delay\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#cap-the-delay\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Cap the delay”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  attempts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">10\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  backoff\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'exponential'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  delayMs\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">100\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  maxDelayMs\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">5000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Never wait more than 5 seconds\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"{\n  attempts: 10,\n  backoff: &#x27;exponential&#x27;,\n  delayMs: 100,\n  maxDelayMs: 5000, // Never wait more than 5 seconds\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"add-jitter\">Add jitter\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#add-jitter\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Add jitter”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Randomize delays to avoid thundering herd:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">{\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  attempts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  backoff\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'exponential'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  delayMs\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">100\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  jitter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Add random variation\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"{\n  attempts: 3,\n  backoff: &#x27;exponential&#x27;,\n  delayMs: 100,\n  jitter: true, // Add random variation\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"conditional-retry\">Conditional retry\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#conditional-retry\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Conditional retry”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Only retry certain errors:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> step.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">retry\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    attempts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    backoff\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'exponential'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    retryOn\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">      // Don't retry NOT_FOUND - the user doesn't exist\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (error \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">===\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">return\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> false\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">      // Retry everything else\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      return\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const user = await step.retry(\n  () => fetchUser(&#x27;1&#x27;),\n  {\n    attempts: 3,\n    backoff: &#x27;exponential&#x27;,\n    retryOn: (error) => {\n      // Don&#x27;t retry NOT_FOUND - the user doesn&#x27;t exist\n      if (error === &#x27;NOT_FOUND&#x27;) return false;\n      // Retry everything else\n      return true;\n    },\n  }\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"combining-retry-and-timeout\">Combining retry and timeout\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#combining-retry-and-timeout\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Combining retry and timeout”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Each attempt has its own timeout:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> data\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> step.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">retry\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> step.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">withTimeout\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchData\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ms\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 2000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">attempts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">backoff\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'exponential'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const data = await step.retry(\n  () => step.withTimeout(() => fetchData(), { ms: 2000 }),\n  { attempts: 3, backoff: &#x27;exponential&#x27; }\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>This retries up to 3 times, with each attempt limited to 2 seconds.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"via-step-options\">Via step options\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#via-step-options\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Via step options”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>You can also configure retry and timeout directly in step options:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  retry\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    attempts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    backoff\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'exponential'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    delayMs\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 100\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  timeout\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    ms\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 5000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const user = await step(() => fetchUser(&#x27;1&#x27;), {\n  retry: {\n    attempts: 3,\n    backoff: &#x27;exponential&#x27;,\n    delayMs: 100,\n  },\n  timeout: {\n    ms: 5000,\n  },\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"full-example\">Full example\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#full-example\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Full example”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ fetchUserFromApi, cacheUser });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Retry API calls with exponential backoff\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> step.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">retry\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> step.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">withTimeout\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUserFromApi\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ms\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 3000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Fetch user'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    ),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      attempts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      backoff\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'exponential'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      delayMs\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 200\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      maxDelayMs\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 2000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      retryOn\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> error \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!==\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Cache doesn't need retry\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> cacheUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> user;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const workflow = createWorkflow({ fetchUserFromApi, cacheUser });\n\nconst result = await workflow(async (step) => {\n  // Retry API calls with exponential backoff\n  const user = await step.retry(\n    () => step.withTimeout(\n      () => fetchUserFromApi(&#x27;123&#x27;),\n      { ms: 3000, name: &#x27;Fetch user&#x27; }\n    ),\n    {\n      attempts: 3,\n      backoff: &#x27;exponential&#x27;,\n      delayMs: 200,\n      maxDelayMs: 2000,\n      retryOn: (error) => error !== &#x27;NOT_FOUND&#x27;,\n    }\n  );\n\n  // Cache doesn&#x27;t need retry\n  await step(() => cacheUser(user));\n\n  return user;\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/workflow/guides/caching/\">Learn about Caching →\u003C/a>\u003C/p>",{"headings":834,"localImagePaths":865,"remoteImagePaths":866,"frontmatter":867,"imagePaths":868},[835,838,841,844,847,850,853,856,859,860,863,864],{"depth":57,"slug":836,"text":837},"timeouts","Timeouts",{"depth":160,"slug":839,"text":840},"with-name-for-debugging","With name for debugging",{"depth":160,"slug":842,"text":843},"checking-for-timeout-errors","Checking for timeout errors",{"depth":57,"slug":845,"text":846},"retries","Retries",{"depth":160,"slug":848,"text":849},"backoff-strategies","Backoff strategies",{"depth":160,"slug":851,"text":852},"cap-the-delay","Cap the delay",{"depth":160,"slug":854,"text":855},"add-jitter","Add jitter",{"depth":160,"slug":857,"text":858},"conditional-retry","Conditional retry",{"depth":57,"slug":375,"text":376},{"depth":57,"slug":861,"text":862},"via-step-options","Via step options",{"depth":57,"slug":685,"text":686},{"depth":57,"slug":384,"text":385},[],[],{"title":823,"description":824},[],"guides/persistence",{"id":869,"data":871,"body":877,"filePath":878,"digest":879,"rendered":880},{"title":872,"description":873,"editUrl":16,"head":874,"template":46,"sidebar":875,"pagefind":16,"draft":35},"Persistence","Save and resume workflows across restarts",[],{"hidden":35,"attrs":876},{},"Save workflow state to a database and resume later. Completed steps return their cached results without re-executing.\n\n## Collect state during execution\n\nUse `createStepCollector` to automatically capture step results:\n\n```typescript\nimport { createWorkflow, createStepCollector } from '@jagreehal/workflow';\n\nconst collector = createStepCollector();\n\nconst workflow = createWorkflow(\n  { fetchUser, fetchPosts },\n  { onEvent: collector.handleEvent }\n);\n\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser('1'), { key: 'user:1' });\n  const posts = await step(() => fetchPosts(user.id), { key: `posts:${user.id}` });\n  return { user, posts };\n});\n\n// Get collected state\nconst state = collector.getState();\n```\n\nOnly steps with `key` are saved.\n\n## Save to database\n\nSerialize the state and store it:\n\n```typescript\nimport { stringifyState } from '@jagreehal/workflow';\n\nconst json = stringifyState(state, {\n  workflowId: 'wf-123',\n  timestamp: Date.now(),\n});\n\nawait db.workflowStates.create({\n  id: 'wf-123',\n  state: json,\n  createdAt: new Date(),\n});\n```\n\n## Resume from saved state\n\nLoad and parse the state, then pass it to a new workflow:\n\n```typescript\nimport { parseState } from '@jagreehal/workflow';\n\nconst saved = await db.workflowStates.findUnique({\n  where: { id: 'wf-123' },\n});\n\nconst resumeState = parseState(saved.state);\n\nconst workflow = createWorkflow(\n  { fetchUser, fetchPosts },\n  { resumeState }\n);\n\nawait workflow(async (step) => {\n  // These steps return cached values - no actual fetch\n  const user = await step(() => fetchUser('1'), { key: 'user:1' });\n  const posts = await step(() => fetchPosts(user.id), { key: `posts:${user.id}` });\n  return { user, posts };\n});\n```\n\n## State persistence adapter\n\nFor structured storage, use `createStatePersistence`:\n\n```typescript\nimport { createStatePersistence } from '@jagreehal/workflow';\n\nconst persistence = createStatePersistence({\n  get: (key) => redis.get(key),\n  set: (key, value) => redis.set(key, value),\n  delete: (key) => redis.del(key).then(n => n > 0),\n  exists: (key) => redis.exists(key).then(n => n > 0),\n  keys: (pattern) => redis.keys(pattern),\n}, 'workflow:state:');\n\n// Save\nawait persistence.save('wf-123', state, { userId: 'user-1' });\n\n// Load\nconst savedState = await persistence.load('wf-123');\n\n// Resume\nconst workflow = createWorkflow(deps, { resumeState: savedState });\n```\n\n## Check if step is complete\n\nUse `isStepComplete` to check state before execution:\n\n```typescript\nimport { isStepComplete } from '@jagreehal/workflow';\n\nconst state = await persistence.load('wf-123');\n\nif (isStepComplete(state, 'user:1')) {\n  console.log('User already fetched');\n}\n```\n\n## Crash recovery pattern\n\nSave state after each batch of work:\n\n```typescript\nconst collector = createStepCollector();\nconst workflow = createWorkflow(deps, { onEvent: collector.handleEvent });\n\nconst result = await workflow(async (step) => {\n  const user = await step(() => fetchUser('1'), { key: 'user:1' });\n\n  // Save after critical step\n  await saveCheckpoint(collector.getState());\n\n  const posts = await step(() => fetchPosts(user.id), { key: `posts:${user.id}` });\n  return { user, posts };\n});\n\n// Final save\nawait saveCheckpoint(collector.getState());\n```\n\nIf the workflow crashes, resume from the last checkpoint:\n\n```typescript\nconst savedState = await loadCheckpoint('wf-123');\n\nconst workflow = createWorkflow(deps, { resumeState: savedState });\n\n// Completed steps use cached values\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser('1'), { key: 'user:1' });\n  const posts = await step(() => fetchPosts(user.id), { key: `posts:${user.id}` });\n  return { user, posts };\n});\n```\n\n## Async resume state loading\n\nLoad state lazily:\n\n```typescript\nconst workflow = createWorkflow(deps, {\n  resumeState: async () => {\n    const saved = await db.workflowStates.findUnique({ where: { id: 'wf-123' } });\n    return saved ? parseState(saved.state) : undefined;\n  },\n});\n```\n\n## File-based persistence\n\nFor simple cases, use the file cache adapter:\n\n```typescript\nimport { createFileCache } from '@jagreehal/workflow';\n\nconst cache = createFileCache({\n  directory: './workflow-state',\n  ttlMs: 7 * 24 * 60 * 60 * 1000, // 7 days\n});\n\nconst workflow = createWorkflow(deps, { cache });\n```\n\n## Next\n\n[Learn about Human-in-the-Loop →](/workflow/guides/human-in-loop/)","src/content/docs/guides/persistence.md","22d9ef3f6c3a3a5f",{"html":881,"metadata":882},"\u003Cp>Save workflow state to a database and resume later. Completed steps return their cached results without re-executing.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"collect-state-during-execution\">Collect state during execution\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#collect-state-during-execution\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Collect state during execution”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">createStepCollector\u003C/code> to automatically capture step results:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createStepCollector\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> collector\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createStepCollector\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { fetchUser, fetchPosts },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> collector.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'user:1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> posts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `posts:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">user\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { user, posts };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Get collected state\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> state\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> collector.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">getState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createWorkflow, createStepCollector } from &#x27;@jagreehal/workflow&#x27;;\n\nconst collector = createStepCollector();\n\nconst workflow = createWorkflow(\n  { fetchUser, fetchPosts },\n  { onEvent: collector.handleEvent }\n);\n\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });\n  const posts = await step(() => fetchPosts(user.id), { key: &#x60;posts:${user.id}&#x60; });\n  return { user, posts };\n});\n\n// Get collected state\nconst state = collector.getState();\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>Only steps with \u003Ccode dir=\"auto\">key\u003C/code> are saved.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"save-to-database\">Save to database\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#save-to-database\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Save to database”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Serialize the state and store it:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">stringifyState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> json\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> stringifyState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(state, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  workflowId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'wf-123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  timestamp\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> Date.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">now\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">workflowStates\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">create\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'wf-123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  state\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> json,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createdAt\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> new\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> Date\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { stringifyState } from &#x27;@jagreehal/workflow&#x27;;\n\nconst json = stringifyState(state, {\n  workflowId: &#x27;wf-123&#x27;,\n  timestamp: Date.now(),\n});\n\nawait db.workflowStates.create({\n  id: &#x27;wf-123&#x27;,\n  state: json,\n  createdAt: new Date(),\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"resume-from-saved-state\">Resume from saved state\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#resume-from-saved-state\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Resume from saved state”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Load and parse the state, then pass it to a new workflow:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">parseState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> saved\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">workflowStates\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">findUnique\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  where\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'wf-123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> resumeState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> parseState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(saved.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">state\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { fetchUser, fetchPosts },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { resumeState }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // These steps return cached values - no actual fetch\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'user:1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> posts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `posts:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">user\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { user, posts };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { parseState } from &#x27;@jagreehal/workflow&#x27;;\n\nconst saved = await db.workflowStates.findUnique({\n  where: { id: &#x27;wf-123&#x27; },\n});\n\nconst resumeState = parseState(saved.state);\n\nconst workflow = createWorkflow(\n  { fetchUser, fetchPosts },\n  { resumeState }\n);\n\nawait workflow(async (step) => {\n  // These steps return cached values - no actual fetch\n  const user = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });\n  const posts = await step(() => fetchPosts(user.id), { key: &#x60;posts:${user.id}&#x60; });\n  return { user, posts };\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"state-persistence-adapter\">State persistence adapter\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#state-persistence-adapter\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “State persistence adapter”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>For structured storage, use \u003Ccode dir=\"auto\">createStatePersistence\u003C/code>:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createStatePersistence\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> persistence\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createStatePersistence\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  get\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">key\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> redis.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">get\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(key),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  set\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">key\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">value\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> redis.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">set\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(key, value),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  delete\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">key\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> redis.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">del\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(key).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">then\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">n\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> =>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> n \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 0\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  exists\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">key\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> redis.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">exists\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(key).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">then\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">n\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> =>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> n \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 0\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  keys\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">pattern\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> redis.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">keys\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(pattern),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'workflow:state:'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Save\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> persistence.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">save\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'wf-123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, state, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">userId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'user-1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Load\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> savedState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> persistence.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">load\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'wf-123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Resume\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">resumeState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> savedState });\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createStatePersistence } from &#x27;@jagreehal/workflow&#x27;;\n\nconst persistence = createStatePersistence({\n  get: (key) => redis.get(key),\n  set: (key, value) => redis.set(key, value),\n  delete: (key) => redis.del(key).then(n => n > 0),\n  exists: (key) => redis.exists(key).then(n => n > 0),\n  keys: (pattern) => redis.keys(pattern),\n}, &#x27;workflow:state:&#x27;);\n\n// Save\nawait persistence.save(&#x27;wf-123&#x27;, state, { userId: &#x27;user-1&#x27; });\n\n// Load\nconst savedState = await persistence.load(&#x27;wf-123&#x27;);\n\n// Resume\nconst workflow = createWorkflow(deps, { resumeState: savedState });\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"check-if-step-is-complete\">Check if step is complete\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#check-if-step-is-complete\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Check if step is complete”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">isStepComplete\u003C/code> to check state before execution:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">isStepComplete\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> state\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> persistence.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">load\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'wf-123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">isStepComplete\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(state, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'user:1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'User already fetched'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { isStepComplete } from &#x27;@jagreehal/workflow&#x27;;\n\nconst state = await persistence.load(&#x27;wf-123&#x27;);\n\nif (isStepComplete(state, &#x27;user:1&#x27;)) {\n  console.log(&#x27;User already fetched&#x27;);\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"crash-recovery-pattern\">Crash recovery pattern\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#crash-recovery-pattern\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Crash recovery pattern”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Save state after each batch of work:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> collector\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createStepCollector\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> collector.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'user:1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Save after critical step\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> saveCheckpoint\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(collector.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">getState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> posts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `posts:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">user\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { user, posts };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Final save\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> saveCheckpoint\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(collector.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">getState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const collector = createStepCollector();\nconst workflow = createWorkflow(deps, { onEvent: collector.handleEvent });\n\nconst result = await workflow(async (step) => {\n  const user = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });\n\n  // Save after critical step\n  await saveCheckpoint(collector.getState());\n\n  const posts = await step(() => fetchPosts(user.id), { key: &#x60;posts:${user.id}&#x60; });\n  return { user, posts };\n});\n\n// Final save\nawait saveCheckpoint(collector.getState());\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>If the workflow crashes, resume from the last checkpoint:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> savedState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> loadCheckpoint\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'wf-123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">resumeState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> savedState });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Completed steps use cached values\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'user:1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> posts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `posts:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">user\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { user, posts };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const savedState = await loadCheckpoint(&#x27;wf-123&#x27;);\n\nconst workflow = createWorkflow(deps, { resumeState: savedState });\n\n// Completed steps use cached values\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser(&#x27;1&#x27;), { key: &#x27;user:1&#x27; });\n  const posts = await step(() => fetchPosts(user.id), { key: &#x60;posts:${user.id}&#x60; });\n  return { user, posts };\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"async-resume-state-loading\">Async resume state loading\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#async-resume-state-loading\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Async resume state loading”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Load state lazily:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  resumeState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> saved\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">workflowStates\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">findUnique\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">where\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'wf-123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> saved \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> parseState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(saved.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">state\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> undefined\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const workflow = createWorkflow(deps, {\n  resumeState: async () => {\n    const saved = await db.workflowStates.findUnique({ where: { id: &#x27;wf-123&#x27; } });\n    return saved ? parseState(saved.state) : undefined;\n  },\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"file-based-persistence\">File-based persistence\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#file-based-persistence\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “File-based persistence”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>For simple cases, use the file cache adapter:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createFileCache\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> cache\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createFileCache\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  directory\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> './workflow-state'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  ttlMs\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 7\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 24\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 60\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 60\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 1000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// 7 days\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, { cache });\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createFileCache } from &#x27;@jagreehal/workflow&#x27;;\n\nconst cache = createFileCache({\n  directory: &#x27;./workflow-state&#x27;,\n  ttlMs: 7 * 24 * 60 * 60 * 1000, // 7 days\n});\n\nconst workflow = createWorkflow(deps, { cache });\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/workflow/guides/human-in-loop/\">Learn about Human-in-the-Loop →\u003C/a>\u003C/p>",{"headings":883,"localImagePaths":909,"remoteImagePaths":910,"frontmatter":911,"imagePaths":912},[884,887,890,893,896,899,902,905,908],{"depth":57,"slug":885,"text":886},"collect-state-during-execution","Collect state during execution",{"depth":57,"slug":888,"text":889},"save-to-database","Save to database",{"depth":57,"slug":891,"text":892},"resume-from-saved-state","Resume from saved state",{"depth":57,"slug":894,"text":895},"state-persistence-adapter","State persistence adapter",{"depth":57,"slug":897,"text":898},"check-if-step-is-complete","Check if step is complete",{"depth":57,"slug":900,"text":901},"crash-recovery-pattern","Crash recovery pattern",{"depth":57,"slug":903,"text":904},"async-resume-state-loading","Async resume state loading",{"depth":57,"slug":906,"text":907},"file-based-persistence","File-based persistence",{"depth":57,"slug":384,"text":385},[],[],{"title":872,"description":873},[],"guides/human-in-loop",{"id":913,"data":915,"body":921,"filePath":922,"digest":923,"rendered":924},{"title":916,"description":917,"editUrl":16,"head":918,"template":46,"sidebar":919,"pagefind":16,"draft":35},"Human-in-the-Loop","Pause workflows for manual approval",[],{"hidden":35,"attrs":920},{},"Pause workflows for human approval (large transfers, deployments, refunds) and resume when approved.\n\n## Create an approval step\n\n```typescript\nimport { createApprovalStep, isPendingApproval } from '@jagreehal/workflow';\n\nconst requireApproval = createApprovalStep({\n  key: 'approve:refund',\n  checkApproval: async () => {\n    const status = await db.getApprovalStatus('refund-123');\n    if (!status) return { status: 'pending' };\n    if (status.approved) return { status: 'approved', value: status };\n    return { status: 'rejected', reason: status.reason };\n  },\n});\n```\n\n## Use in workflow\n\n```typescript\nconst refundWorkflow = createWorkflow({ calculateRefund, processRefund, requireApproval });\n\nconst result = await refundWorkflow(async (step) => {\n  const refund = await step(calculateRefund(orderId));\n\n  // Workflow pauses here until approved\n  const approval = await step(requireApproval, { key: 'approve:refund' });\n\n  return await step(processRefund(refund, approval));\n});\n```\n\n## Check for pending approval\n\n```typescript\nif (!result.ok && isPendingApproval(result.error)) {\n  // Save state, notify team\n  await notifySlack(`Refund ${orderId} needs approval`);\n  await db.workflowStates.create({\n    id: orderId,\n    state: stringifyState(collector.getState()),\n  });\n}\n```\n\n## Inject approval and resume\n\nWhen approval is granted:\n\n```typescript\nimport { injectApproval, parseState } from '@jagreehal/workflow';\n\n// Load saved state\nconst saved = await db.workflowStates.findUnique({ where: { id: orderId } });\nconst state = parseState(saved.state);\n\n// Inject the approval\nconst updatedState = injectApproval(state, {\n  stepKey: 'approve:refund',\n  value: { approvedBy: 'alice@company.com', timestamp: Date.now() },\n});\n\n// Resume workflow\nconst workflow = createWorkflow(\n  { calculateRefund, processRefund, requireApproval },\n  { resumeState: updatedState }\n);\n\nconst result = await workflow(async (step) => {\n  const refund = await step(calculateRefund(orderId));\n  const approval = await step(requireApproval, { key: 'approve:refund' });\n  return await step(processRefund(refund, approval));\n});\n// Now completes successfully\n```\n\n## Handle rejection\n\n```typescript\nimport { isApprovalRejected } from '@jagreehal/workflow';\n\nif (!result.ok && isApprovalRejected(result.error)) {\n  console.log('Rejected:', result.error.reason);\n  await db.refunds.updateStatus(orderId, 'rejected');\n}\n```\n\n## List pending approvals\n\n```typescript\nimport { getPendingApprovals } from '@jagreehal/workflow';\n\nconst state = collector.getState();\nconst pending = getPendingApprovals(state);\n// [{ stepKey: 'approve:refund', ... }]\n```\n\n## HITL orchestrator\n\nFor complex approval flows, use the orchestrator:\n\n```typescript\nimport {\n  createHITLOrchestrator,\n  createMemoryApprovalStore,\n  createMemoryWorkflowStateStore,\n} from '@jagreehal/workflow';\n\nconst orchestrator = createHITLOrchestrator({\n  approvalStore: createMemoryApprovalStore(),\n  workflowStateStore: createMemoryWorkflowStateStore(),\n  createWorkflow: (resumeState) =>\n    createWorkflow(deps, { resumeState }),\n});\n\n// Start workflow\nconst { runId, result } = await orchestrator.start(\n  async (step) => {\n    const data = await step(fetchData());\n    await step(requireApproval, { key: 'approve:data' });\n    return data;\n  },\n  { workflowId: 'wf-1' }\n);\n\n// Approve\nawait orchestrator.approve(runId, 'approve:data', { approvedBy: 'alice' });\n\n// Resume\nconst finalResult = await orchestrator.resume(runId);\n```\n\n## Approval webhook handler\n\nExpose an HTTP endpoint for approvals:\n\n```typescript\nimport { createApprovalWebhookHandler } from '@jagreehal/workflow';\n\nconst handler = createApprovalWebhookHandler({\n  approvalStore,\n  workflowStateStore,\n  resumeWorkflow: async (runId, state) => {\n    const workflow = createWorkflow(deps, { resumeState: state });\n    return workflow(executor);\n  },\n});\n\n// Express\napp.post('/webhooks/approve', async (req, res) => {\n  const result = await handler({\n    runId: req.body.runId,\n    stepKey: req.body.stepKey,\n    action: req.body.action, // 'approve' | 'reject'\n    value: req.body.value,\n    reason: req.body.reason,\n  });\n\n  res.json(result);\n});\n```\n\n## Full example\n\n```typescript\nimport {\n  createWorkflow,\n  createApprovalStep,\n  createStepCollector,\n  isPendingApproval,\n  injectApproval,\n  stringifyState,\n  parseState,\n} from '@jagreehal/workflow';\n\n// Define approval step\nconst requireManagerApproval = createApprovalStep({\n  key: 'manager-approval',\n  checkApproval: async () => {\n    const record = await db.approvals.find('expense-123');\n    if (!record) return { status: 'pending' };\n    return record.approved\n      ? { status: 'approved', value: record }\n      : { status: 'rejected', reason: record.reason };\n  },\n});\n\n// Workflow\nconst expenseWorkflow = createWorkflow({\n  validateExpense,\n  processPayment,\n  requireManagerApproval,\n});\n\nconst collector = createStepCollector();\nconst workflow = createWorkflow(deps, { onEvent: collector.handleEvent });\n\nconst result = await workflow(async (step) => {\n  const expense = await step(validateExpense(data));\n  const approval = await step(requireManagerApproval, { key: 'manager-approval' });\n  return await step(processPayment(expense, approval));\n});\n\nif (!result.ok && isPendingApproval(result.error)) {\n  // Save for later\n  await db.pendingWorkflows.create({\n    id: 'expense-123',\n    state: stringifyState(collector.getState()),\n  });\n  await sendSlackMessage('Expense needs approval: expense-123');\n}\n```\n\n## Next\n\n[Learn about Visualization →](/workflow/guides/visualization/)","src/content/docs/guides/human-in-loop.md","260de0cf43481c75",{"html":925,"metadata":926},"\u003Cp>Pause workflows for human approval (large transfers, deployments, refunds) and resume when approved.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"create-an-approval-step\">Create an approval step\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#create-an-approval-step\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Create an approval step”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createApprovalStep\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">isPendingApproval\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> requireApproval\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createApprovalStep\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'approve:refund'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  checkApproval\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">getApprovalStatus\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'refund-123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">status) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'pending'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (status.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">approved\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'approved'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> status };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'rejected'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> status.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createApprovalStep, isPendingApproval } from &#x27;@jagreehal/workflow&#x27;;\n\nconst requireApproval = createApprovalStep({\n  key: &#x27;approve:refund&#x27;,\n  checkApproval: async () => {\n    const status = await db.getApprovalStatus(&#x27;refund-123&#x27;);\n    if (!status) return { status: &#x27;pending&#x27; };\n    if (status.approved) return { status: &#x27;approved&#x27;, value: status };\n    return { status: &#x27;rejected&#x27;, reason: status.reason };\n  },\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"use-in-workflow\">Use in workflow\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#use-in-workflow\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Use in workflow”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> refundWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ calculateRefund, processRefund, requireApproval });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> refundWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> refund\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">calculateRefund\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(orderId));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Workflow pauses here until approved\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> approval\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(requireApproval, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'approve:refund'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">processRefund\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(refund, approval));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const refundWorkflow = createWorkflow({ calculateRefund, processRefund, requireApproval });\n\nconst result = await refundWorkflow(async (step) => {\n  const refund = await step(calculateRefund(orderId));\n\n  // Workflow pauses here until approved\n  const approval = await step(requireApproval, { key: &#x27;approve:refund&#x27; });\n\n  return await step(processRefund(refund, approval));\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"check-for-pending-approval\">Check for pending approval\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#check-for-pending-approval\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Check for pending approval”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> &#x26;&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> isPendingApproval\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Save state, notify team\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> notifySlack\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`Refund \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">orderId\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> needs approval`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">workflowStates\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">create\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> orderId,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    state\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> stringifyState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(collector.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">getState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">()),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"if (!result.ok &#x26;&#x26; isPendingApproval(result.error)) {\n  // Save state, notify team\n  await notifySlack(&#x60;Refund ${orderId} needs approval&#x60;);\n  await db.workflowStates.create({\n    id: orderId,\n    state: stringifyState(collector.getState()),\n  });\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"inject-approval-and-resume\">Inject approval and resume\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#inject-approval-and-resume\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Inject approval and resume”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>When approval is granted:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">injectApproval\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">parseState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Load saved state\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> saved\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">workflowStates\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">findUnique\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">where\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> orderId } });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> state\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> parseState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(saved.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">state\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Inject the approval\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> updatedState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> injectApproval\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(state, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  stepKey\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'approve:refund'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  value\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">approvedBy\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'alice@company.com'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">timestamp\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> Date.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">now\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">() },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Resume workflow\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { calculateRefund, processRefund, requireApproval },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">resumeState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> updatedState }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> refund\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">calculateRefund\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(orderId));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> approval\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(requireApproval, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'approve:refund'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">processRefund\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(refund, approval));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Now completes successfully\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { injectApproval, parseState } from &#x27;@jagreehal/workflow&#x27;;\n\n// Load saved state\nconst saved = await db.workflowStates.findUnique({ where: { id: orderId } });\nconst state = parseState(saved.state);\n\n// Inject the approval\nconst updatedState = injectApproval(state, {\n  stepKey: &#x27;approve:refund&#x27;,\n  value: { approvedBy: &#x27;alice@company.com&#x27;, timestamp: Date.now() },\n});\n\n// Resume workflow\nconst workflow = createWorkflow(\n  { calculateRefund, processRefund, requireApproval },\n  { resumeState: updatedState }\n);\n\nconst result = await workflow(async (step) => {\n  const refund = await step(calculateRefund(orderId));\n  const approval = await step(requireApproval, { key: &#x27;approve:refund&#x27; });\n  return await step(processRefund(refund, approval));\n});\n// Now completes successfully\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"handle-rejection\">Handle rejection\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#handle-rejection\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Handle rejection”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">isApprovalRejected\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> &#x26;&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> isApprovalRejected\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Rejected:'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">refunds\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">updateStatus\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(orderId, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'rejected'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { isApprovalRejected } from &#x27;@jagreehal/workflow&#x27;;\n\nif (!result.ok &#x26;&#x26; isApprovalRejected(result.error)) {\n  console.log(&#x27;Rejected:&#x27;, result.error.reason);\n  await db.refunds.updateStatus(orderId, &#x27;rejected&#x27;);\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"list-pending-approvals\">List pending approvals\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#list-pending-approvals\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “List pending approvals”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">getPendingApprovals\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> state\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> collector.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">getState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> pending\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> getPendingApprovals\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(state);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// [{ stepKey: 'approve:refund', ... }]\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { getPendingApprovals } from &#x27;@jagreehal/workflow&#x27;;\n\nconst state = collector.getState();\nconst pending = getPendingApprovals(state);\n// [{ stepKey: &#x27;approve:refund&#x27;, ... }]\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"hitl-orchestrator\">HITL orchestrator\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#hitl-orchestrator\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “HITL orchestrator”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>For complex approval flows, use the orchestrator:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createHITLOrchestrator\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createMemoryApprovalStore\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createMemoryWorkflowStateStore\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">} \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> orchestrator\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createHITLOrchestrator\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  approvalStore\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createMemoryApprovalStore\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  workflowStateStore\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createMemoryWorkflowStateStore\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">resumeState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, { resumeState }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Start workflow\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">runId\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">result\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">=\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> orchestrator.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">start\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> data\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchData\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(requireApproval, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'approve:data'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> data;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">workflowId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'wf-1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Approve\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> orchestrator.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">approve\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(runId, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'approve:data'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">approvedBy\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'alice'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Resume\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> finalResult\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> orchestrator.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">resume\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(runId);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import {\n  createHITLOrchestrator,\n  createMemoryApprovalStore,\n  createMemoryWorkflowStateStore,\n} from &#x27;@jagreehal/workflow&#x27;;\n\nconst orchestrator = createHITLOrchestrator({\n  approvalStore: createMemoryApprovalStore(),\n  workflowStateStore: createMemoryWorkflowStateStore(),\n  createWorkflow: (resumeState) =>\n    createWorkflow(deps, { resumeState }),\n});\n\n// Start workflow\nconst { runId, result } = await orchestrator.start(\n  async (step) => {\n    const data = await step(fetchData());\n    await step(requireApproval, { key: &#x27;approve:data&#x27; });\n    return data;\n  },\n  { workflowId: &#x27;wf-1&#x27; }\n);\n\n// Approve\nawait orchestrator.approve(runId, &#x27;approve:data&#x27;, { approvedBy: &#x27;alice&#x27; });\n\n// Resume\nconst finalResult = await orchestrator.resume(runId);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"approval-webhook-handler\">Approval webhook handler\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#approval-webhook-handler\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Approval webhook handler”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Expose an HTTP endpoint for approvals:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createApprovalWebhookHandler\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> handler\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createApprovalWebhookHandler\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  approvalStore,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  workflowStateStore,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  resumeWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">runId\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">state\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">resumeState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> state });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(executor);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Express\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">app.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">post\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'/webhooks/approve'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">req\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">res\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> handler\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    runId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> req.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">body\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">runId\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    stepKey\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> req.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">body\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">stepKey\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    action\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> req.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">body\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">action\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// 'approve' | 'reject'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    value\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> req.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">body\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    reason\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> req.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">body\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  res.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">json\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createApprovalWebhookHandler } from &#x27;@jagreehal/workflow&#x27;;\n\nconst handler = createApprovalWebhookHandler({\n  approvalStore,\n  workflowStateStore,\n  resumeWorkflow: async (runId, state) => {\n    const workflow = createWorkflow(deps, { resumeState: state });\n    return workflow(executor);\n  },\n});\n\n// Express\napp.post(&#x27;/webhooks/approve&#x27;, async (req, res) => {\n  const result = await handler({\n    runId: req.body.runId,\n    stepKey: req.body.stepKey,\n    action: req.body.action, // &#x27;approve&#x27; | &#x27;reject&#x27;\n    value: req.body.value,\n    reason: req.body.reason,\n  });\n\n  res.json(result);\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"full-example\">Full example\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#full-example\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Full example”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createApprovalStep\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createStepCollector\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  isPendingApproval\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  injectApproval\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  stringifyState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  parseState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">} \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Define approval step\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> requireManagerApproval\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createApprovalStep\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'manager-approval'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  checkApproval\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> record\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">approvals\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">find\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'expense-123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">record) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'pending'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> record.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">approved\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">      ?\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'approved'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> record }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">      :\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'rejected'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> record.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Workflow\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> expenseWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  validateExpense,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  processPayment,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  requireManagerApproval,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> collector\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createStepCollector\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> collector.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> expense\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">validateExpense\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(data));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> approval\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(requireManagerApproval, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'manager-approval'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">processPayment\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(expense, approval));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> &#x26;&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> isPendingApproval\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Save for later\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">pendingWorkflows\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">create\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'expense-123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    state\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> stringifyState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(collector.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">getState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">()),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> sendSlackMessage\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Expense needs approval: expense-123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import {\n  createWorkflow,\n  createApprovalStep,\n  createStepCollector,\n  isPendingApproval,\n  injectApproval,\n  stringifyState,\n  parseState,\n} from &#x27;@jagreehal/workflow&#x27;;\n\n// Define approval step\nconst requireManagerApproval = createApprovalStep({\n  key: &#x27;manager-approval&#x27;,\n  checkApproval: async () => {\n    const record = await db.approvals.find(&#x27;expense-123&#x27;);\n    if (!record) return { status: &#x27;pending&#x27; };\n    return record.approved\n      ? { status: &#x27;approved&#x27;, value: record }\n      : { status: &#x27;rejected&#x27;, reason: record.reason };\n  },\n});\n\n// Workflow\nconst expenseWorkflow = createWorkflow({\n  validateExpense,\n  processPayment,\n  requireManagerApproval,\n});\n\nconst collector = createStepCollector();\nconst workflow = createWorkflow(deps, { onEvent: collector.handleEvent });\n\nconst result = await workflow(async (step) => {\n  const expense = await step(validateExpense(data));\n  const approval = await step(requireManagerApproval, { key: &#x27;manager-approval&#x27; });\n  return await step(processPayment(expense, approval));\n});\n\nif (!result.ok &#x26;&#x26; isPendingApproval(result.error)) {\n  // Save for later\n  await db.pendingWorkflows.create({\n    id: &#x27;expense-123&#x27;,\n    state: stringifyState(collector.getState()),\n  });\n  await sendSlackMessage(&#x27;Expense needs approval: expense-123&#x27;);\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/workflow/guides/visualization/\">Learn about Visualization →\u003C/a>\u003C/p>",{"headings":927,"localImagePaths":954,"remoteImagePaths":955,"frontmatter":956,"imagePaths":957},[928,931,934,937,940,943,946,949,952,953],{"depth":57,"slug":929,"text":930},"create-an-approval-step","Create an approval step",{"depth":57,"slug":932,"text":933},"use-in-workflow","Use in workflow",{"depth":57,"slug":935,"text":936},"check-for-pending-approval","Check for pending approval",{"depth":57,"slug":938,"text":939},"inject-approval-and-resume","Inject approval and resume",{"depth":57,"slug":941,"text":942},"handle-rejection","Handle rejection",{"depth":57,"slug":944,"text":945},"list-pending-approvals","List pending approvals",{"depth":57,"slug":947,"text":948},"hitl-orchestrator","HITL orchestrator",{"depth":57,"slug":950,"text":951},"approval-webhook-handler","Approval webhook handler",{"depth":57,"slug":685,"text":686},{"depth":57,"slug":384,"text":385},[],[],{"title":916,"description":917},[],"guides/visualization",{"id":958,"data":960,"body":965,"filePath":966,"digest":967,"rendered":968},{"title":734,"description":961,"editUrl":16,"head":962,"template":46,"sidebar":963,"pagefind":16,"draft":35},"Generate diagrams of workflow execution",[],{"hidden":35,"attrs":964},{},"Visualize workflow execution as ASCII diagrams or Mermaid charts for debugging, documentation, or dashboards.\n\n## Basic usage\n\n```typescript\nimport { createVisualizer } from '@jagreehal/workflow/visualize';\n\nconst viz = createVisualizer({ workflowName: 'checkout' });\n\nconst workflow = createWorkflow(deps, {\n  onEvent: viz.handleEvent,\n});\n\nawait workflow(async (step) => {\n  const order = await step(() => fetchOrder('123'), { name: 'Fetch order' });\n  const payment = await step(() => chargeCard(order.total), { name: 'Charge card' });\n  return { order, payment };\n});\n\n// ASCII output\nconsole.log(viz.render());\n\n// Mermaid output\nconsole.log(viz.renderAs('mermaid'));\n```\n\n## ASCII output\n\n```\n┌── checkout ─────────────────────────────────────────────────────┐\n│                                                                  │\n│  ✓ Fetch order [12ms]                                           │\n│  ✓ Charge card [45ms]                                           │\n│                                                                  │\n│  Completed in 57ms                                               │\n│                                                                  │\n└──────────────────────────────────────────────────────────────────┘\n```\n\n## Mermaid output\n\n```mermaid\nflowchart TD\n    start((\"▶ Start\"))\n    step_fetch_order[✓ Fetch order 12ms]:::success\n    start --> step_fetch_order\n    step_charge_card[✓ Charge card 45ms]:::success\n    step_fetch_order --> step_charge_card\n    finish((\"✓ Done\")):::success\n    step_charge_card --> finish\n```\n\nPaste into GitHub markdown or any Mermaid-compatible renderer.\n\n## JSON output\n\nGet structured data for custom rendering:\n\n```typescript\nconst ir = viz.renderAs('json');\n// {\n//   workflowName: 'checkout',\n//   status: 'completed',\n//   steps: [...],\n//   duration: 57\n// }\n```\n\n## Naming steps\n\nGive steps descriptive names for better diagrams:\n\n```typescript\nconst user = await step(() => fetchUser('1'), { name: 'Fetch user' });\nconst posts = await step(() => fetchPosts(user.id), { name: 'Fetch posts' });\n```\n\nWithout names, steps show as \"unnamed step\".\n\n## Parallel operations\n\nTrack parallel operations individually:\n\n```typescript\nimport { allAsync } from '@jagreehal/workflow';\n\nconst result = await workflow(async (step) => {\n  const [user, posts] = await step(\n    () => allAsync([\n      fetchUser('1'),\n      fetchPosts('1'),\n    ]),\n    { name: 'Fetch user data' }\n  );\n  return { user, posts };\n});\n```\n\n## Decision tracking\n\nTrack conditional logic (if/switch) to visualize branching in your workflows:\n\n### Basic decision tracking\n\n```typescript\nimport { trackDecision } from '@jagreehal/workflow/visualize';\n\nconst viz = createVisualizer();\nconst workflow = createWorkflow(deps, {\n  onEvent: viz.handleEvent,\n});\n\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser('1'), { name: 'Fetch user' });\n\n  // Track a decision point\n  const decision = trackDecision('check-role', {\n    condition: \"user.role === 'admin'\",\n    value: user.role,\n    emit: viz.handleDecisionEvent,\n  });\n\n  if (user.role === 'admin') {\n    decision.takeBranch('admin', true);\n    await step(() => adminDashboard(user), { name: 'Admin dashboard' });\n  } else {\n    decision.takeBranch('user', true);\n    await step(() => userDashboard(user), { name: 'User dashboard' });\n  }\n\n  decision.end();\n});\n```\n\n### trackIf - Simple if/else\n\n```typescript\nimport { trackIf } from '@jagreehal/workflow/visualize';\n\nconst decision = trackIf('check-premium', user.isPremium, {\n  condition: 'user.isPremium',\n  emit: viz.handleDecisionEvent,\n});\n\nif (decision.condition) {\n  decision.then();\n  await step(() => fetchPremiumData(user.id));\n} else {\n  decision.else();\n  await step(() => fetchBasicData(user.id));\n}\n\ndecision.end();\n```\n\n### trackSwitch - Switch statements\n\n```typescript\nimport { trackSwitch } from '@jagreehal/workflow/visualize';\n\nconst decision = trackSwitch('process-by-role', user.role, {\n  condition: 'switch(user.role)',\n  emit: viz.handleDecisionEvent,\n});\n\nswitch (user.role) {\n  case 'admin':\n    decision.case('admin', true);\n    await step(() => processAdmin(user));\n    break;\n  case 'moderator':\n    decision.case('moderator', true);\n    await step(() => processModerator(user));\n    break;\n  default:\n    decision.default(true);\n    await step(() => processUser(user));\n}\n\ndecision.end();\n```\n\n### With event collector\n\n```typescript\nimport { createEventCollector, trackIf } from '@jagreehal/workflow/visualize';\n\nconst collector = createEventCollector({ workflowName: 'Role Check' });\nconst workflow = createWorkflow(deps, {\n  onEvent: collector.handleEvent,\n});\n\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser('1'), { name: 'Fetch user' });\n\n  const decision = trackIf('check-role', user.role === 'admin', {\n    condition: \"user.role === 'admin'\",\n    value: user.role,\n    emit: collector.handleDecisionEvent,\n  });\n\n  if (decision.condition) {\n    decision.then();\n    await step(() => processAdmin(user));\n  } else {\n    decision.else();\n    await step(() => processUser(user));\n  }\n  decision.end();\n\n  return user;\n});\n\n// Visualize with decision tracking\nconsole.log(collector.visualize());\n```\n\n## Post-execution visualization\n\nCollect events and visualize later:\n\n```typescript\nimport { createEventCollector } from '@jagreehal/workflow/visualize';\n\nconst collector = createEventCollector({ workflowName: 'my-workflow' });\n\nconst workflow = createWorkflow(deps, {\n  onEvent: collector.handleEvent,\n});\n\nawait workflow(async (step) => { ... });\n\n// Visualize anytime after\nconsole.log(collector.visualize());\nconsole.log(collector.visualizeAs('mermaid'));\n```\n\n## Options\n\n```typescript\nconst viz = createVisualizer({\n  workflowName: 'checkout',\n  showDurations: true,     // Show step durations\n  showTimestamps: false,   // Show start times\n  maxWidth: 80,            // ASCII width limit\n});\n```\n\n## Integration with logging\n\n```typescript\nconst workflow = createWorkflow(deps, {\n  onEvent: (event) => {\n    // Feed to visualizer\n    viz.handleEvent(event);\n\n    // Also log\n    if (event.type === 'step_complete') {\n      logger.info(`Step ${event.name} completed in ${event.durationMs}ms`);\n    }\n    if (event.type === 'step_error') {\n      logger.error(`Step ${event.name} failed:`, event.error);\n    }\n  },\n});\n```\n\n## Devtools\n\nFor interactive debugging, run comparison, and timeline analysis:\n\n```typescript\nimport { createDevtools, quickVisualize, createConsoleLogger } from '@jagreehal/workflow';\n\nconst devtools = createDevtools({ workflowName: 'checkout' });\n\nconst workflow = createWorkflow(deps, {\n  onEvent: devtools.handleEvent,\n});\n\nawait workflow(async (step) => { ... });\n\n// Get current run\nconst currentRun = devtools.getCurrentRun();\n\n// Get execution history\nconst history = devtools.getHistory();\n\n// Compare runs\nconst diff = devtools.diff(run1.id, run2.id);\nconsole.log(renderDiff(diff));\n\n// Compare with previous run\nconst diffWithPrev = devtools.diffWithPrevious();\n\n// Render timeline\nconsole.log(devtools.renderTimeline());\n\n// Export/import runs\nconst json = devtools.exportRun();\nconst imported = devtools.importRun(json);\n```\n\n### Console logging\n\nUse `createConsoleLogger` for pretty console output:\n\n```typescript\nimport { createConsoleLogger } from '@jagreehal/workflow';\n\nconst logger = createConsoleLogger({ prefix: '[workflow]', colors: true });\n\nconst workflow = createWorkflow(deps, {\n  onEvent: logger,\n});\n\nawait workflow(async (step) => { ... });\n// Output:\n// [workflow] ⏵ Workflow started\n// [workflow] → fetch-user\n// [workflow] ✓ fetch-user (12ms)\n// [workflow] ✓ Workflow completed (45ms)\n```\n\n### Quick visualization\n\nVisualize a workflow run without setting up a visualizer:\n\n```typescript\nimport { quickVisualize } from '@jagreehal/workflow';\n\nconst result = await quickVisualize(\n  async (handleEvent) => {\n    const workflow = createWorkflow(deps, { onEvent: handleEvent });\n    return await workflow(async (step) => { ... });\n  },\n  { workflowName: 'my-workflow' }\n);\n\nconsole.log(result); // ASCII diagram\n```\n\n### Run comparison\n\nCompare two workflow runs to see what changed:\n\n```typescript\nconst diff = devtools.diff(run1.id, run2.id);\n\nif (diff.statusChange) {\n  console.log(`Status: ${diff.statusChange.from} → ${diff.statusChange.to}`);\n}\n\nif (diff.durationChange) {\n  console.log(`Duration: ${diff.durationChange > 0 ? '+' : ''}${diff.durationChange}ms`);\n}\n\n// See what steps were added/removed/changed\nconsole.log('Added:', diff.added);\nconsole.log('Removed:', diff.removed);\nconsole.log('Changed:', diff.changed);\n```\n\n### Timeline analysis\n\nGet detailed timeline data:\n\n```typescript\nconst timeline = devtools.getTimeline();\n\nfor (const entry of timeline) {\n  console.log(`${entry.name}: ${entry.status} (${entry.durationMs}ms)`);\n  if (entry.error) {\n    console.error(`  Error: ${entry.error}`);\n  }\n}\n```\n\n## Advanced features\n\n### Time-travel debugging\n\nStep through workflow execution history:\n\n```typescript\nimport { createTimeTravelController } from '@jagreehal/workflow/visualize';\n\nconst controller = createTimeTravelController({ maxSnapshots: 1000 });\n\nconst workflow = createWorkflow(deps, {\n  onEvent: controller.handleEvent,\n});\n\nawait workflow(async (step) => { ... });\n\n// Navigate through execution history\ncontroller.seek(0);              // Go to start\ncontroller.stepForward();        // Step forward one event\ncontroller.stepBackward();      // Step backward one event\ncontroller.seek(10);            // Jump to event 10\ncontroller.play(2.0);            // Playback at 2x speed\ncontroller.pause();              // Pause playback\n\n// Get current state\nconst ir = controller.getCurrentIR();\nconst state = controller.getState();\n```\n\n### Performance analyzer\n\nIdentify slow steps with heatmap visualization:\n\n```typescript\nimport { createPerformanceAnalyzer, getHeatLevel } from '@jagreehal/workflow/visualize';\n\nconst analyzer = createPerformanceAnalyzer();\n\nconst workflow = createWorkflow(deps, {\n  onEvent: analyzer.handleEvent,\n});\n\nawait workflow(async (step) => { ... });\n\n// Get performance data\nconst data = analyzer.getData();\nconst heatLevel = getHeatLevel(stepDuration, data);\n\n// Export for visualization\nconst json = analyzer.exportData();\n```\n\n### Live visualizer\n\nReal-time visualization as workflow executes:\n\n```typescript\nimport { createLiveVisualizer } from '@jagreehal/workflow/visualize';\n\nconst visualizer = createLiveVisualizer({ workflowName: 'checkout' });\n\n// Subscribe to updates\nvisualizer.onUpdate((ir) => {\n  console.log('Workflow state updated:', ir);\n  // Update UI, render diagram, etc.\n});\n\nconst workflow = createWorkflow(deps, {\n  onEvent: visualizer.handleEvent,\n});\n\nawait workflow(async (step) => { ... });\n```\n\n### Dev server\n\nInteractive web-based visualization with time-travel and performance analysis:\n\n```typescript\nimport { createDevServer } from '@jagreehal/workflow/visualize';\n\nconst server = await createDevServer({\n  port: 3377,\n  workflowName: 'checkout',\n  timeTravel: true,\n  heatmap: true,\n});\n\nawait server.start();\n// Opens browser at http://localhost:3377\n\nconst workflow = createWorkflow(deps, {\n  onEvent: server.handleEvent,\n});\n\nawait workflow(async (step) => { ... });\n\nserver.complete();\n// Later, when done\nawait server.stop();\n```\n\nThe dev server provides:\n- Interactive HTML visualization\n- Time-travel debugging controls\n- Performance heatmap\n- Real-time updates via WebSocket\n- Export/import workflow runs\n\n## Next\n\n[Learn about Testing →](/workflow/guides/testing/)","src/content/docs/guides/visualization.md","876e63da04766c54",{"html":969,"metadata":970},"\u003Cp>Visualize workflow execution as ASCII diagrams or Mermaid charts for debugging, documentation, or dashboards.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"basic-usage\">Basic usage\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#basic-usage\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Basic usage”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createVisualizer\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/visualize'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> viz\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createVisualizer\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">workflowName\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'checkout'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> viz.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> order\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchOrder\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Fetch order'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> payment\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> chargeCard\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(order.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">total\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Charge card'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { order, payment };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// ASCII output\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(viz.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">render\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Mermaid output\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(viz.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">renderAs\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'mermaid'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createVisualizer } from &#x27;@jagreehal/workflow/visualize&#x27;;\n\nconst viz = createVisualizer({ workflowName: &#x27;checkout&#x27; });\n\nconst workflow = createWorkflow(deps, {\n  onEvent: viz.handleEvent,\n});\n\nawait workflow(async (step) => {\n  const order = await step(() => fetchOrder(&#x27;123&#x27;), { name: &#x27;Fetch order&#x27; });\n  const payment = await step(() => chargeCard(order.total), { name: &#x27;Charge card&#x27; });\n  return { order, payment };\n});\n\n// ASCII output\nconsole.log(viz.render());\n\n// Mermaid output\nconsole.log(viz.renderAs(&#x27;mermaid&#x27;));\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"ascii-output\">ASCII output\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#ascii-output\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “ASCII output”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"plaintext\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan>┌── checkout ─────────────────────────────────────────────────────┐\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>│                                                                  │\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>│  ✓ Fetch order [12ms]                                           │\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>│  ✓ Charge card [45ms]                                           │\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>│                                                                  │\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>│  Completed in 57ms                                               │\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>│                                                                  │\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan>└──────────────────────────────────────────────────────────────────┘\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"┌── checkout ─────────────────────────────────────────────────────┐\n│                                                                  │\n│  ✓ Fetch order [12ms]                                           │\n│  ✓ Charge card [45ms]                                           │\n│                                                                  │\n│  Completed in 57ms                                               │\n│                                                                  │\n└──────────────────────────────────────────────────────────────────┘\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"mermaid-output\">Mermaid output\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#mermaid-output\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Mermaid output”\u003C/span>\u003C/a>\u003C/div>\n\u003Cpre class=\"mermaid\">flowchart TD\n    start((\"▶ Start\"))\n    step_fetch_order[✓ Fetch order 12ms]:::success\n    start --> step_fetch_order\n    step_charge_card[✓ Charge card 45ms]:::success\n    step_fetch_order --> step_charge_card\n    finish((\"✓ Done\")):::success\n    step_charge_card --> finish\u003C/pre>\n\u003Cp>Paste into GitHub markdown or any Mermaid-compatible renderer.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"json-output\">JSON output\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#json-output\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “JSON output”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Get structured data for custom rendering:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> ir\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> viz.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">renderAs\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'json'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">//   workflowName: 'checkout',\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">//   status: 'completed',\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">//   steps: [...],\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">//   duration: 57\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// }\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const ir = viz.renderAs(&#x27;json&#x27;);\n// {\n//   workflowName: &#x27;checkout&#x27;,\n//   status: &#x27;completed&#x27;,\n//   steps: [...],\n//   duration: 57\n// }\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"naming-steps\">Naming steps\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#naming-steps\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Naming steps”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Give steps descriptive names for better diagrams:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Fetch user'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> posts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Fetch posts'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const user = await step(() => fetchUser(&#x27;1&#x27;), { name: &#x27;Fetch user&#x27; });\nconst posts = await step(() => fetchPosts(user.id), { name: &#x27;Fetch posts&#x27; });\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>Without names, steps show as “unnamed step”.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"parallel-operations\">Parallel operations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#parallel-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Parallel operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Track parallel operations individually:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">allAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> [\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">user\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">posts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">] \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">=\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> allAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    ]),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Fetch user data'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { user, posts };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { allAsync } from &#x27;@jagreehal/workflow&#x27;;\n\nconst result = await workflow(async (step) => {\n  const [user, posts] = await step(\n    () => allAsync([\n      fetchUser(&#x27;1&#x27;),\n      fetchPosts(&#x27;1&#x27;),\n    ]),\n    { name: &#x27;Fetch user data&#x27; }\n  );\n  return { user, posts };\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"decision-tracking\">Decision tracking\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#decision-tracking\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Decision tracking”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Track conditional logic (if/switch) to visualize branching in your workflows:\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"basic-decision-tracking\">Basic decision tracking\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#basic-decision-tracking\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Basic decision tracking”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">trackDecision\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/visualize'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> viz\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createVisualizer\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> viz.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Fetch user'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Track a decision point\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> decision\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> trackDecision\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'check-role'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    condition\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> \"user.role === 'admin'\"\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    value\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">role\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    emit\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> viz.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleDecisionEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">role\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> ===\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'admin'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    decision.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">takeBranch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'admin'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> adminDashboard\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Admin dashboard'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">else\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    decision.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">takeBranch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'user'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> userDashboard\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'User dashboard'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  decision.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">end\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { trackDecision } from &#x27;@jagreehal/workflow/visualize&#x27;;\n\nconst viz = createVisualizer();\nconst workflow = createWorkflow(deps, {\n  onEvent: viz.handleEvent,\n});\n\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser(&#x27;1&#x27;), { name: &#x27;Fetch user&#x27; });\n\n  // Track a decision point\n  const decision = trackDecision(&#x27;check-role&#x27;, {\n    condition: &#x22;user.role === &#x27;admin&#x27;&#x22;,\n    value: user.role,\n    emit: viz.handleDecisionEvent,\n  });\n\n  if (user.role === &#x27;admin&#x27;) {\n    decision.takeBranch(&#x27;admin&#x27;, true);\n    await step(() => adminDashboard(user), { name: &#x27;Admin dashboard&#x27; });\n  } else {\n    decision.takeBranch(&#x27;user&#x27;, true);\n    await step(() => userDashboard(user), { name: &#x27;User dashboard&#x27; });\n  }\n\n  decision.end();\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"trackif---simple-ifelse\">trackIf - Simple if/else\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#trackif---simple-ifelse\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “trackIf - Simple if/else”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">trackIf\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/visualize'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> decision\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> trackIf\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'check-premium'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">isPremium\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  condition\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'user.isPremium'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  emit\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> viz.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleDecisionEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (decision.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">condition\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  decision.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">then\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchPremiumData\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">} \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">else\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  decision.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">else\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchBasicData\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">decision.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">end\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { trackIf } from &#x27;@jagreehal/workflow/visualize&#x27;;\n\nconst decision = trackIf(&#x27;check-premium&#x27;, user.isPremium, {\n  condition: &#x27;user.isPremium&#x27;,\n  emit: viz.handleDecisionEvent,\n});\n\nif (decision.condition) {\n  decision.then();\n  await step(() => fetchPremiumData(user.id));\n} else {\n  decision.else();\n  await step(() => fetchBasicData(user.id));\n}\n\ndecision.end();\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"trackswitch---switch-statements\">trackSwitch - Switch statements\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#trackswitch---switch-statements\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “trackSwitch - Switch statements”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">trackSwitch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/visualize'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> decision\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> trackSwitch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'process-by-role'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">role\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  condition\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'switch(user.role)'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  emit\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> viz.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleDecisionEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">switch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">role\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  case\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'admin'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    decision.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">case\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'admin'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> processAdmin\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    break\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  case\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'moderator'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    decision.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">case\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'moderator'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> processModerator\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    break\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  default\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    decision.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">default\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> processUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">decision.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">end\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { trackSwitch } from &#x27;@jagreehal/workflow/visualize&#x27;;\n\nconst decision = trackSwitch(&#x27;process-by-role&#x27;, user.role, {\n  condition: &#x27;switch(user.role)&#x27;,\n  emit: viz.handleDecisionEvent,\n});\n\nswitch (user.role) {\n  case &#x27;admin&#x27;:\n    decision.case(&#x27;admin&#x27;, true);\n    await step(() => processAdmin(user));\n    break;\n  case &#x27;moderator&#x27;:\n    decision.case(&#x27;moderator&#x27;, true);\n    await step(() => processModerator(user));\n    break;\n  default:\n    decision.default(true);\n    await step(() => processUser(user));\n}\n\ndecision.end();\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"with-event-collector\">With event collector\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#with-event-collector\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “With event collector”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createEventCollector\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">trackIf\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/visualize'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> collector\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createEventCollector\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">workflowName\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Role Check'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> collector.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Fetch user'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> decision\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> trackIf\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'check-role'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">role\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> ===\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'admin'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    condition\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> \"user.role === 'admin'\"\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    value\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">role\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    emit\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> collector.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleDecisionEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (decision.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">condition\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    decision.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">then\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> processAdmin\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">else\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    decision.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">else\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> processUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  decision.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">end\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> user;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Visualize with decision tracking\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(collector.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">visualize\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createEventCollector, trackIf } from &#x27;@jagreehal/workflow/visualize&#x27;;\n\nconst collector = createEventCollector({ workflowName: &#x27;Role Check&#x27; });\nconst workflow = createWorkflow(deps, {\n  onEvent: collector.handleEvent,\n});\n\nawait workflow(async (step) => {\n  const user = await step(() => fetchUser(&#x27;1&#x27;), { name: &#x27;Fetch user&#x27; });\n\n  const decision = trackIf(&#x27;check-role&#x27;, user.role === &#x27;admin&#x27;, {\n    condition: &#x22;user.role === &#x27;admin&#x27;&#x22;,\n    value: user.role,\n    emit: collector.handleDecisionEvent,\n  });\n\n  if (decision.condition) {\n    decision.then();\n    await step(() => processAdmin(user));\n  } else {\n    decision.else();\n    await step(() => processUser(user));\n  }\n  decision.end();\n\n  return user;\n});\n\n// Visualize with decision tracking\nconsole.log(collector.visualize());\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"post-execution-visualization\">Post-execution visualization\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#post-execution-visualization\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Post-execution visualization”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Collect events and visualize later:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createEventCollector\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/visualize'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> collector\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createEventCollector\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">workflowName\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'my-workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> collector.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Visualize anytime after\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(collector.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">visualize\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(collector.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">visualizeAs\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'mermaid'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createEventCollector } from &#x27;@jagreehal/workflow/visualize&#x27;;\n\nconst collector = createEventCollector({ workflowName: &#x27;my-workflow&#x27; });\n\nconst workflow = createWorkflow(deps, {\n  onEvent: collector.handleEvent,\n});\n\nawait workflow(async (step) => { ... });\n\n// Visualize anytime after\nconsole.log(collector.visualize());\nconsole.log(collector.visualizeAs(&#x27;mermaid&#x27;));\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"options\">Options\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#options\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Options”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> viz\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createVisualizer\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  workflowName\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'checkout'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  showDurations\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,     \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Show step durations\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  showTimestamps\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> false\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,   \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Show start times\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  maxWidth\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 80\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,            \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// ASCII width limit\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const viz = createVisualizer({\n  workflowName: &#x27;checkout&#x27;,\n  showDurations: true,     // Show step durations\n  showTimestamps: false,   // Show start times\n  maxWidth: 80,            // ASCII width limit\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"integration-with-logging\">Integration with logging\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#integration-with-logging\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Integration with logging”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">event\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">    // Feed to visualizer\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    viz.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(event);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">    // Also log\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (event.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">type\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> ===\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'step_complete'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      logger.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">info\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`Step \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">event\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> completed in \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">event\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">durationMs\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">ms`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (event.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">type\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> ===\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'step_error'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      logger.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`Step \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">event\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> failed:`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, event.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const workflow = createWorkflow(deps, {\n  onEvent: (event) => {\n    // Feed to visualizer\n    viz.handleEvent(event);\n\n    // Also log\n    if (event.type === &#x27;step_complete&#x27;) {\n      logger.info(&#x60;Step ${event.name} completed in ${event.durationMs}ms&#x60;);\n    }\n    if (event.type === &#x27;step_error&#x27;) {\n      logger.error(&#x60;Step ${event.name} failed:&#x60;, event.error);\n    }\n  },\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"devtools\">Devtools\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#devtools\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Devtools”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>For interactive debugging, run comparison, and timeline analysis:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createDevtools\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">quickVisualize\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createConsoleLogger\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> devtools\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createDevtools\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">workflowName\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'checkout'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> devtools.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Get current run\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> currentRun\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> devtools.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">getCurrentRun\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Get execution history\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> history\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> devtools.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">getHistory\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Compare runs\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> diff\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> devtools.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">diff\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(run1.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, run2.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">renderDiff\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(diff));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Compare with previous run\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> diffWithPrev\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> devtools.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">diffWithPrevious\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Render timeline\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(devtools.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">renderTimeline\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Export/import runs\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> json\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> devtools.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">exportRun\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> imported\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> devtools.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">importRun\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(json);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createDevtools, quickVisualize, createConsoleLogger } from &#x27;@jagreehal/workflow&#x27;;\n\nconst devtools = createDevtools({ workflowName: &#x27;checkout&#x27; });\n\nconst workflow = createWorkflow(deps, {\n  onEvent: devtools.handleEvent,\n});\n\nawait workflow(async (step) => { ... });\n\n// Get current run\nconst currentRun = devtools.getCurrentRun();\n\n// Get execution history\nconst history = devtools.getHistory();\n\n// Compare runs\nconst diff = devtools.diff(run1.id, run2.id);\nconsole.log(renderDiff(diff));\n\n// Compare with previous run\nconst diffWithPrev = devtools.diffWithPrevious();\n\n// Render timeline\nconsole.log(devtools.renderTimeline());\n\n// Export/import runs\nconst json = devtools.exportRun();\nconst imported = devtools.importRun(json);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"console-logging\">Console logging\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#console-logging\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Console logging”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">createConsoleLogger\u003C/code> for pretty console output:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createConsoleLogger\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> logger\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createConsoleLogger\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">prefix\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '[workflow]'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">colors\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> logger,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Output:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// [workflow] ⏵ Workflow started\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// [workflow] → fetch-user\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// [workflow] ✓ fetch-user (12ms)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// [workflow] ✓ Workflow completed (45ms)\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createConsoleLogger } from &#x27;@jagreehal/workflow&#x27;;\n\nconst logger = createConsoleLogger({ prefix: &#x27;[workflow]&#x27;, colors: true });\n\nconst workflow = createWorkflow(deps, {\n  onEvent: logger,\n});\n\nawait workflow(async (step) => { ... });\n// Output:\n// [workflow] ⏵ Workflow started\n// [workflow] → fetch-user\n// [workflow] ✓ fetch-user (12ms)\n// [workflow] ✓ Workflow completed (45ms)\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"quick-visualization\">Quick visualization\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#quick-visualization\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Quick visualization”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Visualize a workflow run without setting up a visualizer:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">quickVisualize\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> quickVisualize\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> handleEvent });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">workflowName\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'my-workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result); \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// ASCII diagram\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { quickVisualize } from &#x27;@jagreehal/workflow&#x27;;\n\nconst result = await quickVisualize(\n  async (handleEvent) => {\n    const workflow = createWorkflow(deps, { onEvent: handleEvent });\n    return await workflow(async (step) => { ... });\n  },\n  { workflowName: &#x27;my-workflow&#x27; }\n);\n\nconsole.log(result); // ASCII diagram\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"run-comparison\">Run comparison\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#run-comparison\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Run comparison”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Compare two workflow runs to see what changed:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> diff\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> devtools.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">diff\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(run1.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, run2.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (diff.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">statusChange\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`Status: \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">diff\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">statusChange\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">from\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> → \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">diff\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">statusChange\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">to\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (diff.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">durationChange\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`Duration: \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">diff\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">durationChange\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> >\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 0\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> ?\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\"> '\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">+\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> :\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\"> ''}${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">diff\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">durationChange\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">ms`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// See what steps were added/removed/changed\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Added:'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, diff.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">added\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Removed:'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, diff.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">removed\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Changed:'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, diff.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">changed\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const diff = devtools.diff(run1.id, run2.id);\n\nif (diff.statusChange) {\n  console.log(&#x60;Status: ${diff.statusChange.from} → ${diff.statusChange.to}&#x60;);\n}\n\nif (diff.durationChange) {\n  console.log(&#x60;Duration: ${diff.durationChange > 0 ? &#x27;+&#x27; : &#x27;&#x27;}${diff.durationChange}ms&#x60;);\n}\n\n// See what steps were added/removed/changed\nconsole.log(&#x27;Added:&#x27;, diff.added);\nconsole.log(&#x27;Removed:&#x27;, diff.removed);\nconsole.log(&#x27;Changed:&#x27;, diff.changed);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"timeline-analysis\">Timeline analysis\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#timeline-analysis\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Timeline analysis”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Get detailed timeline data:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> timeline\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> devtools.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">getTimeline\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">for\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> entry\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> of\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> timeline) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">entry\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">: \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">entry\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">entry\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">durationMs\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">ms)`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (entry.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`  Error: \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">entry\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const timeline = devtools.getTimeline();\n\nfor (const entry of timeline) {\n  console.log(&#x60;${entry.name}: ${entry.status} (${entry.durationMs}ms)&#x60;);\n  if (entry.error) {\n    console.error(&#x60;  Error: ${entry.error}&#x60;);\n  }\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"advanced-features\">Advanced features\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#advanced-features\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Advanced features”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"time-travel-debugging\">Time-travel debugging\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#time-travel-debugging\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Time-travel debugging”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Step through workflow execution history:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createTimeTravelController\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/visualize'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> controller\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createTimeTravelController\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">maxSnapshots\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 1000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> controller.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Navigate through execution history\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">controller.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">seek\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">0\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);              \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Go to start\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">controller.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">stepForward\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();        \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Step forward one event\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">controller.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">stepBackward\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();      \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Step backward one event\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">controller.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">seek\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">10\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);            \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Jump to event 10\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">controller.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">play\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">2.0\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);            \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Playback at 2x speed\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">controller.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">pause\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();              \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Pause playback\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Get current state\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> ir\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> controller.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">getCurrentIR\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> state\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> controller.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">getState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createTimeTravelController } from &#x27;@jagreehal/workflow/visualize&#x27;;\n\nconst controller = createTimeTravelController({ maxSnapshots: 1000 });\n\nconst workflow = createWorkflow(deps, {\n  onEvent: controller.handleEvent,\n});\n\nawait workflow(async (step) => { ... });\n\n// Navigate through execution history\ncontroller.seek(0);              // Go to start\ncontroller.stepForward();        // Step forward one event\ncontroller.stepBackward();      // Step backward one event\ncontroller.seek(10);            // Jump to event 10\ncontroller.play(2.0);            // Playback at 2x speed\ncontroller.pause();              // Pause playback\n\n// Get current state\nconst ir = controller.getCurrentIR();\nconst state = controller.getState();\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"performance-analyzer\">Performance analyzer\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#performance-analyzer\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Performance analyzer”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Identify slow steps with heatmap visualization:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createPerformanceAnalyzer\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">getHeatLevel\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/visualize'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> analyzer\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createPerformanceAnalyzer\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> analyzer.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Get performance data\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> data\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> analyzer.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">getData\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> heatLevel\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> getHeatLevel\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(stepDuration, data);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Export for visualization\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> json\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> analyzer.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">exportData\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createPerformanceAnalyzer, getHeatLevel } from &#x27;@jagreehal/workflow/visualize&#x27;;\n\nconst analyzer = createPerformanceAnalyzer();\n\nconst workflow = createWorkflow(deps, {\n  onEvent: analyzer.handleEvent,\n});\n\nawait workflow(async (step) => { ... });\n\n// Get performance data\nconst data = analyzer.getData();\nconst heatLevel = getHeatLevel(stepDuration, data);\n\n// Export for visualization\nconst json = analyzer.exportData();\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"live-visualizer\">Live visualizer\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#live-visualizer\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Live visualizer”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Real-time visualization as workflow executes:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createLiveVisualizer\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/visualize'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> visualizer\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createLiveVisualizer\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">workflowName\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'checkout'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Subscribe to updates\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">visualizer.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">onUpdate\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">((\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">ir\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Workflow state updated:'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, ir);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Update UI, render diagram, etc.\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> visualizer.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createLiveVisualizer } from &#x27;@jagreehal/workflow/visualize&#x27;;\n\nconst visualizer = createLiveVisualizer({ workflowName: &#x27;checkout&#x27; });\n\n// Subscribe to updates\nvisualizer.onUpdate((ir) => {\n  console.log(&#x27;Workflow state updated:&#x27;, ir);\n  // Update UI, render diagram, etc.\n});\n\nconst workflow = createWorkflow(deps, {\n  onEvent: visualizer.handleEvent,\n});\n\nawait workflow(async (step) => { ... });\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"dev-server\">Dev server\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#dev-server\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Dev server”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Interactive web-based visualization with time-travel and performance analysis:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createDevServer\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/visualize'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> server\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createDevServer\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  port\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 3377\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  workflowName\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'checkout'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  timeTravel\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  heatmap\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> server.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">start\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Opens browser at http://localhost:3377\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> server.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">server.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">complete\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Later, when done\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> server.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">stop\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createDevServer } from &#x27;@jagreehal/workflow/visualize&#x27;;\n\nconst server = await createDevServer({\n  port: 3377,\n  workflowName: &#x27;checkout&#x27;,\n  timeTravel: true,\n  heatmap: true,\n});\n\nawait server.start();\n// Opens browser at http://localhost:3377\n\nconst workflow = createWorkflow(deps, {\n  onEvent: server.handleEvent,\n});\n\nawait workflow(async (step) => { ... });\n\nserver.complete();\n// Later, when done\nawait server.stop();\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>The dev server provides:\u003C/p>\n\u003Cul>\n\u003Cli>Interactive HTML visualization\u003C/li>\n\u003Cli>Time-travel debugging controls\u003C/li>\n\u003Cli>Performance heatmap\u003C/li>\n\u003Cli>Real-time updates via WebSocket\u003C/li>\n\u003Cli>Export/import workflow runs\u003C/li>\n\u003C/ul>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/workflow/guides/testing/\">Learn about Testing →\u003C/a>\u003C/p>",{"headings":971,"localImagePaths":1041,"remoteImagePaths":1042,"frontmatter":1043,"imagePaths":1044},[972,973,976,979,982,985,988,991,994,997,1000,1003,1006,1007,1010,1013,1016,1019,1022,1025,1028,1031,1034,1037,1040],{"depth":57,"slug":58,"text":59},{"depth":57,"slug":974,"text":975},"ascii-output","ASCII output",{"depth":57,"slug":977,"text":978},"mermaid-output","Mermaid output",{"depth":57,"slug":980,"text":981},"json-output","JSON output",{"depth":57,"slug":983,"text":984},"naming-steps","Naming steps",{"depth":57,"slug":986,"text":987},"parallel-operations","Parallel operations",{"depth":57,"slug":989,"text":990},"decision-tracking","Decision tracking",{"depth":160,"slug":992,"text":993},"basic-decision-tracking","Basic decision tracking",{"depth":160,"slug":995,"text":996},"trackif---simple-ifelse","trackIf - Simple if/else",{"depth":160,"slug":998,"text":999},"trackswitch---switch-statements","trackSwitch - Switch statements",{"depth":160,"slug":1001,"text":1002},"with-event-collector","With event collector",{"depth":57,"slug":1004,"text":1005},"post-execution-visualization","Post-execution visualization",{"depth":57,"slug":730,"text":731},{"depth":57,"slug":1008,"text":1009},"integration-with-logging","Integration with logging",{"depth":57,"slug":1011,"text":1012},"devtools","Devtools",{"depth":160,"slug":1014,"text":1015},"console-logging","Console logging",{"depth":160,"slug":1017,"text":1018},"quick-visualization","Quick visualization",{"depth":160,"slug":1020,"text":1021},"run-comparison","Run comparison",{"depth":160,"slug":1023,"text":1024},"timeline-analysis","Timeline analysis",{"depth":57,"slug":1026,"text":1027},"advanced-features","Advanced features",{"depth":160,"slug":1029,"text":1030},"time-travel-debugging","Time-travel debugging",{"depth":160,"slug":1032,"text":1033},"performance-analyzer","Performance analyzer",{"depth":160,"slug":1035,"text":1036},"live-visualizer","Live visualizer",{"depth":160,"slug":1038,"text":1039},"dev-server","Dev server",{"depth":57,"slug":384,"text":385},[],[],{"title":734,"description":961},[],"guides/versioning",{"id":1045,"data":1047,"body":1053,"filePath":1054,"digest":1055,"rendered":1056},{"title":1048,"description":1049,"editUrl":16,"head":1050,"template":46,"sidebar":1051,"pagefind":16,"draft":35},"Workflow Versioning","Migrate persisted workflow state across versions",[],{"hidden":35,"attrs":1052},{},"Handle schema changes when resuming workflows that were persisted with older step shapes.\n\n## The problem\n\nWhen you persist workflow state (for resume/replay), changing your workflow code can break compatibility with saved state:\n\n```typescript\n// Version 1: Step key was 'user:fetch'\nconst workflowV1 = createWorkflow({ fetchUser }, {\n  resumeState: savedState // Contains 'user:fetch'\n});\n\n// Version 2: You renamed the step key to 'user:load'\nconst workflowV2 = createWorkflow({ fetchUser }, {\n  resumeState: savedState // ❌ Key mismatch!\n});\n```\n\n## Solution: Versioned workflows\n\nUse versioning to migrate old state to new formats:\n\n```typescript\nimport {\n  createVersionedStateLoader,\n  createVersionedState,\n  createKeyRenameMigration,\n  type VersionedState\n} from '@jagreehal/workflow';\n\n// Define migrations\nconst migrations = {\n  1: createKeyRenameMigration({\n    'user:fetch': 'user:load',\n    'order:create': 'order:submit',\n  }),\n  2: createKeyRemoveMigration(['deprecated:step']),\n};\n\n// Create versioned loader\nconst loadVersionedState = createVersionedStateLoader({\n  version: 2, // Current version\n  migrations,\n});\n\n// Load and migrate state\nconst savedState = await db.loadWorkflowState(workflowId);\nconst versionedState = parseVersionedState(savedState);\nconst migratedState = await loadVersionedState(versionedState);\n\nif (migratedState.ok) {\n  const workflow = createWorkflow(deps, {\n    resumeState: migratedState.value,\n  });\n  // ...\n}\n```\n\n## Saving versioned state\n\nAlways save state with version information:\n\n```typescript\nimport { createStepCollector, createVersionedState, stringifyVersionedState } from '@jagreehal/workflow';\n\nconst collector = createStepCollector();\nconst workflow = createWorkflow(deps, {\n  onEvent: collector.handleEvent,\n});\n\nawait workflow(async (step) => {\n  // ...\n});\n\n// Save with version\nconst state = collector.getState();\nconst versionedState = createVersionedState(state, 2); // Current version\nconst json = stringifyVersionedState(versionedState);\nawait db.saveWorkflowState(workflowId, json);\n```\n\n## Migration helpers\n\n### Rename step keys\n\n```typescript\nimport { createKeyRenameMigration } from '@jagreehal/workflow';\n\nconst migrations = {\n  1: createKeyRenameMigration({\n    'old:key': 'new:key',\n    'user:fetch': 'user:load',\n  }),\n};\n```\n\n### Remove step keys\n\n```typescript\nimport { createKeyRemoveMigration } from '@jagreehal/workflow';\n\nconst migrations = {\n  1: createKeyRemoveMigration([\n    'deprecated:step',\n    'old:cache',\n  ]),\n};\n```\n\n### Transform step values\n\n```typescript\nimport { createValueTransformMigration } from '@jagreehal/workflow';\nimport { ok } from '@jagreehal/workflow';\n\nconst migrations = {\n  1: createValueTransformMigration({\n    'user:fetch': (entry) => ({\n      ...entry,\n      result: entry.result.ok\n        ? ok({\n            ...entry.result.value,\n            newField: 'default', // Add new required field\n          })\n        : entry.result,\n    }),\n  }),\n};\n```\n\n### Compose multiple migrations\n\n```typescript\nimport { composeMigrations } from '@jagreehal/workflow';\n\nconst migrations = {\n  1: composeMigrations([\n    createKeyRenameMigration({ 'old': 'new' }),\n    createKeyRemoveMigration(['deprecated']),\n    createValueTransformMigration({\n      'user:fetch': (entry) => ({ ...entry, /* transform */ }),\n    }),\n  ]),\n};\n```\n\n## Complete example\n\n```typescript\nimport {\n  createWorkflow,\n  createStepCollector,\n  createVersionedStateLoader,\n  createVersionedState,\n  parseVersionedState,\n  stringifyVersionedState,\n  createKeyRenameMigration,\n  createValueTransformMigration,\n} from '@jagreehal/workflow';\nimport { ok } from '@jagreehal/workflow';\n\n// Current workflow version\nconst CURRENT_VERSION = 2;\n\n// Define migrations\nconst migrations = {\n  // Migration from v1 to v2\n  1: createKeyRenameMigration({\n    'user:fetch': 'user:load',\n    'order:create': 'order:submit',\n  }),\n  // Migration from v2 to v3 (future)\n  2: createValueTransformMigration({\n    'user:load': (entry) => ({\n      ...entry,\n      result: entry.result.ok\n        ? ok({\n            ...entry.result.value,\n            emailVerified: false, // New required field\n          })\n        : entry.result,\n    }),\n  }),\n};\n\n// Create versioned loader\nconst loadVersionedState = createVersionedStateLoader({\n  version: CURRENT_VERSION,\n  migrations,\n  strictVersioning: true, // Fail if state is from future version\n});\n\n// Load workflow state\nasync function loadWorkflowState(workflowId: string) {\n  const saved = await db.loadWorkflowState(workflowId);\n  if (!saved) return undefined;\n\n  const versionedState = parseVersionedState(saved);\n  if (!versionedState) {\n    throw new Error('Invalid state format');\n  }\n\n  const migrated = await loadVersionedState(versionedState);\n  if (!migrated.ok) {\n    throw new Error(`Migration failed: ${migrated.error.type}`);\n  }\n\n  return migrated.value;\n}\n\n// Save workflow state\nasync function saveWorkflowState(workflowId: string, state: ResumeState) {\n  const versionedState = createVersionedState(state, CURRENT_VERSION);\n  const json = stringifyVersionedState(versionedState);\n  await db.saveWorkflowState(workflowId, json);\n}\n\n// Use in workflow\nconst workflow = createWorkflow(deps, {\n  resumeState: await loadWorkflowState(workflowId),\n  onEvent: (event) => {\n    // Collect state for saving\n    collector.handleEvent(event);\n  },\n});\n\nconst collector = createStepCollector();\nconst result = await workflow(async (step) => {\n  // ...\n});\n\n// Save state after execution\nawait saveWorkflowState(workflowId, collector.getState());\n```\n\n## Error handling\n\n### Migration errors\n\n```typescript\nimport { isMigrationError } from '@jagreehal/workflow';\n\nconst migrated = await loadVersionedState(versionedState);\n\nif (!migrated.ok) {\n  if (isMigrationError(migrated.error)) {\n    console.error(`Migration from ${migrated.error.fromVersion} to ${migrated.error.toVersion} failed:`, migrated.error.cause);\n  }\n}\n```\n\n### Version incompatibility\n\n```typescript\nimport { isVersionIncompatibleError } from '@jagreehal/workflow';\n\nif (!migrated.ok && isVersionIncompatibleError(migrated.error)) {\n  console.error(\n    `State version ${migrated.error.stateVersion} is incompatible with current version ${migrated.error.currentVersion}: ${migrated.error.reason}`\n  );\n}\n```\n\n## Strict versioning\n\nBy default, versioning is strict - it fails if state is from a future version:\n\n```typescript\nconst loader = createVersionedStateLoader({\n  version: 2,\n  migrations: { 1: migrateV1ToV2 },\n  strictVersioning: true, // Default: true\n});\n\n// If state is version 3 and current is 2, this fails\nconst migrated = await loader({ version: 3, state: ... });\n// Error: \"State version is higher than current workflow version\"\n```\n\nSet `strictVersioning: false` to allow future versions (not recommended):\n\n```typescript\nconst loader = createVersionedStateLoader({\n  version: 2,\n  migrations: { 1: migrateV1ToV2 },\n  strictVersioning: false, // Allow future versions\n});\n```\n\n## Best practices\n\n1. **Always version your state**: Save state with version information\n2. **Test migrations**: Write tests for each migration path\n3. **Incremental migrations**: Migrate one version at a time\n4. **Backward compatibility**: Keep old step keys in migrations for a few versions\n5. **Document changes**: Keep a changelog of state schema changes\n\n## Next\n\n[Learn about Persistence →](/workflow/guides/persistence/)","src/content/docs/guides/versioning.md","61be7b5ba066badb",{"html":1057,"metadata":1058},"\u003Cp>Handle schema changes when resuming workflows that were persisted with older step shapes.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"the-problem\">The problem\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#the-problem\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “The problem”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>When you persist workflow state (for resume/replay), changing your workflow code can break compatibility with saved state:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Version 1: Step key was 'user:fetch'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflowV1\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ fetchUser }, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  resumeState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> savedState \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Contains 'user:fetch'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Version 2: You renamed the step key to 'user:load'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflowV2\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ fetchUser }, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  resumeState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> savedState \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// ❌ Key mismatch!\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"// Version 1: Step key was &#x27;user:fetch&#x27;\nconst workflowV1 = createWorkflow({ fetchUser }, {\n  resumeState: savedState // Contains &#x27;user:fetch&#x27;\n});\n\n// Version 2: You renamed the step key to &#x27;user:load&#x27;\nconst workflowV2 = createWorkflow({ fetchUser }, {\n  resumeState: savedState // ❌ Key mismatch!\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"solution-versioned-workflows\">Solution: Versioned workflows\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#solution-versioned-workflows\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Solution: Versioned workflows”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use versioning to migrate old state to new formats:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createVersionedStateLoader\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createVersionedState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createKeyRenameMigration\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  type\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\"> VersionedState\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">} \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Define migrations\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> migrations\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">  1\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createKeyRenameMigration\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">    'user:fetch'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'user:load'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">    'order:create'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'order:submit'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">  2\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createKeyRemoveMigration\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'deprecated:step'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">]),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create versioned loader\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> loadVersionedState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createVersionedStateLoader\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  version\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 2\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Current version\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  migrations,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Load and migrate state\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> savedState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">loadWorkflowState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(workflowId);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> versionedState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> parseVersionedState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(savedState);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> migratedState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> loadVersionedState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(versionedState);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (migratedState.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    resumeState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> migratedState.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import {\n  createVersionedStateLoader,\n  createVersionedState,\n  createKeyRenameMigration,\n  type VersionedState\n} from &#x27;@jagreehal/workflow&#x27;;\n\n// Define migrations\nconst migrations = {\n  1: createKeyRenameMigration({\n    &#x27;user:fetch&#x27;: &#x27;user:load&#x27;,\n    &#x27;order:create&#x27;: &#x27;order:submit&#x27;,\n  }),\n  2: createKeyRemoveMigration([&#x27;deprecated:step&#x27;]),\n};\n\n// Create versioned loader\nconst loadVersionedState = createVersionedStateLoader({\n  version: 2, // Current version\n  migrations,\n});\n\n// Load and migrate state\nconst savedState = await db.loadWorkflowState(workflowId);\nconst versionedState = parseVersionedState(savedState);\nconst migratedState = await loadVersionedState(versionedState);\n\nif (migratedState.ok) {\n  const workflow = createWorkflow(deps, {\n    resumeState: migratedState.value,\n  });\n  // ...\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"saving-versioned-state\">Saving versioned state\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#saving-versioned-state\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Saving versioned state”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Always save state with version information:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createStepCollector\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createVersionedState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">stringifyVersionedState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> collector\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createStepCollector\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> collector.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Save with version\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> state\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> collector.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">getState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> versionedState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createVersionedState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(state, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">2\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">); \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Current version\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> json\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> stringifyVersionedState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(versionedState);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">saveWorkflowState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(workflowId, json);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createStepCollector, createVersionedState, stringifyVersionedState } from &#x27;@jagreehal/workflow&#x27;;\n\nconst collector = createStepCollector();\nconst workflow = createWorkflow(deps, {\n  onEvent: collector.handleEvent,\n});\n\nawait workflow(async (step) => {\n  // ...\n});\n\n// Save with version\nconst state = collector.getState();\nconst versionedState = createVersionedState(state, 2); // Current version\nconst json = stringifyVersionedState(versionedState);\nawait db.saveWorkflowState(workflowId, json);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"migration-helpers\">Migration helpers\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#migration-helpers\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Migration helpers”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"rename-step-keys\">Rename step keys\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#rename-step-keys\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Rename step keys”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createKeyRenameMigration\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> migrations\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">  1\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createKeyRenameMigration\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">    'old:key'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'new:key'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">    'user:fetch'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'user:load'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createKeyRenameMigration } from &#x27;@jagreehal/workflow&#x27;;\n\nconst migrations = {\n  1: createKeyRenameMigration({\n    &#x27;old:key&#x27;: &#x27;new:key&#x27;,\n    &#x27;user:fetch&#x27;: &#x27;user:load&#x27;,\n  }),\n};\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"remove-step-keys\">Remove step keys\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#remove-step-keys\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Remove step keys”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createKeyRemoveMigration\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> migrations\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">  1\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createKeyRemoveMigration\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">    'deprecated:step'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">    'old:cache'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  ]),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createKeyRemoveMigration } from &#x27;@jagreehal/workflow&#x27;;\n\nconst migrations = {\n  1: createKeyRemoveMigration([\n    &#x27;deprecated:step&#x27;,\n    &#x27;old:cache&#x27;,\n  ]),\n};\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"transform-step-values\">Transform step values\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#transform-step-values\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Transform step values”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createValueTransformMigration\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> migrations\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">  1\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createValueTransformMigration\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">    'user:fetch'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">entry\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> ({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">      ...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">entry,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> entry.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">result\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">        ?\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">            ...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">entry.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">result\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">            newField\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'default'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Add new required field\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">          })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">        :\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> entry.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">result\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createValueTransformMigration } from &#x27;@jagreehal/workflow&#x27;;\nimport { ok } from &#x27;@jagreehal/workflow&#x27;;\n\nconst migrations = {\n  1: createValueTransformMigration({\n    &#x27;user:fetch&#x27;: (entry) => ({\n      ...entry,\n      result: entry.result.ok\n        ? ok({\n            ...entry.result.value,\n            newField: &#x27;default&#x27;, // Add new required field\n          })\n        : entry.result,\n    }),\n  }),\n};\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"compose-multiple-migrations\">Compose multiple migrations\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#compose-multiple-migrations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Compose multiple migrations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">composeMigrations\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> migrations\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">  1\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> composeMigrations\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    createKeyRenameMigration\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'old'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'new'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    createKeyRemoveMigration\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'deprecated'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">]),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    createValueTransformMigration\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">      'user:fetch'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">entry\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> ({ \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">entry, \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">/* transform */\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  ]),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { composeMigrations } from &#x27;@jagreehal/workflow&#x27;;\n\nconst migrations = {\n  1: composeMigrations([\n    createKeyRenameMigration({ &#x27;old&#x27;: &#x27;new&#x27; }),\n    createKeyRemoveMigration([&#x27;deprecated&#x27;]),\n    createValueTransformMigration({\n      &#x27;user:fetch&#x27;: (entry) => ({ ...entry, /* transform */ }),\n    }),\n  ]),\n};\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"complete-example\">Complete example\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#complete-example\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Complete example”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createStepCollector\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createVersionedStateLoader\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createVersionedState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  parseVersionedState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  stringifyVersionedState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createKeyRenameMigration\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createValueTransformMigration\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">} \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Current workflow version\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> CURRENT_VERSION\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 2\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Define migrations\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> migrations\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Migration from v1 to v2\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">  1\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createKeyRenameMigration\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">    'user:fetch'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'user:load'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">    'order:create'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'order:submit'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Migration from v2 to v3 (future)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">  2\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createValueTransformMigration\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">    'user:load'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">entry\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> ({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">      ...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">entry,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> entry.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">result\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">        ?\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">            ...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">entry.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">result\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">            emailVerified\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> false\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// New required field\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">          })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">        :\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> entry.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">result\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create versioned loader\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> loadVersionedState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createVersionedStateLoader\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  version\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> CURRENT_VERSION\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  migrations,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  strictVersioning\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Fail if state is from future version\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Load workflow state\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> function\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> loadWorkflowState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">workflowId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> saved\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">loadWorkflowState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(workflowId);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">saved) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">return\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> undefined\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> versionedState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> parseVersionedState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(saved);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">versionedState) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    throw\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> new\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> Error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Invalid state format'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> migrated\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> loadVersionedState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(versionedState);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">migrated.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    throw\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> new\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> Error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`Migration failed: \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">migrated\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">type\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> migrated.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Save workflow state\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> function\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> saveWorkflowState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">workflowId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">state\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> ResumeState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> versionedState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createVersionedState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(state, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">CURRENT_VERSION\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> json\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> stringifyVersionedState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(versionedState);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">saveWorkflowState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(workflowId, json);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Use in workflow\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  resumeState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> loadWorkflowState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(workflowId),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">event\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">    // Collect state for saving\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    collector.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(event);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> collector\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createStepCollector\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Save state after execution\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> saveWorkflowState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(workflowId, collector.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">getState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import {\n  createWorkflow,\n  createStepCollector,\n  createVersionedStateLoader,\n  createVersionedState,\n  parseVersionedState,\n  stringifyVersionedState,\n  createKeyRenameMigration,\n  createValueTransformMigration,\n} from &#x27;@jagreehal/workflow&#x27;;\nimport { ok } from &#x27;@jagreehal/workflow&#x27;;\n\n// Current workflow version\nconst CURRENT_VERSION = 2;\n\n// Define migrations\nconst migrations = {\n  // Migration from v1 to v2\n  1: createKeyRenameMigration({\n    &#x27;user:fetch&#x27;: &#x27;user:load&#x27;,\n    &#x27;order:create&#x27;: &#x27;order:submit&#x27;,\n  }),\n  // Migration from v2 to v3 (future)\n  2: createValueTransformMigration({\n    &#x27;user:load&#x27;: (entry) => ({\n      ...entry,\n      result: entry.result.ok\n        ? ok({\n            ...entry.result.value,\n            emailVerified: false, // New required field\n          })\n        : entry.result,\n    }),\n  }),\n};\n\n// Create versioned loader\nconst loadVersionedState = createVersionedStateLoader({\n  version: CURRENT_VERSION,\n  migrations,\n  strictVersioning: true, // Fail if state is from future version\n});\n\n// Load workflow state\nasync function loadWorkflowState(workflowId: string) {\n  const saved = await db.loadWorkflowState(workflowId);\n  if (!saved) return undefined;\n\n  const versionedState = parseVersionedState(saved);\n  if (!versionedState) {\n    throw new Error(&#x27;Invalid state format&#x27;);\n  }\n\n  const migrated = await loadVersionedState(versionedState);\n  if (!migrated.ok) {\n    throw new Error(&#x60;Migration failed: ${migrated.error.type}&#x60;);\n  }\n\n  return migrated.value;\n}\n\n// Save workflow state\nasync function saveWorkflowState(workflowId: string, state: ResumeState) {\n  const versionedState = createVersionedState(state, CURRENT_VERSION);\n  const json = stringifyVersionedState(versionedState);\n  await db.saveWorkflowState(workflowId, json);\n}\n\n// Use in workflow\nconst workflow = createWorkflow(deps, {\n  resumeState: await loadWorkflowState(workflowId),\n  onEvent: (event) => {\n    // Collect state for saving\n    collector.handleEvent(event);\n  },\n});\n\nconst collector = createStepCollector();\nconst result = await workflow(async (step) => {\n  // ...\n});\n\n// Save state after execution\nawait saveWorkflowState(workflowId, collector.getState());\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"error-handling\">Error handling\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#error-handling\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Error handling”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"migration-errors\">Migration errors\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#migration-errors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Migration errors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">isMigrationError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> migrated\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> loadVersionedState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(versionedState);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">migrated.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">isMigrationError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(migrated.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`Migration from \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">migrated\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">fromVersion\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> to \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">migrated\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">toVersion\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> failed:`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, migrated.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">cause\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { isMigrationError } from &#x27;@jagreehal/workflow&#x27;;\n\nconst migrated = await loadVersionedState(versionedState);\n\nif (!migrated.ok) {\n  if (isMigrationError(migrated.error)) {\n    console.error(&#x60;Migration from ${migrated.error.fromVersion} to ${migrated.error.toVersion} failed:&#x60;, migrated.error.cause);\n  }\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"version-incompatibility\">Version incompatibility\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#version-incompatibility\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Version incompatibility”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">isVersionIncompatibleError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">migrated.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> &#x26;&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> isVersionIncompatibleError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(migrated.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">    `State version \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">migrated\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">stateVersion\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> is incompatible with current version \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">migrated\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">currentVersion\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">: \u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">migrated\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">reason\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { isVersionIncompatibleError } from &#x27;@jagreehal/workflow&#x27;;\n\nif (!migrated.ok &#x26;&#x26; isVersionIncompatibleError(migrated.error)) {\n  console.error(\n    &#x60;State version ${migrated.error.stateVersion} is incompatible with current version ${migrated.error.currentVersion}: ${migrated.error.reason}&#x60;\n  );\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"strict-versioning\">Strict versioning\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#strict-versioning\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Strict versioning”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>By default, versioning is strict - it fails if state is from a future version:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> loader\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createVersionedStateLoader\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  version\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 2\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  migrations\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">1\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> migrateV1ToV2 },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  strictVersioning\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Default: true\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// If state is version 3 and current is 2, this fails\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> migrated\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> loader\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">version\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">state\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> ...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Error: \"State version is higher than current workflow version\"\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const loader = createVersionedStateLoader({\n  version: 2,\n  migrations: { 1: migrateV1ToV2 },\n  strictVersioning: true, // Default: true\n});\n\n// If state is version 3 and current is 2, this fails\nconst migrated = await loader({ version: 3, state: ... });\n// Error: &#x22;State version is higher than current workflow version&#x22;\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>Set \u003Ccode dir=\"auto\">strictVersioning: false\u003C/code> to allow future versions (not recommended):\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> loader\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createVersionedStateLoader\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  version\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 2\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  migrations\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">1\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> migrateV1ToV2 },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  strictVersioning\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> false\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Allow future versions\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const loader = createVersionedStateLoader({\n  version: 2,\n  migrations: { 1: migrateV1ToV2 },\n  strictVersioning: false, // Allow future versions\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"best-practices\">Best practices\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#best-practices\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Best practices”\u003C/span>\u003C/a>\u003C/div>\n\u003Col>\n\u003Cli>\u003Cstrong>Always version your state\u003C/strong>: Save state with version information\u003C/li>\n\u003Cli>\u003Cstrong>Test migrations\u003C/strong>: Write tests for each migration path\u003C/li>\n\u003Cli>\u003Cstrong>Incremental migrations\u003C/strong>: Migrate one version at a time\u003C/li>\n\u003Cli>\u003Cstrong>Backward compatibility\u003C/strong>: Keep old step keys in migrations for a few versions\u003C/li>\n\u003Cli>\u003Cstrong>Document changes\u003C/strong>: Keep a changelog of state schema changes\u003C/li>\n\u003C/ol>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/workflow/guides/persistence/\">Learn about Persistence →\u003C/a>\u003C/p>",{"headings":1059,"localImagePaths":1097,"remoteImagePaths":1098,"frontmatter":1099,"imagePaths":1100},[1060,1063,1066,1069,1072,1075,1078,1081,1084,1085,1086,1089,1092,1095,1096],{"depth":57,"slug":1061,"text":1062},"the-problem","The problem",{"depth":57,"slug":1064,"text":1065},"solution-versioned-workflows","Solution: Versioned workflows",{"depth":57,"slug":1067,"text":1068},"saving-versioned-state","Saving versioned state",{"depth":57,"slug":1070,"text":1071},"migration-helpers","Migration helpers",{"depth":160,"slug":1073,"text":1074},"rename-step-keys","Rename step keys",{"depth":160,"slug":1076,"text":1077},"remove-step-keys","Remove step keys",{"depth":160,"slug":1079,"text":1080},"transform-step-values","Transform step values",{"depth":160,"slug":1082,"text":1083},"compose-multiple-migrations","Compose multiple migrations",{"depth":57,"slug":639,"text":640},{"depth":57,"slug":676,"text":677},{"depth":160,"slug":1087,"text":1088},"migration-errors","Migration errors",{"depth":160,"slug":1090,"text":1091},"version-incompatibility","Version incompatibility",{"depth":57,"slug":1093,"text":1094},"strict-versioning","Strict versioning",{"depth":57,"slug":79,"text":80},{"depth":57,"slug":384,"text":385},[],[],{"title":1048,"description":1049},[],"guides/testing",{"id":1101,"data":1103,"body":1109,"filePath":1110,"digest":1111,"rendered":1112},{"title":1104,"description":1105,"editUrl":16,"head":1106,"template":46,"sidebar":1107,"pagefind":16,"draft":35},"Testing","Test workflows deterministically",[],{"hidden":35,"attrs":1108},{},"Use the test harness to control step execution and verify workflow behavior.\n\n## Basic testing\n\n```typescript\nimport { createWorkflowHarness, okOutcome, errOutcome } from '@jagreehal/workflow';\nimport { describe, it, expect } from 'vitest';\n\ndescribe('checkout workflow', () => {\n  it('completes when payment succeeds', async () => {\n    const harness = createWorkflowHarness({\n      fetchOrder: okOutcome({ id: '123', total: 100 }),\n      chargeCard: okOutcome({ txId: 'tx-123' }),\n    });\n\n    const result = await harness.run(async (step) => {\n      const order = await step(fetchOrder('123'));\n      const payment = await step(chargeCard(order.total));\n      return { order, payment };\n    });\n\n    expect(result.ok).toBe(true);\n    expect(result.value.payment.txId).toBe('tx-123');\n  });\n\n  it('fails when payment is declined', async () => {\n    const harness = createWorkflowHarness({\n      fetchOrder: okOutcome({ id: '123', total: 100 }),\n      chargeCard: errOutcome('DECLINED'),\n    });\n\n    const result = await harness.run(async (step) => {\n      const order = await step(fetchOrder('123'));\n      const payment = await step(chargeCard(order.total));\n      return { order, payment };\n    });\n\n    expect(result.ok).toBe(false);\n    expect(result.error).toBe('DECLINED');\n  });\n});\n```\n\n## Scripted outcomes\n\nControl what each step returns:\n\n```typescript\nconst harness = createWorkflowHarness({\n  // Always succeeds\n  fetchUser: okOutcome({ id: '1', name: 'Alice' }),\n\n  // Always fails\n  sendEmail: errOutcome('EMAIL_FAILED'),\n\n  // Throws exception\n  badOperation: throwOutcome(new Error('Boom')),\n});\n```\n\n## Dynamic outcomes\n\nReturn different results based on input:\n\n```typescript\nconst harness = createWorkflowHarness({\n  fetchUser: (id: string) =>\n    id === '1'\n      ? okOutcome({ id, name: 'Alice' })\n      : errOutcome('NOT_FOUND'),\n});\n```\n\n## Mock functions\n\nTrack calls and change behavior:\n\n```typescript\nimport { createMockFn } from '@jagreehal/workflow';\n\nconst mockFetchUser = createMockFn\u003Ctypeof fetchUser>();\n\n// Set return value\nmockFetchUser.returns(okOutcome({ id: '1', name: 'Alice' }));\n\nconst harness = createWorkflowHarness({\n  fetchUser: mockFetchUser,\n});\n\nawait harness.run(async (step) => {\n  await step(fetchUser('1'));\n  await step(fetchUser('2'));\n});\n\n// Check calls\nexpect(mockFetchUser.calls.length).toBe(2);\nexpect(mockFetchUser.calls[0].args).toEqual(['1']);\nexpect(mockFetchUser.calls[1].args).toEqual(['2']);\n```\n\n## Testing retries\n\n```typescript\nconst mockFetch = createMockFn\u003Ctypeof fetchData>();\n\n// Fail twice, then succeed\nmockFetch\n  .onCall(0).returns(errOutcome('NETWORK_ERROR'))\n  .onCall(1).returns(errOutcome('NETWORK_ERROR'))\n  .onCall(2).returns(okOutcome({ data: 'success' }));\n\nconst harness = createWorkflowHarness({ fetchData: mockFetch });\n\nconst result = await harness.run(async (step) => {\n  return await step.retry(() => fetchData(), { attempts: 3 });\n});\n\nexpect(result.ok).toBe(true);\nexpect(mockFetch.calls.length).toBe(3);\n```\n\n## Snapshot testing\n\nCompare workflow behavior across changes:\n\n```typescript\nimport { createSnapshot, compareSnapshots } from '@jagreehal/workflow';\n\nconst harness = createWorkflowHarness(mocks);\n\nconst result = await harness.run(executor);\nconst snapshot = createSnapshot(harness.getInvocations());\n\n// Save to file or compare\nexpect(snapshot).toMatchSnapshot();\n```\n\n## Testing time-dependent workflows\n\nControl time in tests:\n\n```typescript\nimport { createTestClock } from '@jagreehal/workflow';\n\nconst clock = createTestClock();\n\nconst harness = createWorkflowHarness(mocks, { clock });\n\nawait harness.run(async (step) => {\n  const data = await step.withTimeout(() => fetchData(), { ms: 1000 });\n  return data;\n});\n\n// Advance time\nclock.tick(500);  // 500ms passed\nclock.tick(600);  // Now 1100ms, timeout triggers\n```\n\n## Assertions on step invocations\n\n```typescript\nconst result = await harness.run(executor);\n\nconst invocations = harness.getInvocations();\n\n// Check order\nexpect(invocations[0].name).toBe('fetchOrder');\nexpect(invocations[1].name).toBe('chargeCard');\n\n// Check that chargeCard was called after fetchOrder\nexpect(invocations[1].startedAt).toBeGreaterThan(invocations[0].completedAt);\n```\n\n## Full example\n\n```typescript\nimport { describe, it, expect, beforeEach } from 'vitest';\nimport {\n  createWorkflowHarness,\n  createMockFn,\n  okOutcome,\n  errOutcome,\n} from '@jagreehal/workflow';\n\ndescribe('refund workflow', () => {\n  let mockCalculateRefund: ReturnType\u003Ctypeof createMockFn>;\n  let mockProcessRefund: ReturnType\u003Ctypeof createMockFn>;\n  let harness: ReturnType\u003Ctypeof createWorkflowHarness>;\n\n  beforeEach(() => {\n    mockCalculateRefund = createMockFn();\n    mockProcessRefund = createMockFn();\n\n    mockCalculateRefund.returns(okOutcome({ amount: 50 }));\n    mockProcessRefund.returns(okOutcome({ refundId: 'ref-123' }));\n\n    harness = createWorkflowHarness({\n      calculateRefund: mockCalculateRefund,\n      processRefund: mockProcessRefund,\n    });\n  });\n\n  it('calculates and processes refund', async () => {\n    const result = await harness.run(async (step) => {\n      const refund = await step(calculateRefund('order-1'));\n      return await step(processRefund(refund));\n    });\n\n    expect(result.ok).toBe(true);\n    expect(result.value.refundId).toBe('ref-123');\n    expect(mockCalculateRefund.calls.length).toBe(1);\n    expect(mockProcessRefund.calls.length).toBe(1);\n  });\n\n  it('stops if calculation fails', async () => {\n    mockCalculateRefund.returns(errOutcome('ORDER_NOT_FOUND'));\n\n    const result = await harness.run(async (step) => {\n      const refund = await step(calculateRefund('order-1'));\n      return await step(processRefund(refund));\n    });\n\n    expect(result.ok).toBe(false);\n    expect(result.error).toBe('ORDER_NOT_FOUND');\n    expect(mockProcessRefund.calls.length).toBe(0); // Never called\n  });\n});\n```\n\n## Next\n\n[Learn about Batch Processing →](/workflow/guides/batch-processing/)","src/content/docs/guides/testing.md","60774127e37d732e",{"html":1113,"metadata":1114},"\u003Cp>Use the test harness to control step execution and verify workflow behavior.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"basic-testing\">Basic testing\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#basic-testing\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Basic testing”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createWorkflowHarness\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">okOutcome\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">errOutcome\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">describe\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">it\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">expect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'vitest'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">describe\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'checkout workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  it\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'completes when payment succeeds'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> harness\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflowHarness\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      fetchOrder\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> okOutcome\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">total\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 100\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      chargeCard\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> okOutcome\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">txId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'tx-123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> harness.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">run\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> order\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchOrder\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> payment\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">chargeCard\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(order.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">total\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { order, payment };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    expect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">toBe\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    expect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">payment\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">txId\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">toBe\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'tx-123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  it\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'fails when payment is declined'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> harness\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflowHarness\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      fetchOrder\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> okOutcome\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">total\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 100\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      chargeCard\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> errOutcome\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'DECLINED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> harness.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">run\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> order\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchOrder\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> payment\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">chargeCard\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(order.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">total\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { order, payment };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    expect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">toBe\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">false\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    expect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">toBe\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'DECLINED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createWorkflowHarness, okOutcome, errOutcome } from &#x27;@jagreehal/workflow&#x27;;\nimport { describe, it, expect } from &#x27;vitest&#x27;;\n\ndescribe(&#x27;checkout workflow&#x27;, () => {\n  it(&#x27;completes when payment succeeds&#x27;, async () => {\n    const harness = createWorkflowHarness({\n      fetchOrder: okOutcome({ id: &#x27;123&#x27;, total: 100 }),\n      chargeCard: okOutcome({ txId: &#x27;tx-123&#x27; }),\n    });\n\n    const result = await harness.run(async (step) => {\n      const order = await step(fetchOrder(&#x27;123&#x27;));\n      const payment = await step(chargeCard(order.total));\n      return { order, payment };\n    });\n\n    expect(result.ok).toBe(true);\n    expect(result.value.payment.txId).toBe(&#x27;tx-123&#x27;);\n  });\n\n  it(&#x27;fails when payment is declined&#x27;, async () => {\n    const harness = createWorkflowHarness({\n      fetchOrder: okOutcome({ id: &#x27;123&#x27;, total: 100 }),\n      chargeCard: errOutcome(&#x27;DECLINED&#x27;),\n    });\n\n    const result = await harness.run(async (step) => {\n      const order = await step(fetchOrder(&#x27;123&#x27;));\n      const payment = await step(chargeCard(order.total));\n      return { order, payment };\n    });\n\n    expect(result.ok).toBe(false);\n    expect(result.error).toBe(&#x27;DECLINED&#x27;);\n  });\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"scripted-outcomes\">Scripted outcomes\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#scripted-outcomes\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Scripted outcomes”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Control what each step returns:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> harness\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflowHarness\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Always succeeds\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> okOutcome\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Alice'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Always fails\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  sendEmail\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> errOutcome\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'EMAIL_FAILED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Throws exception\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  badOperation\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> throwOutcome\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">new\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> Error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Boom'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const harness = createWorkflowHarness({\n  // Always succeeds\n  fetchUser: okOutcome({ id: &#x27;1&#x27;, name: &#x27;Alice&#x27; }),\n\n  // Always fails\n  sendEmail: errOutcome(&#x27;EMAIL_FAILED&#x27;),\n\n  // Throws exception\n  badOperation: throwOutcome(new Error(&#x27;Boom&#x27;)),\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"dynamic-outcomes\">Dynamic outcomes\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#dynamic-outcomes\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Dynamic outcomes”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Return different results based on input:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> harness\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflowHarness\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    id \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">===\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '1'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">      ?\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> okOutcome\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ id, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Alice'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> })\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">      :\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> errOutcome\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const harness = createWorkflowHarness({\n  fetchUser: (id: string) =>\n    id === &#x27;1&#x27;\n      ? okOutcome({ id, name: &#x27;Alice&#x27; })\n      : errOutcome(&#x27;NOT_FOUND&#x27;),\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"mock-functions\">Mock functions\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#mock-functions\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Mock functions”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Track calls and change behavior:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createMockFn\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> mockFetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createMockFn\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">typeof\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> fetchUser>();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Set return value\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">mockFetchUser.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">returns\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">okOutcome\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Alice'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> harness\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflowHarness\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> mockFetchUser,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> harness.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">run\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'2'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Check calls\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">expect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(mockFetchUser.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">calls\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#6CB6FF\">length\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">toBe\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">2\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">expect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(mockFetchUser.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">calls\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">[\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">0\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">].\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">args\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">toEqual\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">]);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">expect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(mockFetchUser.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">calls\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">[\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">1\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">].\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">args\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">toEqual\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'2'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">]);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createMockFn } from &#x27;@jagreehal/workflow&#x27;;\n\nconst mockFetchUser = createMockFn\u003Ctypeof fetchUser>();\n\n// Set return value\nmockFetchUser.returns(okOutcome({ id: &#x27;1&#x27;, name: &#x27;Alice&#x27; }));\n\nconst harness = createWorkflowHarness({\n  fetchUser: mockFetchUser,\n});\n\nawait harness.run(async (step) => {\n  await step(fetchUser(&#x27;1&#x27;));\n  await step(fetchUser(&#x27;2&#x27;));\n});\n\n// Check calls\nexpect(mockFetchUser.calls.length).toBe(2);\nexpect(mockFetchUser.calls[0].args).toEqual([&#x27;1&#x27;]);\nexpect(mockFetchUser.calls[1].args).toEqual([&#x27;2&#x27;]);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"testing-retries\">Testing retries\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#testing-retries\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Testing retries”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> mockFetch\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createMockFn\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">typeof\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> fetchData>();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Fail twice, then succeed\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">mockFetch\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  .\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">onCall\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">0\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">returns\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">errOutcome\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'NETWORK_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  .\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">onCall\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">1\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">returns\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">errOutcome\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'NETWORK_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  .\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">onCall\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">2\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">returns\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">okOutcome\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">data\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'success'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> harness\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflowHarness\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">fetchData\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> mockFetch });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> harness.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">run\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> step.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">retry\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchData\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">attempts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">expect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">toBe\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">expect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(mockFetch.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">calls\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#6CB6FF\">length\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">toBe\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const mockFetch = createMockFn\u003Ctypeof fetchData>();\n\n// Fail twice, then succeed\nmockFetch\n  .onCall(0).returns(errOutcome(&#x27;NETWORK_ERROR&#x27;))\n  .onCall(1).returns(errOutcome(&#x27;NETWORK_ERROR&#x27;))\n  .onCall(2).returns(okOutcome({ data: &#x27;success&#x27; }));\n\nconst harness = createWorkflowHarness({ fetchData: mockFetch });\n\nconst result = await harness.run(async (step) => {\n  return await step.retry(() => fetchData(), { attempts: 3 });\n});\n\nexpect(result.ok).toBe(true);\nexpect(mockFetch.calls.length).toBe(3);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"snapshot-testing\">Snapshot testing\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#snapshot-testing\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Snapshot testing”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Compare workflow behavior across changes:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createSnapshot\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">compareSnapshots\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> harness\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflowHarness\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(mocks);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> harness.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">run\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(executor);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> snapshot\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createSnapshot\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(harness.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">getInvocations\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Save to file or compare\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">expect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(snapshot).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">toMatchSnapshot\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createSnapshot, compareSnapshots } from &#x27;@jagreehal/workflow&#x27;;\n\nconst harness = createWorkflowHarness(mocks);\n\nconst result = await harness.run(executor);\nconst snapshot = createSnapshot(harness.getInvocations());\n\n// Save to file or compare\nexpect(snapshot).toMatchSnapshot();\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"testing-time-dependent-workflows\">Testing time-dependent workflows\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#testing-time-dependent-workflows\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Testing time-dependent workflows”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Control time in tests:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createTestClock\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> clock\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createTestClock\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> harness\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflowHarness\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(mocks, { clock });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> harness.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">run\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> data\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> step.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">withTimeout\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchData\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(), { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ms\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 1000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> data;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Advance time\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">clock.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">tick\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">500\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// 500ms passed\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">clock.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">tick\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">600\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Now 1100ms, timeout triggers\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createTestClock } from &#x27;@jagreehal/workflow&#x27;;\n\nconst clock = createTestClock();\n\nconst harness = createWorkflowHarness(mocks, { clock });\n\nawait harness.run(async (step) => {\n  const data = await step.withTimeout(() => fetchData(), { ms: 1000 });\n  return data;\n});\n\n// Advance time\nclock.tick(500);  // 500ms passed\nclock.tick(600);  // Now 1100ms, timeout triggers\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"assertions-on-step-invocations\">Assertions on step invocations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#assertions-on-step-invocations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Assertions on step invocations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> harness.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">run\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(executor);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> invocations\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> harness.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">getInvocations\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Check order\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">expect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(invocations[\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">0\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">].\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">toBe\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'fetchOrder'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">expect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(invocations[\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">1\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">].\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">toBe\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'chargeCard'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Check that chargeCard was called after fetchOrder\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">expect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(invocations[\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">1\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">].\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">startedAt\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">toBeGreaterThan\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(invocations[\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">0\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">].\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">completedAt\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await harness.run(executor);\n\nconst invocations = harness.getInvocations();\n\n// Check order\nexpect(invocations[0].name).toBe(&#x27;fetchOrder&#x27;);\nexpect(invocations[1].name).toBe(&#x27;chargeCard&#x27;);\n\n// Check that chargeCard was called after fetchOrder\nexpect(invocations[1].startedAt).toBeGreaterThan(invocations[0].completedAt);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"full-example\">Full example\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#full-example\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Full example”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">describe\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">it\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">expect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">beforeEach\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'vitest'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createWorkflowHarness\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createMockFn\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  okOutcome\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  errOutcome\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">} \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">describe\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'refund workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  let\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> mockCalculateRefund\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> ReturnType\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">typeof\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> createMockFn>;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  let\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> mockProcessRefund\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> ReturnType\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">typeof\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> createMockFn>;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  let\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> harness\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> ReturnType\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">typeof\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> createWorkflowHarness>;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  beforeEach\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    mockCalculateRefund \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">=\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createMockFn\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    mockProcessRefund \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">=\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createMockFn\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    mockCalculateRefund.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">returns\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">okOutcome\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">amount\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 50\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    mockProcessRefund.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">returns\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">okOutcome\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">refundId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'ref-123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    harness \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">=\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflowHarness\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      calculateRefund\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> mockCalculateRefund,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      processRefund\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> mockProcessRefund,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  it\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'calculates and processes refund'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> harness.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">run\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> refund\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">calculateRefund\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'order-1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      return\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">processRefund\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(refund));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    expect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">toBe\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    expect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">refundId\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">toBe\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'ref-123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    expect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(mockCalculateRefund.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">calls\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#6CB6FF\">length\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">toBe\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">1\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    expect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(mockProcessRefund.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">calls\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#6CB6FF\">length\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">toBe\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">1\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  it\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'stops if calculation fails'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    mockCalculateRefund.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">returns\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">errOutcome\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'ORDER_NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> harness.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">run\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> refund\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">calculateRefund\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'order-1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      return\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">processRefund\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(refund));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    expect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">toBe\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">false\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    expect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">toBe\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'ORDER_NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    expect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(mockProcessRefund.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">calls\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#6CB6FF\">length\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">toBe\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">0\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">); \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Never called\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { describe, it, expect, beforeEach } from &#x27;vitest&#x27;;\nimport {\n  createWorkflowHarness,\n  createMockFn,\n  okOutcome,\n  errOutcome,\n} from &#x27;@jagreehal/workflow&#x27;;\n\ndescribe(&#x27;refund workflow&#x27;, () => {\n  let mockCalculateRefund: ReturnType\u003Ctypeof createMockFn>;\n  let mockProcessRefund: ReturnType\u003Ctypeof createMockFn>;\n  let harness: ReturnType\u003Ctypeof createWorkflowHarness>;\n\n  beforeEach(() => {\n    mockCalculateRefund = createMockFn();\n    mockProcessRefund = createMockFn();\n\n    mockCalculateRefund.returns(okOutcome({ amount: 50 }));\n    mockProcessRefund.returns(okOutcome({ refundId: &#x27;ref-123&#x27; }));\n\n    harness = createWorkflowHarness({\n      calculateRefund: mockCalculateRefund,\n      processRefund: mockProcessRefund,\n    });\n  });\n\n  it(&#x27;calculates and processes refund&#x27;, async () => {\n    const result = await harness.run(async (step) => {\n      const refund = await step(calculateRefund(&#x27;order-1&#x27;));\n      return await step(processRefund(refund));\n    });\n\n    expect(result.ok).toBe(true);\n    expect(result.value.refundId).toBe(&#x27;ref-123&#x27;);\n    expect(mockCalculateRefund.calls.length).toBe(1);\n    expect(mockProcessRefund.calls.length).toBe(1);\n  });\n\n  it(&#x27;stops if calculation fails&#x27;, async () => {\n    mockCalculateRefund.returns(errOutcome(&#x27;ORDER_NOT_FOUND&#x27;));\n\n    const result = await harness.run(async (step) => {\n      const refund = await step(calculateRefund(&#x27;order-1&#x27;));\n      return await step(processRefund(refund));\n    });\n\n    expect(result.ok).toBe(false);\n    expect(result.error).toBe(&#x27;ORDER_NOT_FOUND&#x27;);\n    expect(mockProcessRefund.calls.length).toBe(0); // Never called\n  });\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"next\">Next\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#next\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Next”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ca href=\"/workflow/guides/batch-processing/\">Learn about Batch Processing →\u003C/a>\u003C/p>",{"headings":1115,"localImagePaths":1142,"remoteImagePaths":1143,"frontmatter":1144,"imagePaths":1145},[1116,1119,1122,1125,1128,1131,1134,1137,1140,1141],{"depth":57,"slug":1117,"text":1118},"basic-testing","Basic testing",{"depth":57,"slug":1120,"text":1121},"scripted-outcomes","Scripted outcomes",{"depth":57,"slug":1123,"text":1124},"dynamic-outcomes","Dynamic outcomes",{"depth":57,"slug":1126,"text":1127},"mock-functions","Mock functions",{"depth":57,"slug":1129,"text":1130},"testing-retries","Testing retries",{"depth":57,"slug":1132,"text":1133},"snapshot-testing","Snapshot testing",{"depth":57,"slug":1135,"text":1136},"testing-time-dependent-workflows","Testing time-dependent workflows",{"depth":57,"slug":1138,"text":1139},"assertions-on-step-invocations","Assertions on step invocations",{"depth":57,"slug":685,"text":686},{"depth":57,"slug":384,"text":385},[],[],{"title":1104,"description":1105},[],"patterns/checkout-flow",{"id":1146,"data":1148,"body":1154,"filePath":1155,"digest":1156,"rendered":1157},{"title":1149,"description":1150,"editUrl":16,"head":1151,"template":46,"sidebar":1152,"pagefind":16,"draft":35},"Checkout Flow","A complete e-commerce checkout workflow",[],{"hidden":35,"attrs":1153},{},"A checkout workflow demonstrating validation, payment, and order creation with typed errors.\n\n## Define the operations\n\n```typescript\nimport { ok, err, type AsyncResult } from '@jagreehal/workflow';\n\ntype CartItem = { productId: string; quantity: number; price: number };\ntype Order = { id: string; items: CartItem[]; total: number };\ntype Payment = { transactionId: string; amount: number };\n\nconst validateCart = async (\n  items: CartItem[]\n): AsyncResult\u003CCartItem[], 'EMPTY_CART' | 'INVALID_QUANTITY'> => {\n  if (items.length === 0) return err('EMPTY_CART');\n  if (items.some((i) => i.quantity \u003C= 0)) return err('INVALID_QUANTITY');\n  return ok(items);\n};\n\nconst checkInventory = async (\n  items: CartItem[]\n): AsyncResult\u003CCartItem[], 'OUT_OF_STOCK'> => {\n  // Check each item against inventory\n  const available = await Promise.all(\n    items.map((item) => inventory.check(item.productId, item.quantity))\n  );\n  if (available.some((a) => !a)) return err('OUT_OF_STOCK');\n  return ok(items);\n};\n\nconst calculateTotal = async (\n  items: CartItem[]\n): AsyncResult\u003Cnumber, 'PRICING_ERROR'> => {\n  try {\n    const total = items.reduce((sum, item) => sum + item.price * item.quantity, 0);\n    return ok(total);\n  } catch {\n    return err('PRICING_ERROR');\n  }\n};\n\nconst processPayment = async (\n  amount: number,\n  paymentMethod: string\n): AsyncResult\u003CPayment, 'PAYMENT_DECLINED' | 'PAYMENT_ERROR'> => {\n  const result = await paymentProvider.charge(amount, paymentMethod);\n  if (result.declined) return err('PAYMENT_DECLINED');\n  if (result.error) return err('PAYMENT_ERROR');\n  return ok({ transactionId: result.id, amount });\n};\n\nconst createOrder = async (\n  items: CartItem[],\n  payment: Payment\n): AsyncResult\u003COrder, 'ORDER_CREATION_FAILED'> => {\n  try {\n    const order = await db.orders.create({\n      items,\n      total: payment.amount,\n      paymentId: payment.transactionId,\n    });\n    return ok(order);\n  } catch {\n    return err('ORDER_CREATION_FAILED');\n  }\n};\n```\n\n## Create the workflow\n\n```typescript\nimport { createWorkflow } from '@jagreehal/workflow';\n\nconst checkout = createWorkflow({\n  validateCart,\n  checkInventory,\n  calculateTotal,\n  processPayment,\n  createOrder,\n});\n```\n\n## Execute\n\n```typescript\nconst result = await checkout(async (step) => {\n  // Validate and check inventory\n  const validItems = await step(validateCart(cartItems));\n  const availableItems = await step(checkInventory(validItems));\n\n  // Calculate and charge\n  const total = await step(calculateTotal(availableItems));\n  const payment = await step(processPayment(total, paymentMethodId));\n\n  // Create order\n  const order = await step(createOrder(availableItems, payment));\n\n  return order;\n});\n```\n\n## Handle errors\n\n```typescript\nif (result.ok) {\n  return res.json({ orderId: result.value.id });\n}\n\nswitch (result.error) {\n  case 'EMPTY_CART':\n    return res.status(400).json({ error: 'Cart is empty' });\n  case 'INVALID_QUANTITY':\n    return res.status(400).json({ error: 'Invalid quantity' });\n  case 'OUT_OF_STOCK':\n    return res.status(409).json({ error: 'Some items are out of stock' });\n  case 'PRICING_ERROR':\n    return res.status(500).json({ error: 'Failed to calculate price' });\n  case 'PAYMENT_DECLINED':\n    return res.status(402).json({ error: 'Payment was declined' });\n  case 'PAYMENT_ERROR':\n    return res.status(502).json({ error: 'Payment provider error' });\n  case 'ORDER_CREATION_FAILED':\n    return res.status(500).json({ error: 'Failed to create order' });\n  default:\n    // UnexpectedError\n    console.error(result.error);\n    return res.status(500).json({ error: 'Internal error' });\n}\n```\n\n## With retries and visualization\n\n```typescript\nimport { createVisualizer } from '@jagreehal/workflow/visualize';\n\nconst viz = createVisualizer({ workflowName: 'checkout' });\n\nconst checkout = createWorkflow(deps, {\n  onEvent: viz.handleEvent,\n});\n\nconst result = await checkout(async (step) => {\n  const validItems = await step(\n    () => validateCart(cartItems),\n    { name: 'Validate cart' }\n  );\n\n  const availableItems = await step(\n    () => checkInventory(validItems),\n    { name: 'Check inventory' }\n  );\n\n  const total = await step(\n    () => calculateTotal(availableItems),\n    { name: 'Calculate total' }\n  );\n\n  // Retry payment with exponential backoff\n  const payment = await step.retry(\n    () => processPayment(total, paymentMethodId),\n    {\n      attempts: 3,\n      backoff: 'exponential',\n      delayMs: 500,\n      retryOn: (error) => error === 'PAYMENT_ERROR', // Don't retry declined\n    }\n  );\n\n  const order = await step(\n    () => createOrder(availableItems, payment),\n    { name: 'Create order' }\n  );\n\n  return order;\n});\n\n// Log visualization\nconsole.log(viz.render());\n```\n\n## With idempotency\n\nUse keys to make the workflow resumable:\n\n```typescript\nconst result = await checkout(async (step) => {\n  const validItems = await step(\n    () => validateCart(cartItems),\n    { key: `validate:${sessionId}` }\n  );\n\n  const availableItems = await step(\n    () => checkInventory(validItems),\n    { key: `inventory:${sessionId}` }\n  );\n\n  const total = await step(\n    () => calculateTotal(availableItems),\n    { key: `total:${sessionId}` }\n  );\n\n  // Critical: payment with idempotency key\n  const payment = await step(\n    () => processPayment(total, paymentMethodId),\n    { key: `payment:${idempotencyKey}` }\n  );\n\n  const order = await step(\n    () => createOrder(availableItems, payment),\n    { key: `order:${idempotencyKey}` }\n  );\n\n  return order;\n});\n```\n\nIf the workflow crashes after payment but before order creation, rerunning with the same `idempotencyKey` returns the cached payment instead of charging again.","src/content/docs/patterns/checkout-flow.md","b854c305af8a09f2",{"html":1158,"metadata":1159},"\u003Cp>A checkout workflow demonstrating validation, payment, and order creation with typed errors.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"define-the-operations\">Define the operations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#define-the-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Define the operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> CartItem\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">productId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">; \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">quantity\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> number\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">; \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">price\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> number\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> Order\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">; \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">items\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> CartItem\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">[]; \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">total\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> number\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> Payment\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">transactionId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">; \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">amount\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> number\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> validateCart\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  items\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> CartItem\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">[]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">CartItem\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">[], \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'EMPTY_CART'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'INVALID_QUANTITY'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (items.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#6CB6FF\">length\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> ===\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 0\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'EMPTY_CART'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (items.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">some\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">((\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">i\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> i.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">quantity\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> &#x3C;=\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 0\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'INVALID_QUANTITY'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(items);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> checkInventory\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  items\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> CartItem\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">[]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">CartItem\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">[], \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'OUT_OF_STOCK'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Check each item against inventory\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> available\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#6CB6FF\"> Promise\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">all\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    items.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">map\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">((\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">item\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> inventory.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">check\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(item.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">productId\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, item.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">quantity\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (available.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">some\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">((\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">a\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> !\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">a)) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'OUT_OF_STOCK'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(items);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> calculateTotal\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  items\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> CartItem\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">[]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\">number\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'PRICING_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  try\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> total\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> items.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">reduce\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">((\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">sum\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">item\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> sum \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">+\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> item.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">price\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> *\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> item.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">quantity\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">0\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(total);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">catch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'PRICING_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> processPayment\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  amount\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> number\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  paymentMethod\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">Payment\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'PAYMENT_DECLINED'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'PAYMENT_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> paymentProvider.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">charge\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(amount, paymentMethod);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">declined\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'PAYMENT_DECLINED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'PAYMENT_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">transactionId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, amount });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createOrder\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  items\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> CartItem\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">[],\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  payment\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> Payment\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">Order\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'ORDER_CREATION_FAILED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  try\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> order\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">orders\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">create\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      items,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      total\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> payment.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">amount\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      paymentId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> payment.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">transactionId\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(order);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">catch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'ORDER_CREATION_FAILED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { ok, err, type AsyncResult } from &#x27;@jagreehal/workflow&#x27;;\n\ntype CartItem = { productId: string; quantity: number; price: number };\ntype Order = { id: string; items: CartItem[]; total: number };\ntype Payment = { transactionId: string; amount: number };\n\nconst validateCart = async (\n  items: CartItem[]\n): AsyncResult\u003CCartItem[], &#x27;EMPTY_CART&#x27; | &#x27;INVALID_QUANTITY&#x27;> => {\n  if (items.length === 0) return err(&#x27;EMPTY_CART&#x27;);\n  if (items.some((i) => i.quantity \u003C= 0)) return err(&#x27;INVALID_QUANTITY&#x27;);\n  return ok(items);\n};\n\nconst checkInventory = async (\n  items: CartItem[]\n): AsyncResult\u003CCartItem[], &#x27;OUT_OF_STOCK&#x27;> => {\n  // Check each item against inventory\n  const available = await Promise.all(\n    items.map((item) => inventory.check(item.productId, item.quantity))\n  );\n  if (available.some((a) => !a)) return err(&#x27;OUT_OF_STOCK&#x27;);\n  return ok(items);\n};\n\nconst calculateTotal = async (\n  items: CartItem[]\n): AsyncResult\u003Cnumber, &#x27;PRICING_ERROR&#x27;> => {\n  try {\n    const total = items.reduce((sum, item) => sum + item.price * item.quantity, 0);\n    return ok(total);\n  } catch {\n    return err(&#x27;PRICING_ERROR&#x27;);\n  }\n};\n\nconst processPayment = async (\n  amount: number,\n  paymentMethod: string\n): AsyncResult\u003CPayment, &#x27;PAYMENT_DECLINED&#x27; | &#x27;PAYMENT_ERROR&#x27;> => {\n  const result = await paymentProvider.charge(amount, paymentMethod);\n  if (result.declined) return err(&#x27;PAYMENT_DECLINED&#x27;);\n  if (result.error) return err(&#x27;PAYMENT_ERROR&#x27;);\n  return ok({ transactionId: result.id, amount });\n};\n\nconst createOrder = async (\n  items: CartItem[],\n  payment: Payment\n): AsyncResult\u003COrder, &#x27;ORDER_CREATION_FAILED&#x27;> => {\n  try {\n    const order = await db.orders.create({\n      items,\n      total: payment.amount,\n      paymentId: payment.transactionId,\n    });\n    return ok(order);\n  } catch {\n    return err(&#x27;ORDER_CREATION_FAILED&#x27;);\n  }\n};\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"create-the-workflow\">Create the workflow\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#create-the-workflow\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Create the workflow”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> checkout\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  validateCart,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  checkInventory,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  calculateTotal,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  processPayment,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  createOrder,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createWorkflow } from &#x27;@jagreehal/workflow&#x27;;\n\nconst checkout = createWorkflow({\n  validateCart,\n  checkInventory,\n  calculateTotal,\n  processPayment,\n  createOrder,\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"execute\">Execute\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#execute\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Execute”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> checkout\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Validate and check inventory\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> validItems\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">validateCart\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(cartItems));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> availableItems\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">checkInventory\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(validItems));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Calculate and charge\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> total\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">calculateTotal\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(availableItems));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> payment\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">processPayment\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(total, paymentMethodId));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Create order\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> order\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createOrder\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(availableItems, payment));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> order;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await checkout(async (step) => {\n  // Validate and check inventory\n  const validItems = await step(validateCart(cartItems));\n  const availableItems = await step(checkInventory(validItems));\n\n  // Calculate and charge\n  const total = await step(calculateTotal(availableItems));\n  const payment = await step(processPayment(total, paymentMethodId));\n\n  // Create order\n  const order = await step(createOrder(availableItems, payment));\n\n  return order;\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"handle-errors\">Handle errors\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#handle-errors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Handle errors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> res.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">json\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">orderId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">switch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  case\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'EMPTY_CART'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> res.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">status\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">400\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">json\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Cart is empty'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  case\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'INVALID_QUANTITY'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> res.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">status\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">400\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">json\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Invalid quantity'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  case\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'OUT_OF_STOCK'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> res.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">status\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">409\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">json\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Some items are out of stock'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  case\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'PRICING_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> res.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">status\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">500\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">json\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Failed to calculate price'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  case\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'PAYMENT_DECLINED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> res.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">status\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">402\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">json\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Payment was declined'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  case\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'PAYMENT_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> res.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">status\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">502\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">json\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Payment provider error'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  case\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'ORDER_CREATION_FAILED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> res.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">status\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">500\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">json\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Failed to create order'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  default\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">    // UnexpectedError\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> res.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">status\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">500\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">).\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">json\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Internal error'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"if (result.ok) {\n  return res.json({ orderId: result.value.id });\n}\n\nswitch (result.error) {\n  case &#x27;EMPTY_CART&#x27;:\n    return res.status(400).json({ error: &#x27;Cart is empty&#x27; });\n  case &#x27;INVALID_QUANTITY&#x27;:\n    return res.status(400).json({ error: &#x27;Invalid quantity&#x27; });\n  case &#x27;OUT_OF_STOCK&#x27;:\n    return res.status(409).json({ error: &#x27;Some items are out of stock&#x27; });\n  case &#x27;PRICING_ERROR&#x27;:\n    return res.status(500).json({ error: &#x27;Failed to calculate price&#x27; });\n  case &#x27;PAYMENT_DECLINED&#x27;:\n    return res.status(402).json({ error: &#x27;Payment was declined&#x27; });\n  case &#x27;PAYMENT_ERROR&#x27;:\n    return res.status(502).json({ error: &#x27;Payment provider error&#x27; });\n  case &#x27;ORDER_CREATION_FAILED&#x27;:\n    return res.status(500).json({ error: &#x27;Failed to create order&#x27; });\n  default:\n    // UnexpectedError\n    console.error(result.error);\n    return res.status(500).json({ error: &#x27;Internal error&#x27; });\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"with-retries-and-visualization\">With retries and visualization\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#with-retries-and-visualization\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “With retries and visualization”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createVisualizer\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/visualize'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> viz\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createVisualizer\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">workflowName\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'checkout'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> checkout\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> viz.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> checkout\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> validItems\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> validateCart\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(cartItems),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Validate cart'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> availableItems\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> checkInventory\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(validItems),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Check inventory'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> total\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> calculateTotal\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(availableItems),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Calculate total'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Retry payment with exponential backoff\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> payment\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> step.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">retry\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> processPayment\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(total, paymentMethodId),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      attempts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      backoff\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'exponential'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      delayMs\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 500\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      retryOn\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> error \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">===\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'PAYMENT_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Don't retry declined\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> order\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createOrder\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(availableItems, payment),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Create order'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> order;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Log visualization\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(viz.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">render\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createVisualizer } from &#x27;@jagreehal/workflow/visualize&#x27;;\n\nconst viz = createVisualizer({ workflowName: &#x27;checkout&#x27; });\n\nconst checkout = createWorkflow(deps, {\n  onEvent: viz.handleEvent,\n});\n\nconst result = await checkout(async (step) => {\n  const validItems = await step(\n    () => validateCart(cartItems),\n    { name: &#x27;Validate cart&#x27; }\n  );\n\n  const availableItems = await step(\n    () => checkInventory(validItems),\n    { name: &#x27;Check inventory&#x27; }\n  );\n\n  const total = await step(\n    () => calculateTotal(availableItems),\n    { name: &#x27;Calculate total&#x27; }\n  );\n\n  // Retry payment with exponential backoff\n  const payment = await step.retry(\n    () => processPayment(total, paymentMethodId),\n    {\n      attempts: 3,\n      backoff: &#x27;exponential&#x27;,\n      delayMs: 500,\n      retryOn: (error) => error === &#x27;PAYMENT_ERROR&#x27;, // Don&#x27;t retry declined\n    }\n  );\n\n  const order = await step(\n    () => createOrder(availableItems, payment),\n    { name: &#x27;Create order&#x27; }\n  );\n\n  return order;\n});\n\n// Log visualization\nconsole.log(viz.render());\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"with-idempotency\">With idempotency\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#with-idempotency\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “With idempotency”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use keys to make the workflow resumable:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> checkout\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> validItems\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> validateCart\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(cartItems),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `validate:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">sessionId\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> availableItems\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> checkInventory\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(validItems),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `inventory:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">sessionId\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> total\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> calculateTotal\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(availableItems),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `total:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">sessionId\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Critical: payment with idempotency key\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> payment\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> processPayment\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(total, paymentMethodId),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `payment:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">idempotencyKey\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> order\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createOrder\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(availableItems, payment),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `order:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">idempotencyKey\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> order;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await checkout(async (step) => {\n  const validItems = await step(\n    () => validateCart(cartItems),\n    { key: &#x60;validate:${sessionId}&#x60; }\n  );\n\n  const availableItems = await step(\n    () => checkInventory(validItems),\n    { key: &#x60;inventory:${sessionId}&#x60; }\n  );\n\n  const total = await step(\n    () => calculateTotal(availableItems),\n    { key: &#x60;total:${sessionId}&#x60; }\n  );\n\n  // Critical: payment with idempotency key\n  const payment = await step(\n    () => processPayment(total, paymentMethodId),\n    { key: &#x60;payment:${idempotencyKey}&#x60; }\n  );\n\n  const order = await step(\n    () => createOrder(availableItems, payment),\n    { key: &#x60;order:${idempotencyKey}&#x60; }\n  );\n\n  return order;\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>If the workflow crashes after payment but before order creation, rerunning with the same \u003Ccode dir=\"auto\">idempotencyKey\u003C/code> returns the cached payment instead of charging again.\u003C/p>",{"headings":1160,"localImagePaths":1177,"remoteImagePaths":1178,"frontmatter":1179,"imagePaths":1180},[1161,1164,1165,1168,1171,1174],{"depth":57,"slug":1162,"text":1163},"define-the-operations","Define the operations",{"depth":57,"slug":630,"text":631},{"depth":57,"slug":1166,"text":1167},"execute","Execute",{"depth":57,"slug":1169,"text":1170},"handle-errors","Handle errors",{"depth":57,"slug":1172,"text":1173},"with-retries-and-visualization","With retries and visualization",{"depth":57,"slug":1175,"text":1176},"with-idempotency","With idempotency",[],[],{"title":1149,"description":1150},[],"patterns/parallel-operations",{"id":1181,"data":1183,"body":1189,"filePath":1190,"digest":1191,"rendered":1192},{"title":1184,"description":1185,"editUrl":16,"head":1186,"template":46,"sidebar":1187,"pagefind":16,"draft":35},"Parallel Operations","Run multiple operations concurrently",[],{"hidden":35,"attrs":1188},{},"Execute multiple operations in parallel while maintaining typed error handling.\n\n## Basic parallel execution\n\nUse `allAsync` to run operations concurrently:\n\n```typescript\nimport { allAsync, createWorkflow } from '@jagreehal/workflow';\n\nconst workflow = createWorkflow({ fetchUser, fetchPosts, fetchComments });\n\nconst result = await workflow(async (step) => {\n  const [user, posts, comments] = await step(() =>\n    allAsync([\n      fetchUser('1'),\n      fetchPosts('1'),\n      fetchComments('1'),\n    ])\n  );\n\n  return { user, posts, comments };\n});\n```\n\n## Fail-fast behavior\n\n`allAsync` stops on the first error:\n\n```typescript\nconst result = await allAsync([\n  fetchUser('1'),        // Takes 100ms, succeeds\n  fetchPosts('999'),     // Takes 50ms, fails with 'NOT_FOUND'\n  fetchComments('1'),    // Takes 200ms, never completes\n]);\n\n// result.ok === false\n// result.error === 'NOT_FOUND'\n```\n\n## Collect all results\n\nUse `allSettledAsync` to get all results regardless of failures:\n\n```typescript\nimport { allSettledAsync } from '@jagreehal/workflow';\n\nconst result = await allSettledAsync([\n  fetchUser('1'),      // Succeeds\n  fetchPosts('999'),   // Fails\n  fetchComments('1'),  // Succeeds\n]);\n\nif (result.ok) {\n  result.value.forEach((item) => {\n    if (item.status === 'ok') {\n      console.log('Success:', item.value);\n    } else {\n      console.log('Failed:', item.error);\n    }\n  });\n}\n```\n\n## Partition successes and failures\n\n```typescript\nimport { partition } from '@jagreehal/workflow';\n\nconst results = await Promise.all([\n  fetchUser('1'),\n  fetchUser('2'),\n  fetchUser('999'),\n]);\n\nconst [successes, failures] = partition(results);\n// successes: [User, User]\n// failures: ['NOT_FOUND']\n```\n\n## Named parallel operations\n\nGive parallel groups a name for visualization:\n\n```typescript\nconst result = await workflow(async (step) => {\n  const [user, posts] = await step(\n    () => allAsync([fetchUser('1'), fetchPosts('1')]),\n    { name: 'Fetch user data' }\n  );\n\n  return { user, posts };\n});\n```\n\n## Race to first success\n\nUse `anyAsync` to get the first successful result:\n\n```typescript\nimport { anyAsync } from '@jagreehal/workflow';\n\n// Try multiple API endpoints, use first to respond\nconst result = await anyAsync([\n  fetchFromPrimary(id),\n  fetchFromBackup(id),\n  fetchFromCache(id),\n]);\n\nif (result.ok) {\n  // Got data from whichever responded first\n  console.log(result.value);\n}\n```\n\n## Bounded concurrency\n\nFor large sets, use `processInBatches`:\n\n```typescript\nimport { processInBatches } from '@jagreehal/workflow/batch';\n\nconst result = await processInBatches(\n  userIds,\n  (id) => fetchUser(id),\n  { batchSize: 20, concurrency: 5 }\n);\n```\n\nSee [Batch Processing](/workflow/guides/batch-processing/) for details.\n\n## Parallel with dependencies\n\nSome operations depend on others:\n\n```typescript\nconst result = await workflow(async (step) => {\n  // Fetch user first\n  const user = await step(fetchUser('1'));\n\n  // Then fetch user's data in parallel\n  const [posts, friends, settings] = await step(() =>\n    allAsync([\n      fetchPosts(user.id),\n      fetchFriends(user.id),\n      fetchSettings(user.id),\n    ])\n  );\n\n  return { user, posts, friends, settings };\n});\n```\n\n## Error handling in parallel operations\n\nErrors from parallel operations are typed:\n\n```typescript\nconst fetchUser = async (id: string): AsyncResult\u003CUser, 'USER_NOT_FOUND'> => { ... };\nconst fetchPosts = async (id: string): AsyncResult\u003CPost[], 'POSTS_FETCH_ERROR'> => { ... };\n\nconst result = await allAsync([fetchUser('1'), fetchPosts('1')]);\n// result.error is: 'USER_NOT_FOUND' | 'POSTS_FETCH_ERROR'\n```\n\n## Mapping over arrays\n\nProcess an array with typed errors:\n\n```typescript\nconst userIds = ['1', '2', '3'];\n\nconst results = await allAsync(\n  userIds.map((id) => fetchUser(id))\n);\n\nif (results.ok) {\n  // results.value is User[]\n  console.log(results.value.map((u) => u.name));\n}\n```\n\n## With timeout\n\nAdd a timeout to parallel operations:\n\n```typescript\nconst result = await workflow(async (step) => {\n  const data = await step.withTimeout(\n    () => allAsync([fetchUser('1'), fetchPosts('1')]),\n    { ms: 5000, name: 'Fetch user data' }\n  );\n\n  return data;\n});\n```\n\n## Full example\n\n```typescript\nimport {\n  createWorkflow,\n  allAsync,\n  partition,\n  ok,\n  err,\n  type AsyncResult,\n} from '@jagreehal/workflow';\n\ntype User = { id: string; name: string };\ntype Notification = { id: string; message: string };\n\nconst fetchUser = async (id: string): AsyncResult\u003CUser, 'USER_NOT_FOUND'> => {\n  const user = await db.users.find(id);\n  return user ? ok(user) : err('USER_NOT_FOUND');\n};\n\nconst sendNotification = async (\n  userId: string,\n  message: string\n): AsyncResult\u003CNotification, 'SEND_FAILED'> => {\n  try {\n    const notification = await notificationService.send(userId, message);\n    return ok(notification);\n  } catch {\n    return err('SEND_FAILED');\n  }\n};\n\nconst notifyUsers = createWorkflow({ fetchUser, sendNotification });\n\nconst result = await notifyUsers(async (step) => {\n  const userIds = ['1', '2', '3', '4', '5'];\n\n  // Fetch all users in parallel\n  const usersResult = await step(() =>\n    allAsync(userIds.map((id) => fetchUser(id)))\n  );\n\n  // Send notifications in parallel\n  const notifications = await step(() =>\n    allAsync(\n      usersResult.map((user) =>\n        sendNotification(user.id, 'Hello!')\n      )\n    )\n  );\n\n  return {\n    notified: notifications.length,\n  };\n});\n```","src/content/docs/patterns/parallel-operations.md","b1049fa9a34142ef",{"html":1193,"metadata":1194},"\u003Cp>Execute multiple operations in parallel while maintaining typed error handling.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"basic-parallel-execution\">Basic parallel execution\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#basic-parallel-execution\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Basic parallel execution”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">allAsync\u003C/code> to run operations concurrently:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">allAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ fetchUser, fetchPosts, fetchComments });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> [\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">user\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">posts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">comments\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">] \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">=\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    allAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      fetchComments\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    ])\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { user, posts, comments };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { allAsync, createWorkflow } from &#x27;@jagreehal/workflow&#x27;;\n\nconst workflow = createWorkflow({ fetchUser, fetchPosts, fetchComments });\n\nconst result = await workflow(async (step) => {\n  const [user, posts, comments] = await step(() =>\n    allAsync([\n      fetchUser(&#x27;1&#x27;),\n      fetchPosts(&#x27;1&#x27;),\n      fetchComments(&#x27;1&#x27;),\n    ])\n  );\n\n  return { user, posts, comments };\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"fail-fast-behavior\">Fail-fast behavior\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#fail-fast-behavior\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Fail-fast behavior”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>\u003Ccode dir=\"auto\">allAsync\u003C/code> stops on the first error:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> allAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),        \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Takes 100ms, succeeds\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'999'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),     \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Takes 50ms, fails with 'NOT_FOUND'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  fetchComments\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),    \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Takes 200ms, never completes\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">]);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// result.ok === false\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// result.error === 'NOT_FOUND'\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await allAsync([\n  fetchUser(&#x27;1&#x27;),        // Takes 100ms, succeeds\n  fetchPosts(&#x27;999&#x27;),     // Takes 50ms, fails with &#x27;NOT_FOUND&#x27;\n  fetchComments(&#x27;1&#x27;),    // Takes 200ms, never completes\n]);\n\n// result.ok === false\n// result.error === &#x27;NOT_FOUND&#x27;\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"collect-all-results\">Collect all results\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#collect-all-results\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Collect all results”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">allSettledAsync\u003C/code> to get all results regardless of failures:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">allSettledAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> allSettledAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),      \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Succeeds\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'999'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),   \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Fails\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  fetchComments\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Succeeds\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">]);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">forEach\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">((\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">item\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (item.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> ===\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'ok'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Success:'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, item.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">else\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Failed:'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, item.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { allSettledAsync } from &#x27;@jagreehal/workflow&#x27;;\n\nconst result = await allSettledAsync([\n  fetchUser(&#x27;1&#x27;),      // Succeeds\n  fetchPosts(&#x27;999&#x27;),   // Fails\n  fetchComments(&#x27;1&#x27;),  // Succeeds\n]);\n\nif (result.ok) {\n  result.value.forEach((item) => {\n    if (item.status === &#x27;ok&#x27;) {\n      console.log(&#x27;Success:&#x27;, item.value);\n    } else {\n      console.log(&#x27;Failed:&#x27;, item.error);\n    }\n  });\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"partition-successes-and-failures\">Partition successes and failures\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#partition-successes-and-failures\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Partition successes and failures”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">partition\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> results\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#6CB6FF\"> Promise\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">all\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'2'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'999'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">]);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> [\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">successes\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">failures\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">] \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">=\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> partition\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(results);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// successes: [User, User]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// failures: ['NOT_FOUND']\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { partition } from &#x27;@jagreehal/workflow&#x27;;\n\nconst results = await Promise.all([\n  fetchUser(&#x27;1&#x27;),\n  fetchUser(&#x27;2&#x27;),\n  fetchUser(&#x27;999&#x27;),\n]);\n\nconst [successes, failures] = partition(results);\n// successes: [User, User]\n// failures: [&#x27;NOT_FOUND&#x27;]\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"named-parallel-operations\">Named parallel operations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#named-parallel-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Named parallel operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Give parallel groups a name for visualization:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> [\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">user\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">posts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">] \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">=\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> allAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), \u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)]),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Fetch user data'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { user, posts };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await workflow(async (step) => {\n  const [user, posts] = await step(\n    () => allAsync([fetchUser(&#x27;1&#x27;), fetchPosts(&#x27;1&#x27;)]),\n    { name: &#x27;Fetch user data&#x27; }\n  );\n\n  return { user, posts };\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"race-to-first-success\">Race to first success\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#race-to-first-success\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Race to first success”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">anyAsync\u003C/code> to get the first successful result:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">anyAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Try multiple API endpoints, use first to respond\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> anyAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  fetchFromPrimary\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(id),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  fetchFromBackup\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(id),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  fetchFromCache\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(id),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">]);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Got data from whichever responded first\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { anyAsync } from &#x27;@jagreehal/workflow&#x27;;\n\n// Try multiple API endpoints, use first to respond\nconst result = await anyAsync([\n  fetchFromPrimary(id),\n  fetchFromBackup(id),\n  fetchFromCache(id),\n]);\n\nif (result.ok) {\n  // Got data from whichever responded first\n  console.log(result.value);\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"bounded-concurrency\">Bounded concurrency\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#bounded-concurrency\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Bounded concurrency”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>For large sets, use \u003Ccode dir=\"auto\">processInBatches\u003C/code>:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">processInBatches\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/batch'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> processInBatches\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  userIds,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(id),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">batchSize\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 20\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">concurrency\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 5\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { processInBatches } from &#x27;@jagreehal/workflow/batch&#x27;;\n\nconst result = await processInBatches(\n  userIds,\n  (id) => fetchUser(id),\n  { batchSize: 20, concurrency: 5 }\n);\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>See \u003Ca href=\"/workflow/guides/batch-processing/\">Batch Processing\u003C/a> for details.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"parallel-with-dependencies\">Parallel with dependencies\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#parallel-with-dependencies\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Parallel with dependencies”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Some operations depend on others:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Fetch user first\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Then fetch user's data in parallel\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> [\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">posts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">friends\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">settings\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">] \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">=\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    allAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      fetchFriends\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">      fetchSettings\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    ])\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { user, posts, friends, settings };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await workflow(async (step) => {\n  // Fetch user first\n  const user = await step(fetchUser(&#x27;1&#x27;));\n\n  // Then fetch user&#x27;s data in parallel\n  const [posts, friends, settings] = await step(() =>\n    allAsync([\n      fetchPosts(user.id),\n      fetchFriends(user.id),\n      fetchSettings(user.id),\n    ])\n  );\n\n  return { user, posts, friends, settings };\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"error-handling-in-parallel-operations\">Error handling in parallel operations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#error-handling-in-parallel-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Error handling in parallel operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Errors from parallel operations are typed:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">User\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'USER_NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">Post\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">[], \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'POSTS_FETCH_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> allAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), \u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)]);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// result.error is: 'USER_NOT_FOUND' | 'POSTS_FETCH_ERROR'\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const fetchUser = async (id: string): AsyncResult\u003CUser, &#x27;USER_NOT_FOUND&#x27;> => { ... };\nconst fetchPosts = async (id: string): AsyncResult\u003CPost[], &#x27;POSTS_FETCH_ERROR&#x27;> => { ... };\n\nconst result = await allAsync([fetchUser(&#x27;1&#x27;), fetchPosts(&#x27;1&#x27;)]);\n// result.error is: &#x27;USER_NOT_FOUND&#x27; | &#x27;POSTS_FETCH_ERROR&#x27;\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"mapping-over-arrays\">Mapping over arrays\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#mapping-over-arrays\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Mapping over arrays”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Process an array with typed errors:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> userIds\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> [\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'2'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'3'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">];\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> results\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> allAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  userIds.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">map\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">((\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(id))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (results.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // results.value is User[]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">log\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(results.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">map\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">((\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">u\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> u.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const userIds = [&#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;];\n\nconst results = await allAsync(\n  userIds.map((id) => fetchUser(id))\n);\n\nif (results.ok) {\n  // results.value is User[]\n  console.log(results.value.map((u) => u.name));\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"with-timeout\">With timeout\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#with-timeout\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “With timeout”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Add a timeout to parallel operations:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> data\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> step.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">withTimeout\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> allAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">([\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">), \u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fetchPosts\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)]),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ms\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 5000\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'Fetch user data'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> data;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await workflow(async (step) => {\n  const data = await step.withTimeout(\n    () => allAsync([fetchUser(&#x27;1&#x27;), fetchPosts(&#x27;1&#x27;)]),\n    { ms: 5000, name: &#x27;Fetch user data&#x27; }\n  );\n\n  return data;\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"full-example\">Full example\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#full-example\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Full example”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  allAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  partition\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  type\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">} \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> User\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">; \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">name\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">type\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> Notification\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">; \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">message\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">User\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'USER_NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">users\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">find\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(id);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> user \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user) \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'USER_NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> sendNotification\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  userId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  message\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">Notification\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'SEND_FAILED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  try\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> notification\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> notificationService.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">send\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(userId, message);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(notification);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">catch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'SEND_FAILED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> notifyUsers\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ fetchUser, sendNotification });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> notifyUsers\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> userIds\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> [\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'1'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'2'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'3'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'4'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'5'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">];\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Fetch all users in parallel\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> usersResult\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    allAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(userIds.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">map\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">((\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> fetchUser\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(id)))\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Send notifications in parallel\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> notifications\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">    allAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      usersResult.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">map\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">((\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">user\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">        sendNotification\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Hello!'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      )\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    )\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    notified\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> notifications.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#6CB6FF\">length\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import {\n  createWorkflow,\n  allAsync,\n  partition,\n  ok,\n  err,\n  type AsyncResult,\n} from &#x27;@jagreehal/workflow&#x27;;\n\ntype User = { id: string; name: string };\ntype Notification = { id: string; message: string };\n\nconst fetchUser = async (id: string): AsyncResult\u003CUser, &#x27;USER_NOT_FOUND&#x27;> => {\n  const user = await db.users.find(id);\n  return user ? ok(user) : err(&#x27;USER_NOT_FOUND&#x27;);\n};\n\nconst sendNotification = async (\n  userId: string,\n  message: string\n): AsyncResult\u003CNotification, &#x27;SEND_FAILED&#x27;> => {\n  try {\n    const notification = await notificationService.send(userId, message);\n    return ok(notification);\n  } catch {\n    return err(&#x27;SEND_FAILED&#x27;);\n  }\n};\n\nconst notifyUsers = createWorkflow({ fetchUser, sendNotification });\n\nconst result = await notifyUsers(async (step) => {\n  const userIds = [&#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;];\n\n  // Fetch all users in parallel\n  const usersResult = await step(() =>\n    allAsync(userIds.map((id) => fetchUser(id)))\n  );\n\n  // Send notifications in parallel\n  const notifications = await step(() =>\n    allAsync(\n      usersResult.map((user) =>\n        sendNotification(user.id, &#x27;Hello!&#x27;)\n      )\n    )\n  );\n\n  return {\n    notified: notifications.length,\n  };\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>",{"headings":1195,"localImagePaths":1230,"remoteImagePaths":1231,"frontmatter":1232,"imagePaths":1233},[1196,1199,1202,1205,1208,1211,1214,1217,1220,1223,1226,1229],{"depth":57,"slug":1197,"text":1198},"basic-parallel-execution","Basic parallel execution",{"depth":57,"slug":1200,"text":1201},"fail-fast-behavior","Fail-fast behavior",{"depth":57,"slug":1203,"text":1204},"collect-all-results","Collect all results",{"depth":57,"slug":1206,"text":1207},"partition-successes-and-failures","Partition successes and failures",{"depth":57,"slug":1209,"text":1210},"named-parallel-operations","Named parallel operations",{"depth":57,"slug":1212,"text":1213},"race-to-first-success","Race to first success",{"depth":57,"slug":1215,"text":1216},"bounded-concurrency","Bounded concurrency",{"depth":57,"slug":1218,"text":1219},"parallel-with-dependencies","Parallel with dependencies",{"depth":57,"slug":1221,"text":1222},"error-handling-in-parallel-operations","Error handling in parallel operations",{"depth":57,"slug":1224,"text":1225},"mapping-over-arrays","Mapping over arrays",{"depth":57,"slug":1227,"text":1228},"with-timeout","With timeout",{"depth":57,"slug":685,"text":686},[],[],{"title":1184,"description":1185},[],"patterns/resource-management",{"id":1234,"data":1236,"body":1242,"filePath":1243,"digest":1244,"rendered":1245},{"title":1237,"description":1238,"editUrl":16,"head":1239,"template":46,"sidebar":1240,"pagefind":16,"draft":35},"Resource Management","RAII-style resource cleanup for database connections and files",[],{"hidden":35,"attrs":1241},{},"Manage resources (database connections, file handles, API clients) with guaranteed cleanup using `withScope`.\n\n## Basic usage\n\n```typescript\nimport { withScope, createResource, ok } from '@jagreehal/workflow/resource';\n\nconst result = await withScope(async (scope) => {\n  // Resources are tracked for automatic cleanup\n  const db = scope.add(await createDatabaseClient());\n  const cache = scope.add(await createCacheClient());\n\n  // Do work\n  const user = await db.query('SELECT * FROM users WHERE id = ?', [userId]);\n  await cache.set(`user:${userId}`, user);\n\n  return ok(user);\n});\n// cache closed first, then db (LIFO order) - even on errors!\n```\n\n## Create reusable resources\n\nUse `createResource` to wrap acquire/release logic:\n\n```typescript\nimport { createResource } from '@jagreehal/workflow/resource';\n\nconst createDbResource = async (connectionString: string) =>\n  createResource(\n    // Acquire\n    async () => {\n      const client = new DatabaseClient(connectionString);\n      await client.connect();\n      return client;\n    },\n    // Release\n    async (client) => {\n      await client.disconnect();\n    }\n  );\n\nconst createFileResource = async (path: string, mode: string) =>\n  createResource(\n    async () => {\n      const handle = await fs.open(path, mode);\n      return handle;\n    },\n    async (handle) => {\n      await handle.close();\n    }\n  );\n```\n\n## Use in workflows\n\n```typescript\nimport { withScope, createResource, ok, err } from '@jagreehal/workflow/resource';\n\nconst result = await withScope(async (scope) => {\n  const db = scope.add(await createDbResource(process.env.DATABASE_URL));\n\n  const user = await db.query('SELECT * FROM users WHERE id = ?', ['123']);\n  if (!user) {\n    return err('NOT_FOUND' as const);\n  }\n\n  return ok(user);\n});\n// Database disconnected automatically\n```\n\n## LIFO cleanup order\n\nResources are closed in reverse order of acquisition:\n\n```typescript\nconst result = await withScope(async (scope) => {\n  const db = scope.add(await createDbResource());        // Acquired 1st\n  const cache = scope.add(await createCacheClient());    // Acquired 2nd\n  const apiClient = scope.add(await createApiClient());  // Acquired 3rd\n\n  // ... work ...\n\n  return ok(data);\n});\n// Cleanup order: apiClient → cache → db\n```\n\nThis matters when resources depend on each other (close connections before connection pools).\n\n## Cleanup on error\n\nResources are cleaned up even when the workflow fails:\n\n```typescript\nconst result = await withScope(async (scope) => {\n  const db = scope.add(await createDbResource());\n\n  // This fails\n  const user = await db.query('SELECT * FROM missing_table');\n  return ok(user);\n});\n// db.disconnect() still called\n```\n\n## Cleanup on exception\n\nResources are cleaned up even when code throws:\n\n```typescript\nconst result = await withScope(async (scope) => {\n  const db = scope.add(await createDbResource());\n\n  throw new Error('Something broke');\n\n  return ok(data);\n});\n// db.disconnect() still called\n```\n\n## Nested scopes\n\nScopes can be nested:\n\n```typescript\nconst result = await withScope(async (outer) => {\n  const db = outer.add(await createDbResource());\n\n  // Inner scope for temporary resources\n  const tempResult = await withScope(async (inner) => {\n    const tempFile = inner.add(await createTempFile());\n    await tempFile.write(data);\n    return ok(await tempFile.path());\n  });\n  // tempFile closed here\n\n  if (!tempResult.ok) {\n    return tempResult;\n  }\n\n  await db.query('INSERT INTO files (path) VALUES (?)', [tempResult.value]);\n  return ok({ path: tempResult.value });\n});\n// db closed here\n```\n\n## Manual scope control\n\nFor cases where you need explicit control:\n\n```typescript\nimport { createResourceScope } from '@jagreehal/workflow/resource';\n\nconst scope = createResourceScope();\n\ntry {\n  const db = scope.add(await createDbResource());\n  const cache = scope.add(await createCacheClient());\n\n  // ... work ...\n} finally {\n  await scope.close();\n}\n```\n\n## Handling cleanup errors\n\nIf cleanup fails, you get a `ResourceCleanupError`:\n\n```typescript\nimport { isResourceCleanupError } from '@jagreehal/workflow/resource';\n\nconst result = await withScope(async (scope) => {\n  const db = scope.add(await createDbResource());\n  return ok(data);\n});\n\nif (!result.ok && isResourceCleanupError(result.error)) {\n  console.error('Failed to clean up:', result.error.errors);\n  // errors: Array of individual cleanup failures\n}\n```\n\n## Real-world example: Database transaction\n\n```typescript\nconst createTransaction = async (db: Database) =>\n  createResource(\n    async () => {\n      await db.query('BEGIN');\n      return db;\n    },\n    async (tx) => {\n      // Rollback if not committed\n      try {\n        await tx.query('ROLLBACK');\n      } catch {\n        // Already committed or connection lost\n      }\n    }\n  );\n\nconst transferFunds = async (from: string, to: string, amount: number) => {\n  return await withScope(async (scope) => {\n    const db = scope.add(await createDbResource());\n    const tx = scope.add(await createTransaction(db));\n\n    // Debit\n    const fromAccount = await tx.query(\n      'UPDATE accounts SET balance = balance - ? WHERE id = ? RETURNING balance',\n      [amount, from]\n    );\n\n    if (fromAccount.balance \u003C 0) {\n      return err('INSUFFICIENT_FUNDS' as const);\n      // Transaction rolled back automatically\n    }\n\n    // Credit\n    await tx.query(\n      'UPDATE accounts SET balance = balance + ? WHERE id = ?',\n      [amount, to]\n    );\n\n    // Commit\n    await tx.query('COMMIT');\n\n    return ok({ from, to, amount });\n  });\n};\n```","src/content/docs/patterns/resource-management.md","996ab58d5b86ea38",{"html":1246,"metadata":1247},"\u003Cp>Manage resources (database connections, file handles, API clients) with guaranteed cleanup using \u003Ccode dir=\"auto\">withScope\u003C/code>.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"basic-usage\">Basic usage\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#basic-usage\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Basic usage”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">withScope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createResource\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/resource'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> withScope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">scope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Resources are tracked for automatic cleanup\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> db\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> scope.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">add\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createDatabaseClient\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> cache\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> scope.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">add\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createCacheClient\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Do work\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">query\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'SELECT * FROM users WHERE id = ?'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, [userId]);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> cache.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">set\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`user:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">userId\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, user);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// cache closed first, then db (LIFO order) - even on errors!\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { withScope, createResource, ok } from &#x27;@jagreehal/workflow/resource&#x27;;\n\nconst result = await withScope(async (scope) => {\n  // Resources are tracked for automatic cleanup\n  const db = scope.add(await createDatabaseClient());\n  const cache = scope.add(await createCacheClient());\n\n  // Do work\n  const user = await db.query(&#x27;SELECT * FROM users WHERE id = ?&#x27;, [userId]);\n  await cache.set(&#x60;user:${userId}&#x60;, user);\n\n  return ok(user);\n});\n// cache closed first, then db (LIFO order) - even on errors!\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"create-reusable-resources\">Create reusable resources\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#create-reusable-resources\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Create reusable resources”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use \u003Ccode dir=\"auto\">createResource\u003C/code> to wrap acquire/release logic:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createResource\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/resource'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createDbResource\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">connectionString\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  createResource\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">    // Acquire\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> client\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> new\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> DatabaseClient\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(connectionString);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> client.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">connect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> client;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">    // Release\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">client\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> client.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">disconnect\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createFileResource\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">path\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">mode\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  createResource\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> handle\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> fs.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">open\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(path, mode);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> handle;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">handle\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> handle.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">close\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createResource } from &#x27;@jagreehal/workflow/resource&#x27;;\n\nconst createDbResource = async (connectionString: string) =>\n  createResource(\n    // Acquire\n    async () => {\n      const client = new DatabaseClient(connectionString);\n      await client.connect();\n      return client;\n    },\n    // Release\n    async (client) => {\n      await client.disconnect();\n    }\n  );\n\nconst createFileResource = async (path: string, mode: string) =>\n  createResource(\n    async () => {\n      const handle = await fs.open(path, mode);\n      return handle;\n    },\n    async (handle) => {\n      await handle.close();\n    }\n  );\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"use-in-workflows\">Use in workflows\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#use-in-workflows\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Use in workflows”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">withScope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createResource\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/resource'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> withScope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">scope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> db\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> scope.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">add\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createDbResource\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(process.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">env\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">DATABASE_URL\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">query\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'SELECT * FROM users WHERE id = ?'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, [\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'123'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">]);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">user) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'NOT_FOUND'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F47067\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> const\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Database disconnected automatically\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { withScope, createResource, ok, err } from &#x27;@jagreehal/workflow/resource&#x27;;\n\nconst result = await withScope(async (scope) => {\n  const db = scope.add(await createDbResource(process.env.DATABASE_URL));\n\n  const user = await db.query(&#x27;SELECT * FROM users WHERE id = ?&#x27;, [&#x27;123&#x27;]);\n  if (!user) {\n    return err(&#x27;NOT_FOUND&#x27; as const);\n  }\n\n  return ok(user);\n});\n// Database disconnected automatically\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"lifo-cleanup-order\">LIFO cleanup order\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#lifo-cleanup-order\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “LIFO cleanup order”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Resources are closed in reverse order of acquisition:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> withScope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">scope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> db\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> scope.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">add\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createDbResource\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());        \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Acquired 1st\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> cache\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> scope.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">add\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createCacheClient\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());    \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Acquired 2nd\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> apiClient\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> scope.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">add\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createApiClient\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Acquired 3rd\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // ... work ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(data);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Cleanup order: apiClient → cache → db\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await withScope(async (scope) => {\n  const db = scope.add(await createDbResource());        // Acquired 1st\n  const cache = scope.add(await createCacheClient());    // Acquired 2nd\n  const apiClient = scope.add(await createApiClient());  // Acquired 3rd\n\n  // ... work ...\n\n  return ok(data);\n});\n// Cleanup order: apiClient → cache → db\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>This matters when resources depend on each other (close connections before connection pools).\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"cleanup-on-error\">Cleanup on error\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#cleanup-on-error\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Cleanup on error”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Resources are cleaned up even when the workflow fails:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> withScope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">scope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> db\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> scope.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">add\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createDbResource\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // This fails\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> user\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">query\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'SELECT * FROM missing_table'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(user);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// db.disconnect() still called\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await withScope(async (scope) => {\n  const db = scope.add(await createDbResource());\n\n  // This fails\n  const user = await db.query(&#x27;SELECT * FROM missing_table&#x27;);\n  return ok(user);\n});\n// db.disconnect() still called\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"cleanup-on-exception\">Cleanup on exception\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#cleanup-on-exception\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Cleanup on exception”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Resources are cleaned up even when code throws:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> withScope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">scope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> db\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> scope.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">add\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createDbResource\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  throw\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> new\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> Error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Something broke'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(data);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// db.disconnect() still called\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await withScope(async (scope) => {\n  const db = scope.add(await createDbResource());\n\n  throw new Error(&#x27;Something broke&#x27;);\n\n  return ok(data);\n});\n// db.disconnect() still called\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"nested-scopes\">Nested scopes\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#nested-scopes\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Nested scopes”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Scopes can be nested:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> withScope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">outer\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> db\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> outer.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">add\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createDbResource\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Inner scope for temporary resources\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> tempResult\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> withScope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">inner\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> tempFile\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> inner.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">add\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createTempFile\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> tempFile.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">write\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(data);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> tempFile.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">path\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // tempFile closed here\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">tempResult.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> tempResult;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">query\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'INSERT INTO files (path) VALUES (?)'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, [tempResult.\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">]);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">path\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> tempResult.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">value\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// db closed here\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const result = await withScope(async (outer) => {\n  const db = outer.add(await createDbResource());\n\n  // Inner scope for temporary resources\n  const tempResult = await withScope(async (inner) => {\n    const tempFile = inner.add(await createTempFile());\n    await tempFile.write(data);\n    return ok(await tempFile.path());\n  });\n  // tempFile closed here\n\n  if (!tempResult.ok) {\n    return tempResult;\n  }\n\n  await db.query(&#x27;INSERT INTO files (path) VALUES (?)&#x27;, [tempResult.value]);\n  return ok({ path: tempResult.value });\n});\n// db closed here\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"manual-scope-control\">Manual scope control\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#manual-scope-control\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Manual scope control”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>For cases where you need explicit control:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">createResourceScope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/resource'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> scope\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createResourceScope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">try\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> db\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> scope.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">add\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createDbResource\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> cache\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> scope.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">add\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createCacheClient\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // ... work ...\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">} \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">finally\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> scope.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">close\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { createResourceScope } from &#x27;@jagreehal/workflow/resource&#x27;;\n\nconst scope = createResourceScope();\n\ntry {\n  const db = scope.add(await createDbResource());\n  const cache = scope.add(await createCacheClient());\n\n  // ... work ...\n} finally {\n  await scope.close();\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"handling-cleanup-errors\">Handling cleanup errors\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#handling-cleanup-errors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Handling cleanup errors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>If cleanup fails, you get a \u003Ccode dir=\"auto\">ResourceCleanupError\u003C/code>:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">isResourceCleanupError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow/resource'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> withScope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">scope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> db\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> scope.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">add\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createDbResource\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(data);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">!\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> &#x26;&#x26;\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> isResourceCleanupError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  console.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'Failed to clean up:'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, result.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">error\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">errors\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // errors: Array of individual cleanup failures\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import { isResourceCleanupError } from &#x27;@jagreehal/workflow/resource&#x27;;\n\nconst result = await withScope(async (scope) => {\n  const db = scope.add(await createDbResource());\n  return ok(data);\n});\n\nif (!result.ok &#x26;&#x26; isResourceCleanupError(result.error)) {\n  console.error(&#x27;Failed to clean up:&#x27;, result.error.errors);\n  // errors: Array of individual cleanup failures\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"real-world-example-database-transaction\">Real-world example: Database transaction\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#real-world-example-database-transaction\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Real-world example: Database transaction”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createTransaction\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">db\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> Database\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">  createResource\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">query\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'BEGIN'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">tx\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">      // Rollback if not committed\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      try\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">        await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> tx.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">query\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'ROLLBACK'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">catch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">        // Already committed or connection lost\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> transferFunds\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">from\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">to\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">amount\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> number\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> withScope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">scope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> db\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> scope.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">add\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createDbResource\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">());\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> tx\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> scope.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">add\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createTransaction\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(db));\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">    // Debit\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> fromAccount\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> tx.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">query\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">      'UPDATE accounts SET balance = balance - ? WHERE id = ? RETURNING balance'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      [amount, from]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (fromAccount.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">balance\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> &#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> 0\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">      return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'INSUFFICIENT_FUNDS'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F47067\"> as\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> const\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">      // Transaction rolled back automatically\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">    // Credit\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> tx.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">query\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">      'UPDATE accounts SET balance = balance + ? WHERE id = ?'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      [amount, to]\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">    // Commit\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> tx.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">query\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'COMMIT'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({ from, to, amount });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"const createTransaction = async (db: Database) =>\n  createResource(\n    async () => {\n      await db.query(&#x27;BEGIN&#x27;);\n      return db;\n    },\n    async (tx) => {\n      // Rollback if not committed\n      try {\n        await tx.query(&#x27;ROLLBACK&#x27;);\n      } catch {\n        // Already committed or connection lost\n      }\n    }\n  );\n\nconst transferFunds = async (from: string, to: string, amount: number) => {\n  return await withScope(async (scope) => {\n    const db = scope.add(await createDbResource());\n    const tx = scope.add(await createTransaction(db));\n\n    // Debit\n    const fromAccount = await tx.query(\n      &#x27;UPDATE accounts SET balance = balance - ? WHERE id = ? RETURNING balance&#x27;,\n      [amount, from]\n    );\n\n    if (fromAccount.balance \u003C 0) {\n      return err(&#x27;INSUFFICIENT_FUNDS&#x27; as const);\n      // Transaction rolled back automatically\n    }\n\n    // Credit\n    await tx.query(\n      &#x27;UPDATE accounts SET balance = balance + ? WHERE id = ?&#x27;,\n      [amount, to]\n    );\n\n    // Commit\n    await tx.query(&#x27;COMMIT&#x27;);\n\n    return ok({ from, to, amount });\n  });\n};\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>",{"headings":1248,"localImagePaths":1277,"remoteImagePaths":1278,"frontmatter":1279,"imagePaths":1280},[1249,1250,1253,1256,1259,1262,1265,1268,1271,1274],{"depth":57,"slug":58,"text":59},{"depth":57,"slug":1251,"text":1252},"create-reusable-resources","Create reusable resources",{"depth":57,"slug":1254,"text":1255},"use-in-workflows","Use in workflows",{"depth":57,"slug":1257,"text":1258},"lifo-cleanup-order","LIFO cleanup order",{"depth":57,"slug":1260,"text":1261},"cleanup-on-error","Cleanup on error",{"depth":57,"slug":1263,"text":1264},"cleanup-on-exception","Cleanup on exception",{"depth":57,"slug":1266,"text":1267},"nested-scopes","Nested scopes",{"depth":57,"slug":1269,"text":1270},"manual-scope-control","Manual scope control",{"depth":57,"slug":1272,"text":1273},"handling-cleanup-errors","Handling cleanup errors",{"depth":57,"slug":1275,"text":1276},"real-world-example-database-transaction","Real-world example: Database transaction",[],[],{"title":1237,"description":1238},[],"patterns/payment-retries",{"id":1281,"data":1283,"body":1289,"filePath":1290,"digest":1291,"rendered":1292},{"title":1284,"description":1285,"editUrl":16,"head":1286,"template":46,"sidebar":1287,"pagefind":16,"draft":35},"Safe Payment Retries","Avoid double-charging with idempotent payment workflows",[],{"hidden":35,"attrs":1288},{},"The scariest failure mode in payments: **charge succeeded, but persistence failed**. If you retry naively, you charge the customer twice.\n\n## The problem\n\n```typescript\n// DANGEROUS: No idempotency\nasync function processPayment(order: Order) {\n  const charge = await paymentProvider.charge(order.total); // Succeeds\n\n  await db.orders.update(order.id, { paymentId: charge.id }); // Fails!\n\n  // Retry? You'll charge again\n}\n```\n\n## The solution\n\nUse step keys and persistence to make the workflow resumable:\n\n```typescript\nimport {\n  createWorkflow,\n  createStepCollector,\n  stringifyState,\n  parseState,\n} from '@jagreehal/workflow';\n\nconst processPayment = createWorkflow({\n  validateCard,\n  chargeProvider,\n  persistResult,\n});\n\n// Collect state for persistence\nconst collector = createStepCollector();\n\nconst workflow = createWorkflow(deps, {\n  onEvent: collector.handleEvent,\n});\n\nconst result = await workflow(async (step) => {\n  // Validate - can retry safely\n  const card = await step(\n    () => validateCard(input),\n    { key: `validate:${orderId}` }\n  );\n\n  // CRITICAL: This step must not repeat\n  const charge = await step(\n    () => chargeProvider(card, amount),\n    { key: `charge:${idempotencyKey}` }\n  );\n\n  // Persist - if this fails, we can resume\n  await step(\n    () => persistResult(charge),\n    { key: `persist:${charge.id}` }\n  );\n\n  return { paymentId: charge.id };\n});\n```\n\n## Save state after each run\n\n```typescript\n// Always save state (success or failure)\nconst state = collector.getState();\nconst json = stringifyState(state, { orderId });\n\nawait db.workflowStates.upsert({\n  where: { idempotencyKey },\n  update: { state: json, updatedAt: new Date() },\n  create: { idempotencyKey, state: json },\n});\n```\n\n## Crash recovery\n\nIf the workflow crashes after charging but before persisting:\n\n```typescript\n// On restart, check for existing state\nconst saved = await db.workflowStates.findUnique({\n  where: { idempotencyKey },\n});\n\nif (saved) {\n  // Resume from saved state\n  const resumeState = parseState(saved.state);\n\n  const workflow = createWorkflow(deps, { resumeState });\n\n  const result = await workflow(async (step) => {\n    const card = await step(\n      () => validateCard(input),\n      { key: `validate:${orderId}` }\n    ); // Cache hit\n\n    const charge = await step(\n      () => chargeProvider(card, amount),\n      { key: `charge:${idempotencyKey}` }\n    ); // Cache hit - returns previous charge\n\n    await step(\n      () => persistResult(charge),\n      { key: `persist:${charge.id}` }\n    ); // Runs fresh\n\n    return { paymentId: charge.id };\n  });\n}\n```\n\nThe charge step returns its cached result. No double-billing.\n\n## Idempotency key design\n\nGenerate a unique key per payment attempt:\n\n```typescript\n// Good: Stable across retries\nconst idempotencyKey = `order:${orderId}:attempt:${attemptNumber}`;\n\n// Good: Based on cart contents\nconst idempotencyKey = `cart:${hashCart(items)}:user:${userId}`;\n\n// Bad: Changes every call\nconst idempotencyKey = `payment:${Date.now()}`;\n```\n\n## Full example\n\n```typescript\nimport {\n  createWorkflow,\n  createStepCollector,\n  stringifyState,\n  parseState,\n  ok,\n  err,\n  type AsyncResult,\n} from '@jagreehal/workflow';\n\nconst validateCard = async (\n  cardToken: string\n): AsyncResult\u003CCard, 'INVALID_CARD'> => {\n  const card = await stripe.tokens.retrieve(cardToken);\n  return card ? ok(card) : err('INVALID_CARD');\n};\n\nconst chargeProvider = async (\n  card: Card,\n  amount: number\n): AsyncResult\u003CCharge, 'DECLINED' | 'PROVIDER_ERROR'> => {\n  try {\n    const charge = await stripe.charges.create({\n      amount,\n      source: card.id,\n    });\n    return ok(charge);\n  } catch (e) {\n    if (e.code === 'card_declined') return err('DECLINED');\n    return err('PROVIDER_ERROR');\n  }\n};\n\nconst persistResult = async (\n  charge: Charge\n): AsyncResult\u003Cvoid, 'DB_ERROR'> => {\n  try {\n    await db.payments.create({\n      chargeId: charge.id,\n      amount: charge.amount,\n      status: 'completed',\n    });\n    return ok(undefined);\n  } catch {\n    return err('DB_ERROR');\n  }\n};\n\n// Main function\nasync function handlePayment(orderId: string, cardToken: string, amount: number) {\n  const idempotencyKey = `payment:${orderId}`;\n\n  // Check for existing attempt\n  const existing = await db.workflowStates.findUnique({\n    where: { id: idempotencyKey },\n  });\n\n  const collector = createStepCollector();\n  const resumeState = existing ? parseState(existing.state) : undefined;\n\n  const workflow = createWorkflow(\n    { validateCard, chargeProvider, persistResult },\n    {\n      resumeState,\n      onEvent: collector.handleEvent,\n    }\n  );\n\n  const result = await workflow(async (step) => {\n    const card = await step(() => validateCard(cardToken), {\n      key: `validate:${orderId}`,\n    });\n\n    const charge = await step(() => chargeProvider(card, amount), {\n      key: `charge:${idempotencyKey}`,\n    });\n\n    await step(() => persistResult(charge), {\n      key: `persist:${charge.id}`,\n    });\n\n    return { chargeId: charge.id };\n  });\n\n  // Always save state\n  const state = collector.getState();\n  await db.workflowStates.upsert({\n    where: { id: idempotencyKey },\n    update: { state: stringifyState(state), updatedAt: new Date() },\n    create: { id: idempotencyKey, state: stringifyState(state) },\n  });\n\n  return result;\n}\n```\n\n## Key takeaways\n\n1. **Use idempotency keys** for payment operations\n2. **Save state** after every run (success or failure)\n3. **Resume with saved state** on retry\n4. **Cached steps return previous results** without re-executing","src/content/docs/patterns/payment-retries.md","244dee6d5933ea6a",{"html":1293,"metadata":1294},"\u003Cp>The scariest failure mode in payments: \u003Cstrong>charge succeeded, but persistence failed\u003C/strong>. If you retry naively, you charge the customer twice.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"the-problem\">The problem\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#the-problem\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “The problem”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// DANGEROUS: No idempotency\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> function\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> processPayment\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">order\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> Order\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> charge\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> paymentProvider.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">charge\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(order.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">total\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">); \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Succeeds\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">orders\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">update\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(order.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">paymentId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> charge.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }); \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Fails!\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Retry? You'll charge again\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"// DANGEROUS: No idempotency\nasync function processPayment(order: Order) {\n  const charge = await paymentProvider.charge(order.total); // Succeeds\n\n  await db.orders.update(order.id, { paymentId: charge.id }); // Fails!\n\n  // Retry? You&#x27;ll charge again\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"the-solution\">The solution\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#the-solution\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “The solution”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Use step keys and persistence to make the workflow resumable:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createStepCollector\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  stringifyState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  parseState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">} \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> processPayment\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  validateCard,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  chargeProvider,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  persistResult,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Collect state for persistence\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> collector\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createStepCollector\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> collector.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Validate - can retry safely\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> card\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> validateCard\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(input),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `validate:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">orderId\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // CRITICAL: This step must not repeat\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> charge\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> chargeProvider\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(card, amount),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `charge:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">idempotencyKey\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Persist - if this fails, we can resume\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> persistResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(charge),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `persist:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">charge\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">paymentId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> charge.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import {\n  createWorkflow,\n  createStepCollector,\n  stringifyState,\n  parseState,\n} from &#x27;@jagreehal/workflow&#x27;;\n\nconst processPayment = createWorkflow({\n  validateCard,\n  chargeProvider,\n  persistResult,\n});\n\n// Collect state for persistence\nconst collector = createStepCollector();\n\nconst workflow = createWorkflow(deps, {\n  onEvent: collector.handleEvent,\n});\n\nconst result = await workflow(async (step) => {\n  // Validate - can retry safely\n  const card = await step(\n    () => validateCard(input),\n    { key: &#x60;validate:${orderId}&#x60; }\n  );\n\n  // CRITICAL: This step must not repeat\n  const charge = await step(\n    () => chargeProvider(card, amount),\n    { key: &#x60;charge:${idempotencyKey}&#x60; }\n  );\n\n  // Persist - if this fails, we can resume\n  await step(\n    () => persistResult(charge),\n    { key: &#x60;persist:${charge.id}&#x60; }\n  );\n\n  return { paymentId: charge.id };\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"save-state-after-each-run\">Save state after each run\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#save-state-after-each-run\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Save state after each run”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Always save state (success or failure)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> state\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> collector.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">getState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> json\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> stringifyState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(state, { orderId });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">workflowStates\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">upsert\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  where\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { idempotencyKey },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  update\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">state\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> json, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">updatedAt\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> new\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> Date\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">() },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  create\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { idempotencyKey, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">state\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> json },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"// Always save state (success or failure)\nconst state = collector.getState();\nconst json = stringifyState(state, { orderId });\n\nawait db.workflowStates.upsert({\n  where: { idempotencyKey },\n  update: { state: json, updatedAt: new Date() },\n  create: { idempotencyKey, state: json },\n});\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"crash-recovery\">Crash recovery\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#crash-recovery\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Crash recovery”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>If the workflow crashes after charging but before persisting:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// On restart, check for existing state\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> saved\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">workflowStates\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">findUnique\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  where\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { idempotencyKey },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">});\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (saved) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Resume from saved state\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> resumeState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> parseState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(saved.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">state\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, { resumeState });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> card\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> validateCard\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(input),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `validate:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">orderId\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    ); \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Cache hit\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> charge\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> chargeProvider\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(card, amount),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `charge:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">idempotencyKey\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    ); \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Cache hit - returns previous charge\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> persistResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(charge),\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `persist:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">charge\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    ); \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Runs fresh\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">paymentId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> charge.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"// On restart, check for existing state\nconst saved = await db.workflowStates.findUnique({\n  where: { idempotencyKey },\n});\n\nif (saved) {\n  // Resume from saved state\n  const resumeState = parseState(saved.state);\n\n  const workflow = createWorkflow(deps, { resumeState });\n\n  const result = await workflow(async (step) => {\n    const card = await step(\n      () => validateCard(input),\n      { key: &#x60;validate:${orderId}&#x60; }\n    ); // Cache hit\n\n    const charge = await step(\n      () => chargeProvider(card, amount),\n      { key: &#x60;charge:${idempotencyKey}&#x60; }\n    ); // Cache hit - returns previous charge\n\n    await step(\n      () => persistResult(charge),\n      { key: &#x60;persist:${charge.id}&#x60; }\n    ); // Runs fresh\n\n    return { paymentId: charge.id };\n  });\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cp>The charge step returns its cached result. No double-billing.\u003C/p>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"idempotency-key-design\">Idempotency key design\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#idempotency-key-design\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Idempotency key design”\u003C/span>\u003C/a>\u003C/div>\n\u003Cp>Generate a unique key per payment attempt:\u003C/p>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Good: Stable across retries\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> idempotencyKey\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `order:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">orderId\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">:attempt:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">attemptNumber\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Good: Based on cart contents\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> idempotencyKey\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `cart:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">hashCart\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#96D0FF\">(\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">items\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#96D0FF\">)\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">:user:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">userId\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Bad: Changes every call\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> idempotencyKey\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `payment:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">Date\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">now\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#96D0FF\">()\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"// Good: Stable across retries\nconst idempotencyKey = &#x60;order:${orderId}:attempt:${attemptNumber}&#x60;;\n\n// Good: Based on cart contents\nconst idempotencyKey = &#x60;cart:${hashCart(items)}:user:${userId}&#x60;;\n\n// Bad: Changes every call\nconst idempotencyKey = &#x60;payment:${Date.now()}&#x60;;\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"full-example\">Full example\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#full-example\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Full example”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">import\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  createStepCollector\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  stringifyState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  parseState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">  err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  type\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">} \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">from\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> '@jagreehal/workflow'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> validateCard\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  cardToken\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">Card\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'INVALID_CARD'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> card\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> stripe.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">tokens\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">retrieve\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(cardToken);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> card \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(card) \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'INVALID_CARD'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> chargeProvider\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  card\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> Card\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  amount\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> number\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">Charge\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'DECLINED'\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> |\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'PROVIDER_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  try\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> charge\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> stripe.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">charges\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">create\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      amount,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      source\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> card.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(charge);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">catch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (e) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    if\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (e.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">code\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> ===\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'card_declined'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'DECLINED'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'PROVIDER_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">const\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> persistResult\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">  charge\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> Charge\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\"> AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#6CB6FF\">void\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'DB_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">> \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  try\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">payments\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">create\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      chargeId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> charge.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      amount\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> charge.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">amount\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      status\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> 'completed'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">undefined\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  } \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">catch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">'DB_ERROR'\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">);\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">};\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Main function\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> function\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> handlePayment\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">orderId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">cardToken\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> string\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">amount\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#6CB6FF\"> number\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> idempotencyKey\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `payment:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">orderId\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Check for existing attempt\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> existing\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">workflowStates\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">findUnique\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    where\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> idempotencyKey },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> collector\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createStepCollector\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> resumeState\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> existing \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> parseState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(existing.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">state\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> undefined\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    { validateCard, chargeProvider, persistResult },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">      resumeState,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      onEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> collector.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">handleEvent\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  );\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> card\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> validateCard\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(cardToken), {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `validate:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">orderId\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> charge\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> chargeProvider\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(card, amount), {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `charge:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">idempotencyKey\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    await\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> persistResult\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(charge), {\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">      key\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\"> `persist:\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">${\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">charge\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#CA1243;--shiki-dark:#96D0FF\">}\u003C/span>\u003Cspan style=\"--shiki-light:#50A14F;--shiki-dark:#96D0FF\">`\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">,\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">    });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">    return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">chargeId\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> charge.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> };\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // Always save state\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  const\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> state\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\"> =\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> collector.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">getState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">();\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  await\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> db.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">workflowStates\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">upsert\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">({\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    where\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> idempotencyKey },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    update\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">state\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> stringifyState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(state), \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">updatedAt\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\"> new\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> Date\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">() },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">    create\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">id\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> idempotencyKey, \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">state\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> stringifyState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(state) },\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">  });\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">  return\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> result;\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">}\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"import {\n  createWorkflow,\n  createStepCollector,\n  stringifyState,\n  parseState,\n  ok,\n  err,\n  type AsyncResult,\n} from &#x27;@jagreehal/workflow&#x27;;\n\nconst validateCard = async (\n  cardToken: string\n): AsyncResult\u003CCard, &#x27;INVALID_CARD&#x27;> => {\n  const card = await stripe.tokens.retrieve(cardToken);\n  return card ? ok(card) : err(&#x27;INVALID_CARD&#x27;);\n};\n\nconst chargeProvider = async (\n  card: Card,\n  amount: number\n): AsyncResult\u003CCharge, &#x27;DECLINED&#x27; | &#x27;PROVIDER_ERROR&#x27;> => {\n  try {\n    const charge = await stripe.charges.create({\n      amount,\n      source: card.id,\n    });\n    return ok(charge);\n  } catch (e) {\n    if (e.code === &#x27;card_declined&#x27;) return err(&#x27;DECLINED&#x27;);\n    return err(&#x27;PROVIDER_ERROR&#x27;);\n  }\n};\n\nconst persistResult = async (\n  charge: Charge\n): AsyncResult\u003Cvoid, &#x27;DB_ERROR&#x27;> => {\n  try {\n    await db.payments.create({\n      chargeId: charge.id,\n      amount: charge.amount,\n      status: &#x27;completed&#x27;,\n    });\n    return ok(undefined);\n  } catch {\n    return err(&#x27;DB_ERROR&#x27;);\n  }\n};\n\n// Main function\nasync function handlePayment(orderId: string, cardToken: string, amount: number) {\n  const idempotencyKey = &#x60;payment:${orderId}&#x60;;\n\n  // Check for existing attempt\n  const existing = await db.workflowStates.findUnique({\n    where: { id: idempotencyKey },\n  });\n\n  const collector = createStepCollector();\n  const resumeState = existing ? parseState(existing.state) : undefined;\n\n  const workflow = createWorkflow(\n    { validateCard, chargeProvider, persistResult },\n    {\n      resumeState,\n      onEvent: collector.handleEvent,\n    }\n  );\n\n  const result = await workflow(async (step) => {\n    const card = await step(() => validateCard(cardToken), {\n      key: &#x60;validate:${orderId}&#x60;,\n    });\n\n    const charge = await step(() => chargeProvider(card, amount), {\n      key: &#x60;charge:${idempotencyKey}&#x60;,\n    });\n\n    await step(() => persistResult(charge), {\n      key: &#x60;persist:${charge.id}&#x60;,\n    });\n\n    return { chargeId: charge.id };\n  });\n\n  // Always save state\n  const state = collector.getState();\n  await db.workflowStates.upsert({\n    where: { id: idempotencyKey },\n    update: { state: stringifyState(state), updatedAt: new Date() },\n    create: { id: idempotencyKey, state: stringifyState(state) },\n  });\n\n  return result;\n}\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"key-takeaways\">Key takeaways\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#key-takeaways\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Key takeaways”\u003C/span>\u003C/a>\u003C/div>\n\u003Col>\n\u003Cli>\u003Cstrong>Use idempotency keys\u003C/strong> for payment operations\u003C/li>\n\u003Cli>\u003Cstrong>Save state\u003C/strong> after every run (success or failure)\u003C/li>\n\u003Cli>\u003Cstrong>Resume with saved state\u003C/strong> on retry\u003C/li>\n\u003Cli>\u003Cstrong>Cached steps return previous results\u003C/strong> without re-executing\u003C/li>\n\u003C/ol>",{"headings":1295,"localImagePaths":1313,"remoteImagePaths":1314,"frontmatter":1315,"imagePaths":1316},[1296,1297,1300,1303,1306,1309,1310],{"depth":57,"slug":1061,"text":1062},{"depth":57,"slug":1298,"text":1299},"the-solution","The solution",{"depth":57,"slug":1301,"text":1302},"save-state-after-each-run","Save state after each run",{"depth":57,"slug":1304,"text":1305},"crash-recovery","Crash recovery",{"depth":57,"slug":1307,"text":1308},"idempotency-key-design","Idempotency key design",{"depth":57,"slug":685,"text":686},{"depth":57,"slug":1311,"text":1312},"key-takeaways","Key takeaways",[],[],{"title":1284,"description":1285},[],"reference/api",{"id":1317,"data":1319,"body":1325,"filePath":1326,"digest":1327,"rendered":1328},{"title":1320,"description":1321,"editUrl":16,"head":1322,"template":46,"sidebar":1323,"pagefind":16,"draft":35},"API Reference","Complete API documentation",[],{"hidden":35,"attrs":1324},{},"## Workflows\n\n### createWorkflow\n\n```typescript\ncreateWorkflow(deps)                                    // Auto-inferred error types\ncreateWorkflow(deps, { strict: true, catchUnexpected }) // Closed error union\ncreateWorkflow(deps, { onEvent, createContext })        // Event stream + context\ncreateWorkflow(deps, { cache })                         // Step caching\ncreateWorkflow(deps, { resumeState })                   // Resume from saved state\n\n// Callback signatures:\nworkflow(async (step, deps, ctx) => { ... })           // ctx is WorkflowContext\nworkflow(args, async (step, deps, args, ctx) => { ... }) // With typed args\n```\n\n### step\n\n```typescript\nstep(result)                        // Unwrap Result or exit early\nstep(result, { name, key })         // With tracing/caching options\nstep(() => result)                  // Lazy form (for caching/resume)\nstep(() => result, { name, key })   // Lazy with options\n```\n\n### step.try\n\n```typescript\nstep.try(fn, { error })             // Static error type\nstep.try(fn, { onError })           // Dynamic error from caught value\nstep.try(fn, { error, name, key })  // With tracing options\n```\n\n### Low-level run\n\n```typescript\nrun(fn)                             // One-off workflow\nrun(fn, { onError })                // With error callback\nrun(fn, { onEvent, context })       // With event stream\nrun.strict(fn, { catchUnexpected }) // Closed error union\n```\n\n## Results\n\n### Constructors\n\n```typescript\nok(value)                           // Create success\nerr(error)                          // Create error\nerr(error, { cause })               // Create error with cause\n```\n\n### Type guards\n\n```typescript\nisOk(result)                        // result is { ok: true, value }\nisErr(result)                       // result is { ok: false, error }\nisUnexpectedError(error)            // error is UnexpectedError\n```\n\n## Unwrap\n\n```typescript\nunwrap(result)                      // Value or throw UnwrapError\nunwrapOr(result, defaultValue)      // Value or default\nunwrapOrElse(result, fn)            // Value or compute from error\n```\n\n## Wrap\n\n```typescript\nfrom(fn)                            // Sync throwing → Result\nfrom(fn, onError)                   // With error mapper\nfromPromise(promise)                // Promise → Result\nfromPromise(promise, onError)       // With error mapper\ntryAsync(fn)                        // Async fn → Result\ntryAsync(fn, onError)               // With error mapper\nfromNullable(value, onNull)         // Nullable → Result\n```\n\n## Transform\n\n```typescript\nmap(result, fn)                     // Transform value\nmapError(result, fn)                // Transform error\nmapTry(result, fn, onError)         // Transform value, catch throws\nmapErrorTry(result, fn, onError)    // Transform error, catch throws\nandThen(result, fn)                 // Chain (flatMap)\nmatch(result, { ok, err })          // Pattern match\ntap(result, fn)                     // Side effect on success\ntapError(result, fn)                // Side effect on error\n```\n\n## Batch Operations\n\n```typescript\nall(results)                        // All succeed (sync, short-circuits)\nallAsync(results)                   // All succeed (async, short-circuits)\nany(results)                        // First success (sync)\nanyAsync(results)                   // First success (async)\nallSettled(results)                 // Collect all (sync)\nallSettledAsync(results)            // Collect all (async)\npartition(results)                  // Split into { values, errors }\n```\n\n## Batch Processing\n\n```typescript\nprocessInBatches(items, fn, config)         // Process with bounded concurrency\nprocessInBatches(items, fn, config, hooks)  // With progress/checkpoint hooks\n\n// Config\n{ batchSize: 20, concurrency: 3, batchDelayMs: 50 }\n\n// Hooks\n{ onProgress: (p) => {}, afterBatch: async () => ok(undefined) }\n\n// Presets\nbatchPresets.conservative  // batchSize: 20, concurrency: 3\nbatchPresets.balanced      // batchSize: 50, concurrency: 5\nbatchPresets.aggressive    // batchSize: 100, concurrency: 10\n```\n\n## Resource Management\n\n```typescript\nwithScope(async (scope) => { ... }) // RAII-style resource cleanup\ncreateResource(acquire, release)    // Create reusable resource\ncreateResourceScope()               // Manual scope control\nisResourceCleanupError(error)       // Check for cleanup failure\n```\n\n## Human-in-the-Loop (HITL)\n\n### Creating approval steps\n\n```typescript\ncreateApprovalStep\u003CT>(options)      // Create approval-gated step function\n// options: { key, checkApproval, pendingReason?, rejectedReason? }\n```\n\n### Checking approval status\n\n```typescript\nisPendingApproval(error)            // error is PendingApproval\nisApprovalRejected(error)           // error is ApprovalRejected\npendingApproval(stepKey, options?)  // Create PendingApproval error\n```\n\n### Managing approval state\n\n```typescript\ncreateHITLCollector()               // Collect step events for resume\ninjectApproval(state, { stepKey, value })  // Add approval to resume state\nclearStep(state, stepKey)           // Remove step from resume state\nhasPendingApproval(state, stepKey)  // Check if step is pending\ngetPendingApprovals(state)          // Get all pending step keys\n```\n\n## Circuit Breaker\n\n```typescript\ncreateCircuitBreaker(name, config)  // Create circuit breaker instance\nisCircuitOpenError(error)           // Check if error is circuit open\ncircuitBreakerPresets.critical      // Preset configurations\ncircuitBreakerPresets.lenient\n```\n\n## Saga / Compensation\n\n```typescript\ncreateSagaWorkflow(deps, options)   // Create saga with auto-inferred errors\nrunSaga(fn, options)                // Low-level saga execution\nisSagaCompensationError(error)      // Check for compensation failure\n```\n\n## Rate Limiting\n\n```typescript\ncreateRateLimiter(name, config)     // Token bucket rate limiter\ncreateConcurrencyLimiter(name, cfg) // Concurrent execution limiter\ncreateCombinedLimiter(name, config) // Rate + concurrency combined\nrateLimiterPresets.api              // Preset configurations\nisRateLimitExceededError(error)     // Check if rate limited\nisQueueFullError(error)             // Check if queue full\n```\n\n## Conditional Execution\n\n```typescript\nwhen(condition, operation, opts)           // Run if true\nunless(condition, operation, opts)         // Run if false\nwhenOr(cond, op, default, opts)            // Run if true, else default\nunlessOr(cond, op, default, opts)          // Run if false, else default\ncreateConditionalHelpers(ctx)              // Factory for bound helpers\n```\n\n## Webhook / Event Triggers\n\n```typescript\ncreateWebhookHandler(workflow, fn, config) // Create HTTP handler\ncreateSimpleHandler(config)                // Simple endpoint handler\ncreateEventHandler(workflow, fn, config)   // Queue event handler\ncreateResultMapper(mappings, options)      // Map errors to HTTP codes\ncreateExpressHandler(handler)              // Express middleware\nvalidationError(message, field, details)   // Create validation error\nrequireFields(fields)                      // Field validator\n```\n\n## Policy Middleware\n\n```typescript\nmergePolicies(...policies)          // Combine policies\ncreatePolicyApplier(...policies)    // Create policy applier\nwithPolicy(policy, options)         // Apply single policy\nwithPolicies(policies, name)        // Apply multiple policies\ncreatePolicyRegistry()              // Create policy registry\nstepOptions()                       // Fluent builder\nretryPolicies.standard              // Retry presets\ntimeoutPolicies.api                 // Timeout presets\nservicePolicies.httpApi             // Combined presets\n```\n\n## Persistence\n\n```typescript\ncreateMemoryCache(options)          // In-memory cache\ncreateFileCache(options)            // File-based cache\ncreateKVCache(options)              // Key-value store cache\ncreateStatePersistence(store, prefix)      // State persistence\ncreateHydratingCache(memory, persist, id)  // Hydrating cache\nstringifyState(state, meta)         // JSON stringify\nparseState(json)                    // JSON parse\ncreateStepCollector()               // Collect step events\n```\n\n## Versioning\n\n```typescript\nmigrateState(state, target, migrations)    // Apply migrations\ncreateVersionedStateLoader(config)         // Create loader with migrations\ncreateVersionedState(state, version)       // Wrap state with version\nparseVersionedState(json)                  // Parse from JSON\nstringifyVersionedState(state)             // Serialize to JSON\ncreateKeyRenameMigration(renames)          // Migration helper\ncreateKeyRemoveMigration(keys)             // Migration helper\ncreateValueTransformMigration(transforms)  // Migration helper\ncomposeMigrations(migrations)              // Combine migrations\n```\n\n## Devtools\n\n```typescript\ncreateDevtools(options)             // Create devtools instance\ncreateVisualizer(options)           // Create visualizer\nrenderDiff(diff)                    // Render run diff\nquickVisualize(events)              // Quick visualization\ncreateConsoleLogger(options)        // Console event logger\n```\n\n## Testing\n\n```typescript\ncreateWorkflowHarness(deps, options)       // Create test harness\ncreateMockFn\u003CT, E>()                       // Create mock function\ncreateTestClock(startTime)                 // Deterministic clock\ncreateSnapshot(invocations, result)        // Create snapshot\ncompareSnapshots(snapshot1, snapshot2)     // Compare snapshots\nokOutcome(value)                           // Helper for ok outcome\nerrOutcome(error)                          // Helper for err outcome\n```\n\n## OpenTelemetry (Autotel)\n\n```typescript\ncreateAutotelAdapter(config)        // Create metrics adapter\ncreateAutotelEventHandler(options)  // Event handler for debug\nwithAutotelTracing(trace, options)  // Wrap with tracing\n```\n\n## Types\n\n### Core Result types\n\n```typescript\nResult\u003CT, E, C>                     // { ok: true, value: T } | { ok: false, error: E, cause?: C }\nAsyncResult\u003CT, E, C>                // Promise\u003CResult\u003CT, E, C>>\nUnexpectedError                     // { type: 'UNEXPECTED_ERROR', cause: unknown }\n```\n\n### Workflow types\n\n```typescript\nWorkflow\u003CE, Deps, C>                // Non-strict workflow return type\nWorkflowStrict\u003CE, U, Deps, C>       // Strict workflow return type\nWorkflowOptions\u003CE, C>               // Options for createWorkflow\nWorkflowContext\u003CC>                  // Context: { workflowId, onEvent?, context? }\nStepOptions                         // { name?: string, key?: string }\nWorkflowEvent\u003CE, C>                 // Union of all event types\n```\n\n### Type extraction utilities\n\n```typescript\nErrorOf\u003CFn>                         // Extract error type from function\nCauseOf\u003CFn>                         // Extract cause type from function\nErrors\u003C[Fn1, Fn2, ...]>             // Union of error types from functions\nErrorsOfDeps\u003CDeps>                  // Extract errors from deps object\nExtractValue\u003CResult>                // Extract value type from Result\nExtractError\u003CResult>                // Extract error type from Result\n```\n\n### Cache & Resume types\n\n```typescript\nStepCache                           // Cache interface (get/set/has/delete/clear)\nResumeState                         // { steps: Map\u003Cstring, ResumeStateEntry> }\nResumeStateEntry                    // { result: Result, meta?: StepFailureMeta }\n```\n\n### HITL types\n\n```typescript\nPendingApproval                     // { type: 'PENDING_APPROVAL', stepKey, reason? }\nApprovalRejected                    // { type: 'APPROVAL_REJECTED', stepKey, reason? }\nApprovalStore                       // Approval storage interface\nWorkflowStateStore                  // State storage interface\n```\n\n### Circuit Breaker types\n\n```typescript\nCircuitState                        // 'CLOSED' | 'OPEN' | 'HALF_OPEN'\nCircuitBreakerConfig                // Configuration options\nCircuitBreakerStats                 // Runtime statistics\nCircuitOpenError                    // Error when circuit is open\n```\n\n### Saga types\n\n```typescript\nSagaContext\u003CE>                      // Context with step() and tryStep()\nSagaStepOptions\u003CT>                  // Step options with compensate\nSagaCompensationError               // Error with compensation details\n```\n\n### Rate Limiter types\n\n```typescript\nRateLimiterConfig                   // Rate limiter configuration\nConcurrencyLimiterConfig            // Concurrency limiter config\nRateLimitExceededError              // Error when rate exceeded\nQueueFullError                      // Error when queue full\n```\n\n### Resource types\n\n```typescript\nResource\u003CT>                         // Resource with value and release\nResourceScope                       // Scope for tracking resources\nResourceCleanupError                // Error during cleanup\n```\n\n### Testing types\n\n```typescript\nWorkflowHarness\u003CE, Deps>            // Test harness interface\nMockFunction\u003CT, E>                  // Mock function interface\nScriptedOutcome\u003CT, E>               // Scripted step outcome\nWorkflowSnapshot                    // Snapshot for comparison\n```","src/content/docs/reference/api.md","c792045634a9e82f",{"html":1329,"metadata":1330},"\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"workflows\">Workflows\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#workflows\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Workflows”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"createworkflow\">createWorkflow\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#createworkflow\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “createWorkflow”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps)                                    \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Auto-inferred error types\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, { \u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">strict\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#ADBAC7\">:\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\"> true\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, catchUnexpected }) \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Closed error union\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, { onEvent, createContext })        \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Event stream + context\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, { cache })                         \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Step caching\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, { resumeState })                   \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Resume from saved state\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Callback signatures:\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">deps\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">ctx\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> })           \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// ctx is WorkflowContext\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">workflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(args, \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">deps\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">args\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">ctx\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }) \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// With typed args\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"createWorkflow(deps)                                    // Auto-inferred error types\ncreateWorkflow(deps, { strict: true, catchUnexpected }) // Closed error union\ncreateWorkflow(deps, { onEvent, createContext })        // Event stream + context\ncreateWorkflow(deps, { cache })                         // Step caching\ncreateWorkflow(deps, { resumeState })                   // Resume from saved state\n\n// Callback signatures:\nworkflow(async (step, deps, ctx) => { ... })           // ctx is WorkflowContext\nworkflow(args, async (step, deps, args, ctx) => { ... }) // With typed args\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"step\">step\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#step\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “step”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result)                        \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Unwrap Result or exit early\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result, { name, key })         \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// With tracing/caching options\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> result)                  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Lazy form (for caching/resume)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">step\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(() \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> result, { name, key })   \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Lazy with options\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"step(result)                        // Unwrap Result or exit early\nstep(result, { name, key })         // With tracing/caching options\nstep(() => result)                  // Lazy form (for caching/resume)\nstep(() => result, { name, key })   // Lazy with options\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"steptry\">step.try\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#steptry\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “step.try”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">step.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">try\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(fn, { error })             \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Static error type\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">step.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">try\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(fn, { onError })           \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Dynamic error from caught value\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">step.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">try\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(fn, { error, name, key })  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// With tracing options\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"step.try(fn, { error })             // Static error type\nstep.try(fn, { onError })           // Dynamic error from caught value\nstep.try(fn, { error, name, key })  // With tracing options\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"low-level-run\">Low-level run\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#low-level-run\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Low-level run”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">run\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(fn)                             \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// One-off workflow\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">run\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(fn, { onError })                \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// With error callback\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">run\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(fn, { onEvent, context })       \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// With event stream\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">run.\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">strict\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(fn, { catchUnexpected }) \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Closed error union\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"run(fn)                             // One-off workflow\nrun(fn, { onError })                // With error callback\nrun(fn, { onEvent, context })       // With event stream\nrun.strict(fn, { catchUnexpected }) // Closed error union\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"results\">Results\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#results\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Results”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"constructors\">Constructors\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#constructors\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Constructors”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(value)                           \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create success\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(error)                          \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create error\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">err\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(error, { cause })               \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create error with cause\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"ok(value)                           // Create success\nerr(error)                          // Create error\nerr(error, { cause })               // Create error with cause\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"type-guards\">Type guards\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#type-guards\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Type guards”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">isOk\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result)                        \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// result is { ok: true, value }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">isErr\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result)                       \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// result is { ok: false, error }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">isUnexpectedError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(error)            \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// error is UnexpectedError\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"isOk(result)                        // result is { ok: true, value }\nisErr(result)                       // result is { ok: false, error }\nisUnexpectedError(error)            // error is UnexpectedError\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"unwrap\">Unwrap\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#unwrap\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Unwrap”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">unwrap\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result)                      \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Value or throw UnwrapError\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">unwrapOr\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result, defaultValue)      \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Value or default\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">unwrapOrElse\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result, fn)            \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Value or compute from error\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"unwrap(result)                      // Value or throw UnwrapError\nunwrapOr(result, defaultValue)      // Value or default\nunwrapOrElse(result, fn)            // Value or compute from error\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"wrap\">Wrap\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#wrap\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Wrap”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">from\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(fn)                            \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Sync throwing → Result\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">from\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(fn, onError)                   \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// With error mapper\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fromPromise\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(promise)                \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Promise → Result\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fromPromise\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(promise, onError)       \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// With error mapper\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">tryAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(fn)                        \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Async fn → Result\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">tryAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(fn, onError)               \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// With error mapper\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">fromNullable\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(value, onNull)         \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Nullable → Result\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"from(fn)                            // Sync throwing → Result\nfrom(fn, onError)                   // With error mapper\nfromPromise(promise)                // Promise → Result\nfromPromise(promise, onError)       // With error mapper\ntryAsync(fn)                        // Async fn → Result\ntryAsync(fn, onError)               // With error mapper\nfromNullable(value, onNull)         // Nullable → Result\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"transform\">Transform\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#transform\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Transform”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">map\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result, fn)                     \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Transform value\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">mapError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result, fn)                \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Transform error\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">mapTry\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result, fn, onError)         \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Transform value, catch throws\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">mapErrorTry\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result, fn, onError)    \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Transform error, catch throws\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">andThen\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result, fn)                 \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Chain (flatMap)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">match\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result, { ok, err })          \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Pattern match\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">tap\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result, fn)                     \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Side effect on success\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">tapError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(result, fn)                \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Side effect on error\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"map(result, fn)                     // Transform value\nmapError(result, fn)                // Transform error\nmapTry(result, fn, onError)         // Transform value, catch throws\nmapErrorTry(result, fn, onError)    // Transform error, catch throws\nandThen(result, fn)                 // Chain (flatMap)\nmatch(result, { ok, err })          // Pattern match\ntap(result, fn)                     // Side effect on success\ntapError(result, fn)                // Side effect on error\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"batch-operations\">Batch Operations\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#batch-operations\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Batch Operations”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">all\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(results)                        \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// All succeed (sync, short-circuits)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">allAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(results)                   \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// All succeed (async, short-circuits)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">any\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(results)                        \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// First success (sync)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">anyAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(results)                   \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// First success (async)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">allSettled\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(results)                 \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Collect all (sync)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">allSettledAsync\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(results)            \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Collect all (async)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">partition\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(results)                  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Split into { values, errors }\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"all(results)                        // All succeed (sync, short-circuits)\nallAsync(results)                   // All succeed (async, short-circuits)\nany(results)                        // First success (sync)\nanyAsync(results)                   // First success (async)\nallSettled(results)                 // Collect all (sync)\nallSettledAsync(results)            // Collect all (async)\npartition(results)                  // Split into { values, errors }\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"batch-processing\">Batch Processing\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#batch-processing\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Batch Processing”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">processInBatches\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(items, fn, config)         \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Process with bounded concurrency\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">processInBatches\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(items, fn, config, hooks)  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// With progress/checkpoint hooks\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Config\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">{ \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">batchSize\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">20\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">concurrency\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">3\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">batchDelayMs\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">50\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Hooks\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">{ \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">onProgress\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">p\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> {}, \u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">afterBatch\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">: \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> () \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\"> ok\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">undefined\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Presets\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">batchPresets.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">conservative\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">  // batchSize: 20, concurrency: 3\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">batchPresets.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">balanced\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">      // batchSize: 50, concurrency: 5\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">batchPresets.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">aggressive\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">    // batchSize: 100, concurrency: 10\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"processInBatches(items, fn, config)         // Process with bounded concurrency\nprocessInBatches(items, fn, config, hooks)  // With progress/checkpoint hooks\n\n// Config\n{ batchSize: 20, concurrency: 3, batchDelayMs: 50 }\n\n// Hooks\n{ onProgress: (p) => {}, afterBatch: async () => ok(undefined) }\n\n// Presets\nbatchPresets.conservative  // batchSize: 20, concurrency: 3\nbatchPresets.balanced      // batchSize: 50, concurrency: 5\nbatchPresets.aggressive    // batchSize: 100, concurrency: 10\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"resource-management\">Resource Management\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#resource-management\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Resource Management”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">withScope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">async\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> (\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#F69D50\">scope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">) \u003C/span>\u003Cspan style=\"--shiki-light:#A626A4;--shiki-dark:#F47067\">=>\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> { \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\"> }) \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// RAII-style resource cleanup\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createResource\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(acquire, release)    \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create reusable resource\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createResourceScope\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">()               \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Manual scope control\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">isResourceCleanupError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(error)       \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Check for cleanup failure\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"withScope(async (scope) => { ... }) // RAII-style resource cleanup\ncreateResource(acquire, release)    // Create reusable resource\ncreateResourceScope()               // Manual scope control\nisResourceCleanupError(error)       // Check for cleanup failure\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"human-in-the-loop-hitl\">Human-in-the-Loop (HITL)\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#human-in-the-loop-hitl\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Human-in-the-Loop (HITL)”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"creating-approval-steps\">Creating approval steps\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#creating-approval-steps\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Creating approval steps”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createApprovalStep\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">T\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">>(options)      \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create approval-gated step function\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// options: { key, checkApproval, pendingReason?, rejectedReason? }\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"createApprovalStep\u003CT>(options)      // Create approval-gated step function\n// options: { key, checkApproval, pendingReason?, rejectedReason? }\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"checking-approval-status\">Checking approval status\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#checking-approval-status\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Checking approval status”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">isPendingApproval\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(error)            \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// error is PendingApproval\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">isApprovalRejected\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(error)           \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// error is ApprovalRejected\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">pendingApproval\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(stepKey, options\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">?\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">)  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create PendingApproval error\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"isPendingApproval(error)            // error is PendingApproval\nisApprovalRejected(error)           // error is ApprovalRejected\npendingApproval(stepKey, options?)  // Create PendingApproval error\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"managing-approval-state\">Managing approval state\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#managing-approval-state\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Managing approval state”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createHITLCollector\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">()               \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Collect step events for resume\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">injectApproval\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(state, { stepKey, value })  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Add approval to resume state\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">clearStep\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(state, stepKey)           \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Remove step from resume state\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">hasPendingApproval\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(state, stepKey)  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Check if step is pending\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">getPendingApprovals\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(state)          \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Get all pending step keys\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"createHITLCollector()               // Collect step events for resume\ninjectApproval(state, { stepKey, value })  // Add approval to resume state\nclearStep(state, stepKey)           // Remove step from resume state\nhasPendingApproval(state, stepKey)  // Check if step is pending\ngetPendingApprovals(state)          // Get all pending step keys\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"circuit-breaker\">Circuit Breaker\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#circuit-breaker\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Circuit Breaker”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createCircuitBreaker\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(name, config)  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create circuit breaker instance\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">isCircuitOpenError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(error)           \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Check if error is circuit open\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">circuitBreakerPresets.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">critical\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">      // Preset configurations\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">circuitBreakerPresets.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">lenient\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"createCircuitBreaker(name, config)  // Create circuit breaker instance\nisCircuitOpenError(error)           // Check if error is circuit open\ncircuitBreakerPresets.critical      // Preset configurations\ncircuitBreakerPresets.lenient\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"saga--compensation\">Saga / Compensation\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#saga--compensation\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Saga / Compensation”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createSagaWorkflow\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, options)   \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create saga with auto-inferred errors\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">runSaga\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(fn, options)                \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Low-level saga execution\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">isSagaCompensationError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(error)      \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Check for compensation failure\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"createSagaWorkflow(deps, options)   // Create saga with auto-inferred errors\nrunSaga(fn, options)                // Low-level saga execution\nisSagaCompensationError(error)      // Check for compensation failure\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"rate-limiting\">Rate Limiting\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#rate-limiting\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Rate Limiting”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createRateLimiter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(name, config)     \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Token bucket rate limiter\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createConcurrencyLimiter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(name, cfg) \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Concurrent execution limiter\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createCombinedLimiter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(name, config) \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Rate + concurrency combined\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">rateLimiterPresets.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">api\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">              // Preset configurations\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">isRateLimitExceededError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(error)     \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Check if rate limited\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">isQueueFullError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(error)             \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Check if queue full\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"createRateLimiter(name, config)     // Token bucket rate limiter\ncreateConcurrencyLimiter(name, cfg) // Concurrent execution limiter\ncreateCombinedLimiter(name, config) // Rate + concurrency combined\nrateLimiterPresets.api              // Preset configurations\nisRateLimitExceededError(error)     // Check if rate limited\nisQueueFullError(error)             // Check if queue full\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"conditional-execution\">Conditional Execution\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#conditional-execution\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Conditional Execution”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">when\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(condition, operation, opts)           \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Run if true\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">unless\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(condition, operation, opts)         \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Run if false\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">whenOr\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(cond, op, default, opts)            \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Run if true, else default\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">unlessOr\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(cond, op, default, opts)          \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Run if false, else default\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createConditionalHelpers\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(ctx)              \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Factory for bound helpers\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"when(condition, operation, opts)           // Run if true\nunless(condition, operation, opts)         // Run if false\nwhenOr(cond, op, default, opts)            // Run if true, else default\nunlessOr(cond, op, default, opts)          // Run if false, else default\ncreateConditionalHelpers(ctx)              // Factory for bound helpers\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"webhook--event-triggers\">Webhook / Event Triggers\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#webhook--event-triggers\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Webhook / Event Triggers”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createWebhookHandler\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(workflow, fn, config) \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create HTTP handler\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createSimpleHandler\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(config)                \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Simple endpoint handler\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createEventHandler\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(workflow, fn, config)   \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Queue event handler\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createResultMapper\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(mappings, options)      \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Map errors to HTTP codes\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createExpressHandler\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(handler)              \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Express middleware\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">validationError\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(message, field, details)   \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create validation error\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">requireFields\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(fields)                      \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Field validator\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"createWebhookHandler(workflow, fn, config) // Create HTTP handler\ncreateSimpleHandler(config)                // Simple endpoint handler\ncreateEventHandler(workflow, fn, config)   // Queue event handler\ncreateResultMapper(mappings, options)      // Map errors to HTTP codes\ncreateExpressHandler(handler)              // Express middleware\nvalidationError(message, field, details)   // Create validation error\nrequireFields(fields)                      // Field validator\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"policy-middleware\">Policy Middleware\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#policy-middleware\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Policy Middleware”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">mergePolicies\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">policies)          \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Combine policies\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createPolicyApplier\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">policies)    \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create policy applier\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">withPolicy\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(policy, options)         \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Apply single policy\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">withPolicies\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(policies, name)        \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Apply multiple policies\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createPolicyRegistry\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">()              \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create policy registry\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">stepOptions\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">()                       \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Fluent builder\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">retryPolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">standard\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">              // Retry presets\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">timeoutPolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">api\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">                 // Timeout presets\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">servicePolicies.\u003C/span>\u003Cspan style=\"--shiki-light:#E45649;--shiki-dark:#ADBAC7\">httpApi\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">             // Combined presets\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"mergePolicies(...policies)          // Combine policies\ncreatePolicyApplier(...policies)    // Create policy applier\nwithPolicy(policy, options)         // Apply single policy\nwithPolicies(policies, name)        // Apply multiple policies\ncreatePolicyRegistry()              // Create policy registry\nstepOptions()                       // Fluent builder\nretryPolicies.standard              // Retry presets\ntimeoutPolicies.api                 // Timeout presets\nservicePolicies.httpApi             // Combined presets\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"persistence\">Persistence\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#persistence\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Persistence”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createMemoryCache\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(options)          \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// In-memory cache\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createFileCache\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(options)            \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// File-based cache\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createKVCache\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(options)              \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Key-value store cache\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createStatePersistence\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(store, prefix)      \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// State persistence\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createHydratingCache\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(memory, persist, id)  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Hydrating cache\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">stringifyState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(state, meta)         \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// JSON stringify\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">parseState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(json)                    \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// JSON parse\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createStepCollector\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">()               \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Collect step events\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"createMemoryCache(options)          // In-memory cache\ncreateFileCache(options)            // File-based cache\ncreateKVCache(options)              // Key-value store cache\ncreateStatePersistence(store, prefix)      // State persistence\ncreateHydratingCache(memory, persist, id)  // Hydrating cache\nstringifyState(state, meta)         // JSON stringify\nparseState(json)                    // JSON parse\ncreateStepCollector()               // Collect step events\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"versioning\">Versioning\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#versioning\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Versioning”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">migrateState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(state, target, migrations)    \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Apply migrations\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createVersionedStateLoader\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(config)         \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create loader with migrations\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createVersionedState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(state, version)       \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Wrap state with version\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">parseVersionedState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(json)                  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Parse from JSON\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">stringifyVersionedState\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(state)             \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Serialize to JSON\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createKeyRenameMigration\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(renames)          \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Migration helper\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createKeyRemoveMigration\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(keys)             \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Migration helper\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createValueTransformMigration\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(transforms)  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Migration helper\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">composeMigrations\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(migrations)              \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Combine migrations\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"migrateState(state, target, migrations)    // Apply migrations\ncreateVersionedStateLoader(config)         // Create loader with migrations\ncreateVersionedState(state, version)       // Wrap state with version\nparseVersionedState(json)                  // Parse from JSON\nstringifyVersionedState(state)             // Serialize to JSON\ncreateKeyRenameMigration(renames)          // Migration helper\ncreateKeyRemoveMigration(keys)             // Migration helper\ncreateValueTransformMigration(transforms)  // Migration helper\ncomposeMigrations(migrations)              // Combine migrations\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"devtools\">Devtools\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#devtools\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Devtools”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createDevtools\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(options)             \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create devtools instance\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createVisualizer\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(options)           \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create visualizer\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">renderDiff\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(diff)                    \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Render run diff\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">quickVisualize\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(events)              \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Quick visualization\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createConsoleLogger\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(options)        \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Console event logger\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"createDevtools(options)             // Create devtools instance\ncreateVisualizer(options)           // Create visualizer\nrenderDiff(diff)                    // Render run diff\nquickVisualize(events)              // Quick visualization\ncreateConsoleLogger(options)        // Console event logger\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"testing\">Testing\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#testing\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Testing”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createWorkflowHarness\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(deps, options)       \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create test harness\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createMockFn\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">T\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#C18401;--shiki-dark:#F69D50\">E\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">>()                       \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create mock function\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createTestClock\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(startTime)                 \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Deterministic clock\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createSnapshot\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(invocations, result)        \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create snapshot\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">compareSnapshots\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(snapshot1, snapshot2)     \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Compare snapshots\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">okOutcome\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(value)                           \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Helper for ok outcome\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">errOutcome\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(error)                          \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Helper for err outcome\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"createWorkflowHarness(deps, options)       // Create test harness\ncreateMockFn\u003CT, E>()                       // Create mock function\ncreateTestClock(startTime)                 // Deterministic clock\ncreateSnapshot(invocations, result)        // Create snapshot\ncompareSnapshots(snapshot1, snapshot2)     // Compare snapshots\nokOutcome(value)                           // Helper for ok outcome\nerrOutcome(error)                          // Helper for err outcome\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"opentelemetry-autotel\">OpenTelemetry (Autotel)\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#opentelemetry-autotel\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “OpenTelemetry (Autotel)”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createAutotelAdapter\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(config)        \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Create metrics adapter\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">createAutotelEventHandler\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(options)  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Event handler for debug\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#4078F2;--shiki-dark:#DCBDFB\">withAutotelTracing\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">(trace, options)  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Wrap with tracing\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"createAutotelAdapter(config)        // Create metrics adapter\ncreateAutotelEventHandler(options)  // Event handler for debug\nwithAutotelTracing(trace, options)  // Wrap with tracing\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h2\">\u003Ch2 id=\"types\">Types\u003C/h2>\u003Ca class=\"sl-anchor-link\" href=\"#types\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Types”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"core-result-types\">Core Result types\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#core-result-types\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Core Result types”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">Result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">T\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">E\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">C\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">                     // { ok: true, value: T } | { ok: false, error: E, cause?: C }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">AsyncResult\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">T\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">E\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">C\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">                // Promise&#x3C;Result&#x3C;T, E, C>>\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">UnexpectedError                     \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// { type: 'UNEXPECTED_ERROR', cause: unknown }\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"Result\u003CT, E, C>                     // { ok: true, value: T } | { ok: false, error: E, cause?: C }\nAsyncResult\u003CT, E, C>                // Promise\u003CResult\u003CT, E, C>>\nUnexpectedError                     // { type: &#x27;UNEXPECTED_ERROR&#x27;, cause: unknown }\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"workflow-types\">Workflow types\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#workflow-types\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Workflow types”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">Workflow\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">E\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, Deps, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">C\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">                // Non-strict workflow return type\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">WorkflowStrict\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">E\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">U\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, Deps, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">C\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">       // Strict workflow return type\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">WorkflowOptions\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">E\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">C\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">               // Options for createWorkflow\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">WorkflowContext\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">C\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">                  // Context: { workflowId, onEvent?, context? }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">StepOptions                         \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// { name?: string, key?: string }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">WorkflowEvent\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">E\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">C\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">                 // Union of all event types\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"Workflow\u003CE, Deps, C>                // Non-strict workflow return type\nWorkflowStrict\u003CE, U, Deps, C>       // Strict workflow return type\nWorkflowOptions\u003CE, C>               // Options for createWorkflow\nWorkflowContext\u003CC>                  // Context: { workflowId, onEvent?, context? }\nStepOptions                         // { name?: string, key?: string }\nWorkflowEvent\u003CE, C>                 // Union of all event types\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"type-extraction-utilities\">Type extraction utilities\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#type-extraction-utilities\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Type extraction utilities”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">ErrorOf\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">Fn\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">                         // Extract error type from function\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">CauseOf\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">Fn\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">                         // Extract cause type from function\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">Errors\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">[Fn1, Fn2, \u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">...\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">]\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">             // Union of error types from functions\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">ErrorsOfDeps\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">Deps\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">                  // Extract errors from deps object\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">ExtractValue\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">Result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">                // Extract value type from Result\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">ExtractError\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">Result\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">                // Extract error type from Result\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"ErrorOf\u003CFn>                         // Extract error type from function\nCauseOf\u003CFn>                         // Extract cause type from function\nErrors\u003C[Fn1, Fn2, ...]>             // Union of error types from functions\nErrorsOfDeps\u003CDeps>                  // Extract errors from deps object\nExtractValue\u003CResult>                // Extract value type from Result\nExtractError\u003CResult>                // Extract error type from Result\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"cache--resume-types\">Cache &#x26; Resume types\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#cache--resume-types\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Cache &#x26; Resume types”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">StepCache                           \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Cache interface (get/set/has/delete/clear)\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">ResumeState                         \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// { steps: Map&#x3C;string, ResumeStateEntry> }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">ResumeStateEntry                    \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// { result: Result, meta?: StepFailureMeta }\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"StepCache                           // Cache interface (get/set/has/delete/clear)\nResumeState                         // { steps: Map\u003Cstring, ResumeStateEntry> }\nResumeStateEntry                    // { result: Result, meta?: StepFailureMeta }\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"hitl-types\">HITL types\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#hitl-types\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “HITL types”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">PendingApproval                     \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// { type: 'PENDING_APPROVAL', stepKey, reason? }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">ApprovalRejected                    \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// { type: 'APPROVAL_REJECTED', stepKey, reason? }\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">ApprovalStore                       \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Approval storage interface\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">WorkflowStateStore                  \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// State storage interface\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"PendingApproval                     // { type: &#x27;PENDING_APPROVAL&#x27;, stepKey, reason? }\nApprovalRejected                    // { type: &#x27;APPROVAL_REJECTED&#x27;, stepKey, reason? }\nApprovalStore                       // Approval storage interface\nWorkflowStateStore                  // State storage interface\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"circuit-breaker-types\">Circuit Breaker types\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#circuit-breaker-types\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Circuit Breaker types”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">CircuitState                        \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// 'CLOSED' | 'OPEN' | 'HALF_OPEN'\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">CircuitBreakerConfig                \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Configuration options\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">CircuitBreakerStats                 \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Runtime statistics\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">CircuitOpenError                    \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Error when circuit is open\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"CircuitState                        // &#x27;CLOSED&#x27; | &#x27;OPEN&#x27; | &#x27;HALF_OPEN&#x27;\nCircuitBreakerConfig                // Configuration options\nCircuitBreakerStats                 // Runtime statistics\nCircuitOpenError                    // Error when circuit is open\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"saga-types\">Saga types\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#saga-types\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Saga types”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">SagaContext\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">E\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">                      // Context with step() and tryStep()\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">SagaStepOptions\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">T\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">                  // Step options with compensate\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">SagaCompensationError               \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Error with compensation details\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"SagaContext\u003CE>                      // Context with step() and tryStep()\nSagaStepOptions\u003CT>                  // Step options with compensate\nSagaCompensationError               // Error with compensation details\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"rate-limiter-types\">Rate Limiter types\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#rate-limiter-types\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Rate Limiter types”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">RateLimiterConfig                   \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Rate limiter configuration\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">ConcurrencyLimiterConfig            \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Concurrency limiter config\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">RateLimitExceededError              \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Error when rate exceeded\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">QueueFullError                      \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Error when queue full\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"RateLimiterConfig                   // Rate limiter configuration\nConcurrencyLimiterConfig            // Concurrency limiter config\nRateLimitExceededError              // Error when rate exceeded\nQueueFullError                      // Error when queue full\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"resource-types\">Resource types\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#resource-types\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Resource types”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">Resource\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">T\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">                         // Resource with value and release\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">ResourceScope                       \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Scope for tracking resources\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">ResourceCleanupError                \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Error during cleanup\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"Resource\u003CT>                         // Resource with value and release\nResourceScope                       // Scope for tracking resources\nResourceCleanupError                // Error during cleanup\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>\n\u003Cdiv class=\"sl-heading-wrapper level-h3\">\u003Ch3 id=\"testing-types\">Testing types\u003C/h3>\u003Ca class=\"sl-anchor-link\" href=\"#testing-types\">\u003Cspan aria-hidden=\"true\" class=\"sl-anchor-icon\">\u003Csvg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\">\u003Cpath fill=\"currentcolor\" d=\"m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z\">\u003C/path>\u003C/svg>\u003C/span>\u003Cspan class=\"sr-only\">Section titled “Testing types”\u003C/span>\u003C/a>\u003C/div>\n\u003Cdiv data-nova-code-container=\"\" class=\"not-content relative overflow-hidden [&#x26;_pre]:relative [&#x26;_nova-code-copy-button]:opacity-0 [&#x26;:hover_nova-code-copy-button]:opacity-100 border border-solid border-(--sl-color-gray-5) rounded-md\">\u003Cpre class=\"astro-code astro-code-themes one-light github-dark-dimmed\" style=\"--shiki-light:#383A42;--shiki-dark:#adbac7;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#22272e; overflow-x: auto;\" tabindex=\"0\" data-language=\"typescript\" dir=\"ltr\">\u003Ccode>\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">WorkflowHarness\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">E\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, Deps\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">            // Test harness interface\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">MockFunction\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">T\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">E\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">                  // Mock function interface\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">ScriptedOutcome\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">&#x3C;\u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">T\u003C/span>\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">, \u003C/span>\u003Cspan style=\"--shiki-light:#986801;--shiki-dark:#6CB6FF\">E\u003C/span>\u003Cspan style=\"--shiki-light:#0184BC;--shiki-dark:#F47067\">>\u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">               // Scripted step outcome\u003C/span>\u003C/span>\n\u003Cspan class=\"line\">\u003Cspan style=\"--shiki-light:#383A42;--shiki-dark:#ADBAC7\">WorkflowSnapshot                    \u003C/span>\u003Cspan style=\"--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#768390;--shiki-dark-font-style:inherit\">// Snapshot for comparison\u003C/span>\u003C/span>\u003C/code>\u003C/pre>\u003Cnova-code-copy-button type=\"button\" data-code=\"WorkflowHarness\u003CE, Deps>            // Test harness interface\nMockFunction\u003CT, E>                  // Mock function interface\nScriptedOutcome\u003CT, E>               // Scripted step outcome\nWorkflowSnapshot                    // Snapshot for comparison\" title=\"Copy code\" aria-label=\"Copy code\" class=\"absolute top-2 right-2 m-0 size-6 rounded border border-solid border-(--sl-color-gray-5) bg-gray-100/30 p-1 text-black backdrop-blur-sm transition hover:bg-gray-200/50 active:scale-90 dark:bg-gray-600/30 dark:text-white hover:dark:bg-gray-500/50\">\u003C/nova-code-copy-button>\u003C/div>",{"headings":1331,"localImagePaths":1434,"remoteImagePaths":1435,"frontmatter":1436,"imagePaths":1437},[1332,1334,1335,1337,1340,1343,1345,1348,1349,1352,1355,1358,1360,1362,1364,1367,1370,1373,1376,1378,1380,1382,1384,1387,1390,1392,1395,1396,1398,1401,1404,1407,1410,1413,1416,1419,1422,1425,1428,1431],{"depth":57,"slug":1333,"text":524},"workflows",{"depth":160,"slug":537,"text":538},{"depth":160,"slug":1336,"text":1336},"step",{"depth":160,"slug":1338,"text":1339},"steptry","step.try",{"depth":160,"slug":1341,"text":1342},"low-level-run","Low-level run",{"depth":57,"slug":1344,"text":393},"results",{"depth":160,"slug":1346,"text":1347},"constructors","Constructors",{"depth":160,"slug":412,"text":413},{"depth":57,"slug":1350,"text":1351},"unwrap","Unwrap",{"depth":57,"slug":1353,"text":1354},"wrap","Wrap",{"depth":57,"slug":1356,"text":1357},"transform","Transform",{"depth":57,"slug":258,"text":1359},"Batch Operations",{"depth":57,"slug":1361,"text":652},"batch-processing",{"depth":57,"slug":1363,"text":1237},"resource-management",{"depth":57,"slug":1365,"text":1366},"human-in-the-loop-hitl","Human-in-the-Loop (HITL)",{"depth":160,"slug":1368,"text":1369},"creating-approval-steps","Creating approval steps",{"depth":160,"slug":1371,"text":1372},"checking-approval-status","Checking approval status",{"depth":160,"slug":1374,"text":1375},"managing-approval-state","Managing approval state",{"depth":57,"slug":1377,"text":88},"circuit-breaker",{"depth":57,"slug":1379,"text":43},"saga--compensation",{"depth":57,"slug":1381,"text":235},"rate-limiting",{"depth":57,"slug":1383,"text":695},"conditional-execution",{"depth":57,"slug":1385,"text":1386},"webhook--event-triggers","Webhook / Event Triggers",{"depth":57,"slug":1388,"text":1389},"policy-middleware","Policy Middleware",{"depth":57,"slug":1391,"text":872},"persistence",{"depth":57,"slug":1393,"text":1394},"versioning","Versioning",{"depth":57,"slug":1011,"text":1012},{"depth":57,"slug":1397,"text":1104},"testing",{"depth":57,"slug":1399,"text":1400},"opentelemetry-autotel","OpenTelemetry (Autotel)",{"depth":57,"slug":1402,"text":1403},"types","Types",{"depth":160,"slug":1405,"text":1406},"core-result-types","Core Result types",{"depth":160,"slug":1408,"text":1409},"workflow-types","Workflow types",{"depth":160,"slug":1411,"text":1412},"type-extraction-utilities","Type extraction utilities",{"depth":160,"slug":1414,"text":1415},"cache--resume-types","Cache & Resume types",{"depth":160,"slug":1417,"text":1418},"hitl-types","HITL types",{"depth":160,"slug":1420,"text":1421},"circuit-breaker-types","Circuit Breaker types",{"depth":160,"slug":1423,"text":1424},"saga-types","Saga types",{"depth":160,"slug":1426,"text":1427},"rate-limiter-types","Rate Limiter types",{"depth":160,"slug":1429,"text":1430},"resource-types","Resource types",{"depth":160,"slug":1432,"text":1433},"testing-types","Testing types",[],[],{"title":1320,"description":1321},[]]